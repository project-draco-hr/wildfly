{
  deployer.deploy(BUNDLE_DEPLOYMENT_NAME);
  Bundle bundle=FrameworkUtils.getDeployedBundle(context,BUNDLE_DEPLOYMENT_NAME,null);
  bundle.start();
  assertEquals(Bundle.ACTIVE,bundle.getState());
  bundle.stop();
  assertEquals(Bundle.RESOLVED,bundle.getState());
  final CountDownLatch uninstallLatch=new CountDownLatch(1);
  context.addBundleListener(new BundleListener(){
    public void bundleChanged(    BundleEvent event){
      if (event.getType() == BundleEvent.UNINSTALLED)       uninstallLatch.countDown();
    }
  }
);
  deployer.undeploy(BUNDLE_DEPLOYMENT_NAME);
  if (uninstallLatch.await(1000,TimeUnit.MILLISECONDS) == false)   fail("UNINSTALLED event not received");
  assertEquals(Bundle.UNINSTALLED,bundle.getState());
}
