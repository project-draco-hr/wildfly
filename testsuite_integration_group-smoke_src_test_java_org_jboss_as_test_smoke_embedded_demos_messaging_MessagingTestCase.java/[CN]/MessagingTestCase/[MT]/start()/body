{
  System.out.println("CLASSLOADER " + this.getClass().getClassLoader());
  if (!isInContainer()) {
    return;
  }
  sf=HornetQClient.createServerLocatorWithoutHA(new TransportConfiguration(InVMConnectorFactory.class.getName())).createSessionFactory();
  ClientSession coreSession=sf.createSession(false,true,true);
  coreSession.createQueue(QUEUE_EXAMPLE_QUEUE,QUEUE_EXAMPLE_QUEUE,true);
  coreSession.close();
  session=sf.createSession();
  consumer=session.createConsumer(QUEUE_EXAMPLE_QUEUE);
  session.start();
  new Thread(new Runnable(){
    @Override public void run(){
      while (!shutdown.get()) {
        try {
          ClientMessage message=consumer.receive(500);
          if (message == null) {
            continue;
          }
          String s=message.getStringProperty(BODY);
          log.info("-----> Received: " + s);
          receivedMessage=s;
          latch.countDown();
        }
 catch (        HornetQException e) {
          log.error("Exception, closing receiver",e);
        }
      }
    }
  }
).start();
  log.info("-----> Started queue and session");
}
