{
  KernelServices legacy=kernelServices.getLegacyServices(modelVersion);
  ModelNode legacyModel=legacy.readWholeModel();
  ModelNode legacySubsystem=legacyModel.require(SUBSYSTEM);
  legacySubsystem=legacySubsystem.require(mainSubsystemName);
  if (legacyModelFixer != null) {
    legacySubsystem=legacyModelFixer.fixModel(legacySubsystem);
  }
  ModelNode transformed=kernelServices.readTransformedModel(modelVersion).get(SUBSYSTEM,mainSubsystemName);
  ModelTestUtils.compare(legacySubsystem,transformed,true);
  ResourceDefinition rd=TransformerRegistry.loadSubsystemDefinition(mainSubsystemName,modelVersion);
  ManagementResourceRegistration rr=ManagementResourceRegistration.Factory.create(rd);
  checkModelAgainstDefinition(transformed,rr);
  return legacyModel;
}
