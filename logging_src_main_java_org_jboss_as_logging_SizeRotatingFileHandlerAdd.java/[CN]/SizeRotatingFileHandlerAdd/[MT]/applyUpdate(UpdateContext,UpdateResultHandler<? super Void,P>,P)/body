{
  try {
    final BatchBuilder batchBuilder=updateContext.getBatchBuilder();
    final SizeRotatingFileHandlerService service=new SizeRotatingFileHandlerService();
    final ServiceBuilder<Handler> serviceBuilder=batchBuilder.addService(LogServices.handlerName(getName()),service);
    final String relativeTo=getRelativeTo();
    if (relativeTo != null) {
      serviceBuilder.addDependency(AbstractPathService.pathNameOf(relativeTo),String.class,service.getRelativeToInjector());
    }
    service.setLevel(Level.parse(getLevelName()));
    final Boolean autoFlush=getAutoflush();
    if (autoFlush != null)     service.setAutoflush(autoFlush.booleanValue());
    try {
      service.setEncoding(getEncoding());
    }
 catch (    UnsupportedEncodingException e) {
      handler.handleFailure(e,param);
      return;
    }
    try {
      service.setPath(getPath());
    }
 catch (    FileNotFoundException e) {
      handler.handleFailure(e,param);
      return;
    }
    service.setFormatterSpec(getFormatter());
    service.setMaxBackupIndex(maxBackupIndex);
    service.setRotateSize(rotateSize);
    serviceBuilder.setInitialMode(ServiceController.Mode.ACTIVE);
    serviceBuilder.addListener(new UpdateResultHandler.ServiceStartListener<P>(handler,param));
  }
 catch (  Throwable t) {
    handler.handleFailure(t,param);
  }
}
