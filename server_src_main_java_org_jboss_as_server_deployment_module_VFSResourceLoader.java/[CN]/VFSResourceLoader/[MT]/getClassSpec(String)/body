{
  final VirtualFile file=root.getChild(name);
  if (!file.exists()) {
    return null;
  }
  final long size=file.getSize();
  final ClassSpec spec=new ClassSpec();
  final InputStream is=file.openStream();
  try {
    if (size <= (long)Integer.MAX_VALUE) {
      final int castSize=(int)size;
      byte[] bytes=new byte[castSize];
      int a=0, res;
      while ((res=is.read(bytes,a,castSize - a)) > 0) {
        a+=res;
      }
      is.close();
      spec.setBytes(bytes);
      spec.setCodeSource(new CodeSource(rootUrl,(CodeSigner[])null));
      return spec;
    }
 else {
      throw new IOException("Resource is too large to be a valid class file");
    }
  }
  finally {
    VFSUtils.safeClose(is);
  }
}
