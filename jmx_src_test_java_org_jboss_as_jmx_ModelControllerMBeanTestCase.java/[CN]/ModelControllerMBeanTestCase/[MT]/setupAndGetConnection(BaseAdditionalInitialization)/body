{
  String subsystemXml="<subsystem xmlns=\"" + Namespace.CURRENT.getUriString() + "\">"+ "<expose-resolved-model domain-name=\"jboss.resolved\"/>"+ "<expose-expression-model/>"+ "<remoting-connector/>"+ "</subsystem>"+ additionalInitialization.getExtraXml();
  createKernelServicesBuilder(additionalInitialization).setSubsystemXml(subsystemXml).build();
  String host="localhost";
  int port=12345;
  String urlString=System.getProperty("jmx.service.url","service:jmx:remoting-jmx://" + host + ":"+ port);
  JMXServiceURL serviceURL=new JMXServiceURL(urlString);
  long end=System.currentTimeMillis() + 10000;
  while (true) {
    try {
      JMXConnector jmxConnector=JMXConnectorFactory.connect(serviceURL,null);
      return jmxConnector.getMBeanServerConnection();
    }
 catch (    Exception e) {
      if (System.currentTimeMillis() >= end) {
        throw new RuntimeException(e);
      }
      Thread.sleep(50);
    }
  }
}
