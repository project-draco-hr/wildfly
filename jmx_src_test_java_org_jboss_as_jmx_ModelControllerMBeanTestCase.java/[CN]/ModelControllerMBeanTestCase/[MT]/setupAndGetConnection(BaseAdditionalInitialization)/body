{
  if (additionalInitialization == null) {
    additionalInitialization=new BaseAdditionalInitialization();
  }
  String subsystemXml="<subsystem xmlns=\"" + Namespace.CURRENT.getUriString() + "\" show-model=\"true\">"+ "    <jmx-connector registry-binding=\"registry\" server-binding=\"server\" />"+ "</subsystem>"+ additionalInitialization.getExtraXml();
  KernelServices services=super.installInController(additionalInitialization,subsystemXml);
  String host="localhost";
  int port=12345;
  String urlString=System.getProperty("jmx.service.url","service:jmx:rmi:///jndi/rmi://" + host + ":"+ port+ "/jmxrmi");
  JMXServiceURL serviceURL=new JMXServiceURL(urlString);
  long end=System.currentTimeMillis() + 10000;
  while (true) {
    try {
      JMXConnector jmxConnector=JMXConnectorFactory.connect(serviceURL,null);
      return jmxConnector.getMBeanServerConnection();
    }
 catch (    Exception e) {
      if (System.currentTimeMillis() >= end) {
        throw new RuntimeException(e);
      }
      Thread.sleep(50);
    }
  }
}
