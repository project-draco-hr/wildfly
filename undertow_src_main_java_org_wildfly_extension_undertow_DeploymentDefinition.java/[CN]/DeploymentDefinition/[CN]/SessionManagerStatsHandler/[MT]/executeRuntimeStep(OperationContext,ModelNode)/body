{
  final PathAddress address=PathAddress.pathAddress(operation.get(ModelDescriptionConstants.OP_ADDR));
  final Resource web=context.readResourceFromRoot(address.subAddress(0,address.size()),false);
  final ModelNode subModel=web.getModel();
  final String host=VIRTUAL_HOST.resolveModelAttribute(context,subModel).asString();
  final String path=CONTEXT_ROOT.resolveModelAttribute(context,subModel).asString();
  final String server=SERVER.resolveModelAttribute(context,subModel).asString();
  final ServiceController<?> controller=context.getServiceRegistry(false).getService(UndertowService.deploymentServiceName(server,host,path));
  final UndertowDeploymentService deploymentService=(UndertowDeploymentService)controller.getService();
  Deployment deployment=deploymentService.getDeployment();
  SessionManager sessionManager=deployment.getSessionManager();
  SessionStat stat=SessionStat.getStat(operation.require(ModelDescriptionConstants.NAME).asString());
  if (stat == null) {
    context.getFailureDescription().set(UndertowLogger.ROOT_LOGGER.unknownMetric(operation.require(ModelDescriptionConstants.NAME).asString()));
  }
 else {
    ModelNode result=new ModelNode();
switch (stat) {
case ACTIVE_SESSIONS:
      result.set(sessionManager.getActiveSessions().size());
    break;
case SESSIONS_CREATED:
  result.set(sessionManager.getAllSessions().size());
break;
default :
throw new IllegalStateException(UndertowLogger.ROOT_LOGGER.unknownMetric(stat));
}
context.getResult().set(result);
}
context.stepCompleted();
}
