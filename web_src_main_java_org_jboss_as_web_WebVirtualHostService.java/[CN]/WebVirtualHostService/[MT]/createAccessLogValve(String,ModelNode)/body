{
  boolean extended=element.get(Constants.EXTENDED).asBoolean(false);
  String pattern=null;
  if (element.hasDefined(Constants.PATTERN)) {
    pattern=element.get(Constants.PATTERN).asString();
  }
  final AccessLogValve log;
  if (extended) {
    log=new ExtendedAccessLogValve();
  }
 else {
    log=new AccessLogValve();
  }
  log.setDirectory(logDirectory);
  if (element.hasDefined(Constants.RESOLVE_HOSTS))   log.setResolveHosts(element.get(Constants.RESOLVE_HOSTS).asBoolean());
  if (element.hasDefined(Constants.ROTATE))   log.setRotatable(element.get(Constants.ROTATE).asBoolean());
  if (pattern != null) {
    log.setPattern(pattern);
  }
 else {
    if (extended) {
      log.setPattern("time cs-method cs-uri sc-status sc(Referer)");
    }
 else {
      log.setPattern("common");
    }
  }
  if (element.hasDefined(Constants.PREFIX))   log.setPrefix(element.get(Constants.PREFIX).asString());
  return log;
}
