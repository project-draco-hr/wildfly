{
  if (className.equals(endpointClass)) {
    if (!isEjb3Endpoint) {
      final ServiceName endpointComponentName=getEndpointComponentServiceName();
      final BasicComponent endpointComponent=getComponentController(endpointComponentName).getValue();
      final ComponentInstance endpointComponentInstance=endpointComponent.createInstance(delegate.getInstance(className));
      return endpointComponentInstance.getInstance();
    }
  }
 else {
    final ServiceName handlerComponentName=getHandlerComponentServiceName(className);
    final ServiceController<BasicComponent> handlerComponentController=getComponentController(handlerComponentName);
    if (handlerComponentController != null) {
      final BasicComponent handlerComponent=handlerComponentController.getValue();
      final ComponentInstance handlerComponentInstance=handlerComponent.createInstance(delegate.getInstance(className));
      return handlerComponentInstance.getInstance();
    }
  }
  return delegate.getInstance(className);
}
