{
  String relatedEntityName=metadata.getRelatedRole().getEntity().getName();
  Catalog catalog=manager.getCatalog();
  relatedEntity=(JDBCEntityBridge)catalog.getEntityByEJBName(relatedEntityName);
  if (relatedEntity == null) {
    throw CmpMessages.MESSAGES.relatedEntityNotFound(getEntity().getEntityName(),getFieldName(),relatedEntityName);
  }
  JDBCCMRFieldBridge[] cmrFields=(JDBCCMRFieldBridge[])relatedEntity.getCMRFields();
  for (int i=0; i < cmrFields.length; ++i) {
    JDBCCMRFieldBridge cmrField=cmrFields[i];
    if (metadata.getRelatedRole() == cmrField.getMetaData()) {
      relatedCMRField=cmrField;
      break;
    }
  }
  if (relatedCMRField == null) {
    throw MESSAGES.relatedCmrFieldNotFound(relatedEntityName,entity.getEntityName(),getFieldName() != null ? getFieldName() : "<no-field>",relatedEntityName,metadata.getRelatedRole().getCMRFieldName() != null ? metadata.getRelatedRole().getCMRFieldName() : "<no-field>");
  }
  relatedManager=(JDBCStoreManager)relatedEntity.getManager();
  CmpEntityBeanComponent relatedComponent=relatedManager.getComponent();
  this.relatedContainerRef=new WeakReference<CmpEntityBeanComponent>(relatedComponent);
  Class homeClass=(relatedComponent.getLocalHomeClass() != null ? relatedComponent.getLocalHomeClass() : relatedComponent.getHomeClass());
  try {
    relatedFindByPrimaryKey=homeClass.getMethod("findByPrimaryKey",new Class[]{relatedEntity.getPrimaryKeyClass()});
  }
 catch (  Exception e) {
    throw CmpMessages.MESSAGES.findByPrimaryKeyNotFound(relatedEntity.getPrimaryKeyClass().getName(),homeClass.getName());
  }
  if (metadata.getRelationMetaData().isTableMappingStyle()) {
    Collection tableKeys=metadata.getKeyFields();
    List keyFieldsList=new ArrayList(tableKeys.size());
    Map pkFieldsToFKFields=new HashMap(tableKeys.size());
    for (Iterator i=tableKeys.iterator(); i.hasNext(); ) {
      JDBCCMPFieldMetaData cmpFieldMetaData=(JDBCCMPFieldMetaData)i.next();
      FieldBridge pkField=entity.getFieldByName(cmpFieldMetaData.getFieldName());
      if (pkField == null) {
        throw MESSAGES.pkNotFoundForKeyField(cmpFieldMetaData.getFieldName());
      }
      pkFieldsToFKFields.put(pkField,new JDBCCMP2xFieldBridge(manager,cmpFieldMetaData));
    }
    JDBCFieldBridge[] pkFields=entity.getPrimaryKeyFields();
    for (int i=0; i < pkFields.length; ++i) {
      Object fkField=pkFieldsToFKFields.get(pkFields[i]);
      if (fkField == null) {
        throw MESSAGES.primaryKeyNotMapped(pkFields[i].getFieldName());
      }
      keyFieldsList.add(fkField);
    }
    tableKeyFields=(JDBCCMP2xFieldBridge[])keyFieldsList.toArray(new JDBCCMP2xFieldBridge[keyFieldsList.size()]);
    dataSource=manager.getDataSource(metadata.getRelationMetaData().getDataSourceName());
  }
 else {
    initializeForeignKeyFields();
    dataSource=hasForeignKey() ? entity.getDataSource() : relatedEntity.getDataSource();
  }
  qualifiedTableName=SQLUtil.fixTableName(metadata.getRelationMetaData().getDefaultTableName(),dataSource);
  tableName=SQLUtil.getTableNameWithoutSchema(qualifiedTableName);
  relationManager=relatedCMRField.initRelationManager(this);
}
