{
  final Module module=context.getModule();
  final ClassLoader classLoader=module.getClassLoader();
  final Value<ClassLoader> classLoaderValue=Values.immediateValue(classLoader);
  final BatchBuilder batchBuilder=context.getBatchBuilder();
  final String codeName=serviceConfig.getCode();
  final Value<Class<?>> classValue=cached(new LookupClassValue(codeName,classLoaderValue));
  final List<Value<?>> constructorArguments=new ArrayList<Value<?>>();
  final List<Value<Class<?>>> constructorSignature=new ArrayList<Value<Class<?>>>();
  final JBossServiceConstructorConfig constructorConfig=serviceConfig.getConstructorConfig();
  if (constructorConfig != null) {
    final JBossServiceConstructorConfig.Argument[] arguments=constructorConfig.getArguments();
    for (    JBossServiceConstructorConfig.Argument argument : arguments) {
      final Value<Class<?>> attributeTypeValue=cached(new LookupClassValue(argument.getType(),classLoaderValue));
      constructorArguments.add(cached(new ArgumentValue(attributeTypeValue,argument.getValue())));
      constructorSignature.add(attributeTypeValue);
    }
  }
  final Value<Constructor> constructorValue=cached(new LookupConstructorValue(classValue,constructorSignature));
  final Value<Object> constructedValue=cached(new ConstructedValue(constructorValue,constructorArguments));
  final JBossService<?> jBossService=new JBossService<Object>(constructedValue);
  final String serviceName=serviceConfig.getName();
  final BatchServiceBuilder<?> serviceBuilder=batchBuilder.addService(convert(serviceName),jBossService);
  final JBossServiceDependencyConfig[] dependencyConfigs=serviceConfig.getDependencyConfigs();
  if (dependencyConfigs != null) {
    for (    JBossServiceDependencyConfig dependencyConfig : dependencyConfigs) {
      final ServiceName dependencyServiceName=convert(dependencyConfig.getDependencyName());
      final String optionalAttributeName=dependencyConfig.getOptionalAttributeName();
      if (optionalAttributeName != null) {
        serviceBuilder.addDependency(dependencyServiceName,getPropertyInjector(classValue,optionalAttributeName,jBossService,Values.injectedValue()));
      }
 else {
        serviceBuilder.addDependency(dependencyServiceName);
      }
    }
  }
  final JBossServiceAttributeConfig[] attributeConfigs=serviceConfig.getAttributeConfigs();
  if (attributeConfigs != null) {
    for (    JBossServiceAttributeConfig attributeConfig : attributeConfigs) {
      final String attributeName=attributeConfig.getName();
      final JBossServiceAttributeConfig.Inject inject=attributeConfig.getInject();
      final JBossServiceAttributeConfig.ValueFactory valueFactory=attributeConfig.getValueFactory();
      if (inject != null) {
        final String propertyName=inject.getPropertyName();
        Value<?> valueToInject=Values.injectedValue();
        if (propertyName != null) {
          valueToInject=cached(new MethodValue<Object>(new LookupGetMethodValue(classValue,propertyName),valueToInject,Values.<Object>emptyList()));
        }
        serviceBuilder.addDependency(convert(inject.getBeanName()),getPropertyInjector(classValue,attributeName,jBossService,valueToInject));
      }
 else       if (valueFactory != null) {
        final String methodName=valueFactory.getMethodName();
        final JBossServiceAttributeConfig.ValueFactoryParameter[] parameters=valueFactory.getParameters();
        final List<Value<Class<?>>> paramTypes=new ArrayList<Value<Class<?>>>(parameters.length);
        final List<Value<?>> paramValues=new ArrayList<Value<?>>(parameters.length);
        for (        JBossServiceAttributeConfig.ValueFactoryParameter parameter : parameters) {
          final Value<Class<?>> attributeTypeValue=cached(new LookupClassValue(parameter.getType(),classLoaderValue));
          paramTypes.add(attributeTypeValue);
          paramValues.add(cached(new ArgumentValue(attributeTypeValue,parameter.getValue())));
        }
        final Value<?> valueToInject=cached(new MethodValue(new LookupMethodValue(classValue,methodName,paramTypes),Values.injectedValue(),paramValues));
        serviceBuilder.addDependency(convert(valueFactory.getBeanName()),getPropertyInjector(classValue,attributeName,jBossService,valueToInject));
      }
 else {
        serviceBuilder.addInjectionValue(getPropertyInjector(classValue,attributeName,jBossService,Values.injectedValue()),cached(new AttributeValue(classValue,attributeName,attributeConfig.getValue())));
      }
    }
  }
}
