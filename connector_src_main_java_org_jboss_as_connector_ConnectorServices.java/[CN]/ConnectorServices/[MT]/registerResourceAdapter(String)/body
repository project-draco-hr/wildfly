{
  if (raName == null)   throw new IllegalArgumentException("RaName is null");
  Integer identifier=getResourceAdapterIdentifier(raName);
  ServiceName serviceName=RESOURCE_ADAPTER_SERVICE_PREFIX.append(raName + "_" + identifier);
  Set<ServiceName> entries=resourceAdapterServiceNames.get(raName);
  if (entries == null) {
    entries=new HashSet<ServiceName>(1);
    resourceAdapterServiceNames.put(raName,entries);
  }
  if (entries.contains(serviceName)) {
    resourceAdapterIdentifiers.get(raName).remove(identifier);
    throw new IllegalStateException("ServiceName '" + serviceName.getCanonicalName() + "' already registered");
  }
  entries.add(serviceName);
  return serviceName;
}
