{
  if (!target.getParentFile().exists()) {
    target.getParentFile().mkdirs();
  }
  final OutputStream os=new FileOutputStream(target);
  try {
    byte[] nh=copyAndGetHash(is,os);
    os.close();
    return nh;
  }
  finally {
    safeClose(os);
  }
}
