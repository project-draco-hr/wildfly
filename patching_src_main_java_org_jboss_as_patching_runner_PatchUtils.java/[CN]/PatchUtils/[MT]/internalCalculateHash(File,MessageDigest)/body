{
  if (file.isDirectory()) {
    final File[] children=file.listFiles();
    if (children != null && children.length > 0) {
      for (      final File child : children) {
        internalCalculateHash(child,digest);
      }
    }
  }
 else {
    final InputStream is=new FileInputStream(file);
    try {
      final DigestOutputStream os=new DigestOutputStream(PatchUtils.NULL_OUTPUT_STREAM,digest);
      PatchUtils.copyStream(is,os);
      is.close();
    }
  finally {
      safeClose(is);
    }
  }
}
