{
  if (file.isDirectory()) {
    final File[] children=file.listFiles();
    for (    final File child : children) {
      internalCalculateHash(child,digest);
    }
  }
 else {
    final InputStream is=new FileInputStream(file);
    try {
      final DigestOutputStream os=new DigestOutputStream(PatchUtils.NULL_OUTPUT_STREAM,digest);
      PatchUtils.copyStream(is,os);
      is.close();
    }
  finally {
      StreamUtils.safeClose(is);
    }
  }
}
