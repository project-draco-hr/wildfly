{
  final InputStream is=new FileInputStream(file);
  try {
    final DigestOutputStream os=new DigestOutputStream(PatchUtils.NULL_OUTPUT_STREAM,DIGEST);
synchronized (DIGEST) {
      DIGEST.reset();
      PatchUtils.copyStream(is,os);
      return DIGEST.digest();
    }
  }
  finally {
    StreamUtils.safeClose(is);
  }
}
