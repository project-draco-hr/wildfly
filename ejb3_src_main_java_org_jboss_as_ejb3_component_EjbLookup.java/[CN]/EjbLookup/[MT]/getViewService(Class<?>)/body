{
  final Set<EjbDescription> ejbs=this.ejbsByViewType.get(type);
  if (ejbs == null || ejbs.isEmpty()) {
    throw new RuntimeException("Could not resolve EJB with a view type of " + type);
  }
  if (ejbs.size() == 1) {
    return ejbs.iterator().next().serviceName(type);
  }
  EjbDescription localEjb=null;
  for (  EjbDescription ejb : ejbs) {
    if (ejb.deployedInCurrentModule) {
      if (localEjb != null) {
        throw new RuntimeException("More than one bean exists with a view of type " + type + " Beans: "+ ejbs);
      }
 else {
        localEjb=ejb;
      }
    }
  }
  if (localEjb != null) {
    return localEjb.serviceName(type);
  }
  throw new RuntimeException("More than one bean exists with a view of type " + type + " Beans: "+ ejbs);
}
