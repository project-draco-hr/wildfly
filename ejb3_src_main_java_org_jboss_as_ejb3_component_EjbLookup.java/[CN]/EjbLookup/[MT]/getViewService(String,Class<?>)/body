{
  final EjbDescription description=ejbs.get(ejbName);
  if (description == null) {
    throw new RuntimeException("Could not find EJB with name " + ejbName);
  }
  if (type == null) {
    if (description.serviceNames.size() == 1) {
      return description.serviceNames.values().iterator().next();
    }
 else     if (description.serviceNames.isEmpty()) {
      throw new RuntimeException("EJB " + ejbName + " does not have any views");
    }
 else {
      throw new RuntimeException("Could not determine view type to inject for ejb " + ejbName);
    }
  }
  if (description.serviceNames.size() == 1) {
    return description.serviceNames.values().iterator().next();
  }
  final ServiceName serviceName=description.serviceName(type);
  if (serviceName == null) {
    throw new RuntimeException("Could not find a view of type " + type + " for EJB "+ ejbName);
  }
  return serviceName;
}
