{
synchronized (this) {
    final InternalState initialRequired=this.requiredState;
    for (; ; ) {
      final InternalState required=this.requiredState;
      if (required == InternalState.FAILED) {
        return false;
      }
 else       if (initialRequired != required) {
        return false;
      }
      final InternalState current=this.internalState;
      if (expected == current) {
        return true;
      }
      try {
        wait();
      }
 catch (      InterruptedException e) {
        Thread.currentThread().interrupt();
        return false;
      }
    }
  }
}
