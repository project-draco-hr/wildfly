{
  final ElementState element=parent.getState();
  if (element.layer == null) {
    final PatchElementProvider metadata=element.getMetadata().getProvider();
    final Layer layer=ctx.getInstallationManager().getLayer(metadata.getName());
    if (layer == null) {
      ctx.getErrorHandler().error("Layer not found: " + metadata.getName());
      return null;
    }
    element.layer=new State(layer,element.getMetadata().getId());
  }
  return element.layer;
}
