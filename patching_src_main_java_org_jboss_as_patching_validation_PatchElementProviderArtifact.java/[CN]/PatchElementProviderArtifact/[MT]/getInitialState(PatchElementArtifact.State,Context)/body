{
  State state=parent.getLayer();
  if (state != null) {
    return state;
  }
  final PatchElementProvider metadata=parent.getMetadata().getProvider();
  final Layer layer=ctx.getInstallationManager().getLayer(metadata.getName());
  if (layer == null) {
    ctx.getErrorHandler().error("Layer not found: " + metadata.getName());
    return null;
  }
  state=new State(layer,parent.getMetadata().getId());
  parent.setLayer(state);
  return state;
}
