{
  HttpMetadata metadata=context.getAttachment(HttpMetadata.class);
  if (state == Bundle.STARTING) {
    String servletName=metadata.getServletName();
    try {
      log.info("Publish HttpMetadata: " + metadata);
      Bundle bundle=context.getBundle();
      Class<?> servletClass=bundle.loadClass(servletName);
      HttpServlet servlet=(HttpServlet)servletClass.newInstance();
      HttpService httpService=getHttpService(context,true);
      httpService.registerServlet("/servlet",servlet,null,null);
    }
 catch (    RuntimeException rte) {
      throw rte;
    }
catch (    Exception ex) {
      throw new LifecycleInterceptorException("Cannot publish: " + servletName,ex);
    }
  }
 else   if (state == Bundle.STOPPING) {
    log.info("Unpublish HttpMetadata: " + metadata);
    HttpService httpService=getHttpService(context,false);
    if (httpService != null)     httpService.unregister("/servlet");
  }
}
