{
  if (component == null) {
synchronized (this) {
      if (component == null) {
        final ServiceName createServiceName=descriptor.getCreateServiceName();
        final ServiceController<?> controller=serviceRegistry.getRequiredService(createServiceName);
        component=(Component)controller.getValue();
      }
    }
  }
  final ServiceName viewServiceName=component.getViewServices().get(businessInterfaceType);
  if (viewServiceName == null) {
    throw new RuntimeException("Could not find view for " + businessInterfaceType);
  }
  final ServiceController<?> viewController=serviceRegistry.getRequiredService(viewServiceName);
  ComponentView view=(ComponentView)viewController.getValue();
  if (descriptor.isStateful()) {
    StatefulSessionComponent sfsb=(StatefulSessionComponent)component;
    if (sessionId == null) {
synchronized (this) {
        if (sessionId == null) {
          sessionId=sfsb.createSession();
        }
      }
    }
    return (S)view.getViewForInstance(sessionId);
  }
  return (S)view.getReference().getInstance();
}
