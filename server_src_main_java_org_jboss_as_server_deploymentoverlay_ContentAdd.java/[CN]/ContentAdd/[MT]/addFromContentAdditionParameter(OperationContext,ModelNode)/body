{
  byte[] hash;
  InputStream in=getInputStream(context,contentItemNode);
  try {
    try {
      hash=contentRepository.addContent(in);
    }
 catch (    IOException e) {
      throw createFailureException(e.toString());
    }
  }
  finally {
    StreamUtils.safeClose(in);
  }
  contentItemNode.clear();
  contentItemNode.get(HASH).set(hash);
  return hash;
}
