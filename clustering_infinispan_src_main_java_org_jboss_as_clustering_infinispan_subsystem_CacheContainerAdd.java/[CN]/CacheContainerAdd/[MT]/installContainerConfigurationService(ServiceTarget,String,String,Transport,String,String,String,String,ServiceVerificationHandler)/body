{
  ServiceName configServiceName=EmbeddedCacheManagerConfigurationService.getServiceName(containerName);
  ServiceName classLoaderServiceName=EmbeddedCacheManagerConfigurationService.getClassLoaderServiceName(containerName);
  EmbeddedCacheManagerDependencies dependencies=new EmbeddedCacheManagerDependencies(transportConfig);
  ServiceBuilder<EmbeddedCacheManagerConfiguration> configBuilder=target.addService(configServiceName,new EmbeddedCacheManagerConfigurationService(containerName,defaultCache,dependencies)).addDependency(Services.JBOSS_SERVICE_MODULE_LOADER,ModuleLoader.class,dependencies.getModuleLoaderInjector()).addDependency(MBeanServerService.SERVICE_NAME,MBeanServer.class,dependencies.getMBeanServerInjector()).addDependency(DependencyType.OPTIONAL,classLoaderServiceName,ClassLoader.class,dependencies.getClassLoaderInjector()).setInitialMode(ServiceController.Mode.ON_DEMAND);
  if (transportConfig != null) {
    if (transportExecutor != null)     addExecutorDependency(configBuilder,transportExecutor,transportConfig.getExecutorInjector());
    ServiceName channelServiceName=ChannelService.getServiceName(containerName);
    configBuilder.addDependency(channelServiceName,Channel.class,transportConfig.getChannelInjector());
  }
  addExecutorDependency(configBuilder,listenerExecutor,dependencies.getListenerExecutorInjector());
  addScheduledExecutorDependency(configBuilder,evictionExecutor,dependencies.getEvictionExecutorInjector());
  addScheduledExecutorDependency(configBuilder,replicationQueueExecutor,dependencies.getReplicationQueueExecutorInjector());
  return configBuilder.install();
}
