{
  ServiceName configServiceName=EmbeddedCacheManagerConfigurationService.getServiceName(containerName);
  EmbeddedCacheManagerDependencies dependencies=new EmbeddedCacheManagerDependencies(transportConfig);
  ServiceBuilder<EmbeddedCacheManagerConfiguration> configBuilder=target.addService(configServiceName,new EmbeddedCacheManagerConfigurationService(containerName,defaultCache,moduleId,dependencies)).addDependency(Services.JBOSS_SERVICE_MODULE_LOADER,ModuleLoader.class,dependencies.getModuleLoaderInjector()).addDependency(MBeanServerService.SERVICE_NAME,MBeanServer.class,dependencies.getMBeanServerInjector()).setInitialMode(ServiceController.Mode.ON_DEMAND);
  if (transportConfig != null) {
    if (transportExecutor != null) {
      addExecutorDependency(configBuilder,transportExecutor,transportConfig.getExecutorInjector());
    }
    ServiceName channelServiceName=ChannelService.getServiceName(containerName);
    configBuilder.addDependency(channelServiceName,Channel.class,transportConfig.getChannelInjector());
  }
  addExecutorDependency(configBuilder,listenerExecutor,dependencies.getListenerExecutorInjector());
  addScheduledExecutorDependency(configBuilder,evictionExecutor,dependencies.getEvictionExecutorInjector());
  addScheduledExecutorDependency(configBuilder,replicationQueueExecutor,dependencies.getReplicationQueueExecutorInjector());
  return configBuilder.install();
}
