{
  try (EntryIterable<String,?> entries=cache.getAdvancedCache().withFlags(Flag.CACHE_MODE_LOCAL,Flag.SKIP_CACHE_LOAD).filterEntries(this.filter)){
    for (    CacheEntry<String,?> entry : entries.converter(NullValueConverter.getInstance())) {
      String sessionId=entry.getKey();
      if (!oldLocality.isLocal(sessionId) && newLocality.isLocal(sessionId)) {
        Batch batch=this.batcher.createBatch();
        try {
          V value=this.factory.findValue(sessionId);
          if (value != null) {
            this.scheduler.schedule(this.factory.createImmutableSession(sessionId,value));
          }
        }
  finally {
          batch.discard();
        }
      }
    }
  }
 }
