{
  final boolean started=this.cache.startBatch();
  return new Batch(){
    @Override public void close(){
      this.end(true);
    }
    @Override public void discard(){
      this.end(false);
    }
    private void end(    boolean success){
      if (started) {
        InfinispanSessionManager.this.cache.endBatch(success);
      }
    }
  }
;
}
