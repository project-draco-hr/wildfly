{
  final IfElseBlock ifBlock=IfElseBlock.remove(ctx);
  final BatchManager batchManager=ctx.getBatchManager();
  if (!batchManager.isBatchActive()) {
    if (ifBlock.isInIf()) {
      throw new CommandLineException("if block did not activate batch mode.");
    }
 else {
      throw new CommandLineException("else block did not activate batch mode.");
    }
  }
  final Batch batch=batchManager.getActiveBatch();
  batchManager.discardActiveBatch();
  final ModelControllerClient client=ctx.getModelControllerClient();
  if (client == null) {
    throw new CommandLineException("The connection to the controller has not been established.");
  }
  final ModelNode conditionRequest=ifBlock.getConditionRequest();
  if (conditionRequest == null) {
    throw new CommandLineException("The condition request is not available.");
  }
  final String[] path=ifBlock.getConditionPath();
  if (path == null || path.length == 0) {
    throw new CommandLineException("The condition path is empty.");
  }
  final String value=ifBlock.getConditionValue();
  if (value == null) {
    throw new CommandLineException("The condition value is not specified.");
  }
  ModelNode targetValue;
  try {
    targetValue=client.execute(conditionRequest);
  }
 catch (  IOException e) {
    throw new CommandLineException("condition request failed",e);
  }
  boolean pathExists=true;
  for (  String name : path) {
    if (!targetValue.hasDefined(name)) {
      pathExists=false;
      break;
    }
 else {
      targetValue=targetValue.get(name);
    }
  }
  if (pathExists && value.equals(targetValue.asString())) {
    ModelNode ifRequest=ifBlock.getIfRequest();
    if (ifRequest == null) {
      if (batch.size() == 0) {
        throw new CommandLineException("if request is missing.");
      }
      ifRequest=batch.toRequest();
    }
    try {
      final ModelNode response=client.execute(ifRequest);
      if (!Util.isSuccess(response)) {
        new CommandLineException("if request failed: " + Util.getFailureDescription(response));
      }
    }
 catch (    IOException e) {
      throw new CommandLineException("if request failed",e);
    }
  }
 else   if (ifBlock.isInElse()) {
    if (batch.size() == 0) {
      throw new CommandLineException("else block is empty.");
    }
    try {
      final ModelNode response=client.execute(batch.toRequest());
      if (!Util.isSuccess(response)) {
        throw new CommandLineException("else request failed: " + Util.getFailureDescription(response));
      }
    }
 catch (    IOException e) {
      throw new CommandLineException("else request failed",e);
    }
  }
}
