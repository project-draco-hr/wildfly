{
  if (!installed && beanManager != null && JspFactory.getDefaultFactory() != null) {
synchronized (this) {
      if (!installed) {
        installed=true;
        JspApplicationContext jspAppContext=JspFactory.getDefaultFactory().getJspApplicationContext(sre.getServletContext());
        jspAppContext.addELResolver(beanManager.getELResolver());
        jspAppContext.addELContextListener(Reflections.<ELContextListener>newInstance("org.jboss.weld.el.WeldELContextListener",getClass().getClassLoader()));
        JspApplicationContextImpl wrappedJspApplicationContextImpl=new WeldJspApplicationContextImpl(JspApplicationContextImpl.getInstance(sre.getServletContext()),beanManager.wrapExpressionFactory(jspAppContext.getExpressionFactory()));
        sre.getServletContext().setAttribute(JspApplicationContextImpl.class.getName(),wrappedJspApplicationContextImpl);
      }
    }
  }
}
