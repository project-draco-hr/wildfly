{
  final BatchBuilder batchBuilder=context.getBatchBuilder();
  final ScaledCount maxThreads=getMaxThreads();
  final ThreadFactoryExecutorService service=new ThreadFactoryExecutorService(maxThreads != null ? maxThreads.getScaledCount() : Integer.MAX_VALUE);
  final ServiceName serviceName=JBOSS_THREAD_EXECUTOR.append(getName());
  final BatchServiceBuilder<ExecutorService> serviceBuilder=batchBuilder.addService(serviceName,service);
  final String threadFactory=getThreadFactory();
  final ServiceName threadFactoryName;
  if (threadFactory == null) {
    threadFactoryName=serviceName.append("thread-factory");
    batchBuilder.addService(threadFactoryName,new ThreadFactoryService());
  }
 else {
    threadFactoryName=JBOSS_THREAD_FACTORY.append(threadFactory);
  }
  serviceBuilder.addDependency(threadFactoryName,ThreadFactory.class,service.getThreadFactoryInjector());
}
