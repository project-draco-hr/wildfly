{
  final WarMetaData warMetaData=deploymentUnitContext.getAttachment(WarMetaData.ATTACHMENT_KEY);
  JBossWebMetaData metaData=warMetaData.getMergedJBossWebMetaData();
  if (ok && (metaData != null)) {
    metaData.resolveAnnotations();
    resolveAnnotations(metaData.getAnnotations());
  }
  if (ok) {
    resolveServletSecurity();
  }
  if (ok) {
    validateSecurityRoles();
  }
  if (ok && (metaData != null)) {
    metaData.resolveRunAs();
  }
  if (ok) {
    if (!authenValves.isEmpty()) {
      Map<String,Valve> authenvalves=new HashMap<String,Valve>();
      for (      String name : authenValves.keySet()) {
        AuthenticatorValve authenvalve=(AuthenticatorValve)authenValves.get(name);
        Valve valve=null;
        try {
          valve=(Valve)authenvalve.classz.newInstance();
        }
 catch (        InstantiationException e) {
          ok=false;
          break;
        }
catch (        IllegalAccessException e) {
          ok=false;
          break;
        }
        if (authenvalve.properties != null) {
          for (          String pro : authenvalve.properties.keySet()) {
            IntrospectionUtils.setProperty(valve,pro,authenvalve.properties.get(pro));
          }
        }
        authenvalves.put(name,valve);
      }
      if (ok)       setCustomAuthenticators(authenvalves);
    }
  }
  if (ok) {
    authenticatorConfig();
  }
  if (!ok) {
    WebLogger.WEB_LOGGER.unavailable(context.getName());
    context.setConfigured(false);
  }
}
