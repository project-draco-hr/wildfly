{
  final TldsMetaData tldsMetaData=deploymentUnitContext.getAttachment(TldsMetaData.ATTACHMENT_KEY);
  if (tldsMetaData == null) {
    return;
  }
  Map<String,TldMetaData> localTlds=tldsMetaData.getTlds();
  List<TldMetaData> sharedTlds=tldsMetaData.getSharedTlds();
  ArrayList<TagLibraryInfo> tagLibraries=new ArrayList<TagLibraryInfo>();
  for (  String location : localTlds.keySet()) {
    processTld(tagLibraries,location,localTlds.get(location));
  }
  for (  TldMetaData sharedTld : sharedTlds) {
    processTld(tagLibraries,null,sharedTld);
  }
  String[] taglibs=context.findTaglibs();
  for (int i=0; i < taglibs.length; i++) {
    String uri=taglibs[i];
    String path=context.findTaglib(taglibs[i]);
    String location="";
    if (path.indexOf(':') == -1 && !path.startsWith("/")) {
      path="/WEB-INF/" + path;
    }
    if (path.endsWith(".jar")) {
      location=path;
      path="META-INF/taglib.tld";
    }
    for (int j=0; j < tagLibraries.size(); j++) {
      TagLibraryInfo tagLibraryInfo=tagLibraries.get(j);
      if (tagLibraryInfo.getLocation().equals(location) && tagLibraryInfo.getPath().equals(path)) {
        context.addJspTagLibrary(uri,tagLibraryInfo);
      }
    }
  }
}
