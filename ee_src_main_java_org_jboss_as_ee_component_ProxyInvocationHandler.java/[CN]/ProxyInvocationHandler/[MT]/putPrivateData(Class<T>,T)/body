{
  if (key == null) {
    throw new IllegalArgumentException("key is null");
  }
synchronized (this) {
    final Map<Class<?>,Object> newMap=new IdentityHashMap<Class<?>,Object>(initialPrivateData);
    if (value == null)     try {
      return key.cast(newMap.remove(key));
    }
  finally {
      initialPrivateData=newMap;
    }
 else     try {
      return key.cast(newMap.put(key,value));
    }
  finally {
      initialPrivateData=newMap;
    }
  }
}
