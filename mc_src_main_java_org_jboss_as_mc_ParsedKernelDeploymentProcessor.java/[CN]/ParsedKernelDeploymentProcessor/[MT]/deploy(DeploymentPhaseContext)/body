{
  final KernelDeploymentXmlDescriptor kdXmlDescriptor=phaseContext.getAttachment(KernelDeploymentXmlDescriptor.ATTACHMENT_KEY);
  if (kdXmlDescriptor == null)   return;
  final Module module=phaseContext.getAttachment(ModuleDeploymentProcessor.MODULE_ATTACHMENT_KEY);
  if (module == null)   throw new DeploymentUnitProcessingException("Failed to get module attachment for deployment: " + phaseContext.getName());
  final ClassLoader classLoader=module.getClassLoader();
  final Value<ClassLoader> classLoaderValue=Values.immediateValue(classLoader);
  final List<BeanMetaDataConfig> beanConfigs=kdXmlDescriptor.getBeans();
  final ServiceTarget serviceTarget=phaseContext.getBatchBuilder();
  for (  final BeanMetaDataConfig beanConfig : beanConfigs) {
    addBean(serviceTarget,beanConfig,classLoaderValue);
  }
}
