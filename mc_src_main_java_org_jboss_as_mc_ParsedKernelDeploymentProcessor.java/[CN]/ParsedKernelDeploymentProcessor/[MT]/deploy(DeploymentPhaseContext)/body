{
  final KernelDeploymentXmlDescriptor kdXmlDescriptor=phaseContext.getDeploymentUnit().getAttachment(KernelDeploymentXmlDescriptor.ATTACHMENT_KEY);
  if (kdXmlDescriptor == null)   return;
  final Module module=phaseContext.getDeploymentUnit().getAttachment(Attachments.MODULE);
  if (module == null)   throw new DeploymentUnitProcessingException("Failed to get module attachment for " + phaseContext.getDeploymentUnit());
  final ClassLoader classLoader=module.getClassLoader();
  final Value<ClassLoader> classLoaderValue=Values.immediateValue(classLoader);
  final List<BeanMetaDataConfig> beanConfigs=kdXmlDescriptor.getBeans();
  final ServiceTarget serviceTarget=phaseContext.getServiceTarget();
  for (  final BeanMetaDataConfig beanConfig : beanConfigs) {
    addBean(serviceTarget,beanConfig,classLoaderValue);
  }
}
