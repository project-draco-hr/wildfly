{
  if (cmd == null) {
    throw new IllegalArgumentException("The command is null!");
  }
  if (requestBuilder == null) {
    throw new IllegalArgumentException("The request builder is null!");
  }
  cmd=cmd.trim();
  int colonIndex=cmd.indexOf(ADDRESS_OPERATION_SEPARATOR);
  if (colonIndex > 0) {
    String address=cmd.substring(0,colonIndex).trim();
    if (address.isEmpty()) {
      throw new CommandFormatException("The address part is missing. Command '" + cmd + "' doesn't follow the format "+ FORMAT);
    }
    int nodeIndex=0;
    while (nodeIndex < address.length()) {
      int slashIndex=address.indexOf(NODE_SEPARATOR,nodeIndex);
      if (slashIndex < 0) {
        slashIndex=address.length();
      }
      String node=address.substring(nodeIndex,slashIndex).trim();
      if (node.isEmpty()) {
        throw new CommandFormatException("Node name is missing or the format is wrong for the address string '" + address + "'");
      }
      int nameValueSep=node.indexOf(NODE_TYPE_NAME_SEPARATOR);
      if (nameValueSep < 0) {
        throw new CommandFormatException("Couldn't locate node type/name separator in '" + node + "' in command '"+ cmd+ "'");
      }
      String nodeType=node.substring(0,nameValueSep).trim();
      if (nodeType.isEmpty()) {
        throw new CommandFormatException("The node type is missing for the node '" + node + "' or the format is wrong for the address string '"+ address+ "'");
      }
      if (!isValidIdentifier(nodeType)) {
        throw new CommandFormatException("The node type is invalid (not a valid Java identifier) '" + nodeType + "' or the format is wrong for the address string '"+ address+ "'");
      }
      String nodeName=node.substring(nameValueSep + 1).trim();
      if (nodeName.isEmpty()) {
        throw new CommandFormatException("The node name is missing for the node '" + node + "' or the format is wrong for the address string '"+ address+ "'");
      }
      if (!isValidIdentifier(nodeName)) {
        throw new CommandFormatException("The node name is invalid (not a valid Java identifier) '" + nodeName + "' or the format is wrong for the address string '"+ address+ "'");
      }
      requestBuilder.addAddressNode(nodeType,nodeName);
      nodeIndex=slashIndex + 1;
    }
  }
  String operation;
  int argListStartIndex=cmd.indexOf(ARG_LIST_START,colonIndex + 1);
  if (argListStartIndex < 0) {
    int argListEndIndex=cmd.indexOf(ARG_LIST_END,colonIndex + 1);
    if (argListEndIndex != -1)     throw new CommandFormatException("Couldn't locate '" + ARG_LIST_START + "' but found '"+ ARG_LIST_END+ "'. Command '"+ cmd+ "' doesn't follow the format "+ FORMAT);
    operation=cmd.substring(colonIndex + 1);
  }
 else {
    operation=cmd.substring(colonIndex + 1,argListStartIndex).trim();
  }
  if (operation.isEmpty()) {
    throw new CommandFormatException("The operation name is missing: '" + cmd + "'");
  }
  if (!isValidIdentifier(operation)) {
    throw new CommandFormatException("The operation name is invalid '" + operation + "' or command '"+ cmd+ "' doesn't follow the format "+ FORMAT);
  }
  requestBuilder.setOperationName(operation);
  if (argListStartIndex != -1) {
    int argListEndIndex=cmd.indexOf(ARG_LIST_END,argListStartIndex + 1);
    if (argListEndIndex < 0) {
      throw new CommandFormatException("Couldn't locate '" + ARG_LIST_END + "'. Command '"+ cmd+ "' doesn't follow the format "+ FORMAT);
    }
    String args=cmd.substring(argListStartIndex + 1,argListEndIndex).trim();
    int argIndex=0;
    while (argIndex < args.length()) {
      int argSepIndex=args.indexOf(ARG_SEPARATOR,argIndex);
      if (argSepIndex == -1) {
        argSepIndex=args.length();
      }
      String arg=args.substring(argIndex,argSepIndex).trim();
      if (arg.isEmpty()) {
        throw new CommandFormatException("An argument is missing or the command is in the wrong format: '" + cmd + "'");
      }
      int argNameValueSepIndex=arg.indexOf(ARG_NAME_VALUE_SEPARATOR);
      if (argNameValueSepIndex < 0) {
        throw new CommandFormatException("Couldn't locate '" + ARG_NAME_VALUE_SEPARATOR + "' in the argument '"+ arg+ "'");
      }
      String argName=arg.substring(0,argNameValueSepIndex).trim();
      if (argName.isEmpty()) {
        throw new CommandFormatException("The argument name is missing or the format is wrong for argument '" + arg + "'");
      }
      if (!isValidIdentifier(argName)) {
        throw new CommandFormatException("Argument name '" + argName + "' is invalid (not a valid Java identifier) or the format is wrong for the argument list '"+ args+ "'");
      }
      String argValue=arg.substring(argNameValueSepIndex + 1).trim();
      if (argValue.isEmpty()) {
        throw new CommandFormatException("The argument value is missing or the format is wrong for argument '" + arg + "'");
      }
      requestBuilder.addArgument(argName,argValue);
      argIndex=argSepIndex + 1;
    }
  }
}
