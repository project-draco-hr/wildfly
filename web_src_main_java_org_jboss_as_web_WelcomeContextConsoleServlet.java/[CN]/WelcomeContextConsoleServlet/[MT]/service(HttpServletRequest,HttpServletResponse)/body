{
  String target=noconsole;
  if (hasConsole) {
    InetAddress inboundAddress=InetAddress.getByName(req.getLocalAddr());
    if (isAccessible(inboundAddress)) {
      boolean secureRedirect=secureRedirect(req.isSecure());
      String host=req.getServerName();
      StringBuilder targetBuilder=new StringBuilder();
      if (secureRedirect) {
        target=assembleURL(HTTPS,host,consoleSecurePort,SECURE_DEFAULT_PORT,CONSOLE_PATH);
      }
 else {
        target=assembleURL(HTTP,host,consolePort,DEFAULT_PORT,CONSOLE_PATH);
      }
    }
 else {
      target=noredirect;
    }
  }
  resp.sendRedirect(target);
}
