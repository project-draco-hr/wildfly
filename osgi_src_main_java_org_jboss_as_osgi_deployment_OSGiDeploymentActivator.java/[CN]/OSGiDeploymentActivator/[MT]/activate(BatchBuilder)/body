{
  batchBuilder.addServiceValueIfNotExist(DeploymentChainProviderService.SERVICE_NAME,new DeploymentChainProviderService());
  final Value<DeploymentChain> deploymentChainValue=Values.immediateValue((DeploymentChain)new DeploymentChainImpl(OSGI_DEPLOYMENT_CHAIN_SERVICE_NAME.toString()));
  final DeploymentChainService deploymentChainService=new DeploymentChainService(deploymentChainValue);
  BatchServiceBuilder<?> serviceBuilder=batchBuilder.addService(OSGI_DEPLOYMENT_CHAIN_SERVICE_NAME,deploymentChainService);
  DeploymentChainProviderInjector<DeploymentChain> injector=new DeploymentChainProviderInjector<DeploymentChain>(deploymentChainValue,new OSGiDeploymentChainSelector(),OSGI_DEPLOYMENT_CHAIN_PRIORITY);
  serviceBuilder.addDependency(DeploymentChainProviderService.SERVICE_NAME,DeploymentChainProvider.class,injector);
  addDeploymentProcessor(batchBuilder,new OSGiManifestDeploymentProcessor(),OSGiManifestDeploymentProcessor.PRIORITY);
  addDeploymentProcessor(batchBuilder,new OSGiAttachmentsDeploymentProcessor(),OSGiAttachmentsDeploymentProcessor.PRIORITY);
}
