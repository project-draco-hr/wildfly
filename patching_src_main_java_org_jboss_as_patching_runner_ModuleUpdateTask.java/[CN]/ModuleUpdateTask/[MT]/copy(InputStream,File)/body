{
  if (!target.getParentFile().exists()) {
    target.getParentFile().mkdirs();
  }
  final OutputStream os=new FileOutputStream(target);
  try {
    byte[] nh=PatchUtils.copyAndGetHash(is,os);
    os.close();
    return nh;
  }
  finally {
    PatchUtils.safeClose(os);
  }
}
