{
  final Set<String> securityRoles=new HashSet<String>();
  final EjbJarMetaData ejbJarMD=unit.getAttachment(EjbDeploymentAttachmentKeys.EJB_JAR_METADATA);
  if (ejbJarMD != null && ejbJarMD.getAssemblyDescriptor() != null) {
    final List<SecurityRoleMetaData> securityRoleMetaDatas=ejbJarMD.getAssemblyDescriptor().getAny(SecurityRoleMetaData.class);
    if (securityRoleMetaDatas != null) {
      for (      final SecurityRoleMetaData securityRoleMetaData : securityRoleMetaDatas) {
        securityRoles.add(securityRoleMetaData.getRoleName());
      }
    }
    final SecurityRolesMetaData securityRolesMD=ejbJarMD.getAssemblyDescriptor().getSecurityRoles();
    if (securityRolesMD != null && securityRolesMD.size() > 0) {
      for (      final SecurityRoleMetaData securityRoleMD : securityRolesMD) {
        securityRoles.add(securityRoleMD.getRoleName());
      }
    }
  }
  if (webServiceClassInfo.annotations().containsKey(ROLES_ALLOWED_ANNOTATION)) {
    final AnnotationInstance allowedRoles=webServiceClassInfo.annotations().get(ROLES_ALLOWED_ANNOTATION).get(0);
    for (    final String roleName : allowedRoles.value().asStringArray()) {
      securityRoles.add(roleName);
    }
  }
  return (securityRoles.size() > 0) ? Collections.unmodifiableSet(securityRoles) : Collections.<String>emptySet();
}
