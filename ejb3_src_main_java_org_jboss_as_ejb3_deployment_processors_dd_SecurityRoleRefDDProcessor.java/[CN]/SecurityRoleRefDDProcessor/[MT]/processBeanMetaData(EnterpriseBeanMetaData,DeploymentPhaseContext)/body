{
  SecurityRoleRefsMetaData securityRoleRefs=null;
  if (beanMetaData instanceof SessionBeanMetaData) {
    securityRoleRefs=beanMetaData.getSecurityRoleRefs();
  }
 else   if (beanMetaData instanceof MessageDrivenBeanMetaData) {
    ROOT_LOGGER.securityRoleForMdbNotImplemented();
  }
  if (securityRoleRefs == null) {
    return;
  }
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final EEModuleDescription moduleDescription=deploymentUnit.getAttachment(Attachments.EE_MODULE_DESCRIPTION);
  final EJBComponentDescription ejbComponentDescription=(EJBComponentDescription)moduleDescription.getComponentByName(beanMetaData.getEjbName());
  for (  final SecurityRoleRefMetaData securityRoleRef : securityRoleRefs) {
    final String fromRole=securityRoleRef.getRoleName();
    String toRole=securityRoleRef.getRoleLink();
    if (fromRole == null || fromRole.trim().isEmpty()) {
      throw MESSAGES.roleNamesIsNull(ejbComponentDescription.getEJBName());
    }
    if (toRole == null) {
      toRole=fromRole;
    }
    ejbComponentDescription.linkSecurityRoles(fromRole,toRole);
  }
}
