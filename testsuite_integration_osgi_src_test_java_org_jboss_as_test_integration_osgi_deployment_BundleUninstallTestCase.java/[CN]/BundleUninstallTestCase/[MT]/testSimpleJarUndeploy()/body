{
  ServerDeploymentHelper server=new ServerDeploymentHelper(managementClient.getControllerClient());
  String jarName=server.deploy(V200_JAR,deployer.getDeployment(V200_JAR));
  Bundle jar=FrameworkUtils.getBundles(context,V200_JAR,null)[0];
  Assert.assertEquals(Bundle.ACTIVE,jar.getState());
  XEnvironment env=context.getBundle().adapt(XEnvironment.class);
  XBundleRevision brev=(XBundleRevision)jar.adapt(BundleRevision.class);
  Long resid=brev.getAttachment(XResource.RESOURCE_IDENTIFIER_KEY);
  server.undeploy(jarName);
  Assert.assertEquals(Bundle.UNINSTALLED,jar.getState());
  Assert.assertNull("BundleRevision is null",jar.adapt(BundleRevision.class));
  Assert.assertNull("BundleWiring is null",brev.getWiring());
  Assert.assertNull("BundleRevision removed from environment",env.getResourceById(resid));
}
