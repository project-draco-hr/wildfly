{
  AccessController.doPrivileged(new PrivilegedAction<Object>(){
    public Object run(){
      Provider saslProvider=new JBossSaslProvider();
      if (Security.getProvider(saslProvider.getName()) == null) {
        Security.insertProviderAt(saslProvider,1);
      }
      return null;
    }
  }
);
  String path=tmpDirValue.getValue();
  File authDir=new File(path,"auth");
  if (authDir.exists()) {
    if (authDir.isDirectory() == false) {
      throw new StartException("Unable to create tmp dir for auth tokens as file already exists.");
    }
  }
 else   if (authDir.mkdirs() == false) {
    throw new StartException("Unable to create auth dir.");
  }
 else {
    authDir.setWritable(false,false);
    authDir.setWritable(true,true);
    authDir.setReadable(false,false);
    authDir.setReadable(true,true);
    authDir.setExecutable(false,false);
    authDir.setExecutable(true,true);
  }
  realmAuthenticationProvider=new RealmAuthenticationProvider(securityRealmInjectedValue.getOptionalValue(),serverCallbackValue.getOptionalValue(),authDir.getAbsolutePath());
}
