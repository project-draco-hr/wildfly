{
  try {
    boolean inLockingValve=SessionReplicationContext.isLocallyActive();
    if (inLockingValve || this.valveLock.tryLock(0,TimeUnit.SECONDS)) {
      try {
switch (this.getReplicationGranularity()) {
case ATTRIBUTE:
          return (ClusteredSession<O>)new AttributeBasedClusteredSession((DistributableSessionManager<OutgoingAttributeGranularitySessionData>)this);
default :
        return (ClusteredSession<O>)new SessionBasedClusteredSession((DistributableSessionManager<OutgoingSessionGranularitySessionData>)this);
    }
  }
  finally {
    if (!inLockingValve) {
      this.valveLock.unlock();
    }
  }
}
}
 catch (InterruptedException e) {
Thread.currentThread().interrupt();
}
return null;
}
