{
  if (!session.isValid()) {
    log.debugf("Cannot add session with id=%s because it is invalid",session.getIdInternal());
    return;
  }
  String realId=session.getRealId();
  Object existing=sessions.put(realId,session);
  unloadedSessions.remove(realId);
  if (!session.equals(existing)) {
    if (replicate) {
      storeSession(session);
    }
    calcActiveSessions();
    log.tracef("Session with id=%s added. Current active sessions %d",session.getIdInternal(),localActiveCounter.get());
  }
}
