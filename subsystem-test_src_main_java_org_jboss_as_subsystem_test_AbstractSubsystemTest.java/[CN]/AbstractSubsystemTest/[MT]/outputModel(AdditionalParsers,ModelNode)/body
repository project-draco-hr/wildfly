{
  addAdditionalParsers(additionalParsers);
  StringConfigurationPersister persister=new StringConfigurationPersister(Collections.<ModelNode>emptyList(),testParser);
  Extension extension=mainExtension.getClass().newInstance();
  extension.initialize(new ExtensionContextImpl(MOCK_RESOURCE_REG,MOCK_RESOURCE_REG,persister,ProcessType.EMBEDDED_SERVER).createTracking("Test"));
  ConfigurationPersister.PersistenceResource resource=persister.store(model,Collections.<PathAddress>emptySet());
  resource.commit();
  return persister.marshalled;
}
