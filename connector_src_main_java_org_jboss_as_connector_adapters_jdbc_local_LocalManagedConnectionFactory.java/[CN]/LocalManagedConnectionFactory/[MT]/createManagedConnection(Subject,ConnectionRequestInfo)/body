{
  Properties props=getConnectionProperties(subject,cri);
  Properties copy=(Properties)props.clone();
  boolean trace=log.isTraceEnabled();
  if (trace) {
    Properties logCopy=copy;
    if (copy.getProperty("password") != null) {
      logCopy=(Properties)props.clone();
      logCopy.setProperty("password","--hidden--");
    }
    log.trace("Using properties: " + logCopy);
  }
  if (urlSelector != null) {
    return getHALocalManagedConnection(props,copy);
  }
 else {
    return getLocalManagedConnection(props,copy);
  }
}
