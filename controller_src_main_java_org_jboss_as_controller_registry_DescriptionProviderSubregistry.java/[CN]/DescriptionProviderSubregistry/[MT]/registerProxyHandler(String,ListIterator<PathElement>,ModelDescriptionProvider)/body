{
  DescriptionProviderRegistry registry;
  registry=childRegistriesUpdater.get(this,elementValue);
  if (registry == null) {
    final boolean last=!iterator.hasNext();
    final DescriptionProviderRegistry newRegistry=last ? new ProxyDescriptionProviderRegistry(elementValue,this,provider) : new ConcreteDescriptionProviderRegistry(elementValue,this);
    final DescriptionProviderRegistry appearingRegistry=childRegistriesUpdater.putIfAbsent(this,elementValue,newRegistry);
    if (appearingRegistry == null && last) {
      return;
    }
    registry=appearingRegistry;
  }
  registry.registerProxyProvider(iterator,provider);
}
