{
  final SubsystemRegistration subsystem=context.registerSubsystem(SUBSYSTEM_NAME,2,0,0);
  final ManagementResourceRegistration registration=initializeSubsystem(subsystem);
  registration.registerOperationHandler("update",new OperationStepHandler(){
    @Override public void execute(    final OperationContext context,    final ModelNode operation) throws OperationFailedException {
      final Resource resource=context.readResourceForUpdate(PathAddress.EMPTY_ADDRESS);
      final ModelNode model=resource.getModel();
      model.get("test-attribute").set("test");
      context.getResult().set(model);
      context.completeStep(OperationContext.RollbackHandler.NOOP_ROLLBACK_HANDLER);
    }
  }
,new DefaultOperationDescriptionProvider("update",TEST_RESOURCE_DESCRIPTION_RESOLVER));
  registration.registerSubModel(new TestResourceDefinition(NEW_ELEMENT));
  registration.registerSubModel(new TestResourceDefinition(RENAMED));
  final TransformersSubRegistration transformers=subsystem.registerModelTransformers(ModelVersion.create(1,0,0),new ResourceTransformer(){
    @Override public ModelNode transformModel(    TransformationContext context,    ModelNode model){
      ModelNode transformed=model.clone();
      return transformed;
    }
  }
);
  subsystem.registerSubsystemTransformer(new AbstractSubsystemTransformer(1,0,0){
    @Override public ModelNode transformModel(    TransformationContext context,    ModelNode model){
      ModelNode transformed=model.clone();
      transformed.remove("new-element");
      if (transformed.has("renamed")) {
        ModelNode node=transformed.remove("renamed");
        if (node.has("element")) {
          node=node.remove("element");
          transformed.get("element","renamed").set(node);
        }
      }
      return transformed;
    }
  }
);
  transformers.registerOperationTransformer("update",new UpdateTransformer());
  final TransformersSubRegistration newElement=transformers.registerSubResource(NEW_ELEMENT);
  newElement.discardOperations(TransformersSubRegistration.COMMON_OPERATIONS);
  final TransformersSubRegistration renamed=transformers.registerSubResource(RENAMED,AliasOperationTransformer.replaceLastElement(PathElement.pathElement("element","renamed")));
}
