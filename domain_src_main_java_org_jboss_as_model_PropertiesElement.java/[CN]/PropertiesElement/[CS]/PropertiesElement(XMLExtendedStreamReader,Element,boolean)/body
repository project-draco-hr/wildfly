{
  super(reader);
  this.propertyType=propertyType;
  this.allowNullValue=allowNullValue;
  final String myNamespace=reader.getNamespaceURI();
  if (reader.getAttributeCount() > 0) {
    throw unexpectedAttribute(reader,0);
  }
  while (reader.hasNext() && reader.nextTag() != END_ELEMENT) {
    final String namespace=reader.getNamespaceURI();
    if (myNamespace == null ? namespace != null : !myNamespace.equals(namespace)) {
      throw unexpectedElement(reader);
    }
    if (reader.getLocalName().equals(propertyType.getLocalName())) {
      String name=reader.getAttributeValue(null,Attribute.NAME.getLocalName());
      if (properties.containsKey(name)) {
        throw new XMLStreamException("Property " + name + " already exists",reader.getLocation());
      }
      String value=reader.getAttributeValue(null,Attribute.VALUE.getLocalName());
      if (value == null && !allowNullValue) {
        throw new XMLStreamException("Value for property " + name + " is null",reader.getLocation());
      }
      properties.put(name,value);
    }
 else {
      throw unexpectedElement(reader);
    }
  }
}
