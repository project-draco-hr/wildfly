{
  ConfigAdminService configAdmin=getConfigAdminService();
  Dictionary<String,String> config=configAdmin.getConfiguration(ConfiguredService.SERVICE_PID);
  assertNull("Config null",config);
  config=new Hashtable<String,String>();
  config.put("foo","bar");
  Dictionary<String,String> oldConfig=configAdmin.putConfiguration(ConfiguredService.SERVICE_PID,config);
  try {
    assertNull("Config null",oldConfig);
    Dictionary<String,String> regConfig=configAdmin.getConfiguration(ConfiguredService.SERVICE_PID);
    assertNotNull("Config not null",regConfig);
    assertEquals("Config not null",1,regConfig.size());
    assertEquals("bar",regConfig.get("foo"));
    try {
      regConfig.remove("foo");
      fail("UnsupportedOperationException expected");
    }
 catch (    UnsupportedOperationException ex) {
    }
    config.put("foo","baz");
    regConfig=configAdmin.getConfiguration(ConfiguredService.SERVICE_PID);
    assertEquals("bar",regConfig.get("foo"));
  }
  finally {
    oldConfig=configAdmin.removeConfiguration(ConfiguredService.SERVICE_PID);
    assertNotNull("Config not null",oldConfig);
    config=configAdmin.getConfiguration(ConfiguredService.SERVICE_PID);
    assertNull("Config null",config);
  }
}
