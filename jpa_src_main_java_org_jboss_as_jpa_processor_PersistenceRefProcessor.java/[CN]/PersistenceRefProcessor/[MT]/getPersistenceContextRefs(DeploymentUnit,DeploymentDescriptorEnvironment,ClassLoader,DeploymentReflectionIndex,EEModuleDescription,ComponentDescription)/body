{
  List<BindingConfiguration> bindingConfigurations=new ArrayList<BindingConfiguration>();
  if (environment.getEnvironment() == null) {
    return bindingConfigurations;
  }
  PersistenceContextReferencesMetaData persistenceUnitRefs=environment.getEnvironment().getPersistenceContextRefs();
  if (persistenceUnitRefs != null) {
    for (    PersistenceContextReferenceMetaData puRef : persistenceUnitRefs) {
      String name=puRef.getName();
      String persistenceUnitName=puRef.getPersistenceUnitName();
      String lookup=puRef.getLookupName();
      if (!isEmpty(lookup) && !isEmpty(persistenceUnitName)) {
        throw new DeploymentUnitProcessingException("Cannot specify both <lookup-name> (" + lookup + ") and persistence-unit-name ("+ persistenceUnitName+ ") in <persistence-context-ref/> for "+ componentDescription);
      }
      if (!name.startsWith("java:")) {
        name=environment.getDefaultContext() + name;
      }
      LookupInjectionSource injectionSource=new LookupInjectionSource(name);
      processInjectionTargets(moduleDescription,injectionSource,classLoader,deploymentReflectionIndex,puRef,EntityManager.class);
      BindingConfiguration bindingConfiguration=null;
      if (!isEmpty(lookup)) {
        bindingConfiguration=new BindingConfiguration(name,new LookupInjectionSource(lookup));
      }
 else       if (!isEmpty(persistenceUnitName)) {
        PropertiesMetaData properties=puRef.getProperties();
        Map map=new HashMap();
        if (properties != null) {
          for (          PropertyMetaData prop : properties) {
            map.put(prop.getKey(),prop.getValue());
          }
        }
        PersistenceContextType type=puRef.getPersistenceContextType() == null ? PersistenceContextType.TRANSACTION : puRef.getPersistenceContextType();
        InjectionSource pcBindingSource=this.getPersistenceContextBindingSource(deploymentUnit,persistenceUnitName,type,map);
        bindingConfiguration=new BindingConfiguration(name,pcBindingSource);
      }
 else {
        throw new RuntimeException("Support for persistence-context-ref without a lookup or persistence-unit-name, isn't yet implemented");
      }
    }
  }
  return bindingConfigurations;
}
