{
  ModelNode globalModules=new ModelNode();
  requireNoAttributes(reader);
  while (reader.hasNext() && reader.nextTag() != END_ELEMENT) {
switch (Element.forName(reader.getLocalName())) {
case MODULE:
{
        final int count=reader.getAttributeCount();
        String name=null;
        String slot=null;
        Boolean annotations=null;
        Boolean metaInf=null;
        Boolean services=null;
        for (int i=0; i < count; i++) {
          requireNoNamespaceAttribute(reader,i);
          final String value=reader.getAttributeValue(i);
          final Attribute attribute=Attribute.forName(reader.getAttributeLocalName(i));
switch (attribute) {
case NAME:
            if (name != null) {
              throw unexpectedAttribute(reader,i);
            }
          name=value;
        break;
case SLOT:
      if (slot != null) {
        throw unexpectedAttribute(reader,i);
      }
    slot=value;
  break;
case ANNOTATIONS:
if (annotations != null) {
  throw unexpectedAttribute(reader,i);
}
annotations=Boolean.parseBoolean(value);
break;
case SERVICES:
if (services != null) {
throw unexpectedAttribute(reader,i);
}
services=Boolean.parseBoolean(value);
break;
case META_INF:
if (metaInf != null) {
throw unexpectedAttribute(reader,i);
}
metaInf=Boolean.parseBoolean(value);
break;
default :
throw unexpectedAttribute(reader,i);
}
}
if (name == null) {
throw missingRequired(reader,Collections.singleton(NAME));
}
final ModelNode module=new ModelNode();
module.get(GlobalModulesDefinition.NAME).set(name);
if (slot != null) {
module.get(GlobalModulesDefinition.SLOT).set(slot);
}
if (annotations != null) {
module.get(GlobalModulesDefinition.ANNOTATIONS).set(annotations);
}
if (services != null) {
module.get(GlobalModulesDefinition.SERVICES).set(services);
}
if (metaInf != null) {
module.get(GlobalModulesDefinition.META_INF).set(metaInf);
}
globalModules.add(module);
requireNoContent(reader);
break;
}
default :
{
throw unexpectedElement(reader);
}
}
}
return globalModules;
}
