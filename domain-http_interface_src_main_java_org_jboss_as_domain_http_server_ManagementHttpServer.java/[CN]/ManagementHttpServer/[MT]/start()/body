{
  final Xnio xnio;
  try {
    xnio=Xnio.getInstance(null,Module.getModuleFromCallerModuleLoader(ModuleIdentifier.fromString("org.jboss.xnio.nio")).getClassLoader());
  }
 catch (  Exception e) {
    throw new IllegalStateException(e.getLocalizedMessage());
  }
  try {
    worker=xnio.createWorker(OptionMap.builder().set(Options.WORKER_WRITE_THREADS,4).set(Options.WORKER_READ_THREADS,4).set(Options.CONNECTION_HIGH_WATER,1000000).set(Options.CONNECTION_LOW_WATER,1000000).set(Options.WORKER_TASK_CORE_THREADS,10).set(Options.WORKER_TASK_MAX_THREADS,12).set(Options.TCP_NODELAY,true).set(Options.CORK,true).getMap());
    Builder serverOptionsBuilder=OptionMap.builder().set(Options.WORKER_ACCEPT_THREADS,4).set(Options.TCP_NODELAY,true).set(Options.REUSE_ADDRESSES,true);
    ChannelListener acceptListener=ChannelListeners.openListenerAdapter(openListener);
    if (httpAddress != null) {
      normalServer=worker.createStreamServer(httpAddress,acceptListener,serverOptionsBuilder.getMap());
      normalServer.resumeAccepts();
    }
    if (secureAddress != null) {
      SSLContext sslContext=securityRealm.getSSLContext();
      if (securityRealm.getSupportedAuthenticationMechanisms().contains(AuthenticationMechanism.CLIENT_CERT)) {
        serverOptionsBuilder.set(SSL_CLIENT_AUTH_MODE,REQUESTED);
      }
      OptionMap secureOptions=serverOptionsBuilder.getMap();
      XnioSsl xnioSsl=new JsseXnioSsl(worker.getXnio(),secureOptions,sslContext);
      secureServer=xnioSsl.createSslTcpServer(worker,secureAddress,acceptListener,secureOptions);
      secureServer.resumeAccepts();
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
