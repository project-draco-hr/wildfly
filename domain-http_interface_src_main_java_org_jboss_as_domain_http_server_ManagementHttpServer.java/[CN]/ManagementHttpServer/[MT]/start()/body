{
  final Xnio xnio;
  try {
    xnio=Xnio.getInstance(null,Module.getModuleFromCallerModuleLoader(ModuleIdentifier.fromString("org.jboss.xnio.nio")).getClassLoader());
  }
 catch (  Exception e) {
    throw new IllegalStateException(e.getLocalizedMessage());
  }
  try {
    worker=xnio.createWorker(OptionMap.builder().set(Options.WORKER_IO_THREADS,4).set(Options.CONNECTION_HIGH_WATER,1000000).set(Options.CONNECTION_LOW_WATER,1000000).set(Options.WORKER_TASK_CORE_THREADS,10).set(Options.WORKER_TASK_MAX_THREADS,12).set(Options.TCP_NODELAY,true).set(Options.CORK,true).getMap());
    Builder serverOptionsBuilder=OptionMap.builder().set(Options.TCP_NODELAY,true).set(Options.REUSE_ADDRESSES,true);
    ChannelListener acceptListener=ChannelListeners.openListenerAdapter(openListener);
    if (httpAddress != null) {
      normalServer=worker.createStreamConnectionServer(httpAddress,acceptListener,serverOptionsBuilder.getMap());
      normalServer.resumeAccepts();
    }
    if (secureAddress != null) {
      SSLContext sslContext=securityRealm.getSSLContext();
      Set<AuthMechanism> supportedMechanisms=securityRealm.getSupportedAuthenticationMechanisms();
      if (supportedMechanisms.contains(AuthMechanism.CLIENT_CERT)) {
        if (supportedMechanisms.contains(AuthMechanism.DIGEST) || supportedMechanisms.contains(AuthMechanism.PLAIN)) {
          serverOptionsBuilder.set(SSL_CLIENT_AUTH_MODE,REQUESTED);
        }
 else {
          serverOptionsBuilder.set(SSL_CLIENT_AUTH_MODE,REQUIRED);
        }
      }
      OptionMap secureOptions=serverOptionsBuilder.getMap();
      XnioSsl xnioSsl=new JsseXnioSsl(worker.getXnio(),secureOptions,sslContext);
      secureServer=xnioSsl.createSslConnectionServer(worker,secureAddress,acceptListener,secureOptions);
      secureServer.resumeAccepts();
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
