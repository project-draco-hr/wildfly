{
  output.writeByte(ModelControllerProtocol.PARAM_SUBJECT_LENGTH);
  if (subject != null) {
    Collection<Principal> principals=subject.getPrincipals();
    Collection<PrincipalWriter> writers=new ArrayList<PrincipalWriter>(principals.size());
    for (    Principal current : principals) {
      PrincipalWriter writer=findWriter(current);
      if (writer != null) {
        writers.add(writer);
      }
    }
    output.writeInt(1);
    output.write(PRINCIPALS_PARAM);
    output.writeInt(writers.size());
    for (    PrincipalWriter current : writers) {
      current.write(output);
    }
  }
 else {
    output.writeInt(0);
  }
}
