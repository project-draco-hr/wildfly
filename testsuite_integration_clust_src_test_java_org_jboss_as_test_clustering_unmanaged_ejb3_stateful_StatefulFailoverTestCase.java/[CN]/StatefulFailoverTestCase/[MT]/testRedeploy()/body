{
  controller.start(CONTAINER1);
  deployer.deploy(DEPLOYMENT1);
  DefaultHttpClient client=new DefaultHttpClient();
  String url1="http://127.0.0.1:8080/stateful/count";
  String url2="http://127.0.0.1:8180/stateful/count";
  try {
    assertQueryCount(10101,client,url1);
    assertQueryCount(20202,client,url1);
    controller.start(CONTAINER2);
    deployer.deploy(DEPLOYMENT2);
    assertQueryCount(30303,client,url1);
    assertQueryCount(40404,client,url1);
    assertQueryCount(50505,client,url2);
    assertQueryCount(60606,client,url2);
    deployer.undeploy(DEPLOYMENT2);
    assertQueryCount(70707,client,url1);
    assertQueryCount(80808,client,url1);
    deployer.deploy(DEPLOYMENT2);
    assertQueryCount(90909,client,url1);
    assertQueryCount(101010,client,url1);
    assertQueryCount(111111,client,url2);
    assertQueryCount(121212,client,url2);
    deployer.undeploy(DEPLOYMENT1);
    assertQueryCount(131313,client,url2);
    assertQueryCount(141414,client,url2);
    deployer.deploy(DEPLOYMENT1);
    assertQueryCount(151515,client,url1);
    assertQueryCount(161616,client,url1);
    assertQueryCount(171717,client,url2);
    assertQueryCount(181818,client,url2);
  }
  finally {
    client.getConnectionManager().shutdown();
    this.cleanup(DEPLOYMENT1,CONTAINER1);
    this.cleanup(DEPLOYMENT2,CONTAINER2);
  }
}
