{
  context.addStep(new OperationStepHandler(){
    @Override public void execute(    OperationContext context,    ModelNode operation) throws OperationFailedException {
      RegisterMBeanServerDelegateService mbeanServerService=new RegisterMBeanServerDelegateService();
      context.getServiceTarget().addService(RegisterMBeanServerDelegateService.SERVICE_NAME,mbeanServerService).addDependency(MBeanServerService.SERVICE_NAME,PluggableMBeanServer.class,mbeanServerService.injectedMbeanServer).addDependency(Services.JBOSS_SERVER_CONTROLLER,ModelController.class,mbeanServerService.injectedController).setInitialMode(Mode.ACTIVE).install();
      RegisterManagementEJBService managementEjbService=new RegisterManagementEJBService();
      context.getServiceTarget().addService(RegisterManagementEJBService.SERVICE_NAME,managementEjbService).addDependency(DeploymentRepository.SERVICE_NAME,DeploymentRepository.class,managementEjbService.deploymentRepositoryValue).addDependency(MBeanServerService.SERVICE_NAME,MBeanServer.class,managementEjbService.mbeanServerValue).addDependency(EjbClientContextService.DEFAULT_SERVICE_NAME,EJBClientContext.class,managementEjbService.ejbClientContextValue).addDependency(TCCLBasedEJBClientContextSelector.TCCL_BASED_EJB_CLIENT_CONTEXT_SELECTOR_SERVICE_NAME,TCCLBasedEJBClientContextSelector.class,managementEjbService.ejbClientContextSelectorValue).setInitialMode(Mode.ACTIVE).install();
      final ContextNames.BindInfo bindInfo=ContextNames.bindInfoFor(JNDI_NAME);
      final BinderService binderService=new BinderService(bindInfo.getBindName(),null);
      context.getServiceTarget().addService(bindInfo.getBinderServiceName(),binderService).addInjection(binderService.getManagedObjectInjector(),new RemoteViewManagedReferenceFactory(APP_NAME,MODULE_NAME,DISTINCT_NAME,EJB_NAME,ManagementHome.class.getName(),false)).addDependency(bindInfo.getParentContextServiceName(),ServiceBasedNamingStore.class,binderService.getNamingStoreInjector()).setInitialMode(Mode.ACTIVE).install();
      TempMBeanService tempService=new TempMBeanService();
      context.getServiceTarget().addService(TempMBeanService.SERVICE_NAME,tempService).addDependency(MBeanServerService.SERVICE_NAME,MBeanServer.class,tempService.mbeanServerValue).addDependency(EjbClientContextService.DEFAULT_SERVICE_NAME,EJBClientContext.class,tempService.ejbClientContextValue).setInitialMode(Mode.ACTIVE).install();
      context.completeStep();
    }
  }
,Stage.RUNTIME);
}
