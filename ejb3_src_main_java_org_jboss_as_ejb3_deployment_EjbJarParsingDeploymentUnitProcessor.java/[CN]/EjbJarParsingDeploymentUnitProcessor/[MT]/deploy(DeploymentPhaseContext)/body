{
  DeploymentUnit deploymentUnit=deploymentPhase.getDeploymentUnit();
  VirtualFile deploymentRoot=deploymentUnit.getAttachment(Attachments.DEPLOYMENT_ROOT).getRoot();
  VirtualFile ejbJarXml=null;
  if (deploymentRoot.getName().toLowerCase().endsWith(WAR_FILE_EXTENSION)) {
    ejbJarXml=deploymentRoot.getChild(EJB_JAR_XML_LOCATION_IN_WAR);
  }
 else   if (deploymentRoot.getName().toLowerCase().endsWith(JAR_FILE_EXTENSION)) {
    ejbJarXml=deploymentRoot.getChild(EJB_JAR_XML_LOCATION_IN_JAR);
  }
 else {
    return;
  }
  if (ejbJarXml == null) {
    return;
  }
  XMLStreamReader reader=this.getXMLStreamReader(ejbJarXml);
  MetaDataElementParser.DTDInfo dtdInfo=new MetaDataElementParser.DTDInfo();
  try {
    EjbJarMetaData ejbJarMetaData=EjbJarMetaDataParser.parse(reader,dtdInfo);
    deploymentUnit.putAttachment(EjbDeploymentAttachmentKeys.EJB_JAR_METADATA,ejbJarMetaData);
  }
 catch (  XMLStreamException xmlse) {
    throw new DeploymentUnitProcessingException("Exception while parsing ejb-jar.xml: " + ejbJarXml.getPathName(),xmlse);
  }
}
