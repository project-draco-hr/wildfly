{
  ServiceName baseServiceName=EmbeddedCacheManagerService.getServiceName(null);
  ServiceName serviceName=ServiceName.parse((this.cacheName != null) ? this.cacheName : DEFAULT_BACKING_CACHE);
  if (!baseServiceName.isParentOf(serviceName)) {
    serviceName=baseServiceName.append(serviceName);
  }
  if (serviceName.length() < 4) {
    serviceName=serviceName.append(CacheContainer.DEFAULT_CACHE_NAME);
  }
  String container=serviceName.getParent().getSimpleName();
  final CoreGroupCommunicationServiceService groupCommunicationService=new CoreGroupCommunicationServiceService(SCOPE_ID);
  groupCommunicationService.build(target,container).setInitialMode(ServiceController.Mode.ON_DEMAND).addDependency(ServiceBuilder.DependencyType.OPTIONAL,GroupMembershipNotifierRegistryService.SERVICE_NAME,GroupMembershipNotifierRegistry.class,groupCommunicationService.getGroupMembershipNotifierRegistryInjector()).install();
  new SharedLocalYieldingClusterLockManagerService(container).build(target).setInitialMode(ServiceController.Mode.ON_DEMAND).install();
  ServiceName registryServiceName=ServiceName.JBOSS.append("ejb",container,"registry");
  new RegistryService<String,InetAddress>(this).build(target,registryServiceName,CacheService.getServiceName(container,"registry")).addDependency(serviceName,Cache.class,this.groupCache).addDependency(ServerEnvironmentService.SERVICE_NAME,ServerEnvironment.class,this.environment).install();
  builder.addDependency(SharedLocalYieldingClusterLockManagerService.getServiceName(container),SharedLocalYieldingClusterLockManager.class,this.lockManager);
  builder.addDependency(registryServiceName,Registry.class,this.registry);
}
