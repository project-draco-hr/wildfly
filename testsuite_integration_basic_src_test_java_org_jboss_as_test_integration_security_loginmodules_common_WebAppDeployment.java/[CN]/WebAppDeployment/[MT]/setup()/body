{
  log.debug("start setup()");
  try {
    createSecurityDomain();
  }
 catch (  Exception e) {
    log.error("updateSecurityDomain() throws exception: " + e.getMessage());
    throw new RuntimeException(e);
  }
  war=ShrinkWrap.create(WebArchive.class,deploymentName + ".war");
  war.addClass(servletClass);
  war.addClass(AbstractLoginModuleTestServlet.class);
  war.addAsWebResource(WebAppDeployment.class.getPackage(),"login.jsp","login.jsp");
  war.addAsWebResource(WebAppDeployment.class.getPackage(),"error.jsp","error.jsp");
  war.addAsWebInfResource(new StringAsset("<?xml version=\"1.0\"?>" + "<jboss-web>" + "<security-domain>" + getSecurityDomainName() + "</security-domain>"+ "</jboss-web>"),"jboss-web.xml");
  for (  Class clazz : classes) {
    war.addClass(clazz);
  }
  war.addAsWebInfResource(WebAppDeployment.class.getPackage(),"web.xml","web.xml");
  setUp=true;
  log.debug("setup completed");
}
