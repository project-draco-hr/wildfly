{
  String entityName=metadata.getEJBName();
  if (entityName != null) {
    Catalog catalog=entity.getManager().getCatalog();
    JDBCEntityBridge2 otherEntity=(JDBCEntityBridge2)catalog.getEntityByEJBName(entityName);
    if (otherEntity == null) {
      throw new RuntimeException("Unknown entity: " + entityName);
    }
    this.entity=otherEntity;
  }
 else {
    this.entity=entity;
  }
  String fieldName=metadata.getFieldName();
  if (fieldName == null) {
    setEntityReader(this.entity,metadata.isSelectDistinct());
  }
 else {
    selectedField=(JDBCCMPFieldBridge2)entity.getFieldByName(fieldName);
    if (selectedField == null) {
      throw new RuntimeException("Unknown cmp field: " + fieldName);
    }
    setFieldReader(selectedField);
  }
}
