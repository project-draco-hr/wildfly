{
  StringBuffer sqlBuf=new StringBuffer();
  ArrayList params=new ArrayList();
  if (sql != null) {
    sql=sql.trim();
    StringTokenizer tokens=new StringTokenizer(sql,"{}",true);
    while (tokens.hasMoreTokens()) {
      String token=tokens.nextToken();
      if (token.equals("{")) {
        token=tokens.nextToken();
        if (Character.isDigit(token.charAt(0))) {
          QueryParameter parameter=new QueryParameter(entity.getManager(),metadata.getMethod(),token);
          sqlBuf.append("?");
          params.add(parameter);
          if (!tokens.nextToken().equals("}")) {
            throw new RuntimeException("Invalid parameter - missing closing '}' : " + sql);
          }
        }
 else {
          sqlBuf.append("{").append(token);
        }
      }
 else {
        sqlBuf.append(token);
      }
    }
  }
  setParameters(params);
  return sqlBuf.toString();
}
