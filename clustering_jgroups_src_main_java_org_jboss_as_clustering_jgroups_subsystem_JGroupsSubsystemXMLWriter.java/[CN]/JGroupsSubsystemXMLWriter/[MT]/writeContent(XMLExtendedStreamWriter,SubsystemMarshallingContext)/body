{
  context.startSubsystemElement(JGroupsSchema.CURRENT.getNamespaceUri(),false);
  ModelNode model=context.getModelNode();
  if (model.isDefined()) {
    if (model.hasDefined(ChannelResourceDefinition.WILDCARD_PATH.getKey())) {
      writer.writeStartElement(Element.CHANNELS.getLocalName());
      JGroupsSubsystemResourceDefinition.DEFAULT_CHANNEL.marshallAsAttribute(model,writer);
      for (      Property property : model.get(ChannelResourceDefinition.WILDCARD_PATH.getKey()).asPropertyList()) {
        writer.writeStartElement(Element.CHANNEL.getLocalName());
        writer.writeAttribute(Attribute.NAME.getLocalName(),property.getName());
        ModelNode channel=property.getValue();
        ChannelResourceDefinition.STACK.marshallAsAttribute(channel,writer);
        ChannelResourceDefinition.MODULE.marshallAsAttribute(channel,writer);
        writer.writeEndElement();
      }
      writer.writeEndElement();
    }
    if (model.hasDefined(StackResourceDefinition.WILDCARD_PATH.getKey())) {
      writer.writeStartElement(Element.STACKS.getLocalName());
      JGroupsSubsystemResourceDefinition.DEFAULT_STACK.marshallAsAttribute(model,writer);
      for (      Property property : model.get(StackResourceDefinition.WILDCARD_PATH.getKey()).asPropertyList()) {
        writer.writeStartElement(Element.STACK.getLocalName());
        writer.writeAttribute(Attribute.NAME.getLocalName(),property.getName());
        ModelNode stack=property.getValue();
        if (stack.get(TransportResourceDefinition.PATH.getKeyValuePair()).isDefined()) {
          writeTransport(writer,stack.get(TransportResourceDefinition.PATH.getKeyValuePair()));
        }
        if (stack.hasDefined(ProtocolResourceDefinition.WILDCARD_PATH.getKey())) {
          for (          Property protocol : StackAddHandler.getOrderedProtocolPropertyList(stack)) {
            writeProtocol(writer,protocol.getValue());
          }
        }
        if (stack.get(RelayResourceDefinition.PATH.getKeyValuePair()).isDefined()) {
          writeRelay(writer,stack.get(RelayResourceDefinition.PATH.getKeyValuePair()));
        }
        writer.writeEndElement();
      }
      writer.writeEndElement();
    }
  }
  writer.writeEndElement();
}
