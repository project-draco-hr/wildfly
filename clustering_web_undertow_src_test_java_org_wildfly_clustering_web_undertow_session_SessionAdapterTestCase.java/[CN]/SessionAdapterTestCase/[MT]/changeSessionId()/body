{
  HttpServerExchange exchange=new HttpServerExchange(null);
  SessionConfig config=mock(SessionConfig.class);
  SessionManager<LocalSessionContext> manager=mock(SessionManager.class);
  Session<LocalSessionContext> session=mock(Session.class);
  SessionAttributes oldAttributes=mock(SessionAttributes.class);
  SessionAttributes newAttributes=mock(SessionAttributes.class);
  SessionMetaData oldMetaData=mock(SessionMetaData.class);
  SessionMetaData newMetaData=mock(SessionMetaData.class);
  LocalSessionContext oldContext=mock(LocalSessionContext.class);
  LocalSessionContext newContext=mock(LocalSessionContext.class);
  String sessionId="session";
  String route="route";
  String routedSessionid="session:route";
  String name="name";
  Object value=new Object();
  Date date=new Date();
  long interval=10L;
  AuthenticatedSession authenticatedSession=new AuthenticatedSession(null,null);
  ArgumentCaptor<TimeUnit> capturedUnit=ArgumentCaptor.forClass(TimeUnit.class);
  when(this.manager.getSessionManager()).thenReturn(manager);
  when(manager.createSessionId()).thenReturn(sessionId);
  when(manager.createSession(sessionId)).thenReturn(session);
  when(this.session.getAttributes()).thenReturn(oldAttributes);
  when(this.session.getMetaData()).thenReturn(oldMetaData);
  when(session.getAttributes()).thenReturn(newAttributes);
  when(session.getMetaData()).thenReturn(newMetaData);
  when(oldAttributes.getAttributeNames()).thenReturn(Collections.singleton(name));
  when(oldAttributes.getAttribute(name)).thenReturn(value);
  when(newAttributes.setAttribute(name,value)).thenReturn(null);
  when(oldMetaData.getLastAccessedTime()).thenReturn(date);
  when(oldMetaData.getMaxInactiveInterval(capturedUnit.capture())).thenReturn(interval);
  when(session.getId()).thenReturn(sessionId);
  when(manager.locate(sessionId)).thenReturn(route);
  when(this.session.getLocalContext()).thenReturn(oldContext);
  when(session.getLocalContext()).thenReturn(newContext);
  when(oldContext.getAuthenticatedSession()).thenReturn(authenticatedSession);
  when(this.manager.format(sessionId,route)).thenReturn(routedSessionid);
  String result=this.adapter.changeSessionId(exchange,config);
  assertSame(sessionId,result);
  verify(newMetaData).setLastAccessedTime(date);
  verify(newMetaData).setMaxInactiveInterval(interval,capturedUnit.getValue());
  verify(config).setSessionId(exchange,routedSessionid);
  verify(newContext).setAuthenticatedSession(same(authenticatedSession));
}
