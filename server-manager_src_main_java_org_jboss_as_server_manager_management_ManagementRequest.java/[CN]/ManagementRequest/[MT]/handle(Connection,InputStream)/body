{
  try {
    expectHeader(input,ManagementProtocol.RESPONSE_START);
    byte responseCode=StreamUtils.readByte(input);
    if (responseCode != getResponseCode()) {
      throw new ManagementException("Invalid response code.  Expecting '" + getResponseCode() + "' received '"+ responseCode+ "'");
    }
    connection.setMessageHandler(responseBodyHandler);
  }
 catch (  ManagementException e) {
    future.setException(e);
  }
catch (  Throwable t) {
    future.setException(new ManagementException("Failed to handle management message",t));
  }
}
