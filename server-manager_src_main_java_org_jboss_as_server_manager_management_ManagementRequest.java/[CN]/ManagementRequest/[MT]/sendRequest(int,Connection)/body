{
  OutputStream outputStream=null;
  ByteDataOutput output=null;
  try {
    try {
      outputStream=connection.writeMessage();
      output=new SimpleByteDataOutput(outputStream);
      output.writeByte(ManagementProtocol.REQUEST_OPERATION);
      output.writeByte(getRequestCode());
      output.writeByte(ManagementProtocol.REQUEST_START);
      output.close();
      outputStream.close();
    }
  finally {
      safeClose(output);
      safeClose(outputStream);
    }
    try {
      outputStream=connection.writeMessage();
      sendRequest(protocolVersion,outputStream);
      outputStream.close();
    }
  finally {
      safeClose(outputStream);
    }
    try {
      outputStream=connection.writeMessage();
      output=new SimpleByteDataOutput(outputStream);
      output.writeByte(ManagementProtocol.REQUEST_END);
      output.close();
      outputStream.close();
    }
  finally {
      safeClose(output);
      safeClose(outputStream);
    }
  }
 catch (  ManagementException e) {
    throw e;
  }
catch (  Throwable t) {
    throw new ManagementException("Failed to send management request",t);
  }
}
