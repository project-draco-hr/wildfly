{
  deployer.deploy(MODULE_A);
  try {
    InputStream inputA=deployer.getDeployment(BUNDLE_A);
    Bundle bundleA=context.installBundle(BUNDLE_A,inputA);
    try {
      FrameworkWiring fwkWiring=context.getBundle().adapt(FrameworkWiring.class);
      Assert.assertTrue(fwkWiring.resolveBundles(Collections.singleton(bundleA)));
      BundleWiring wiringA=bundleA.adapt(BundleWiring.class);
      List<BundleWire> wires=wiringA.getRequiredWires(PackageNamespace.PACKAGE_NAMESPACE);
      Assert.assertEquals(1,wires.size());
      BundleWire wire=wires.get(0);
      Assert.assertEquals(bundleA,wire.getRequirer().getBundle());
      XBundleRevision provider=(XBundleRevision)wire.getProvider();
      XIdentityCapability icap=provider.getIdentityCapability();
      Assert.assertEquals("deployment.module-a",icap.getName());
    }
  finally {
      bundleA.uninstall();
    }
  }
  finally {
    deployer.undeploy(MODULE_A);
  }
}
