{
  deployer.deploy(MODULE_A);
  try {
    XBundleRevisionBuilder builder=XBundleRevisionBuilderFactory.create();
    builder.addCapability(IdentityNamespace.IDENTITY_NAMESPACE,"somename");
    XRequirement req=builder.addRequirement(PackageNamespace.PACKAGE_NAMESPACE,"org.jboss.as.test.integration.osgi.classloading.suba");
    builder.getResource();
    List<Capability> caps=getEnvironment().findProviders(req);
    Assert.assertEquals(1,caps.size());
    XBundleRevision brev=(XBundleRevision)caps.get(0).getResource();
    XIdentityCapability icap=brev.getIdentityCapability();
    Assert.assertEquals("deployment.module-a",icap.getName());
    Assert.assertEquals(Version.emptyVersion,icap.getVersion());
    Assert.assertEquals(XResource.TYPE_MODULE,icap.getType());
    caps=brev.getCapabilities(PackageNamespace.PACKAGE_NAMESPACE);
    Assert.assertEquals("One exported package capability",1,caps.size());
  }
  finally {
    deployer.undeploy(MODULE_A);
  }
}
