{
  GenericPrincipal principal=(GenericPrincipal)principals.get(username);
  boolean validated=false;
  if (principal != null && credentials != null) {
    if (hasMessageDigest()) {
      validated=(digest(credentials).equalsIgnoreCase(principal.getPassword()));
    }
 else {
      validated=(digest(credentials).equals(principal.getPassword()));
    }
  }
  if (validated) {
    if (log.isDebugEnabled())     log.debug(sm.getString("memoryRealm.authenticateSuccess",username));
    return (principal);
  }
 else {
    if (log.isDebugEnabled())     log.debug(sm.getString("memoryRealm.authenticateFailure",username));
    return (null);
  }
}
