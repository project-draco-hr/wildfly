{
  UserInfo userInfo=channel.getConnection().getUserInfo();
  if (userInfo instanceof SubjectUserInfo) {
    final Subject subject=((SubjectUserInfo)userInfo).getSubject();
    try {
      AccessAuditContext.doAs(subject,new PrivilegedExceptionAction<Void>(){
        @Override public Void run() throws IOException {
          SecurityActions.currentAccessAuditContext().setAccessMechanism(AccessMechanism.JMX);
          event.run();
          return null;
        }
      }
);
    }
 catch (    PrivilegedActionException e) {
      Exception cause=e.getException();
      if (cause instanceof IOException) {
        throw (IOException)cause;
      }
 else {
        throw new IOException(cause);
      }
    }
  }
 else {
    event.run();
  }
}
