{
  UserInfo userInfo=channel.getConnection().getUserInfo();
  final Subject subject;
  if (userInfo instanceof SubjectUserInfo) {
    subject=((SubjectUserInfo)userInfo).getSubject();
  }
 else {
    subject=new Subject();
  }
  try {
    AccessAuditContext.doAs(subject,new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws IOException {
        SecurityActions.currentAccessAuditContext().setAccessMechanism(AccessMechanism.JMX);
        event.run();
        return null;
      }
    }
);
  }
 catch (  PrivilegedActionException e) {
    Exception cause=e.getException();
    if (cause instanceof IOException) {
      throw (IOException)cause;
    }
 else {
      throw new IOException(cause);
    }
  }
}
