{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (DeploymentTypeMarker.isType(DeploymentType.EAR,deploymentUnit)) {
    return;
  }
  final DeploymentUnit parentEar=deploymentUnit.getParent();
  if (parentEar == null) {
    return;
  }
  final List<DeploymentUnit> subDeployments=parentEar.getAttachmentList(Attachments.SUB_DEPLOYMENTS);
  if (subDeployments == null || subDeployments.isEmpty()) {
    return;
  }
  final ResourceRoot deploymentRoot=deploymentUnit.getAttachment(Attachments.DEPLOYMENT_ROOT);
  for (  DeploymentUnit subDeployment : subDeployments) {
    final ResourceRoot subDeploymentRoot=subDeployment.getAttachment(Attachments.DEPLOYMENT_ROOT);
    if (subDeploymentRoot.equals(deploymentRoot)) {
      continue;
    }
    if (DeploymentTypeMarker.isType(DeploymentType.WAR,subDeployment)) {
      continue;
    }
    final ModuleIdentifier subDeploymentModuleIdentifier=subDeployment.getAttachment(Attachments.MODULE_IDENTIFIER);
    logger.debug("Subdeployment " + subDeployment + " with module identifier "+ subDeploymentModuleIdentifier+ " will be added to the classpath entries of deployment unit "+ deploymentUnit);
    deploymentUnit.addToAttachmentList(Attachments.CLASS_PATH_ENTRIES,subDeploymentModuleIdentifier);
  }
}
