{
  final String value=element.getProperty(name);
switch (kind) {
case ADD:
    try {
      return new PropertiesUpdate(Kind.REMOVE,name,null);
    }
  finally {
      element.addProperty(name,propertyUpdate.getValue());
    }
case CHANGE:
  try {
    return new PropertiesUpdate(Kind.CHANGE,name,new PropertyUpdate(value));
  }
  finally {
    element.changeProperty(name,propertyUpdate.getValue());
  }
case REMOVE:
try {
  return new PropertiesUpdate(Kind.ADD,name,new PropertyUpdate(value));
}
  finally {
  element.removeProperty(name);
}
default :
throw new IllegalStateException();
}
}
