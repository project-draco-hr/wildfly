{
  final BatchBuilder batchBuilder=serviceActivatorContext.getBatchBuilder();
  final String deploymentName=key.getName() + ":" + key.getSha1HashAsHexString();
  final ServiceName deploymentServiceName=DeploymentService.SERVICE_NAME.append(deploymentName);
  batchBuilder.addService(deploymentServiceName,new DeploymentService(deploymentName));
  final BatchBuilder deploymentSubBatch=batchBuilder.subBatchBuilder();
  deploymentSubBatch.addDependency(deploymentServiceName);
  final DeploymentItemContext deploymentItemContext=new DeploymentItemContextImpl(deploymentSubBatch);
  final Collection<DeploymentItem> deploymentItems=DeploymentItemRegistry.getDeploymentItems(key);
  if (deploymentItems == null)   throw new RuntimeException("Failed to find deployment items for deployment: " + key);
  for (  DeploymentItem deploymentItem : deploymentItems) {
    deploymentItem.install(deploymentItemContext);
  }
}
