{
  final DeploymentChain deploymentChain=deploymentService.getDeploymentChain();
  final DeploymentModuleLoader deploymentModuleLoader=deploymentService.getModuleLoader();
  DeploymentModuleLoaderSelector.CURRENT_MODULE_LOADER.set(deploymentModuleLoader);
  try {
    deploymentChain.processDeployment(deploymentUnitContext);
  }
 catch (  DeploymentUnitProcessingException e) {
    throw new DeploymentException("Failed to process deployment chain.",e);
  }
 finally {
    DeploymentModuleLoaderSelector.CURRENT_MODULE_LOADER.set(null);
  }
}
