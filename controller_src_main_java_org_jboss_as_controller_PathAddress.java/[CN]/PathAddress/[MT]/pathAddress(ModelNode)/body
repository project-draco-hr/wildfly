{
  final Map<String,PathElement> pathMap;
  if (node.isDefined()) {
    final List<Property> props=new ArrayList<Property>();
    String key=null;
    for (    ModelNode element : node.asList()) {
      Property prop=null;
      if (element.getType() == ModelType.PROPERTY) {
        prop=element.asProperty();
      }
 else       if (key == null) {
        key=element.asString();
      }
 else {
        prop=new Property(key,element);
      }
      if (prop != null) {
        props.add(prop);
        key=null;
      }
    }
    if (props.size() == 0) {
      return EMPTY_ADDRESS;
    }
 else {
      pathMap=new LinkedHashMap<String,PathElement>();
      for (      final Property prop : props) {
        final String name=prop.getName();
        if (pathMap.put(name,new PathElement(name,prop.getValue().asString())) != null) {
          throw duplicateElement(name);
        }
      }
    }
  }
 else {
    return EMPTY_ADDRESS;
  }
  return new PathAddress(Collections.unmodifiableList(new ArrayList<PathElement>(pathMap.values())));
}
