{
  super.setupServices(batchBuilder);
  deploymentChain.removeProcessor(deploymentModuleLoaderProcessor,Phase.DEPLOYMENT_MODULE_LOADER_PROCESSOR);
  deploymentModuleLoaderProcessor=new DeploymentModuleLoaderProcessor(new DeploymentModuleLoaderImpl());
  deploymentChain.addProcessor(deploymentModuleLoaderProcessor,Phase.DEPLOYMENT_MODULE_LOADER_PROCESSOR);
  javaContext=new MockContext();
  batchBuilder.addService(ContextNames.JAVA_CONTEXT_SERVICE_NAME,new PassthroughService<Context>(javaContext));
  final Context globalContext=javaContext.createSubcontext("global");
  batchBuilder.addService(ContextNames.GLOBAL_CONTEXT_SERVICE_NAME,new PassthroughService<Context>(globalContext));
  globalContext.bind("someNumber",Integer.valueOf(99));
  batchBuilder.addService(DeploymentChain.SERVICE_NAME,new DeploymentChainService(deploymentChain));
}
