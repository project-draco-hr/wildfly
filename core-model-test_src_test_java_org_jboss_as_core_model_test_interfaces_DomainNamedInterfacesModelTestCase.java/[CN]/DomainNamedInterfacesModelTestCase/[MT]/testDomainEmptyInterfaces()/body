{
  KernelServices kernelServices=createKernelServicesBuilder(ModelType.DOMAIN).setXmlResource("domain-empty.xml").build();
  Assert.assertTrue(kernelServices.isSuccessfulBoot());
  String marshalled=kernelServices.getPersistedSubsystemXml();
  ModelNode original=kernelServices.readWholeModel();
  kernelServices=createKernelServicesBuilder(ModelType.DOMAIN).setXml(marshalled).build();
  Assert.assertTrue(kernelServices.isSuccessfulBoot());
  ModelTestUtils.compare(original,kernelServices.readWholeModel());
}
