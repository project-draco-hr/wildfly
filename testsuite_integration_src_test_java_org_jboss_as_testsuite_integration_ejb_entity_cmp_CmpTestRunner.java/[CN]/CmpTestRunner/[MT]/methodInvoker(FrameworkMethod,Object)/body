{
  final AbstractCmpTest cmpTest=AbstractCmpTest.class.cast(test);
  return super.methodInvoker(new FrameworkMethod(method.getMethod()){
    public Object invokeExplosively(    final Object target,    final Object... params) throws Throwable {
      getTransactionWrapper(cmpTest).invokeWithTransaction(new TransactionWrappingSessionBean.Task<Void>(){
        public Void execute() throws Throwable {
          cmpTest.setUpEjb();
          return null;
        }
      }
);
      Object result=getTransactionWrapper(cmpTest).invokeWithTransaction(new TransactionWrappingSessionBean.Task<Object>(){
        public Object execute() throws Throwable {
          return method.invokeExplosively(target,params);
        }
      }
);
      getTransactionWrapper(cmpTest).invokeWithTransaction(new TransactionWrappingSessionBean.Task<Void>(){
        public Void execute() throws Throwable {
          cmpTest.tearDownEjb();
          return null;
        }
      }
);
      return result;
    }
  }
,test);
}
