{
  ServiceName serviceName=depUnit.getServiceName().append("Activate");
  BundleActivateService service=new BundleActivateService(depUnit,bundle);
  ServiceBuilder<XBundle> builder=serviceTarget.addService(serviceName,service);
  OSGiMetaData metadata=depUnit.getAttachment(OSGiConstants.OSGI_METADATA_KEY);
  if (metadata != null && metadata.getBundleActivator() != null) {
    String activatorClass=metadata.getBundleActivator();
    EEModuleDescription moduleDescription=depUnit.getAttachment(EE_MODULE_DESCRIPTION);
    if (moduleDescription != null) {
      for (      ComponentDescription componentDescription : moduleDescription.getComponentDescriptions()) {
        if (activatorClass.equals(componentDescription.getComponentClassName())) {
          ServiceName startServiceName=componentDescription.getStartServiceName();
          builder.addDependency(startServiceName,Component.class,service.injectedComponent);
        }
      }
    }
  }
  builder.addDependencies(depUnit.getAttachmentList(Attachments.BUNDLE_ACTIVE_DEPENDENCIES));
  return builder.install();
}
