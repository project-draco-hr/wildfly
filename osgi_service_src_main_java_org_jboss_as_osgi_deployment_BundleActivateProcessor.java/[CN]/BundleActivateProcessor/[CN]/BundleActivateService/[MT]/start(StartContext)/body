{
  Deployment deployment=depUnit.getAttachment(OSGiConstants.DEPLOYMENT_KEY);
  BundleManager bundleManager=depUnit.getAttachment(OSGiConstants.BUNDLE_MANAGER_KEY);
  Component activatorComponent=injectedComponent.getOptionalValue();
  if (activatorComponent != null && deployment.getAttachment(BUNDLE_ACTIVATOR_KEY) == null) {
    ComponentInstance componentInstance=activatorComponent.createInstance();
    BundleActivator instance=(BundleActivator)componentInstance.getInstance();
    deployment.putAttachment(BUNDLE_ACTIVATOR_KEY,instance);
  }
  if (bundle.getState() != Bundle.ACTIVE) {
    try {
      bundleManager.startBundle(bundle,Bundle.START_ACTIVATION_POLICY);
      depUnit.putAttachment(Attachments.BUNDLE_STATE_KEY,BundleState.ACTIVE);
    }
 catch (    BundleException ex) {
      throw MESSAGES.cannotStartBundle(ex,bundle);
    }
  }
}
