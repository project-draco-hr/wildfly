{
  XBundle bundle=injectedBundle.getValue();
  Deployment deployment=depUnit.getAttachment(OSGiConstants.DEPLOYMENT_KEY);
  if (bundle != null && deployment.isAutoStart() && bundle.isResolved()) {
    Component activatorComponent=injectedComponent.getOptionalValue();
    if (activatorComponent != null) {
      ComponentInstance componentInstance=activatorComponent.createInstance();
      BundleActivator instance=(BundleActivator)componentInstance.getInstance();
      deployment.addAttachment(BundleActivator.class,instance);
    }
    try {
      bundle.start(Bundle.START_ACTIVATION_POLICY);
      depUnit.putAttachment(Attachments.BUNDLE_STATE_KEY,BundleState.ACTIVE);
    }
 catch (    BundleException ex) {
      throw MESSAGES.cannotStartBundle(ex,bundle);
    }
  }
}
