{
  MBeanServerConnection mbeanServer=runtime.getMBeanServer();
  Object[] params=new Object[]{serviceName.getCanonicalName()};
  String[] signature=new String[]{String.class.getName()};
  String state=(String)mbeanServer.invoke(SERVICE_CONTAINER_OBJECTNAME,"getState",params,signature);
  while ((state == null || state != expState.toString()) && timeout > 0) {
    try {
      Thread.sleep(100);
    }
 catch (    InterruptedException ex) {
    }
    state=(String)mbeanServer.invoke(SERVICE_CONTAINER_OBJECTNAME,"getState",params,signature);
    timeout-=100;
  }
  return state != null ? State.valueOf(state) : null;
}
