{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final ResourceRoot resourceRoot=deploymentUnit.getAttachment(org.jboss.as.server.deployment.Attachments.DEPLOYMENT_ROOT);
  final ServiceModuleLoader moduleLoader=deploymentUnit.getAttachment(org.jboss.as.server.deployment.Attachments.SERVICE_MODULE_LOADER);
  VirtualFile descriptorFile=null;
  for (  final String loc : EJB_CLIENT_DESCRIPTOR_LOCATIONS) {
    final VirtualFile file=resourceRoot.getRoot().getChild(loc);
    if (file.exists()) {
      descriptorFile=file;
      break;
    }
  }
  if (descriptorFile == null) {
    return;
  }
  if (deploymentUnit.getParent() != null) {
    logger.warnf("%s in subdeployment ignored. jboss-ejb-client.xml is only parsed for top level deployments.",descriptorFile.getPathName());
    return;
  }
  final File ejbClientDeploymentDescriptorFile;
  try {
    ejbClientDeploymentDescriptorFile=descriptorFile.getPhysicalFile();
  }
 catch (  IOException e) {
    throw EeMessages.MESSAGES.failedToProcessEJBClientDescriptor(e);
  }
  final EJBClientDescriptorMetaData ejbClientDescriptorMetaData=parse(ejbClientDeploymentDescriptorFile,deploymentUnit,moduleLoader);
  logger.debug("Successfully parsed jboss-ejb-client.xml for deployment unit " + deploymentUnit);
  deploymentUnit.putAttachment(Attachments.EJB_CLIENT_METADATA,ejbClientDescriptorMetaData);
}
