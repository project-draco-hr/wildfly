{
  try {
    final InputStream input=archive.as(ZipExporter.class).exportAsInputStream();
    try {
      DeploymentPlanBuilder builder=deploymentManager.newDeploymentPlan();
      builder=builder.add(archive.getName(),input).andDeploy();
      DeploymentPlan plan=builder.build();
      DeploymentAction deployAction=builder.getLastAction();
      return executeDeploymentPlan(plan,deployAction);
    }
  finally {
      if (input != null)       try {
        input.close();
      }
 catch (      IOException e) {
        log.warnf(e,"Failed to close resource %s",input);
      }
    }
  }
 catch (  Exception e) {
    String rcMessage=e.getMessage();
    Throwable rootCause=e.getCause();
    while (null != rootCause) {
      rcMessage=rootCause.getMessage();
      rootCause=rootCause.getCause();
    }
    throw new DeploymentException("Could not deploy to container: " + rcMessage,e);
  }
}
