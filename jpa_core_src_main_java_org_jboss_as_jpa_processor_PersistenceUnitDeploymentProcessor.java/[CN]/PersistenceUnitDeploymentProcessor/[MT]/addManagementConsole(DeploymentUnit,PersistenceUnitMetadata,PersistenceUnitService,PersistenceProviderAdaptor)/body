{
  ManagementAdaptor managementAdaptor=adaptor.getManagementAdaptor();
  if (managementAdaptor != null) {
    final String providerLabel=managementAdaptor.getIdentificationLabel();
    final String scopedPersistenceUnitName=pu.getScopedPersistenceUnitName();
    final String filteredPersistenceUnitName=ManagementUtil.filterScopedPuNameForManagement(scopedPersistenceUnitName);
    Resource providerResource=managementAdaptor.createManagementResource(filteredPersistenceUnitName,persistenceUnitService);
    ModelNode perPuNode=providerResource.getModel();
    perPuNode.get("scoped-unit-name").set(pu.getScopedPersistenceUnitName());
    AttachmentKey<Resource> key=AttachmentKey.create(Resource.class);
    final Resource deploymentResource=deploymentUnit.getAttachment(key);
    Resource subsystemResource;
synchronized (deploymentResource) {
      subsystemResource=getOrCreateResource(deploymentResource,PathElement.pathElement(ModelDescriptionConstants.SUBSYSTEM,"jpa"));
    }
synchronized (subsystemResource) {
      subsystemResource.registerChild(PathElement.pathElement(providerLabel,filteredPersistenceUnitName),providerResource);
    }
  }
}
