{
  ManagementAdaptor managementAdaptor=adaptor.getManagementAdaptor();
  if (managementAdaptor != null) {
    final String providerLabel=managementAdaptor.getIdentificationLabel();
    final String scopedPersistenceUnitName=pu.getScopedPersistenceUnitName();
    Resource providerResource=managementAdaptor.createPersistenceUnitResource(scopedPersistenceUnitName);
    ModelNode perPuNode=providerResource.getModel();
    perPuNode.get("scoped-unit-name").set(pu.getScopedPersistenceUnitName());
    final Resource deploymentResource=deploymentUnit.getAttachment(DeploymentModelUtils.DEPLOYMENT_RESOURCE);
    Resource subsystemResource;
synchronized (deploymentResource) {
      subsystemResource=getOrCreateResource(deploymentResource,PathElement.pathElement(ModelDescriptionConstants.SUBSYSTEM,"jpa"));
    }
synchronized (subsystemResource) {
      subsystemResource.registerChild(PathElement.pathElement(providerLabel,scopedPersistenceUnitName),providerResource);
    }
  }
}
