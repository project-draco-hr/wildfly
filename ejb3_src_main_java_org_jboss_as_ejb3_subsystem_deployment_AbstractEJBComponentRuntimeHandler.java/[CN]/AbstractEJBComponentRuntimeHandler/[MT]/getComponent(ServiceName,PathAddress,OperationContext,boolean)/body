{
  ServiceRegistry registry=context.getServiceRegistry(forWrite);
  ServiceController<?> controller=registry.getService(serviceName);
  if (controller == null) {
    String exceptionMessage=MESSAGES.noComponentAvailableForAddress(operationAddress);
    throw new OperationFailedException(new ModelNode().set(exceptionMessage));
  }
  ServiceController.State controllerState=controller.getState();
  if (controllerState != ServiceController.State.UP) {
    String exceptionMessage=MESSAGES.invalidComponentState(operationAddress,controllerState,ServiceController.State.UP);
    throw new OperationFailedException(new ModelNode().set(exceptionMessage));
  }
  return componentClass.cast(controller.getValue());
}
