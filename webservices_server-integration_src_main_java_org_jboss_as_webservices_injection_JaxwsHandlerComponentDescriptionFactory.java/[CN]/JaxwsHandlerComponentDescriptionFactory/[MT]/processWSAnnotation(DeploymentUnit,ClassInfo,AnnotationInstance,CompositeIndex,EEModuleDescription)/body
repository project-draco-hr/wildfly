{
  final ServiceName unitServiceName=unit.getServiceName();
  final WSEndpointHandlersMapping mapping=getRequiredAttachment(unit,WS_ENDPOINT_HANDLERS_MAPPING_KEY);
  final String endpointClassName=classInfo.name().toString();
  if (isJaxwsEjb(classInfo)) {
    for (    final EJBEndpoint container : getJaxwsEjbs(unit)) {
      if (endpointClassName.equals(container.getClassName())) {
        for (        final String handlerClassName : mapping.getHandlers(endpointClassName)) {
          final String ejbName=container.getName();
          final String handlerID=ejbName + "-" + handlerClassName;
          final ServiceName ejbContextServiceName=container.getContextServiceName();
          final DeploymentDescriptorEnvironment ejbEnv=container.getDeploymentDescriptorEnvironment();
          if (moduleDescription.getComponentByName(handlerID) == null) {
            final ComponentDescription jaxwsHandlerDescription=new WSComponentDescription(handlerID,handlerClassName,moduleDescription,unitServiceName);
            moduleDescription.addComponent(jaxwsHandlerDescription);
            final ServiceName serviceName=EndpointService.getServiceName(unit,ejbName);
            jaxwsHandlerDescription.addDependency(serviceName,ServiceBuilder.DependencyType.REQUIRED);
            jaxwsHandlerDescription.setContextServiceName(ejbContextServiceName);
            jaxwsHandlerDescription.setDeploymentDescriptorEnvironment(ejbEnv);
            jaxwsHandlerDescription.addDependency(ejbContextServiceName,ServiceBuilder.DependencyType.REQUIRED);
          }
        }
      }
    }
  }
 else {
    for (    final POJOEndpoint pojoEndpoint : getJaxwsPojos(unit)) {
      if (endpointClassName.equals(pojoEndpoint.getClassName())) {
        for (        final String handlerClassName : mapping.getHandlers(endpointClassName)) {
          final String pojoName=pojoEndpoint.getName();
          final String handlerID=pojoName + "-" + handlerClassName;
          if (moduleDescription.getComponentByName(handlerID) == null) {
            final ComponentDescription jaxwsHandlerDescription=new WSComponentDescription(handlerID,handlerClassName,moduleDescription,unitServiceName);
            moduleDescription.addComponent(jaxwsHandlerDescription);
            final ServiceName serviceName=EndpointService.getServiceName(unit,pojoName);
            jaxwsHandlerDescription.addDependency(serviceName,ServiceBuilder.DependencyType.REQUIRED);
          }
        }
      }
    }
  }
}
