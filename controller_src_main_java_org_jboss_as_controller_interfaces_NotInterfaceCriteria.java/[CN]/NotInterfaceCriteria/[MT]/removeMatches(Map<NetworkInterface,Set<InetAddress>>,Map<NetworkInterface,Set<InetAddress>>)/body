{
  Map<NetworkInterface,Set<InetAddress>> result=new HashMap<NetworkInterface,Set<InetAddress>>();
  for (  Map.Entry<NetworkInterface,Set<InetAddress>> entry : candidates.entrySet()) {
    Set<InetAddress> retained=new HashSet<InetAddress>(entry.getValue());
    Set<InetAddress> badAddresses=toRemove.get(entry.getKey());
    if (badAddresses != null && badAddresses.size() > 0) {
      retained.removeAll(badAddresses);
      if (retained.size() > 0) {
        result.put(entry.getKey(),retained);
      }
    }
 else {
      result.put(entry.getKey(),retained);
    }
  }
  return result;
}
