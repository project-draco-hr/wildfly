{
  log.infof("Shutdown requested; stopping all services");
  context.asynchronous();
  final ServiceContainer container=context.getController().getServiceContainer();
  final MultipleRemoveListener<Runnable> listener=MultipleRemoveListener.create(new Runnable(){
    @Override public void run(){
      context.complete();
      log.infof("JBoss AS %s \"%s\" stopped in %dms",Version.AS_VERSION,Version.AS_RELEASE_CODENAME,Integer.valueOf((int)(context.getElapsedTime() / 1000000L)));
    }
  }
);
  for (  ServiceName name : services) {
    ServiceController<?> service=container.getService(name);
    if (service != null) {
      service.addListener(listener);
      service.setMode(ServiceController.Mode.REMOVE);
    }
  }
  listener.done();
}
