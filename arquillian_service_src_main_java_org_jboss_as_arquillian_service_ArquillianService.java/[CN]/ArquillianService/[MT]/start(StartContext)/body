{
  log.debugf("Starting Arquillian Test Runner");
  final MBeanServer mbeanServer=injectedMBeanServer.getValue();
  final TestClassLoader testClassLoader=new TestClassLoaderImpl();
  serviceContainer=context.getController().getServiceContainer();
  ServiceLoader<TestEnricher> loader=ServiceLoader.load(TestEnricher.class,testClassLoader.getServiceClassLoader());
  for (  TestEnricher enricher : loader.getProviders()) {
    if (enricher instanceof ServiceContainerInjector)     ((ServiceContainerInjector)enricher).inject(serviceContainer);
  }
  try {
    jmxTestRunner=new JMXTestRunner(){
      @Override protected TestClassLoader getTestClassLoader(){
        return testClassLoader;
      }
    }
;
    jmxTestRunner.registerMBean(mbeanServer);
  }
 catch (  Throwable t) {
    throw new StartException("Failed to start Arquillian Test Runner",t);
  }
}
