{
synchronized (deployedTests) {
    Class<?> result=null;
    for (    ArquillianConfig arqConfig : deployedTests) {
      if (arqConfig.getTestClasses().contains(className)) {
        DeploymentUnitContext context=arqConfig.getDeploymentUnitContext();
        Module module=context.getAttachment(ModuleDeploymentProcessor.MODULE_ATTACHMENT_KEY);
        if (module != null) {
          result=module.getClassLoader().loadClass(className);
          break;
        }
        Deployment dep=OSGiDeploymentAttachment.getAttachment(context);
        if (dep != null) {
          Bundle bundle=dep.getAttachment(Bundle.class);
          result=bundle.loadClass(className);
          BundleAssociation.setBundle(bundle);
          BundleContext sysContext=getSystemBundleContext();
          BundleContextAssociation.setBundleContext(sysContext);
          break;
        }
      }
    }
    if (result == null)     throw new ClassNotFoundException(className);
    return result;
  }
}
