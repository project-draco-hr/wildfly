{
  ServiceController<?> controller=serviceContainer.getService(serviceName);
  State state=controller != null ? controller.getState() : null;
  while ((state == null || state != expState) && timeout > 0) {
    try {
      Thread.sleep(100);
    }
 catch (    InterruptedException ex) {
    }
    controller=serviceContainer.getService(serviceName);
    state=controller != null ? controller.getState() : null;
    timeout-=100;
  }
  if (expState != state)   throw new IllegalArgumentException(serviceName + " expected: " + expState+ " but was "+ state);
}
