{
  Name currentName=name;
  ContextNode currentNode=root;
  for (int i=0; i < name.size(); i++) {
    String childName=currentName.get(0);
    final TreeNode childNode=currentNode.children.get(childName);
    currentName=currentName.getSuffix(1);
    if (childNode == null) {
      throw nameNotFound(childName,currentName);
    }
 else     if (currentName.isEmpty()) {
      return childNode.binding.getObject();
    }
 else     if (childNode instanceof ContextNode) {
      currentNode=ContextNode.class.cast(childNode);
    }
 else {
      final Object boundObject=childNode.binding.getObject();
      if (boundObject instanceof Reference) {
        checkReferenceForContinuation(currentName,boundObject);
        return new ResolveResult(boundObject,currentName);
      }
      throw notAContext(name);
    }
  }
  return currentNode;
}
