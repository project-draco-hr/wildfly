{
  final XMLMapper mapper=XMLMapper.Factory.create();
  try {
    final FileOutputStream fos=new FileOutputStream(fileName);
    try {
      BufferedOutputStream output=new BufferedOutputStream(fos);
      final XMLStreamWriter streamWriter=XMLOutputFactory.newInstance().createXMLStreamWriter(output);
      mapper.deparseDocument(rootDeparser,model,streamWriter);
      streamWriter.close();
      output.close();
      fos.close();
    }
  finally {
      StreamUtils.safeClose(fos);
    }
  }
 catch (  Exception e) {
    throw new ConfigurationPersistenceException("Failed to store configuration",e);
  }
}
