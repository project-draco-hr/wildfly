{
  for (  Callback current : callbacks) {
    if (current instanceof NameCallback) {
      NameCallback ncb=(NameCallback)current;
      String userName=ncb.getDefaultName();
      if ((allowAll || allowedUsersSet.contains(userName)) == false) {
        SECURITY_LOGGER.tracef("Username '%s' is not permitted for local authentication.",userName);
        throw MESSAGES.invalidLocalUser(userName);
      }
    }
 else     if (current instanceof AuthorizeCallback) {
      AuthorizeCallback acb=(AuthorizeCallback)current;
      boolean authorized=acb.getAuthenticationID().equals(acb.getAuthorizationID());
      if (authorized == false) {
        SECURITY_LOGGER.tracef("Checking 'AuthorizeCallback', authorized=false, authenticationID=%s, authorizationID=%s.",acb.getAuthenticationID(),acb.getAuthorizationID());
      }
      acb.setAuthorized(authorized);
      if (authorized && skipGroupLoading) {
        sharedState.put(SKIP_GROUP_LOADING_KEY,Boolean.TRUE);
      }
    }
 else {
      throw new UnsupportedCallbackException(current);
    }
  }
}
