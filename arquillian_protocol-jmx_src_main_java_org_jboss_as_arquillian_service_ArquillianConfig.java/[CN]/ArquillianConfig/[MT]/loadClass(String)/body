{
  if (testClasses.contains(className) == false)   throw new ClassNotFoundException("Class '" + className + "' not found in: "+ testClasses);
  Module module=depUnit.getAttachment(Attachments.MODULE);
  Deployment osgidep=OSGiDeploymentAttachment.getDeployment(depUnit);
  if (module == null && osgidep == null)   throw new IllegalStateException("Cannot determine deployment type: " + depUnit);
  if (module != null && osgidep != null)   throw new IllegalStateException("Found MODULE attachment for Bundle deployment: " + depUnit);
  Class<?> testClass;
  if (osgidep != null) {
    Bundle bundle=osgidep.getAttachment(Bundle.class);
    testClass=bundle.loadClass(className);
    BundleAssociation.setBundle(bundle);
  }
 else {
    testClass=module.getClassLoader().loadClass(className);
  }
  ServiceTargetAssociation.setServiceTarget(serviceTarget);
  ServiceContainerAssociation.setServiceContainer(serviceContainer);
  return testClass;
}
