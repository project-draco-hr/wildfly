{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final ResourceRoot resourceRoot=deploymentUnit.getAttachment(Attachments.DEPLOYMENT_ROOT);
  final VirtualFile deploymentRoot=resourceRoot.getRoot();
  final boolean resolveProperties=Util.shouldResolveJBoss(deploymentUnit);
  if (deploymentRoot == null || !deploymentRoot.exists())   return;
  final String deploymentRootName=deploymentRoot.getName().toLowerCase(Locale.ENGLISH);
  VirtualFile serviceXmlFile=null;
  if (deploymentRootName.endsWith(".rar")) {
    serviceXmlFile=deploymentRoot.getChild("/META-INF/ironjacamar.xml");
  }
  if (serviceXmlFile == null || !serviceXmlFile.exists())   return;
  InputStream xmlStream=null;
  IronJacamar result=null;
  try {
    xmlStream=serviceXmlFile.openStream();
    IronJacamarParser ironJacamarParser=new IronJacamarParser();
    ironJacamarParser.setSystemPropertiesResolved(resolveProperties);
    result=ironJacamarParser.parse(xmlStream);
    if (result != null) {
      IronJacamarXmlDescriptor xmlDescriptor=new IronJacamarXmlDescriptor(result);
      deploymentUnit.putAttachment(IronJacamarXmlDescriptor.ATTACHMENT_KEY,xmlDescriptor);
    }
 else     throw MESSAGES.failedToParseServiceXml(serviceXmlFile);
  }
 catch (  Exception e) {
    throw MESSAGES.failedToParseServiceXml(e,serviceXmlFile);
  }
 finally {
    VFSUtils.safeClose(xmlStream);
  }
}
