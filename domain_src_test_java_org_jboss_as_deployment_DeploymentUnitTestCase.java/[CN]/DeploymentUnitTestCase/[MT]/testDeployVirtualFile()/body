{
  final VirtualFile virtualFile=VFS.getChild(getResource("/test/testDeployment"));
  final DeploymentUnitKey expectedKey=new DeploymentUnitKey(virtualFile.getName(),BLANK_SHA1);
  final String expectedDeploymentName=expectedKey.getName() + ":" + expectedKey.getSha1HashAsHexString();
  final BatchBuilder batchBuilder=serviceContainer.batchBuilder();
  final CountDownLatch latch=new CountDownLatch(1);
  final TimingServiceListener listener=new TimingServiceListener(new Runnable(){
    @Override public void run(){
      latch.countDown();
    }
  }
);
  batchBuilder.addListener(listener);
  new ServerGroupDeploymentElement(null,virtualFile.getName(),BLANK_SHA1,true).activate(new ServiceActivatorContextImpl(batchBuilder));
  batchBuilder.install();
  listener.finishBatch();
  latch.await(1L,TimeUnit.SECONDS);
  if (!listener.finished())   fail("Did not install deployment within 1 second.");
  final ServiceController<?> serviceController=serviceContainer.getService(DeploymentService.SERVICE_NAME.append(expectedDeploymentName));
  assertNotNull(serviceController);
  assertEquals(ServiceController.State.UP,serviceController.getState());
}
