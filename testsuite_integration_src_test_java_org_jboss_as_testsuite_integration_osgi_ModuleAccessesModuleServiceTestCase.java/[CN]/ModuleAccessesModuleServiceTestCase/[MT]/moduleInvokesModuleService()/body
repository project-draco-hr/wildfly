{
  Archive<?> targetArchive=deploymentProvider.getClientDeployment(TARGET_MODULE_NAME);
  String targetDeploymentName=archiveDeployer.deploy(targetArchive);
  assertNotNull("Deployment name not null",targetDeploymentName);
  try {
    ServiceName targetService=ServiceName.parse("jboss.osgi.example.target.service");
    assertServiceState(targetService,State.UP,5000);
    Archive<?> clientArchive=deploymentProvider.getClientDeployment(CLIENT_MODULE_NAME);
    String clientDeploymentName=archiveDeployer.deploy(clientArchive);
    assertNotNull("Deployment name not null",clientDeploymentName);
    try {
      ServiceName clientService=ServiceName.parse("jboss.osgi.example.invoker.service");
      assertServiceState(clientService,State.UP,5000);
    }
  finally {
      archiveDeployer.undeploy(clientDeploymentName);
    }
  }
  finally {
    archiveDeployer.undeploy(targetDeploymentName);
  }
}
