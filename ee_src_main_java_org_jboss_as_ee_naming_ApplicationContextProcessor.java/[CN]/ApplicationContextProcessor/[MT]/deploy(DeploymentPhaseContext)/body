{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (deploymentUnit.getParent() != null) {
    return;
  }
  final ServiceTarget serviceTarget=phaseContext.getServiceTarget();
  final ServiceName applicationContextServiceName=ContextServiceNameBuilder.app(deploymentUnit);
  final RootContextService contextService=new RootContextService();
  serviceTarget.addService(applicationContextServiceName,contextService).install();
  final BinderService<String> applicationNameBinder=new BinderService<String>("AppName",Values.immediateValue(deploymentUnit.getName()));
  serviceTarget.addService(applicationContextServiceName.append("AppName"),applicationNameBinder).addDependency(applicationContextServiceName,Context.class,applicationNameBinder.getContextInjector()).install();
  final ContextService envContextService=new ContextService(JndiName.of("env"));
  serviceTarget.addService(applicationContextServiceName.append("env"),envContextService).addDependency(applicationContextServiceName,Context.class,envContextService.getParentContextInjector()).install();
  phaseContext.getDeploymentUnit().putAttachment(Attachments.APPLICATION_CONTEXT_CONFIG,new NamingContextConfig(applicationContextServiceName));
}
