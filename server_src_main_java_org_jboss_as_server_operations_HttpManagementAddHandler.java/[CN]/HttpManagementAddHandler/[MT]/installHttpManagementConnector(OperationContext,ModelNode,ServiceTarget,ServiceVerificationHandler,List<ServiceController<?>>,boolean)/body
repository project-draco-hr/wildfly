{
  ServiceName socketBindingServiceName=null;
  ServiceName secureSocketBindingServiceName=null;
  ServiceName interfaceSvcName=null;
  int port=-1;
  int securePort=-1;
  final ModelNode interfaceModelNode=validateResolvedModel(INTERFACE,context,model);
  if (interfaceModelNode.isDefined()) {
    String interfaceName=interfaceModelNode.asString();
    interfaceSvcName=NetworkInterfaceService.JBOSS_NETWORK_INTERFACE.append(interfaceName);
    final ModelNode portNode=HTTP_PORT.resolveModelAttribute(context,model);
    port=portNode.isDefined() ? portNode.asInt() : -1;
    final ModelNode securePortNode=HTTPS_PORT.resolveModelAttribute(context,model);
    securePort=securePortNode.isDefined() ? securePortNode.asInt() : -1;
    if (securePort > -1) {
      if (port > -1) {
        ServerLogger.ROOT_LOGGER.creatingHttpManagementServiceOnPortAndSecurePort(interfaceName,port,securePort);
      }
 else {
        ServerLogger.ROOT_LOGGER.creatingHttpManagementServiceOnSecurePort(interfaceName,securePort);
      }
    }
 else     if (port > -1) {
      ServerLogger.ROOT_LOGGER.creatingHttpManagementServiceOnPort(interfaceName,port);
    }
  }
 else {
    final ModelNode socketBindingNode=SOCKET_BINDING.resolveModelAttribute(context,model);
    if (socketBindingNode.isDefined()) {
      final String bindingName=socketBindingNode.asString();
      socketBindingServiceName=SocketBinding.JBOSS_BINDING_NAME.append(bindingName);
    }
    final ModelNode secureSocketBindingNode=SECURE_SOCKET_BINDING.resolveModelAttribute(context,model);
    if (secureSocketBindingNode.isDefined()) {
      final String bindingName=secureSocketBindingNode.asString();
      secureSocketBindingServiceName=SocketBinding.JBOSS_BINDING_NAME.append(bindingName);
    }
    if (socketBindingServiceName != null) {
      if (secureSocketBindingServiceName != null) {
        ServerLogger.ROOT_LOGGER.creatingHttpManagementServiceOnSocketAndSecureSocket(socketBindingServiceName.getSimpleName(),secureSocketBindingServiceName.getSimpleName());
      }
 else {
        ServerLogger.ROOT_LOGGER.creatingHttpManagementServiceOnSocket(socketBindingServiceName.getSimpleName());
      }
    }
 else     if (secureSocketBindingServiceName != null) {
      ServerLogger.ROOT_LOGGER.creatingHttpManagementServiceOnSecureSocket(secureSocketBindingServiceName.getSimpleName());
    }
  }
  ServiceName realmSvcName=null;
  final ModelNode realmNode=SECURITY_REALM.resolveModelAttribute(context,model);
  if (realmNode.isDefined()) {
    realmSvcName=SecurityRealmService.BASE_SERVICE_NAME.append(realmNode.asString());
  }
 else {
    ServerLogger.ROOT_LOGGER.httpManagementInterfaceIsUnsecured();
  }
  boolean consoleEnabled=model.get(ModelDescriptionConstants.CONSOLE_ENABLED).asBoolean(true);
  ConsoleMode consoleMode;
  if (consoleEnabled) {
    consoleMode=context.getRunningMode() == RunningMode.ADMIN_ONLY ? ConsoleMode.ADMIN_ONLY : ConsoleMode.CONSOLE;
  }
 else {
    consoleMode=ConsoleMode.NO_CONSOLE;
  }
  ServerEnvironment environment=(ServerEnvironment)context.getServiceRegistry(false).getRequiredService(ServerEnvironmentService.SERVICE_NAME).getValue();
  final _UndertowHttpManagementService undertowService=new _UndertowHttpManagementService(consoleMode,environment.getProductConfig().getConsoleSlot(),httpUpgrade);
  ServiceBuilder<HttpManagement> undertowBuilder=serviceTarget.addService(_UndertowHttpManagementService.SERVICE_NAME,undertowService).addDependency(Services.JBOSS_SERVER_CONTROLLER,ModelController.class,undertowService.getModelControllerInjector()).addDependency(SocketBindingManagerImpl.SOCKET_BINDING_MANAGER,SocketBindingManager.class,undertowService.getSocketBindingManagerInjector()).addDependency(ControlledProcessStateService.SERVICE_NAME,ControlledProcessStateService.class,undertowService.getControlledProcessStateServiceInjector()).addInjection(undertowService.getExecutorServiceInjector(),Executors.newCachedThreadPool(new JBossThreadFactory(new ThreadGroup("HttpManagementService-threads"),Boolean.FALSE,null,"%G - %t",null,null,doPrivileged(GetAccessControlContextAction.getInstance()))));
  if (interfaceSvcName != null) {
    undertowBuilder.addDependency(interfaceSvcName,NetworkInterfaceBinding.class,undertowService.getInterfaceInjector()).addInjection(undertowService.getPortInjector(),port).addInjection(undertowService.getSecurePortInjector(),securePort);
  }
 else {
    if (socketBindingServiceName != null) {
      undertowBuilder.addDependency(socketBindingServiceName,SocketBinding.class,undertowService.getSocketBindingInjector());
    }
    if (secureSocketBindingServiceName != null) {
      undertowBuilder.addDependency(secureSocketBindingServiceName,SocketBinding.class,undertowService.getSecureSocketBindingInjector());
    }
  }
  if (realmSvcName != null) {
    undertowBuilder.addDependency(realmSvcName,SecurityRealmService.class,undertowService.getSecurityRealmInjector());
  }
  if (verificationHandler != null) {
    undertowBuilder.addListener(verificationHandler);
  }
  ServiceController<?> controller=undertowBuilder.install();
  if (newControllers != null) {
    newControllers.add(controller);
  }
  if (httpUpgrade) {
    final String hostName=SecurityActions.getSystemProperty(ServerEnvironment.NODE_NAME);
    ServiceName tmpDirPath=ServiceName.JBOSS.append("server","path","jboss.server.temp.dir");
    RemotingServices.installSecurityServices(serviceTarget,ManagementRemotingServices.HTTP_CONNECTOR,realmSvcName,null,tmpDirPath,verificationHandler,newControllers);
    NativeManagementServices.installRemotingServicesIfNotInstalled(serviceTarget,hostName,verificationHandler,null,context.getServiceRegistry(false));
    RemotingHttpUpgradeService.installServices(serviceTarget,ManagementRemotingServices.HTTP_CONNECTOR,ManagementRemotingServices.MANAGEMENT_ENDPOINT,OptionMap.EMPTY,verificationHandler);
  }
}
