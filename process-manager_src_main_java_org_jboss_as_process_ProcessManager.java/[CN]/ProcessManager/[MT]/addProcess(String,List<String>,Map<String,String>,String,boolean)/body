{
synchronized (lock) {
    if (shutdown) {
      return;
    }
    final Map<String,ManagedProcess> processes=this.processes;
    if (processes.containsKey(processName)) {
      log.warnf("Attempted to register duplicate-named process '%s'",processName);
      return;
    }
    final byte[] authKey=new byte[16];
    rng.nextBytes(authKey);
    final ManagedProcess process=new ManagedProcess(processName,command,env,workingDirectory,lock,this,authKey,isInitial);
    processes.put(processName,process);
    processesByKey.put(new Key(authKey),process);
    for (    Connection connection : managerConnections) {
      try {
        final OutputStream os=connection.writeMessage();
        try {
          os.write(Protocol.PROCESS_ADDED);
          StreamUtils.writeUTFZBytes(os,processName);
          os.close();
        }
  finally {
          StreamUtils.safeClose(os);
        }
      }
 catch (      IOException e) {
        log.errorf("Failed to write PROCESS_ADDED message to manager connection: %s",e);
      }
    }
  }
}
