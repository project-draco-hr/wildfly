{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final ServiceVerificationHandler serviceVerificationHandler=deploymentUnit.getAttachment(org.jboss.as.server.deployment.Attachments.SERVICE_VERIFICATION_HANDLER);
  final ServiceTarget serviceTarget=phaseContext.getServiceTarget();
  final String applicationName=configuration.getApplicationName();
  final String moduleName=configuration.getModuleName();
  final String componentName=configuration.getComponentName();
  final ServiceName baseName=configuration.getComponentDescription().getServiceName();
  final EEApplicationDescription applicationDescription=deploymentUnit.getAttachment(Attachments.EE_APPLICATION_DESCRIPTION);
  final ServiceName createServiceName=baseName.append("CREATE");
  final ServiceName startServiceName=baseName.append("START");
  final BasicComponentCreateService createService=configuration.getComponentCreateServiceFactory().constructService(configuration);
  final ServiceBuilder<Component> createBuilder=serviceTarget.addService(createServiceName,createService);
  createBuilder.addDependency(deploymentUnit.getServiceName(),DeploymentUnit.class,createService.getDeploymentUnitInjector());
  final ComponentStartService startService=new ComponentStartService();
  final ServiceBuilder<Component> startBuilder=serviceTarget.addService(startServiceName,startService);
  final EEModuleConfiguration moduleConfiguration=deploymentUnit.getAttachment(Attachments.EE_MODULE_CONFIGURATION);
  final IntHolder i=new IntHolder();
  if (moduleConfiguration == null) {
    return;
  }
  for (  DependencyConfigurator configurator : configuration.getCreateDependencies()) {
    configurator.configureDependency(createBuilder,createService);
  }
  for (  DependencyConfigurator configurator : configuration.getStartDependencies()) {
    configurator.configureDependency(startBuilder,startService);
  }
  startBuilder.addDependency(createServiceName,BasicComponent.class,startService.getComponentInjector());
  startBuilder.addDependency(bindingDependencyService);
  final ServiceName contextServiceName;
  if (configuration.getComponentDescription().getNamingMode() == ComponentNamingMode.CREATE) {
    final RootContextService contextService=new RootContextService();
    contextServiceName=ContextNames.contextServiceNameOfComponent(configuration.getApplicationName(),configuration.getModuleName(),configuration.getComponentName());
    serviceTarget.addService(contextServiceName,contextService).install();
  }
 else {
    contextServiceName=ContextNames.contextServiceNameOfModule(configuration.getApplicationName(),configuration.getModuleName());
  }
  final InjectionSource.ResolutionContext resolutionContext=new InjectionSource.ResolutionContext(configuration.getComponentDescription().getNamingMode() == ComponentNamingMode.USE_MODULE,configuration.getComponentName(),configuration.getModuleName(),configuration.getApplicationName());
  for (  ViewConfiguration viewConfiguration : configuration.getViews()) {
    final ServiceName serviceName=viewConfiguration.getViewServiceName();
    final ViewService viewService=new ViewService(viewConfiguration);
    serviceTarget.addService(serviceName,viewService).addDependency(createServiceName,Component.class,viewService.getComponentInjector()).install();
    for (    BindingConfiguration bindingConfiguration : viewConfiguration.getBindingConfigurations()) {
      final String bindingName=bindingConfiguration.getName();
      final ServiceName binderServiceName=ContextNames.serviceNameOfContext(applicationName,moduleName,componentName,bindingName);
      final ServiceName namingStoreName=ContextNames.serviceNameOfNamingStore(applicationName,moduleName,componentName,bindingName);
      final BindingHandleService service=new BindingHandleService(bindingName,binderServiceName,bindingConfiguration.getSource(),namingStoreName,serviceVerificationHandler);
      final ServiceName handleServiceName=binderServiceName.append(baseName).append(String.valueOf(i.value++));
      dependencies.add(binderServiceName);
      ServiceBuilder<Void> serviceBuilder=serviceTarget.addService(handleServiceName,service);
      bindingConfiguration.getSource().getResourceValue(resolutionContext,serviceBuilder,phaseContext,service.getManagedObjectInjector());
      serviceBuilder.install();
    }
  }
  if (configuration.getComponentDescription().getNamingMode() == ComponentNamingMode.CREATE) {
    processBindings(phaseContext,configuration,serviceTarget,contextServiceName,baseName,resolutionContext,configuration.getComponentDescription().getBindingConfigurations(),i,dependencies,serviceVerificationHandler);
    new ClassDescriptionTraversal(configuration.getModuleClassConfiguration(),applicationDescription){
      @Override protected void handle(      final EEModuleClassConfiguration classConfiguration,      final EEModuleClassDescription classDescription) throws DeploymentUnitProcessingException {
        processBindings(phaseContext,configuration,serviceTarget,contextServiceName,baseName,resolutionContext,classConfiguration.getBindingConfigurations(),i,dependencies,serviceVerificationHandler);
      }
    }
.run();
    for (    InterceptorDescription interceptor : configuration.getComponentDescription().getAllInterceptors()) {
      final EEModuleClassConfiguration interceptorClass=applicationDescription.getClassConfiguration(interceptor.getInterceptorClassName());
      if (interceptorClass != null) {
        new ClassDescriptionTraversal(interceptorClass,applicationDescription){
          @Override protected void handle(          final EEModuleClassConfiguration classConfiguration,          final EEModuleClassDescription classDescription) throws DeploymentUnitProcessingException {
            processBindings(phaseContext,configuration,serviceTarget,contextServiceName,baseName,resolutionContext,classConfiguration.getBindingConfigurations(),i,dependencies,serviceVerificationHandler);
          }
        }
.run();
      }
    }
  }
  createBuilder.install();
  startBuilder.install();
}
