{
  if (!operation.hasDefined(CONTENT)) {
    throw createFailureException(DomainControllerLogger.ROOT_LOGGER.invalidContentDeclaration());
  }
  final ModelNode content=operation.get(CONTENT).get(0);
  if (content.hasDefined(HASH)) {
    throw createFailureException(DomainControllerLogger.ROOT_LOGGER.invalidContentDeclaration());
  }
  final byte[] hash=storeDeploymentContent(context,operation,contentRepository);
  final ModelNode slave=operation.clone();
  slave.get(CONTENT).setEmptyList().add().get(HASH).set(hash);
  List<DomainOperationTransformer> transformers=context.getAttachment(OperationAttachments.SLAVE_SERVER_OPERATION_TRANSFORMERS);
  if (transformers == null) {
    context.attach(OperationAttachments.SLAVE_SERVER_OPERATION_TRANSFORMERS,transformers=new ArrayList<DomainOperationTransformer>());
  }
  transformers.add(new CompositeOperationAwareTransformer(slave));
  return hash;
}
