{
  final Serializable sessionId=((SessionBeanComponentInstance.SessionBeanComponentInstanceContext)ctx).getId();
  if (viewServices.containsKey(businessInterface.getName())) {
    final ServiceController<?> serviceController=CurrentServiceRegistry.getServiceRegistry().getRequiredService(viewServices.get(businessInterface.getName()));
    final ComponentView view=(ComponentView)serviceController.getValue();
    final ComponentViewInstance instance;
    if (sessionId != null) {
      instance=view.createInstance(Collections.<Object,Object>singletonMap(StatefulSessionComponent.SESSION_ATTACH_KEY,sessionId));
    }
 else {
      instance=view.createInstance();
    }
    return (T)instance.createProxy();
  }
 else {
    throw new IllegalStateException("View of type " + businessInterface + " not found on bean "+ this);
  }
}
