{
  URL manifestURL=module.getExportedResource(JarFile.MANIFEST_NAME);
  if (manifestURL != null) {
    InputStream input=manifestURL.openStream();
    try {
      Manifest manifest=new Manifest(input);
      if (OSGiManifestBuilder.isValidBundleManifest(manifest)) {
        return OSGiMetaDataBuilder.load(manifest);
      }
    }
  finally {
      input.close();
    }
  }
  File homeDir=injectedServerEnvironment.getValue().getHomeDir();
  final File modulesDir=new File(homeDir + File.separator + "modules");
  final ModuleIdentifier identifier=module.getIdentifier();
  String identifierPath=identifier.getName().replace('.',File.separatorChar) + File.separator + identifier.getSlot();
  File entryFile=new File(modulesDir + File.separator + identifierPath+ File.separator+ "jbosgi-xservice.properties");
  if (entryFile.exists()) {
    FileInputStream input=new FileInputStream(entryFile);
    try {
      Properties props=new Properties();
      props.load(input);
      return OSGiMetaDataBuilder.load(props);
    }
  finally {
      input.close();
    }
  }
  return null;
}
