{
  Manifest manifest=null;
  ModuleIdentifier identifier=module.getIdentifier();
  ModuleClassLoader moduleClassLoader=module.getClassLoader();
  Iterator<Resource> itres=moduleClassLoader.iterateResources("/META-INF",false);
  while (itres.hasNext()) {
    Resource res=itres.next();
    if (res.getName().equals(JarFile.MANIFEST_NAME)) {
      if (manifest != null) {
        LOGGER.debugf("Cannot process multiple manifest entries for: %s",identifier);
        manifest=null;
        break;
      }
      InputStream input=res.openStream();
      try {
        manifest=new Manifest(input);
      }
  finally {
        input.close();
      }
    }
  }
  if (OSGiManifestBuilder.isValidBundleManifest(manifest))   return OSGiMetaDataBuilder.load(manifest);
  FileSystem fileSystem=FileSystems.getDefault();
  File homeDir=injectedServerEnvironment.getValue().getHomeDir();
  Path modulesPath=fileSystem.getPath(homeDir.getAbsolutePath(),"modules","system","layers","base");
  String identifierPath=identifier.getName().replace('.',File.separatorChar) + File.separator + identifier.getSlot();
  File entryFile=fileSystem.getPath(modulesPath.toString(),identifierPath,"jbosgi-xservice.properties").toFile();
  if (entryFile.exists()) {
    FileInputStream input=new FileInputStream(entryFile);
    try {
      Properties props=new Properties();
      props.load(input);
      return OSGiMetaDataBuilder.load(props);
    }
  finally {
      input.close();
    }
  }
  return null;
}
