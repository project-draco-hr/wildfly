{
  List<Deployment> deployments=new ArrayList<Deployment>();
  try {
    ServerEnvironment serverEnvironment=injectedServerEnvironment.getValue();
    bundlesDir=serverEnvironment.getBundlesDir();
    if (bundlesDir.isDirectory() == false)     throw MESSAGES.illegalStateCannotFindBundleDir(bundlesDir);
    modulecaps=new ArrayList<OSGiCapability>();
    List<OSGiCapability> configcaps=new ArrayList<OSGiCapability>();
    for (    String capspec : SystemPackagesIntegration.DEFAULT_CAPABILITIES) {
      configcaps.add(new OSGiCapability(capspec,null));
    }
    configcaps.addAll(injectedSubsystemState.getValue().getCapabilities());
    Iterator<OSGiCapability> iterator=configcaps.iterator();
    while (iterator.hasNext()) {
      OSGiCapability configcap=iterator.next();
      if (installInitialModuleCapability(configcap)) {
        modulecaps.add(configcap);
        iterator.remove();
      }
    }
    for (    OSGiCapability configcap : configcaps) {
      Deployment dep=getInitialBundleDeployment(configcap);
      deployments.add(dep);
    }
  }
 catch (  Exception ex) {
    throw MESSAGES.startFailedToProcessInitialCapabilites(ex);
  }
  installBootstrapBundles(context.getChildTarget(),deployments);
}
