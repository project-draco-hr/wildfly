{
  log.tracef("Uninstall deployment: %s",dep);
  BundleManagement bundleManager=injectedBundleManager.getValue();
  bundleManager.uninstallBundle(dep);
  try {
    DeploymentPlanBuilder builder=deploymentManager.newDeploymentPlan();
    String contextName=DeploymentHolderService.getContextName(dep);
    builder=builder.undeploy(contextName).remove(contextName);
    DeploymentPlan plan=builder.build();
    DeploymentAction removeAction=builder.getLastAction();
    executeDeploymentPlan(plan,removeAction);
  }
 catch (  Exception ex) {
    log.warn("Cannot undeploy bundle: " + dep,ex);
  }
}
