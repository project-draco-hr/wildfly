{
  final ModelControllerClient client=ModelControllerClient.Factory.create(InetAddress.getByName("localhost"),9999);
  List<ModelNode> updates=new ArrayList<ModelNode>();
  ModelNode op1=new ModelNode();
  op1.get(OP).set(ADD);
  op1.get(OP_ADDR).add(SUBSYSTEM,"security");
  op1.get(OP_ADDR).add(SECURITY_DOMAIN,"prepare-login-module");
  updates.add(op1);
  op1=new ModelNode();
  op1.get(OP).set(ADD);
  op1.get(OP_ADDR).add(SUBSYSTEM,"security");
  op1.get(OP_ADDR).add(SECURITY_DOMAIN,"prepare-login-module");
  op1.get(OP_ADDR).add(Constants.AUTHENTICATION,Constants.CLASSIC);
  ModelNode loginModule=op1.get(Constants.LOGIN_MODULES).add();
  loginModule.get(ModelDescriptionConstants.CODE).set(UsersRolesLoginModule.class.getName());
  loginModule.get(FLAG).set("optional");
  op1.get(OPERATION_HEADERS).get(ALLOW_RESOURCE_SERVICE_RESTART).set(true);
  updates.add(op1);
  String securityDomain="users-roles-login-module";
  ModelNode op2=new ModelNode();
  op2.get(OP).set(ADD);
  op2.get(OP_ADDR).add(SUBSYSTEM,"security");
  op2.get(OP_ADDR).add(SECURITY_DOMAIN,securityDomain);
  updates.add(op2);
  op2=new ModelNode();
  op2.get(OP).set(ADD);
  op2.get(OP_ADDR).add(SUBSYSTEM,"security");
  op2.get(OP_ADDR).add(SECURITY_DOMAIN,securityDomain);
  op2.get(OP_ADDR).add(Constants.AUTHENTICATION,Constants.CLASSIC);
  loginModule=op2.get(Constants.LOGIN_MODULES).add();
  loginModule.get(ModelDescriptionConstants.CODE).set(UsersRolesLoginModule.class.getName());
  loginModule.get(FLAG).set("required");
  op2.get(OPERATION_HEADERS).get(ALLOW_RESOURCE_SERVICE_RESTART).set(true);
  URL usersProp=Utils.getResource("users-roles-login-module.war/users.properties");
  URL rolesProp=Utils.getResource("users-roles-login-module.war/roles.properties");
  ModelNode moduleOptions=loginModule.get("module-options");
  Map<String,String> moduleOptionsMap=classModuleOptionsMap.get(UsersRolesLoginModuleTestCase8.class);
  moduleOptions.get("usersProperties").set(usersProp.getFile());
  moduleOptions.get("rolesProperties").set(rolesProp.getFile());
  for (  Map.Entry<String,String> entry : moduleOptionsMap.entrySet()) {
    moduleOptions.get(entry.getKey()).set(entry.getValue());
  }
  updates.add(op2);
  applyUpdates(updates,client);
}
