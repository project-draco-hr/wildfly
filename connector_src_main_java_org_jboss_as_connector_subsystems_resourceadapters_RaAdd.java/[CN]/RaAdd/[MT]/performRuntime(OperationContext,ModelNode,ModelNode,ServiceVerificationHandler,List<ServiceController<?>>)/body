{
  final ModelNode address=operation.require(OP_ADDR);
  final String name=PathAddress.pathAddress(address).getLastElement().getValue();
  String archiveOrModuleName;
  if (model.get(ARCHIVE.getName()).isDefined()) {
    archiveOrModuleName=model.get(ARCHIVE.getName()).asString();
  }
 else {
    archiveOrModuleName=model.get(MODULE.getName()).asString();
  }
  if (name.startsWith(archiveOrModuleName) && (name.substring(archiveOrModuleName.length()).contains(ConnectorServices.RA_SERVICE_NAME_SEPARATOR) || name.equals(archiveOrModuleName))) {
    archiveOrModuleName=name;
  }
 else {
    Integer identifier=ConnectorServices.getResourceIdentifier(archiveOrModuleName);
    if (identifier != null && identifier != 0) {
      archiveOrModuleName=archiveOrModuleName + ConnectorServices.RA_SERVICE_NAME_SEPARATOR + identifier;
    }
  }
  if (model.get(ARCHIVE.getName()).isDefined()) {
    model.get(ARCHIVE.getName()).set(archiveOrModuleName);
  }
 else {
    model.get(MODULE.getName()).set(archiveOrModuleName);
  }
  ModifiableResourceAdapter resourceAdapter=RaOperationUtil.buildResourceAdaptersObject(context,operation,archiveOrModuleName);
  if (model.get(ARCHIVE.getName()).isDefined()) {
    RaOperationUtil.installRaServices(context,verificationHandler,name,resourceAdapter);
  }
 else {
    RaOperationUtil.installRaServicesAndDeployFromModule(context,verificationHandler,name,resourceAdapter,archiveOrModuleName);
  }
}
