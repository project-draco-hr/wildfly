{
  log.tracef("Uninstalling deployment: %s",deployment);
  try {
    FrameworkExt bundleManager=injectedBundleManager.getValue();
    bundleManager.uninstallBundle(deployment);
  }
 catch (  Throwable t) {
    log.errorf(t,"Failed to uninstall deployment: %s",deployment);
  }
  ServiceName serviceName=Services.deploymentUnitName(context.getController().getName().getSimpleName());
  ServiceController<?> deploymentController=context.getController().getServiceContainer().getService(serviceName);
  if (deploymentController != null) {
    deploymentController.setMode(Mode.REMOVE);
  }
}
