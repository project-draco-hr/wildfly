{
  ServiceController<?> controller=context.getController();
  ServiceContainer serviceContainer=controller.getServiceContainer();
  ServiceController<?> contextController=serviceContainer.getService(FrameworkService.SERVICE_NAME);
  contextController.setMode(Mode.ACTIVE);
  log.tracef("Installing deployment: %s",deployment);
  try {
    boolean autoStart=deployment.isAutoStart();
    deployment.setAutoStart(false);
    FrameworkExt bundleManager=injectedBundleManager.getValue();
    bundleManager.installBundle(deployment);
    deployment.setAutoStart(autoStart);
  }
 catch (  Throwable t) {
    throw new StartException("Failed to install deployment: " + deployment,t);
  }
}
