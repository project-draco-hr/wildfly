{
  Set<ClusteredSession<? extends OutgoingDistributableSessionData>> toProcess=null;
synchronized (sessions) {
    toProcess=new HashSet<ClusteredSession<? extends OutgoingDistributableSessionData>>(sessions);
    sessions.clear();
  }
  SessionManager mgr=getManager();
  for (  ClusteredSession<? extends OutgoingDistributableSessionData> session : toProcess) {
    if (!processingAllowed)     break;
    try {
      mgr.storeSession(session);
    }
 catch (    Exception e) {
      getLog().error("Caught exception processing session " + session.getRealId(),e);
    }
  }
}
