{
  String patchID=randomString();
  File oneOffPatchDir=mkdir(tempDir,patchID);
  ContentModification file1Modified=ContentModificationUtils.modifyMisc(oneOffPatchDir,patchID,file1patchedContent,new File(file1),"README.txt");
  ContentModification file2Modified=ContentModificationUtils.modifyMisc(oneOffPatchDir,patchID,file2patchedContent,new File(file2),"LICENSE.txt");
  ProductConfig productConfig=new ProductConfig(PRODUCT,AS_VERSION,"main");
  Patch oneOffPatch=PatchBuilder.create().setPatchId(patchID).setDescription("A one-off patch modifying two misc files.").oneOffPatchIdentity(productConfig.getProductName(),productConfig.getProductVersion()).getParent().addContentModification(file1Modified).addContentModification(file2Modified).build();
  PatchingTestUtil.createPatchXMLFile(oneOffPatchDir,oneOffPatch);
  File zippedPatch=PatchingTestUtil.createZippedPatchFile(oneOffPatchDir,patchID);
  PatchingTestUtil.setFileContent(file1,file1modifiedContent);
  PatchingTestUtil.setFileContent(file2,file2modifiedContent);
  controller.start(CONTAINER);
  Assert.assertFalse("Server should reject patch installation in this case",CliUtilsForPatching.applyPatch(zippedPatch.getAbsolutePath()));
  Assert.assertEquals("Misc file should not be overwritten",file1modifiedContent,PatchingTestUtil.readFile(file1));
  Assert.assertEquals("Misc file should not be overwritten",file2modifiedContent,PatchingTestUtil.readFile(file2));
  Assert.assertTrue("Patch should be accepted",CliUtilsForPatching.applyPatch(zippedPatch.getAbsolutePath(),String.format(CliUtilsForPatching.OVERRIDE,"README.txt,LICENSE.txt")));
  Assert.assertTrue("server should be in restart-required mode",CliUtilsForPatching.doesServerRequireRestart());
  controller.stop(CONTAINER);
  controller.start(CONTAINER);
  Assert.assertTrue("The patch " + patchID + " should be listed as installed",CliUtilsForPatching.getInstalledPatches().contains(patchID));
  Assert.assertEquals("Misc file should be overwritten",file1patchedContent,PatchingTestUtil.readFile(file1));
  Assert.assertEquals("Misc file should be overwritten",file2patchedContent,PatchingTestUtil.readFile(file2));
  Assert.assertTrue("Rollback should be accepted",CliUtilsForPatching.rollbackPatch(patchID,String.format(CliUtilsForPatching.OVERRIDE,"LICENSE.txt"),String.format(CliUtilsForPatching.PRESERVE,"README.txt")));
  Assert.assertTrue("server should be in restart-required mode",CliUtilsForPatching.doesServerRequireRestart());
  controller.stop(CONTAINER);
  controller.start(CONTAINER);
  Assert.assertFalse("The patch " + patchID + " NOT should be listed as installed",CliUtilsForPatching.getInstalledPatches().contains(patchID));
  Assert.assertEquals("Misc file should not be overridden",file1patchedContent,PatchingTestUtil.readFile(file1));
  Assert.assertEquals("Misc file should be restored",file2modifiedContent,PatchingTestUtil.readFile(file2));
  controller.stop(CONTAINER);
}
