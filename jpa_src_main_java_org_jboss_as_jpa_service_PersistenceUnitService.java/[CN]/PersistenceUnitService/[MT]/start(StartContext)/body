{
  try {
    PersistenceProvider provider=lookupProvider(pu.getPersistenceProviderClassName());
    try {
      if (pu.getJtaDataSourceName() != null) {
        pu.setJtaDataSource((DataSource)Util.lookup(pu.getJtaDataSourceName(),DataSource.class));
      }
    }
 catch (    Exception e) {
      throw new RuntimeException("couldn't locate jta DataSource " + pu.getJtaDataSourceName(),e);
    }
    try {
      if (pu.getNonJtaDataSourceName() != null) {
        pu.setNonJtaDataSource((DataSource)Util.lookup(pu.getNonJtaDataSourceName(),DataSource.class));
      }
    }
 catch (    Exception e) {
      throw new RuntimeException("couldn't locate non-jta DataSource " + pu.getNonJtaDataSourceName(),e);
    }
    this.entityManagerFactory=createContainerEntityManagerFactory(provider);
    register(this);
  }
  finally {
    pu.setTempClassloader(null);
  }
}
