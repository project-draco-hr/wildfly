{
  AccessController.doPrivileged(new SetContextLoaderAction(com.arjuna.ats.jbossatx.jta.TransactionManagerService.class.getClassLoader()));
  try {
    return provider.createContainerEntityManagerFactory(pu,properties.getValue());
  }
  finally {
    AccessController.doPrivileged(CLEAR_ACTION);
  }
}
