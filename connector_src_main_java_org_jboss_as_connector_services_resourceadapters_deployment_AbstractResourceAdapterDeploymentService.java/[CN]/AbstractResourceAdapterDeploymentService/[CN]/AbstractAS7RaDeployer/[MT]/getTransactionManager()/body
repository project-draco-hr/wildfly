{
  if (getSecurityManager() == null) {
    currentThread().setContextClassLoader(TransactionIntegration.class.getClassLoader());
  }
 else {
    doPrivileged(new SetContextClassLoaderAction(doPrivileged(new GetClassLoaderAction(TransactionIntegration.class))));
  }
  try {
    return getTxIntegration().getValue().getTransactionManager();
  }
  finally {
    doPrivileged(ClearContextClassLoaderAction.getInstance());
  }
}
