{
  if (len == 0) {
    return;
  }
  final byte[] hdr=this.hdr;
  hdr[0]=(byte)CHUNK_START;
  hdr[1]=(byte)(len >> 24);
  hdr[2]=(byte)(len >> 16);
  hdr[3]=(byte)(len >> 8);
  hdr[4]=(byte)(len >> 0);
synchronized (lock) {
    if (sender != this || writeDone) {
      if (sender == this)       sender=null;
      throw new IOException("Write channel closed");
    }
    out.write(hdr);
    super.write(b,off,len);
  }
}
