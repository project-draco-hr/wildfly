{
synchronized (lock) {
    if (sender != this)     return;
    sender=null;
    if (writeDone)     throw new IOException("Write channel closed");
    if (readDone) {
      readExecutor.execute(new Runnable(){
        public void run(){
          safeHandleFinished();
        }
      }
);
    }
    out.write(CHUNK_END);
  }
}
