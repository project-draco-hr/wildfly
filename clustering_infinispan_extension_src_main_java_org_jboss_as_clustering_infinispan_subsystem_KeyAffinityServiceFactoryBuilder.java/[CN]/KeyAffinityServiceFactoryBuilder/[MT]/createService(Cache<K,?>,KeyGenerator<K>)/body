{
  CacheMode mode=cache.getCacheConfiguration().clustering().cacheMode();
  return mode.isDistributed() || mode.isReplicated() ? new KeyAffinityServiceImpl<>(this.executor,cache,generator,this.bufferSize,Collections.singleton(cache.getCacheManager().getAddress()),false) : new SimpleKeyAffinityService<>(generator);
}
