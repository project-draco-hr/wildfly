{
  if (!(entityManager instanceof AbstractEntityManager)) {
    throw new RuntimeException("internal error, XPC needs to be a AbstractEntityManager so that we can get metadata");
  }
  List<EntityManager> xpcList=Collections.synchronizedList(new ArrayList<EntityManager>());
  xpcList.add(entityManager);
  xpcList=contextToXPCMap.putIfAbsent(beanContextHandle,xpcList);
  if (null != xpcList) {
    xpcList.add(entityManager);
  }
  List<SFSBContextHandle> sfsbList=Collections.synchronizedList(new ArrayList<SFSBContextHandle>());
  sfsbList.add(beanContextHandle);
  sfsbList=XPCToContextMap.putIfAbsent(entityManager,sfsbList);
  if (null != sfsbList) {
    sfsbList.add(beanContextHandle);
  }
}
