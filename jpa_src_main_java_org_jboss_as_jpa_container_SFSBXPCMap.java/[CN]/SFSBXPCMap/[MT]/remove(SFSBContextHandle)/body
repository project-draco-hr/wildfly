{
  List<EntityManager> result=null;
  List<WeakReference<EntityManager>> xpcList=contextToXPCMap.remove(bean);
  if (xpcList != null) {
    for (    WeakReference<EntityManager> xpc_ref : xpcList) {
      EntityManager xpc=xpc_ref.get();
      if (xpc != null) {
        List<SFSBContextHandle> sfsbList=XPCToContextMap.get(xpc);
        if (sfsbList != null) {
          List<SFSBContextHandle> removed=new ArrayList<SFSBContextHandle>();
          for (          SFSBContextHandle beanContextHandle : sfsbList) {
            if (beanContextHandle == bean || beanContextHandle.getBeanContextHandle() == null) {
              removed.add(beanContextHandle);
            }
          }
          sfsbList.removeAll(removed);
          if (sfsbList.size() == 0) {
            result.add(xpc);
          }
        }
      }
    }
  }
  return result;
}
