{
  LOGGER.tracef("Install deployment: %s",dep);
  try {
    String contextName=getContextName(dep);
    deploymentMap.put(contextName,dep);
    InputStream input=dep.getRoot().openStream();
    try {
      ServerDeploymentHelper server=new ServerDeploymentHelper(deploymentManager);
      server.deploy(contextName,input);
    }
  finally {
      if (input != null)       try {
        input.close();
      }
 catch (      IOException e) {
        LOGGER.debugf(e,"Failed to close resource %s",input);
      }
    }
  }
 catch (  RuntimeException rte) {
    throw rte;
  }
catch (  Exception ex) {
    throw MESSAGES.cannotDeployBundle(ex,dep);
  }
}
