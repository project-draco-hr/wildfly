{
  VaultExpressionSensitivityConfig.INSTANCE.setConfiguredRequiresAccessPermission(false);
  VaultExpressionSensitivityConfig.INSTANCE.setConfiguredRequiresReadPermission(true);
  VaultExpressionSensitivityConfig.INSTANCE.setConfiguredRequiresWritePermission(true);
  try {
    ChildResourceDefinition oneChild=new ChildResourceDefinition(ONE);
    oneChild.addAttribute("attr1");
    oneChild.addOperation("test",true,false,null);
    rootRegistration.registerSubModel(oneChild);
    Resource resourceA=Resource.Factory.create();
    resourceA.getModel().get("attr1").set("test-a");
    rootResource.registerChild(ONE_A,resourceA);
    Subject subject=standardRole == null ? null : new Subject(true,Collections.singleton(new RealmUser(roleToUserName(standardRole))),Collections.emptySet(),Collections.emptySet());
    Subject.doAs(subject,new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws Exception {
        try {
          server.setAttribute(ONE_A_NAME,new Attribute("attr1","${VAULT::AA::bb::cc}"));
          Assert.assertTrue(writable);
        }
 catch (        JMRuntimeException e) {
          Assert.assertFalse(writable);
        }
        return null;
      }
    }
);
  }
  finally {
    VaultExpressionSensitivityConfig.INSTANCE.setConfiguredRequiresAccessPermission(null);
    VaultExpressionSensitivityConfig.INSTANCE.setConfiguredRequiresReadPermission(null);
    VaultExpressionSensitivityConfig.INSTANCE.setConfiguredRequiresWritePermission(null);
  }
}
