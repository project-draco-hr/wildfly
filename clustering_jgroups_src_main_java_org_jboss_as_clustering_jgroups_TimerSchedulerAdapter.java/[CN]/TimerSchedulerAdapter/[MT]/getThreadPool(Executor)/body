{
  if (executor instanceof ThreadPoolExecutor) {
    return (ThreadPoolExecutor)executor;
  }
 else {
    final Field field=getField(executor.getClass(),Executor.class);
    if (field != null) {
      PrivilegedAction<Void> action=new PrivilegedAction<Void>(){
        @Override public Void run(){
          field.setAccessible(true);
          return null;
        }
      }
;
      AccessController.doPrivileged(action);
      try {
        return getThreadPool((Executor)field.get(executor));
      }
 catch (      IllegalAccessException e) {
        throw new IllegalStateException(e);
      }
    }
  }
  throw new UnsupportedOperationException();
}
