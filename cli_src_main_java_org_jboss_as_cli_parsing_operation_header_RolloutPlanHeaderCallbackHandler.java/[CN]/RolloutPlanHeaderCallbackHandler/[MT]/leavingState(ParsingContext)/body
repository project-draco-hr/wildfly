{
  final String id=ctx.getState().getId();
  if (id.equals(HeaderValueState.ID)) {
    handler.header(header);
  }
 else   if (id.equals(InSeriesState.ID)) {
    final String value=buffer.toString().trim();
    if (!value.equals(Util.IN_SERIES)) {
      throw new CommandFormatException("Expected '" + Util.IN_SERIES + "' but got '"+ value+ "' at index "+ ctx.getLocation());
    }
  }
 else   if (ServerGroupNameState.ID.equals(id)) {
    final String groupName=buffer.toString().trim();
    if (groupName.isEmpty()) {
      throw new CommandFormatException("Empty group name at index " + ctx.getLocation());
    }
    ((SingleRolloutPlanGroup)group).setGroupName(groupName);
  }
 else   if (PropertyState.ID.equals(id)) {
    final String value=buffer.length() == 0 ? null : buffer.toString().trim();
    if (value == null || value.isEmpty()) {
      throw new CommandFormatException("Property '" + name + "' is missing value at index "+ ctx.getLocation());
    }
    ((SingleRolloutPlanGroup)group).addProperty(name,value);
  }
 else   if (ServerGroupState.ID.equals(id)) {
    if (concurrent) {
      header.addConcurrentGroup(group);
      concurrent=false;
    }
 else {
      header.addGroup(group);
    }
  }
}
