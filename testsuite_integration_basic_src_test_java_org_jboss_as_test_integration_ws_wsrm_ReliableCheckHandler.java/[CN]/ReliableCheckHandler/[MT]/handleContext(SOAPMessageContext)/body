{
  Boolean outboundProperty=(Boolean)smc.get(MessageContext.MESSAGE_OUTBOUND_PROPERTY);
  SOAPMessage message=smc.getMessage();
  invoked++;
  if (outboundProperty.booleanValue()) {
    log.debug("Outgoing message:");
  }
 else {
    log.debug("Incoming message:");
  }
  log.debug("-----------");
  try {
    message.writeTo(System.out);
    log.debug("");
  }
 catch (  Exception e) {
    log.debug("Exception in handler: " + e);
  }
  log.debug("-----------");
  try {
switch (invoked % 4) {
case 1:
      SOAPElement firstBodyElement=(SOAPElement)message.getSOAPBody().getChildElements().next();
    if (!"CreateSequence".equals(firstBodyElement.getNodeName())) {
      throw new WebServiceException("CreateSequence in soap body was expected, but it contains '" + firstBodyElement.getElementName() + "'");
    }
  break;
case 2:
firstBodyElement=(SOAPElement)message.getSOAPBody().getChildElements().next();
if (!"CreateSequenceResponse".equals(firstBodyElement.getNodeName())) {
throw new WebServiceException("CreateSequenceResponse in soap body was expected, but it contains '" + firstBodyElement.getElementName() + "'");
}
break;
case 3:
Iterator headerElements=message.getSOAPHeader().getChildElements();
boolean found=false;
while (headerElements.hasNext()) {
SOAPElement soapElement=(SOAPElement)headerElements.next();
if ("wsrm:Sequence".equals(soapElement.getNodeName())) {
found=true;
}
}
if (!found) {
throw new WebServiceException("wsrm:Sequence is not present in soap header");
}
break;
case 0:
headerElements=message.getSOAPHeader().getChildElements();
found=false;
while (headerElements.hasNext()) {
SOAPElement soapElement=(SOAPElement)headerElements.next();
if ("wsrm:SequenceAcknowledgement".equals(soapElement.getNodeName())) {
found=true;
}
}
if (!found) {
throw new WebServiceException("wsrm:SequenceAcknowledgement is not present in soap header");
}
break;
}
}
 catch (SOAPException ex) {
throw new WebServiceException(ex.getMessage(),ex);
}
}
