{
  final Set<ModuleIdentifier> deps=new HashSet<ModuleIdentifier>();
  for (  ModuleDependency dependency : moduleSpecification.getSystemDependencies()) {
    deps.add(dependency.getIdentifier());
  }
  for (  final ModuleSpecification depInfo : phaseContext.getAttachmentList(Attachments.MODULE_DEPENDENCY_INFORMATION)) {
    for (    ModuleDependency dependency : depInfo.getSystemDependencies()) {
      if (deps.contains(dependency)) {
        continue;
      }
      deps.add(dependency.getIdentifier());
      if (depInfo.isRequiresTransitiveDependencies()) {
        moduleSpecification.addSystemDependency(dependency);
        if (dependency.getIdentifier().getName().startsWith(ServiceModuleLoader.MODULE_PREFIX)) {
          processManualTransitiveDependencies(moduleSpecification,phaseContext,deps,dependency.getIdentifier());
        }
      }
    }
  }
}
