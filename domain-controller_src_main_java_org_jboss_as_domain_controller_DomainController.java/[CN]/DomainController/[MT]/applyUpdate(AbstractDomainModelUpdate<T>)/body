{
  DomainUpdateApplierResponse firstCut=applyUpdateToModel(update);
  if (firstCut.getDomainFailure() != null) {
    return new DomainUpdateResult<T>(firstCut.getDomainFailure());
  }
  Map<ServerIdentity,T> serverResults=null;
  Map<ServerIdentity,Throwable> serverFailures=null;
  List<ServerIdentity> servers=firstCut.getServers();
  if (servers != null && servers.size() > 0) {
    List<AbstractServerModelUpdate<?>> serverUpdates=Collections.<AbstractServerModelUpdate<?>>singletonList(update.getServerModelUpdate());
    for (    ServerIdentity server : servers) {
      List<UpdateResultHandlerResponse<?>> rsps=applyUpdateToServer(serverUpdates,server);
      UpdateResultHandlerResponse<?> rsp=rsps.get(0);
      if (rsp.getFailureResult() != null) {
        if (serverFailures == null) {
          serverFailures=new HashMap<ServerIdentity,Throwable>();
        }
        serverFailures.put(server,rsp.getFailureResult());
      }
 else {
        if (serverResults == null) {
          serverResults=new HashMap<ServerIdentity,T>();
        }
        @SuppressWarnings("unchecked") T result=(T)rsp.getSuccessResult();
        serverResults.put(server,result);
      }
    }
  }
  return new DomainUpdateResult<T>(firstCut.getHostFailures(),serverResults,serverFailures);
}
