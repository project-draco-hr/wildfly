{
  final File domainXML=new File(domainConfigDir,"domain.xml");
  if (!domainXML.exists()) {
    throw new IllegalStateException("File " + domainXML.getAbsolutePath() + " does not exist. A DomainController cannot be launched without a valid domain.xml");
  }
 else   if (!domainXML.canWrite()) {
    throw new IllegalStateException("File " + domainXML.getAbsolutePath() + " is not writable. A DomainController cannot be launched without a writable domain.xml");
  }
  try {
    final List<AbstractDomainModelUpdate<?>> domainUpdates=new ArrayList<AbstractDomainModelUpdate<?>>();
    mapper.parseDocument(domainUpdates,XMLInputFactory.newInstance().createXMLStreamReader(new BufferedReader(new FileReader(domainXML))));
    final DomainModel domainModel=new DomainModel();
    for (    final AbstractDomainModelUpdate<?> update : domainUpdates) {
      domainModel.update(update);
    }
    return domainModel;
  }
 catch (  RuntimeException e) {
    throw e;
  }
catch (  Exception e) {
    throw new RuntimeException("Caught exception during processing of domain.xml",e);
  }
}
