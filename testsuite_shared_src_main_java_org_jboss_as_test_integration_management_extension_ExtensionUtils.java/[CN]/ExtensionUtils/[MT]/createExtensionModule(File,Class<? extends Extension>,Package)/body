{
  deleteRecursively(extensionModuleRoot.toPath());
  if (extensionModuleRoot.exists()) {
    throw new IllegalArgumentException(extensionModuleRoot + " already exists");
  }
  File file=new File(extensionModuleRoot,"main");
  if (!file.mkdirs()) {
    throw new IllegalArgumentException("Could not create " + file);
  }
  final InputStream is=createResourceRoot(extension,additionalPackages).exportAsInputStream();
  try {
    copyFile(new File(file,JAR_NAME),is);
  }
  finally {
    IoUtils.safeClose(is);
  }
  URL url=extension.getResource("module.xml");
  if (url == null) {
    throw new IllegalStateException("Could not find module.xml");
  }
  copyFile(new File(file,"module.xml"),url.openStream());
}
