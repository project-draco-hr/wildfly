{
  final Resource root=unit.getAttachment(DEPLOYMENT_RESOURCE);
synchronized (root) {
    final ImmutableManagementResourceRegistration registration=unit.getAttachment(REGISTRATION_ATTACHMENT);
    final Resource subsystem=getOrCreate(root,PathElement.pathElement(SUBSYSTEM,subsystemName));
    Resource parent=subsystem;
    int count=address.size() - 1;
    for (int index=0; index < count; index++) {
      parent=getOrCreate(parent,address.getElement(index));
    }
    final ImmutableManagementResourceRegistration subModel=registration.getSubModel(getExtensionAddress(subsystemName,address));
    if (subModel == null) {
      throw new IllegalStateException(address.toString());
    }
    return getOrCreate(parent,address.getLastElement(),resource).getModel();
  }
}
