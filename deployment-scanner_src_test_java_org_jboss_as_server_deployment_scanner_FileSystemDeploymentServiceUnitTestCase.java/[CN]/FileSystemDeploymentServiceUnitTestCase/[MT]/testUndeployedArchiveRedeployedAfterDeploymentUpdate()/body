{
  final String warName="helloworld2.war";
  File war=new File(tmpDir,warName);
  testSupport.createZip(war,0,false,false,false,false);
  TesteeSet ts=createTestee();
  ts.controller.addCompositeSuccessResponse(1);
  ts.testee.setAutoDeployZippedContent(true);
  ts.testee.scan();
  assertTrue(war.getAbsolutePath() + " is missing after deployment",war.exists());
  File deployed=new File(tmpDir,warName + FileSystemDeploymentService.DEPLOYED);
  assertTrue(deployed.getAbsolutePath() + " marker file not found after deployment",deployed.exists());
  assertTrue("Could not delete " + deployed.getAbsolutePath() + " marker file",deployed.delete());
  ts.controller.addCompositeSuccessResponse(1);
  ts.testee.scan();
  File undeployed=new File(tmpDir,warName + FileSystemDeploymentService.UNDEPLOYED);
  assertTrue(undeployed.getAbsolutePath() + " marker file not found after undeployment",undeployed.exists());
  long newLastModifiedTime=undeployed.lastModified() + 1000;
  logger.info("Updating last modified time of war " + war + " from "+ war.lastModified()+ " to "+ newLastModifiedTime+ " to simulate changes to the deployment");
  war.setLastModified(newLastModifiedTime);
  ts.controller.addCompositeSuccessResponse(1);
  ts.testee.scan();
  assertTrue(war.getAbsolutePath() + " is missing after re-deployment",war.exists());
  deployed=createFile(warName + FileSystemDeploymentService.DEPLOYED);
  assertTrue(deployed.getAbsolutePath() + " marker file not found after re-deployment",deployed.exists());
  undeployed=new File(tmpDir,warName + FileSystemDeploymentService.UNDEPLOYED);
  assertFalse(undeployed.getAbsolutePath() + " marker file (unexpectedly) exists after re-deployment",undeployed.exists());
}
