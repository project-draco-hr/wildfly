{
  final ModelNode model=context.readModel(PathAddress.EMPTY_ADDRESS);
  PathAddress rootAddress=PathAddress.pathAddress(PathAddress.pathAddress(operation.require(OP_ADDR)).getLastElement());
  final ModelNode subsystem=new ModelNode();
  subsystem.get(OP).set(ADD);
  subsystem.get(OP_ADDR).set(rootAddress.toModelNode());
  if (model.has(ACTIVATION)) {
    subsystem.get(ACTIVATION).set(model.get(ACTIVATION));
  }
  ModelNode result=context.getResult();
  result.add(subsystem);
  if (model.has(CONFIGURATION)) {
    for (    Property conf : model.get(CONFIGURATION).asPropertyList()) {
      ModelNode address=rootAddress.toModelNode();
      address.add(CommonAttributes.CONFIGURATION,conf.getName());
      result.add(OSGiCasConfigAdd.getAddOperation(address,conf.getValue()));
    }
  }
  if (model.has(PROPERTY)) {
    for (    Property prop : model.get(PROPERTY).asPropertyList()) {
      ModelNode address=rootAddress.toModelNode();
      address.add(CommonAttributes.PROPERTY,prop.getName());
      result.add(OSGiPropertyAdd.getAddOperation(address,prop.getValue()));
    }
  }
  if (model.has(MODULE)) {
    for (    Property prop : model.get(MODULE).asPropertyList()) {
      ModelNode address=rootAddress.toModelNode();
      address.add(CommonAttributes.MODULE,prop.getName());
      result.add(OSGiModuleAdd.getAddOperation(address,prop.getValue()));
    }
  }
  context.completeStep();
}
