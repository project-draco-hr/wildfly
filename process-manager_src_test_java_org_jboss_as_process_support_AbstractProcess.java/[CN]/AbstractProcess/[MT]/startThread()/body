{
  new Thread(new Runnable(){
    @Override public void run(){
      InputStream in=conn.getInputStream();
      StringBuilder b=new StringBuilder();
      try {
        while (!shutdown.get()) {
          Status status=StreamUtils.readWord(in,b);
          try {
            final OutgoingPmCommand command=OutgoingPmCommand.valueOf(b.toString());
            status=command.handleMessage(in,status,handler,b);
          }
 catch (          IllegalArgumentException e) {
          }
          if (status == Status.MORE)           StreamUtils.readToEol(in);
        }
      }
 catch (      IOException e) {
        handler.handleShutdown();
      }
    }
  }
).start();
  new Thread(new Runnable(){
    @Override public void run(){
      InputStream in=clientStream.getInput();
      StringBuilder b=new StringBuilder();
      try {
        while (!shutdown.get()) {
          Status status=StreamUtils.readWord(in,b);
          handleTestCommand(b.toString());
          if (status == Status.MORE)           StreamUtils.readToEol(in);
        }
      }
 catch (      IOException e) {
        handler.handleShutdown();
      }
    }
  }
).start();
  new Thread(new Runnable(){
    @Override public void run(){
      debug("Monitor stdin " + processName);
      InputStream in=System.in;
      try {
        while (in != null && in.read() != -1) {
        }
      }
 catch (      IOException e) {
        e.printStackTrace();
      }
      debug("End of stdin " + processName);
      handler.handleShutdown();
      System.exit(0);
    }
  }
).start();
  started();
}
