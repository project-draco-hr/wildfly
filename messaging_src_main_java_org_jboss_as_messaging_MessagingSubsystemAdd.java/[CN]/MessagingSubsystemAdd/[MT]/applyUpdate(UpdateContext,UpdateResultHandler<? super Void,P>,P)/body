{
  final HornetQService hqservice=new HornetQService();
  final Configuration hqConfig=new ConfigurationImpl();
  hqConfig.setBindingsDirectory(getBindingsDirectory());
  hqConfig.setJournalDirectory(getJournalDirectory());
  hqConfig.setLargeMessagesDirectory(getLargeMessagesDirectory());
  hqConfig.setPagingDirectory(getPagingDirectory());
  hqConfig.setClustered(isClustered());
  hqConfig.setJournalMinFiles(getJournalMinFiles());
  hqConfig.setJournalFileSize(getJournalFileSize());
  hqConfig.setJournalType(getJournalType());
  hqservice.setConfiguration(hqConfig);
  final BatchBuilder batchBuilder=updateContext.getBatchBuilder();
  final BatchServiceBuilder<HornetQServer> serviceBuilder=batchBuilder.addService(MessagingSubsystemElement.JBOSS_MESSAGING,hqservice);
  serviceBuilder.setInitialMode(ServiceController.Mode.IMMEDIATE);
}
