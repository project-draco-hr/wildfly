{
  if (legacyServices == null) {
    throw new IllegalStateException("Can only be called for the main controller");
  }
  PathElement pathElement=PathElement.pathElement(SUBSYSTEM,mainSubsystemName);
  PathAddress opAddr=PathAddress.pathAddress(operation.get(OP_ADDR));
  if (opAddr.size() > 0 && opAddr.getElement(0).equals(pathElement)) {
    TransformerRegistry transformerRegistry=extensionRegistry.getTransformerRegistry();
    DomainModelTransformers transformers=transformerRegistry.getDomainTransformers();
    PathAddress address=PathAddress.pathAddress(operation.get(OP_ADDR));
    OperationTransformerRegistry registry=transformers.resolveServer(modelVersion,createSubsystemVersionRegistry(modelVersion));
    TransformationContext transformationContext=null;
    return registry.resolveOperationTransformer(address,operation.get(OP).asString()).getTransformer().transformOperation(transformationContext,address,operation).getTransformedOperation();
  }
  return operation;
}
