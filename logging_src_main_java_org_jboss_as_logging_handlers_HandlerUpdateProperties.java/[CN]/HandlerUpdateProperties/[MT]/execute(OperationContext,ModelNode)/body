{
  final Resource resource=context.readResourceForUpdate(PathAddress.EMPTY_ADDRESS);
  final ModelNode originalModel=resource.getModel().clone();
  final ModelNode model=resource.getModel();
  updateModel(operation,model);
  if (requiresRuntime(context)) {
    context.addStep(new OperationStepHandler(){
      public void execute(      OperationContext context,      ModelNode operation) throws OperationFailedException {
        final PathAddress address=PathAddress.pathAddress(operation.require(OP_ADDR));
        final String name=address.getLastElement().getValue();
        final ServiceRegistry serviceRegistry=context.getServiceRegistry(false);
        @SuppressWarnings("unchecked") final ServiceController<T> controller=(ServiceController<T>)serviceRegistry.getService(LogServices.handlerName(name));
        if (controller != null) {
          final T handler=controller.getValue();
          final ModelNode level=LEVEL.resolveModelAttribute(context,model);
          final ModelNode formatter=FORMATTER.resolveModelAttribute(context,model);
          final ModelNode encoding=ENCODING.resolveModelAttribute(context,model);
          final ModelNode filter=FILTER.resolveModelAttribute(context,model);
          if (level.isDefined()) {
            handler.setLevel(ModelParser.parseLevel(level));
          }
          if (formatter.isDefined()) {
            FormatterSpec.fromModelNode(context,model).apply(handler);
          }
          if (encoding.isDefined()) {
            try {
              handler.setEncoding(encoding.asString());
            }
 catch (            UnsupportedEncodingException e) {
              throw new OperationFailedException(e,new ModelNode().set(MESSAGES.failedToSetHandlerEncoding()));
            }
          }
          if (filter.isDefined()) {
            handler.setFilter(ModelParser.parseFilter(context,filter));
          }
          final boolean restartRequired=applyUpdateToRuntime(context,name,model,originalModel,handler);
          copyOriginal(originalModel,model);
          if (restartRequired) {
            context.reloadRequired();
          }
          if (context.completeStep() != OperationContext.ResultAction.KEEP) {
            try {
              revertUpdateToRuntime(context,name,model,originalModel,handler);
            }
 catch (            Exception e) {
              ROOT_LOGGER.errorRevertingOperation(e,getClass().getSimpleName(),operation.require(ModelDescriptionConstants.OP).asString(),PathAddress.pathAddress(operation.require(ModelDescriptionConstants.OP_ADDR)));
            }
            if (restartRequired) {
              context.revertReloadRequired();
            }
          }
        }
      }
    }
,OperationContext.Stage.RUNTIME);
  }
  context.completeStep();
}
