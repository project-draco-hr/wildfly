{
  final String patchId=patch.getPatchId();
  final DirectoryStructure structure=context.getStructure();
  final File jbossHome=structure.getInstalledImage().getJbossHome();
  final File historyDir=structure.getHistoryDir(patch.getPatchId());
  final File source=getTargetFile(jbossHome,item);
  final File backup=getTargetFile(historyDir,item);
  if (backup.exists()) {
    if (source.exists()) {
      byte[] hash=PatchUtils.calculateHash(source);
      if (!Arrays.equals(sourceHash,hash)) {
        throw new IllegalStateException();
      }
    }
    PatchUtils.copyFile(backup,source);
  }
}
