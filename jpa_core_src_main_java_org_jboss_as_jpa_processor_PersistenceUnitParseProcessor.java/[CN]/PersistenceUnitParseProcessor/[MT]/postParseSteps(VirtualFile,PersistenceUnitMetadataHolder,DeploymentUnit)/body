{
  for (  PersistenceUnitMetadata pu : puHolder.getPersistenceUnits()) {
    boolean convertVFS=false;
    String enableVFS=pu.getProperties().getProperty(Configuration.JPA_ENABLE_VFS_URLS);
    if (enableVFS != null && Boolean.parseBoolean(enableVFS) == false) {
      convertVFS=true;
    }
    List<URL> jarfilesUrls=new ArrayList<URL>();
    if (pu.getJarFiles() != null) {
      for (      String jar : pu.getJarFiles()) {
        jarfilesUrls.add(getRelativeURL(persistence_xml,jar,convertVFS));
      }
    }
    pu.setJarFileUrls(jarfilesUrls);
    URL url=getPersistenceUnitURL(persistence_xml,convertVFS);
    pu.setPersistenceUnitRootUrl(url);
    pu.setScopedPersistenceUnitName(createBeanName(deploymentUnit,pu.getPersistenceUnitName()));
    final ServiceName puServiceName=PersistenceUnitServiceImpl.getPUServiceName(pu);
    deploymentUnit.addToAttachmentList(org.jboss.as.ee.structure.Attachments.INITIALISE_IN_ORDER_SERVICES,puServiceName);
  }
}
