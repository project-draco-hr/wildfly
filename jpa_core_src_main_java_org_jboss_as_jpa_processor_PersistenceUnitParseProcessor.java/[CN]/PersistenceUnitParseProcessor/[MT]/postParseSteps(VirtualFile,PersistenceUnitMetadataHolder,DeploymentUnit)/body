{
  for (  PersistenceUnitMetadata pu : puHolder.getPersistenceUnits()) {
    List<URL> jarfilesUrls=new ArrayList<URL>();
    if (pu.getJarFiles() != null) {
      for (      String jar : pu.getJarFiles()) {
        jarfilesUrls.add(getRelativeURL(persistence_xml,jar));
      }
    }
    pu.setJarFileUrls(jarfilesUrls);
    URL url=getPersistenceUnitURL(persistence_xml);
    pu.setPersistenceUnitRootUrl(url);
    pu.setScopedPersistenceUnitName(createBeanName(deploymentUnit,pu.getPersistenceUnitName()));
    final ServiceName puServiceName=PersistenceUnitServiceImpl.getPUServiceName(pu);
    deploymentUnit.addToAttachmentList(org.jboss.as.ee.structure.Attachments.INITIALISE_IN_ORDER_SERVICES,puServiceName);
  }
}
