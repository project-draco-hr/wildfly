{
  Principal principal=request.getUserPrincipal();
  if (principal != null) {
    log.info("User " + principal.getName() + " is already autenticated");
    return true;
  }
  Realm realm=request.getContext().getRealm();
  log.info("Authentication against " + realm.toString() + " realm: "+ realm.getInfo());
  principal=realm.authenticate("user1","password1");
  if (principal != null) {
    request.setUserPrincipal(principal);
    log.info("Authentication via custom valve authenticator");
    response.addHeader("valve",testparam);
    log.info("Valve " + TestAuthenticator.class.getName() + " was hit and adding header parameter 'authenticated' with value "+ testparam);
    return true;
  }
  log.warn("Login via global valve authenticator wasn't successfull");
  return false;
}
