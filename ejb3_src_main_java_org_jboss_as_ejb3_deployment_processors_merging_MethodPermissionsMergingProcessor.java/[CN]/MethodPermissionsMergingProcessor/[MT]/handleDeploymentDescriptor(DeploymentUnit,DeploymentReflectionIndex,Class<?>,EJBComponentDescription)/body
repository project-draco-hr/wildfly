{
  componentConfiguration.getConfigurators().add(new EjbJaccConfigurator());
  EjbJarMetaData ejbJarMetadata=deploymentUnit.getAttachment(EjbDeploymentAttachmentKeys.EJB_JAR_METADATA);
  if (ejbJarMetadata != null) {
    final AssemblyDescriptorMetaData assemblyDescriptor=ejbJarMetadata.getAssemblyDescriptor();
    if (assemblyDescriptor != null) {
      final ExcludeListMetaData excludeList=assemblyDescriptor.getExcludeListByEjbName(componentConfiguration.getEJBName());
      if (excludeList != null && excludeList.getMethods() != null) {
        for (        final MethodMetaData method : excludeList.getMethods()) {
          final String methodName=method.getMethodName();
          final MethodIntf methodIntf=this.getMethodIntf(method.getMethodIntf());
          if (methodName.equals("*")) {
            componentConfiguration.getDescriptorMethodPermissions().setAttribute(methodIntf,null,EJBMethodSecurityAttribute.denyAll());
          }
 else {
            final MethodParametersMetaData methodParams=method.getMethodParams();
            if (methodParams == null) {
              componentConfiguration.getDescriptorMethodPermissions().setAttribute(methodIntf,EJBMethodSecurityAttribute.denyAll(),methodName);
            }
 else {
              componentConfiguration.getDescriptorMethodPermissions().setAttribute(methodIntf,EJBMethodSecurityAttribute.denyAll(),null,methodName,this.getMethodParams(methodParams));
            }
          }
        }
      }
      final MethodPermissionsMetaData methodPermissions=assemblyDescriptor.getMethodPermissionsByEjbName(componentConfiguration.getEJBName());
      if (methodPermissions != null) {
        for (        final MethodPermissionMetaData methodPermissionMetaData : methodPermissions) {
          final MethodsMetaData methods=methodPermissionMetaData.getMethods();
          for (          final MethodMetaData method : methods) {
            EJBMethodSecurityAttribute ejbMethodSecurityMetaData;
            if (methodPermissionMetaData.isNotChecked()) {
              ejbMethodSecurityMetaData=EJBMethodSecurityAttribute.permitAll();
            }
 else {
              ejbMethodSecurityMetaData=EJBMethodSecurityAttribute.rolesAllowed(methodPermissionMetaData.getRoles());
            }
            final String methodName=method.getMethodName();
            final MethodIntf methodIntf=this.getMethodIntf(method.getMethodIntf());
            if (methodName.equals("*")) {
              final EJBMethodSecurityAttribute existingRoles=componentConfiguration.getDescriptorMethodPermissions().getAttributeStyle1(methodIntf,null);
              ejbMethodSecurityMetaData=mergeExistingRoles(ejbMethodSecurityMetaData,existingRoles);
              componentConfiguration.getDescriptorMethodPermissions().setAttribute(methodIntf,null,ejbMethodSecurityMetaData);
            }
 else {
              final MethodParametersMetaData methodParams=method.getMethodParams();
              if (methodParams == null) {
                final EJBMethodSecurityAttribute existingRoles=componentConfiguration.getDescriptorMethodPermissions().getAttributeStyle2(methodIntf,methodName);
                ejbMethodSecurityMetaData=mergeExistingRoles(ejbMethodSecurityMetaData,existingRoles);
                componentConfiguration.getDescriptorMethodPermissions().setAttribute(methodIntf,ejbMethodSecurityMetaData,methodName);
              }
 else {
                final EJBMethodSecurityAttribute existingRoles=componentConfiguration.getDescriptorMethodPermissions().getAttributeStyle3(methodIntf,null,methodName,this.getMethodParams(methodParams));
                ejbMethodSecurityMetaData=mergeExistingRoles(ejbMethodSecurityMetaData,existingRoles);
                componentConfiguration.getDescriptorMethodPermissions().setAttribute(methodIntf,ejbMethodSecurityMetaData,null,methodName,this.getMethodParams(methodParams));
              }
            }
          }
        }
      }
    }
  }
}
