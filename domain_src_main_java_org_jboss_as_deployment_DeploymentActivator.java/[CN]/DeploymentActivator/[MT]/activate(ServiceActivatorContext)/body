{
  final BatchBuilder batchBuilder=context.getBatchBuilder();
  batchBuilder.addService(DeploymentChainProvider.SERVICE_NAME,DeploymentChainProvider.INSTANCE);
  batchBuilder.addService(DeploymentModuleLoaderProvider.SERVICE_NAME,new DeploymentModuleLoaderProvider());
  final DeploymentModuleLoader deploymentModuleLoader=new DeploymentModuleLoaderImpl(ModuleLoaderSelector.DEFAULT.getCurrentLoader());
  final Service<DeploymentModuleLoader> deploymentModuleLoaderService=new DeploymentModuleLoaderService(deploymentModuleLoader);
  batchBuilder.addService(DeploymentModuleLoaderImpl.SERVICE_NAME,deploymentModuleLoaderService).addDependency(DeploymentModuleLoaderProvider.SERVICE_NAME,DeploymentModuleLoaderProvider.class,new DeploymentModuleLoaderProvider.SelectorInjector<DeploymentModuleLoaderProvider.Selector>(deploymentModuleLoaderService,Values.<DeploymentModuleLoaderProvider.Selector>immediateValue(new DeploymentModuleLoaderProvider.Selector(){
    public boolean supports(    VirtualFile root){
      return true;
    }
  }
),DeploymentModuleLoaderImpl.SELECTOR_PRIORITY));
  batchBuilder.addService(TempFileProviderService.SERVICE_NAME,new TempFileProviderService());
}
