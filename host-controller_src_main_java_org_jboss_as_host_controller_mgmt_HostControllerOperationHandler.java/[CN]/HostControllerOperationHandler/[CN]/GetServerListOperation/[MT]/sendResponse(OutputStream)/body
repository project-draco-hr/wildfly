{
  final Marshaller marshaller=getMarshaller();
  marshaller.start(createByteOutput(output));
  try {
    Map<ServerIdentity,ServerStatus> serverStatuses=hostController.getServerStatuses();
    marshaller.writeByte(HostControllerProtocol.RETURN_SERVER_COUNT);
    marshaller.writeInt(serverStatuses.size());
    for (    Map.Entry<ServerIdentity,ServerStatus> entry : serverStatuses.entrySet()) {
      marshaller.writeByte(HostControllerProtocol.RETURN_SERVER_NAME);
      marshaller.writeUTF(entry.getKey().getServerName());
      marshaller.writeByte(HostControllerProtocol.RETURN_SERVER_GROUP_NAME);
      marshaller.writeUTF(entry.getKey().getServerGroupName());
      marshaller.writeByte(HostControllerProtocol.RETURN_SERVER_STATUS);
      marshaller.writeObject(entry.getValue());
    }
    marshaller.finish();
  }
  finally {
    safeFinish(marshaller);
  }
}
