{
  String enteredRealm=stateValues.getRealm();
  if (enteredRealm.length() == 0) {
    return new ErrorState(theConsole,MESSAGES.realmMustBeSpecified(),new PromptRealmState(theConsole,stateValues));
  }
  if (stateValues.getFileMode() != FileMode.UNDEFINED) {
    final String expectedRealm=stateValues.getFileMode() == FileMode.MANAGEMENT ? DEFAULT_MANAGEMENT_REALM : DEFAULT_APPLICATION_REALM;
    if (expectedRealm.equals(enteredRealm) == false) {
      String message=MESSAGES.alternativeRealm(expectedRealm);
      String prompt=MESSAGES.realmConfirmation(enteredRealm) + " " + MESSAGES.yes()+ "/"+ MESSAGES.no()+ "?";
      return new ConfirmationChoice(theConsole,message,prompt,new PromptNewUserState(theConsole,stateValues),new PromptRealmState(theConsole,stateValues));
    }
  }
  return new PromptNewUserState(theConsole,stateValues);
}
