{
  try {
    Transaction tx=tm.getTransaction();
    if (tx == null) {
      return null;
    }
    Map<Object,Object> txMap=(Map<Object,Object>)transactionData.get(tx);
    if (txMap == null) {
      int status=tx.getStatus();
      if (status == Status.STATUS_ACTIVE || status == Status.STATUS_PREPARING) {
        txMap=new HashMap<Object,Object>();
        transactionData.set(tx,txMap);
      }
    }
    return txMap;
  }
 catch (  EJBException e) {
    throw e;
  }
catch (  Exception e) {
    throw CmpMessages.MESSAGES.errorGettingTxMap(e);
  }
}
