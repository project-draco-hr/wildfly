{
  Transaction tx=mock(Transaction.class);
  when(this.tm.getTransaction()).thenReturn(null);
  when(this.tm.suspend()).thenReturn(tx);
  Batch batch=this.batcher.startBatch();
  verify(this.tm).begin();
  when(this.tm.suspend()).thenReturn(tx);
  batch.close();
  verify(this.tm,times(1)).resume(same(tx));
  verify(this.tm).commit();
}
