{
  Transaction tx=mock(Transaction.class);
  when(this.tm.getTransaction()).thenReturn(tx);
  TransactionBatch batch=this.batcher.startBatch();
  assertSame(tx,batch.getTransaction());
  Transaction existing=mock(Transaction.class);
  when(this.tm.suspend()).thenReturn(existing);
  BatchContext context=this.batcher.resume(batch);
  verify(this.tm).resume(same(tx));
  context.close();
  verify(this.tm).resume(same(existing));
}
