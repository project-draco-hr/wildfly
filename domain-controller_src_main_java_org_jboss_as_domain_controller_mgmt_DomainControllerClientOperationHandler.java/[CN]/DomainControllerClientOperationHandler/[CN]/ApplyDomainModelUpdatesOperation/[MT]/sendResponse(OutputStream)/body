{
  List<DomainUpdateResult<?>> responses=domainController.applyUpdates(updates);
  final Marshaller marshaller=getMarshaller();
  marshaller.start(createByteOutput(output));
  try {
    marshaller.writeByte(DomainClientProtocol.RETURN_APPLY_UPDATES_RESULT_COUNT);
    marshaller.writeInt(responses.size());
    for (    DomainUpdateResult<?> response : responses) {
      marshaller.writeByte(DomainClientProtocol.RETURN_APPLY_UPDATE);
      marshaller.writeObject(response);
    }
    marshaller.finish();
  }
  finally {
    safeFinish(marshaller);
  }
}
