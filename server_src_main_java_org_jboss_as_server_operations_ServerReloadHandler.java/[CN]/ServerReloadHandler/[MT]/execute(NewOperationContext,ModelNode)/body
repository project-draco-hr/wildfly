{
  context.addStep(new NewStepHandler(){
    @Override public void execute(    NewOperationContext context,    ModelNode operation) throws OperationFailedException {
      ServiceController<?> service=context.getServiceRegistry(true).getRequiredService(Services.JBOSS_AS);
      service.addListener(new AbstractServiceListener<Object>(){
        public void listenerAdded(        final ServiceController<?> controller){
          controller.setMode(ServiceController.Mode.NEVER);
        }
        public void transition(        final ServiceController<? extends Object> controller,        final ServiceController.Transition transition){
          if (transition == ServiceController.Transition.STOPPING_to_DOWN) {
            controller.removeListener(this);
            controller.setMode(ServiceController.Mode.ACTIVE);
          }
        }
      }
);
      context.completeStep();
    }
  }
,NewOperationContext.Stage.RUNTIME);
  context.completeStep();
}
