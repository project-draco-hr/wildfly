{
  deployer.deploy(DEPLOYMENT_NAME);
  try {
    Long bundleId=getBundleId(SYMBOLIC_NAME,null);
    Assert.assertNotNull("Bundle found",bundleId);
    Assert.assertEquals("INSTALLED",getBundleState(bundleId));
    Assert.assertTrue("Bundle started",bundleStart(bundleId));
    Assert.assertEquals("ACTIVE",getBundleState(bundleId));
    Map<String,Object> info=getBundleInfo(bundleId);
    Assert.assertEquals(7,info.size());
    Assert.assertEquals(bundleId + "L",info.get(ModelConstants.ID));
    Assert.assertEquals("1",info.get(ModelConstants.STARTLEVEL));
    Assert.assertEquals("ACTIVE",info.get(ModelConstants.STATE));
    Assert.assertEquals(SYMBOLIC_NAME,info.get(ModelConstants.SYMBOLIC_NAME));
    Assert.assertEquals(DEPLOYMENT_NAME,info.get(ModelConstants.LOCATION));
    Assert.assertEquals("bundle",info.get(ModelConstants.TYPE));
    Assert.assertEquals("0.0.0",info.get(ModelConstants.VERSION));
    Assert.assertTrue("Bundle stopped",bundleStop(bundleId));
    Assert.assertEquals("RESOLVED",getBundleState(bundleId));
    Assert.assertTrue("Bundle started",bundleStart(DEPLOYMENT_NAME));
    Assert.assertEquals("ACTIVE",getBundleState(DEPLOYMENT_NAME));
    Assert.assertTrue("Bundle stopped",bundleStop(DEPLOYMENT_NAME));
    Assert.assertEquals("RESOLVED",getBundleState(DEPLOYMENT_NAME));
  }
  finally {
    deployer.undeploy(DEPLOYMENT_NAME);
  }
}
