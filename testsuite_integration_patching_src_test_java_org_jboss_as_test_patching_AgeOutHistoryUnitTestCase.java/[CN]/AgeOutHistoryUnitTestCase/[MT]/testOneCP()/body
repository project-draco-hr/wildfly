{
  Module module=new Module.Builder("module-test").miscFile(new ResourceItem("resource-test",("module resource").getBytes())).build();
  File moduleDir=module.writeToDisk(new File(MODULES_PATH));
  byte[] targetHash=HashUtils.hashFile(moduleDir);
  targetHash=applyCP("cp1",targetHash);
  controller.start(CONTAINER);
  try {
    client=createClient();
    assertPatched(client,new String[]{"cp1"},new boolean[]{true});
    ageoutHistory(client);
    assertPatched(client,new String[]{"cp1"},new boolean[]{true});
  }
  finally {
    controller.stop(CONTAINER);
  }
}
