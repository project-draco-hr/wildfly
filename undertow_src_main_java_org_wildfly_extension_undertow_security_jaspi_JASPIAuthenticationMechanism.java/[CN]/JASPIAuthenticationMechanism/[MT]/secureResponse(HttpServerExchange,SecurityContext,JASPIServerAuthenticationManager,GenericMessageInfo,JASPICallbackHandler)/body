{
  exchange.addExchangeCompleteListener(new ExchangeCompletionListener(){
    @Override public void exchangeEvent(    final HttpServerExchange exchange,    final NextListener nextListener){
      ServletRequestContext requestContext=exchange.getAttachment(ServletRequestContext.ATTACHMENT_KEY);
      String applicationIdentifier=buildApplicationIdentifier(requestContext);
      if (isSecureResponse(requestContext,securityContext)) {
        ROOT_LOGGER.debugf("secureResponse for layer [%s] and applicationContextIdentifier [%s].",JASPI_HTTP_SERVLET_LAYER,applicationIdentifier);
        sam.secureResponse(messageInfo,new Subject(),JASPI_HTTP_SERVLET_LAYER,applicationIdentifier,cbh);
      }
      nextListener.proceed();
    }
  }
);
}
