{
  if (cbh == null) {
    throw MESSAGES.nullParamter("JASPICallbackHandler");
  }
  CallerPrincipalCallback cpc=cbh.getCallerPrincipalCallback();
  if (cpc == null) {
    throw MESSAGES.nullParamter("CallerPrincipalCallback from JASPI CallbackHandler");
  }
  String userName;
  if (cpc.getPrincipal() != null) {
    userName=cpc.getPrincipal().getName();
  }
 else {
    userName=cpc.getName();
  }
  PasswordValidationCallback pcb=cbh.getPasswordValidationCallback();
  PasswordCredential credential=null;
  if (pcb != null && pcb.getPassword() != null) {
    credential=new PasswordCredential(pcb.getPassword());
  }
  GroupPrincipalCallback gpc=cbh.getGroupPrincipalCallback();
  Set<String> groups=null;
  if (gpc != null && gpc.getGroups() != null) {
    groups=new HashSet<String>(Arrays.asList(gpc.getGroups()));
  }
  return new AccountImpl(new SimplePrincipal(userName),groups,credential);
}
