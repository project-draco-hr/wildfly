{
  ModelNode attributeDescriptions=description.get(ATTRIBUTES);
  for (  Property descProp : attributeDescriptions.asPropertyList()) {
    String attrName=descProp.getName();
    ModelNode attrDesc=descProp.getValue();
    if (isAttributeExcluded(address,attrName,attrDesc)) {
      continue;
    }
    ModelNode noDefaultValue=resourceNoDefaults.get(attrName);
    if (!noDefaultValue.isDefined()) {
      Set<String> base=new HashSet<String>();
      base.add(attrName);
      if (attrDesc.hasDefined(REQUIRES)) {
        for (        ModelNode node : attrDesc.get(REQUIRES).asList()) {
          base.add(node.asString());
        }
      }
      boolean conflict=false;
      for (      String baseAttr : base) {
        ModelNode baseAttrAlts=attributeDescriptions.get(baseAttr,ALTERNATIVES);
        if (baseAttrAlts.isDefined()) {
          for (          ModelNode alt : baseAttrAlts.asList()) {
            String altName=alt.asString();
            if (resourceNoDefaults.hasDefined(alt.asString()) || expressionAttrs.containsKey(altName) || otherAttrs.containsKey(altName)) {
              conflict=true;
              break;
            }
          }
        }
      }
      if (conflict) {
        continue;
      }
    }
    ModelNode attrValue=resource.get(attrName);
    ModelType attrType=attrValue.getType();
    if (attrDesc.get(EXPRESSIONS_ALLOWED).asBoolean(false)) {
      if (attrType != ModelType.UNDEFINED && attrType != ModelType.EXPRESSION) {
        if (COMPLEX_TYPES.contains(attrType)) {
          ModelNode valueType=attrDesc.get(VALUE_TYPE);
          if (valueType.getType() == ModelType.TYPE) {
            handleSimpleCollection(address,attrName,attrValue,valueType.asType(),expressionAttrs,otherAttrs,expectedAttrs);
          }
 else           if (valueType.isDefined()) {
            handleComplexCollection(address,attrName,attrValue,valueType,expressionAttrs,otherAttrs,expectedAttrs);
          }
 else {
            otherAttrs.put(attrName,attrValue);
            expectedAttrs.put(attrName,attrValue);
          }
        }
 else {
          if (attrType == ModelType.STRING) {
            checkForUnconvertedExpression(address,attrName,attrValue);
          }
          String expression="${exp.test:" + attrValue.asString() + "}";
          expressionAttrs.put(attrName,new ModelNode(expression));
          expectedAttrs.put(attrName,new ModelNode().setExpression(expression));
        }
      }
    }
 else     if (COMPLEX_TYPES.contains(attrType) && attrDesc.get(VALUE_TYPE).getType() != ModelType.TYPE && attrDesc.get(VALUE_TYPE).isDefined()) {
      handleComplexCollection(address,attrName,attrValue,attrDesc.get(VALUE_TYPE),expressionAttrs,otherAttrs,expectedAttrs);
    }
 else {
      otherAttrs.put(attrName,attrValue);
      expectedAttrs.put(attrName,attrValue);
    }
  }
}
