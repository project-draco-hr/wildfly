{
  final MBeanServerConnection mBeanServerConnection=JMXConnectorFactory.connect(managementClient.getRemoteJMXURL()).getMBeanServerConnection();
  try {
    deployer.deploy(ServiceMBeanSupportTestCase.UNMANAGED_SAR_DEPLOYMENT_NAME);
    int state=(Integer)mBeanServerConnection.getAttribute(new ObjectName("jboss:name=service-mbean-support-test"),"State");
    Assert.assertEquals("Unexpected return state from Test MBean: " + state,ServiceMBean.STARTED,state);
  }
  finally {
    deployer.undeploy(ServiceMBeanSupportTestCase.UNMANAGED_SAR_DEPLOYMENT_NAME);
  }
  String attribute="CreateServiceInvoked";
  Boolean result=(Boolean)mBeanServerConnection.getAttribute(new ObjectName("jboss:name=service-mbean-support-test-result"),attribute);
  Assert.assertTrue("Unexpected result for " + attribute + ": "+ result,result);
  attribute="StartServiceInvoked";
  result=(Boolean)mBeanServerConnection.getAttribute(new ObjectName("jboss:name=service-mbean-support-test-result"),attribute);
  Assert.assertTrue("Unexpected result for " + attribute + ": "+ result,result);
  attribute="StopServiceInvoked";
  result=(Boolean)mBeanServerConnection.getAttribute(new ObjectName("jboss:name=service-mbean-support-test-result"),attribute);
  Assert.assertTrue("Unexpected result for " + attribute + ": "+ result,result);
  attribute="DestroyServiceInvoked";
  result=(Boolean)mBeanServerConnection.getAttribute(new ObjectName("jboss:name=service-mbean-support-test-result"),attribute);
  Assert.assertTrue("Unexpected result for " + attribute + ": "+ result,result);
}
