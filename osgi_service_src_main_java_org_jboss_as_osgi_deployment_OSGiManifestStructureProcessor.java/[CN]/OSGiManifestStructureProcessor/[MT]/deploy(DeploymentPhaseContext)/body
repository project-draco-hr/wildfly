{
  final DeploymentUnit depUnit=phaseContext.getDeploymentUnit();
  if (depUnit.hasAttachment(Attachments.OSGI_MANIFEST) || depUnit.hasAttachment(OSGiConstants.OSGI_METADATA_KEY))   return;
  final ResourceRoot deploymentRoot=depUnit.getAttachment(Attachments.DEPLOYMENT_ROOT);
  if (deploymentRoot == null)   return;
  Manifest manifest=deploymentRoot.getAttachment(Attachments.MANIFEST);
  if (OSGiManifestBuilder.isValidBundleManifest(manifest)) {
    depUnit.putAttachment(Attachments.OSGI_MANIFEST,manifest);
    OSGiMetaData metadata=OSGiMetaDataBuilder.load(manifest);
    depUnit.putAttachment(OSGiConstants.OSGI_METADATA_KEY,metadata);
  }
}
