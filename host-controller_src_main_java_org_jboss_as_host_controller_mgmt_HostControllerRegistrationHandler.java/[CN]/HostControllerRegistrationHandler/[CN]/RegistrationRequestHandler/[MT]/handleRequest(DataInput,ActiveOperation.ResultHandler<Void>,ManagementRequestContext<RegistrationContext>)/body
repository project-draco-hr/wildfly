{
  expectHeader(input,DomainControllerProtocol.PARAM_HOST_ID);
  final String hostName=input.readUTF();
  final ModelNode hostInfo=new ModelNode();
  hostInfo.readExternal(input);
  final RegistrationContext registration=context.getAttachment();
  registration.initialize(hostName,hostInfo,context);
  if (domainController.isHostRegistered(hostName)) {
    registration.failed(SlaveRegistrationException.ErrorCode.HOST_ALREADY_EXISTS,hostName);
  }
  context.executeAsync(new ManagementRequestContext.AsyncTask<RegistrationContext>(){
    @Override public void execute(    ManagementRequestContext<RegistrationContext> context) throws Exception {
      final ModelNode result;
      try {
        result=controller.execute(READ_DOMAIN_MODEL,OperationMessageHandler.logging,registration,OperationAttachments.EMPTY);
      }
 catch (      Exception e) {
        registration.failed(SlaveRegistrationException.ErrorCode.UNKNOWN,e.getClass().getName() + ":" + e.getMessage());
        return;
      }
      registration.sendCompletedMessage(result);
    }
  }
);
}
