{
  if (completed.compareAndSet(false,true)) {
    failed=true;
    try {
      sendFailedResponse(responseChannel,errorCode,message);
    }
 catch (    IOException e) {
      ProtocolLogger.ROOT_LOGGER.debugf(e,"failed to process message");
    }
 finally {
      completedLatch.countDown();
    }
  }
}
