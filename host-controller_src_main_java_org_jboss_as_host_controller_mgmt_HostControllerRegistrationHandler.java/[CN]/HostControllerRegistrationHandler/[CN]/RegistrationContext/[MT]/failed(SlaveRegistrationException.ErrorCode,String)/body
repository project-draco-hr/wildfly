{
  byte errorCode=error.getCode();
  if (completed.compareAndSet(false,true)) {
    failed=true;
    final IOTask<?> task=this.task;
    if (task != null) {
      task.setFailed();
    }
    try {
      sendFailedResponse(responseChannel,errorCode,message);
    }
 catch (    IOException e) {
      ProtocolLogger.ROOT_LOGGER.debugf(e,"failed to process message");
    }
    activeOperation.getResultHandler().done(null);
    addFailureEvent(error);
  }
}
