{
  for (; ; ) {
    final Map<String,SubRegistry> subRegistries=subRegistriesUpdater.get(this);
    SubRegistry registry=subRegistries.get(key);
    if (registry == null) {
      registry=new SubRegistry();
      SubRegistry existing=subRegistriesUpdater.putAtomic(this,key,registry,subRegistries);
      if (existing == null) {
        return registry;
      }
 else       if (existing != registry) {
        return existing;
      }
    }
    return registry;
  }
}
