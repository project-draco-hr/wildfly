{
  final ClassLoader classLoader=WildFlySecurityManager.getCurrentContextClassLoaderPrivileged();
  try {
    WildFlySecurityManager.setCurrentContextClassLoaderPrivileged(FlowCDIExtension.class.getClassLoader());
    Metadata<Extension> metadata=new CDIExtensionMetadataImpl(new FlowCDIExtension());
    topLevelDeployment.addToAttachmentList(WeldAttachments.PORTABLE_EXTENSIONS,metadata);
    metadata=new CDIExtensionMetadataImpl(new ViewScopeExtension());
    topLevelDeployment.addToAttachmentList(WeldAttachments.PORTABLE_EXTENSIONS,metadata);
    metadata=new CDIExtensionMetadataImpl(new FlowDiscoveryCDIExtension());
    topLevelDeployment.addToAttachmentList(WeldAttachments.PORTABLE_EXTENSIONS,metadata);
  }
  finally {
    WildFlySecurityManager.setCurrentContextClassLoaderPrivileged(classLoader);
  }
}
