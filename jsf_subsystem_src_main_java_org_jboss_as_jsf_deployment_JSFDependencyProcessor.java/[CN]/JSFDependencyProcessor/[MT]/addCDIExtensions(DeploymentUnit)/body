{
  final ClassLoader classLoader=SecurityActions.getContextClassLoader();
  try {
    SecurityActions.setContextClassLoader(FlowCDIExtension.class.getClassLoader());
    Metadata<Extension> metadata=new CDIExtensionMetadataImpl(new FlowCDIExtension());
    topLevelDeployment.addToAttachmentList(WeldAttachments.PORTABLE_EXTENSIONS,metadata);
    metadata=new CDIExtensionMetadataImpl(new ViewScopeExtension());
    topLevelDeployment.addToAttachmentList(WeldAttachments.PORTABLE_EXTENSIONS,metadata);
    metadata=new CDIExtensionMetadataImpl(new FlowDiscoveryCDIExtension());
    topLevelDeployment.addToAttachmentList(WeldAttachments.PORTABLE_EXTENSIONS,metadata);
  }
  finally {
    SecurityActions.setContextClassLoader(classLoader);
  }
}
