{
  String uri=DeploymentManagerImpl.DEPLOYER_URI + "?targetType=as7&serverHost=127.0.0.1&serverPort=9999";
  DeploymentManager manager=getDeploymentManager(uri,USERNAME,PASSWORD);
  Target[] targets=manager.getTargets();
  TargetModuleID[] modules=manager.getAvailableModules(ModuleType.EAR,targets);
  assertNull(modules);
  ProgressObject progress=jsr88Deploy(manager,getEarArchive());
  TargetModuleID[] targetModules=progress.getResultTargetModuleIDs();
  try {
    modules=manager.getAvailableModules(ModuleType.EAR,targets);
    assertNotNull(modules);
    assertEquals(1,modules.length);
    TargetModuleID targetModuleID=modules[0];
    String moduleID=targetModuleID.getModuleID();
    assertTrue("Ends with deployment-app.ear",moduleID.endsWith("deployment-app.ear"));
    modules=manager.getNonRunningModules(ModuleType.EAR,targets);
    assertEquals(0,modules.length);
    modules=manager.getRunningModules(ModuleType.EAR,targets);
    assertEquals(1,modules.length);
    targetModuleID=modules[0];
    moduleID=targetModuleID.getModuleID();
    assertTrue("Ends with deployment-app.ear",moduleID.endsWith("deployment-app.ear"));
    manager.stop(modules);
    modules=manager.getRunningModules(ModuleType.EAR,targets);
    assertEquals(0,modules.length);
    modules=manager.getNonRunningModules(ModuleType.EAR,targets);
    assertEquals(1,modules.length);
    manager.start(modules);
    modules=manager.getNonRunningModules(ModuleType.EAR,targets);
    assertEquals(0,modules.length);
    modules=manager.getRunningModules(ModuleType.EAR,targets);
    assertEquals(1,modules.length);
  }
  finally {
    jsr88Undeploy(manager,targetModules);
  }
}
