{
  String uri=DeploymentManagerImpl.DEPLOYER_URI + "?targetType=as7&serverHost=" + managementClient.getMgmtAddress()+ "&serverPort="+ managementClient.getMgmtPort();
  DeploymentManager manager=getDeploymentManager(uri,Authentication.USERNAME,Authentication.PASSWORD);
  Target[] targets=manager.getTargets();
  TargetModuleID[] modules=manager.getAvailableModules(ModuleType.EAR,targets);
  assertNull(modules);
  ProgressObject progress=jsr88Deploy(manager,getEarArchive());
  TargetModuleID[] targetModules=progress.getResultTargetModuleIDs();
  try {
    modules=manager.getAvailableModules(ModuleType.EAR,targets);
    assertNotNull(modules);
    assertEquals(1,modules.length);
    TargetModuleID targetModuleID=modules[0];
    String moduleID=targetModuleID.getModuleID();
    assertTrue("Ends with deployment-app.ear",moduleID.endsWith("deployment-app.ear"));
    modules=manager.getNonRunningModules(ModuleType.EAR,targets);
    assertEquals("non-running EAR modules count expected to be zero " + modules,0,modules.length);
    modules=manager.getRunningModules(ModuleType.EAR,targets);
    assertEquals("running EAR modules count expected to be one " + modules,1,modules.length);
    targetModuleID=modules[0];
    moduleID=targetModuleID.getModuleID();
    assertTrue("Ends with deployment-app.ear",moduleID.endsWith("deployment-app.ear"));
    ProgressObject operationProgress=manager.stop(modules);
    awaitCompletion(operationProgress,TIMEOUT);
    modules=manager.getRunningModules(ModuleType.EAR,targets);
    assertEquals("after stopping deployment-app.ear, running EAR modules count expected to be zero" + modules,0,modules.length);
    modules=manager.getNonRunningModules(ModuleType.EAR,targets);
    assertEquals("after stopping deployment-app.ear, non-running EAR modules count expected to be one" + modules,1,modules.length);
    operationProgress=manager.start(modules);
    awaitCompletion(operationProgress,TIMEOUT);
    modules=manager.getNonRunningModules(ModuleType.EAR,targets);
    assertEquals("after starting deployment-app.ear, non-running EAR modules count expected to be zero" + modules,0,modules.length);
    modules=manager.getRunningModules(ModuleType.EAR,targets);
    assertEquals("after starting deployment-app.ear, running EAR modules count expected to be one",1,modules.length);
  }
  finally {
    jsr88Undeploy(manager,targetModules);
  }
}
