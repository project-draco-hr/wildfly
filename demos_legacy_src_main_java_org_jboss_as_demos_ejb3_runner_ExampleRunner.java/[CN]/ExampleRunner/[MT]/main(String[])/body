{
  DeploymentUtils utils=new DeploymentUtils();
  try {
    utils.addDeployment("ejb3-rar.rar",SimpleQueueResourceAdapter.class.getPackage());
    utils.addDeployment("ejb3-mdb.jar",PostmanPatMDB.class.getPackage());
    utils.addDeployment("ejb3-example.jar",SimpleStatelessSessionBean.class.getPackage());
    utils.addDeployment("ejb3-mbean.sar",Test.class.getPackage());
    utils.deploy();
    MBeanServerConnection mbeanServer=utils.getConnection();
    SimpleStatelessSessionLocal bean=createProxy(mbeanServer,"java:global/ejb3-example/SimpleStatelessSessionBean!" + SimpleStatelessSessionLocal.class.getName(),SimpleStatelessSessionLocal.class);
    String msg=bean.echo("Hello world");
    System.out.println(msg);
    final String result=(String)mbeanServer.invoke(new ObjectName("jboss:name=ejb3-test,type=service"),"callAsync",new Object[]{"java:global/ejb3-example/AsyncBean!" + AsyncLocal.class.getName(),"Hello World"},new String[]{String.class.getName(),String.class.getName()});
    System.out.println(result);
    exec(mbeanServer,ExerciseStateful.class);
    String singletonBeanJndiName="java:global/ejb3-example/SimpleSingletonBean!" + SimpleSingletonLocal.class.getName();
    workOnSingletoBean(mbeanServer,singletonBeanJndiName,100,10);
    exec(mbeanServer,ExerciseBMT.class);
    exec(mbeanServer,ExerciseEchoService.class);
    exec(mbeanServer,ExercisePatClifton.class);
  }
  finally {
    utils.undeploy();
    safeClose(utils);
  }
}
