{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  SharedSessionManagerConfig sharedConfig=deploymentUnit.getAttachment(UndertowAttachments.SHARED_SESSION_MANAGER_CONFIG);
  if (sharedConfig == null) {
    return;
  }
  ServiceName serviceName=deploymentUnit.getServiceName().append(SharedSessionManagerConfig.SHARED_SESSION_MANAGER_SERVICE_NAME);
  if (sharedConfig.getReplicationConfig() == null) {
    InMemorySessionManager manager=new InMemorySessionManager(deploymentUnit.getName(),sharedConfig.getMaxActiveSessions());
    if (sharedConfig.getSessionConfig() != null) {
      if (sharedConfig.getSessionConfig().getSessionTimeoutSet()) {
        manager.setDefaultSessionTimeout(sharedConfig.getSessionConfig().getSessionTimeout());
      }
    }
    phaseContext.getServiceTarget().addService(serviceName,new ValueService<SessionManagerFactory>(new ImmediateValue<SessionManagerFactory>(new ImmediateSessionManagerFactory(manager)))).install();
  }
 else {
    throw new DeploymentUnitProcessingException("Clustering not supported yet in shared session managers");
  }
}
