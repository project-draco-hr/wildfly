{
  String operation=getRequiredParameter(req,OPERATION);
  HttpSession session=req.getSession(true);
  resp.addHeader(SESSION_ID,session.getId());
  System.out.println(String.format("%s?%s;jsessionid=%s",req.getRequestURL(),req.getQueryString(),session.getId()));
  if (operation.equals(SET)) {
    String name=getRequiredParameter(req,NAME);
    String value=req.getParameter(VALUE);
    session.setAttribute(name,(value != null) ? new SessionAttributeValue(value) : null);
  }
 else   if (operation.equals(REMOVE)) {
    String name=getRequiredParameter(req,NAME);
    session.removeAttribute(name);
  }
 else   if (operation.equals(INVALIDATE)) {
    session.invalidate();
  }
 else   if (operation.equals(GET)) {
    String name=getRequiredParameter(req,NAME);
    SessionAttributeValue value=(SessionAttributeValue)session.getAttribute(name);
    if (value != null) {
      resp.setHeader(RESULT,value.getValue());
    }
  }
 else   if (operation.equals(TIMEOUT)) {
    String timeout=getRequiredParameter(req,TIMEOUT);
    session.setMaxInactiveInterval(Integer.parseInt(timeout));
  }
 else {
    throw new ServletException("Unrecognized operation: " + operation);
  }
  setHeader(resp,ACTIVATED_SESSIONS,SessionAttributeValue.activatedSessions);
  setHeader(resp,PASSIVATED_SESSIONS,SessionAttributeValue.passivatedSessions);
}
