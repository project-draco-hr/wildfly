{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  int defaultProviderCount=0;
  Set<String> moduleDependencies=new HashSet<String>();
  PersistenceUnitsInApplication persistenceUnitsInApplication=DeploymentUtils.getTopDeploymentUnit(deploymentUnit).getAttachment(PersistenceUnitsInApplication.PERSISTENCE_UNITS_IN_APPLICATION);
  for (  PersistenceUnitMetadataHolder holder : persistenceUnitsInApplication.getPersistenceUnitHolders()) {
    defaultProviderCount+=loadPersistenceUnits(moduleLoader,deploymentUnit,moduleDependencies,holder);
  }
  if (defaultProviderCount > 0) {
    moduleDependencies.add(Configuration.PROVIDER_MODULE_DEFAULT);
    ROOT_LOGGER.debugf("added (default provider) %s dependency to %s (since %d PU(s) didn't specify %s",Configuration.PROVIDER_MODULE_DEFAULT,deploymentUnit.getName(),defaultProviderCount,Configuration.PROVIDER_MODULE + ")");
    addDependency(moduleSpecification,moduleLoader,HIBERNATE_ENVERS_ID);
  }
  for (  String dependency : moduleDependencies) {
    addDependency(moduleSpecification,moduleLoader,ModuleIdentifier.fromString(dependency));
    ROOT_LOGGER.debugf("added %s dependency to application deployment",dependency);
  }
}
