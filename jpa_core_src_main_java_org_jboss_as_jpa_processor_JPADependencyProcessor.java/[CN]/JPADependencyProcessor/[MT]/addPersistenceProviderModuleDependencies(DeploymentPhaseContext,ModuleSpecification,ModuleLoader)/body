{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  int defaultProviderCount=0;
  Set<String> moduleDependencies=new HashSet<String>();
  for (  ResourceRoot resourceRoot : DeploymentUtils.allResourceRoots(deploymentUnit)) {
    PersistenceUnitMetadataHolder holder=resourceRoot.getAttachment(PersistenceUnitMetadataHolder.PERSISTENCE_UNITS);
    defaultProviderCount+=loadPersistenceUnits(moduleLoader,deploymentUnit,moduleDependencies,holder);
  }
  if (defaultProviderCount > 0) {
    moduleDependencies.add(Configuration.PROVIDER_MODULE_DEFAULT);
    ROOT_LOGGER.debugf("added (default provider) %s dependency to application deployment (since %s PU(s) didn't specify %d",Configuration.PROVIDER_MODULE_DEFAULT,defaultProviderCount,Configuration.PROVIDER_MODULE + ")");
    addDependency(moduleSpecification,moduleLoader,HIBERNATE_ENVERS_ID);
  }
  for (  String dependency : moduleDependencies) {
    addDependency(moduleSpecification,moduleLoader,ModuleIdentifier.fromString(dependency));
    ROOT_LOGGER.debugf("added %s dependency to application deployment",dependency);
  }
}
