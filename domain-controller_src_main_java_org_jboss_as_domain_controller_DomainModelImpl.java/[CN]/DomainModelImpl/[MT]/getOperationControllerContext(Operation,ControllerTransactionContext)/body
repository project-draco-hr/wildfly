{
  boolean forHost=isOperationForHost(operation.getOperation());
  final ConfigurationPersisterProvider persisterProvider=new DualRootConfigurationPersisterProvider(getConfigurationPersisterProvider(),hostPersisterProvider,forHost);
  final TransactionAwareOperationControllerContext occ=new TransactionAwareOperationControllerContext(persisterProvider,transaction);
  if (transaction != null) {
    transaction.registerSynchronization(new ControllerTransactionSynchronization(){
      @Override public void beforeCompletion(){
      }
      @Override public void afterCompletion(      boolean status){
        occ.doUnlock();
      }
    }
);
  }
  return occ;
}
