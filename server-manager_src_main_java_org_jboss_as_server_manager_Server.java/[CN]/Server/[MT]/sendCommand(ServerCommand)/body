{
  final ByteArrayOutputStream baos=new ByteArrayOutputStream(1024);
  final Checksum chksum=new Adler32();
  final CheckedOutputStream cos=new CheckedOutputStream(baos,chksum);
  final Marshaller marshaller=MARSHALLER_FACTORY.createMarshaller(CONFIG);
  try {
    marshaller.start(Marshalling.createByteOutput(cos));
    marshaller.writeObject(command);
    marshaller.finish();
    marshaller.close();
    communicationHandler.sendMessage(baos.toByteArray(),chksum.getValue());
  }
  finally {
    safeClose(marshaller);
  }
}
