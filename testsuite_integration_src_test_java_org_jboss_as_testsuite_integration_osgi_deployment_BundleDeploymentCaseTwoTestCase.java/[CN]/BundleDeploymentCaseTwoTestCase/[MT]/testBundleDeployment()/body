{
  deployer.deploy(BUNDLE_DEPLOYMENT);
  Bundle bundle=getDeployedBundle(context,BUNDLE_DEPLOYMENT,null);
  bundle.start();
  OSGiTestHelper.assertBundleState(Bundle.ACTIVE,bundle.getState());
  bundle.stop();
  OSGiTestHelper.assertBundleState(Bundle.RESOLVED,bundle.getState());
  final CountDownLatch uninstallLatch=new CountDownLatch(1);
  context.addBundleListener(new BundleListener(){
    public void bundleChanged(    BundleEvent event){
      if (event.getType() == BundleEvent.UNINSTALLED)       uninstallLatch.countDown();
    }
  }
);
  deployer.undeploy(BUNDLE_DEPLOYMENT);
  if (uninstallLatch.await(1000,TimeUnit.MILLISECONDS) == false)   fail("UNINSTALLED event not received");
  OSGiTestHelper.assertBundleState(Bundle.UNINSTALLED,bundle.getState());
}
