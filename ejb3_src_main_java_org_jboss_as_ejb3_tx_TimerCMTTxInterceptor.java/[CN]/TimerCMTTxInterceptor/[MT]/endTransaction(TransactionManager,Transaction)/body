{
  boolean rolledBack=false;
  try {
    if (tx.getStatus() == Status.STATUS_MARKED_ROLLBACK) {
      rolledBack=true;
    }
  }
 catch (  SystemException e) {
    throw new RuntimeException(e);
  }
  super.endTransaction(tm,tx);
  if (rolledBack) {
    throw new TimerTransactionRolledBackException("Timer invocation failed, transaction rolled back");
  }
}
