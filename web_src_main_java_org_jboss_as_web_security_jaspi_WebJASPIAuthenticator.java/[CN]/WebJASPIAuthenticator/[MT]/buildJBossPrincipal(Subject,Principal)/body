{
  List<String> roles=new ArrayList<String>();
  for (  Principal p : subject.getPrincipals()) {
    if (p instanceof Group && p.getName().equals("Roles")) {
      Enumeration<? extends Principal> members=((Group)p).members();
      while (members.hasMoreElements())       roles.add(members.nextElement().getName());
    }
  }
  JBossWebRealm realm=(JBossWebRealm)this.getContainer().getRealm();
  if (roles.isEmpty())   roles.addAll(realm.getPrincipalVersusRolesMap().get(principal.getName()));
  return new JBossGenericPrincipal(realm,principal.getName(),null,roles,principal,null,null,null,subject);
}
