{
  List<String> roles=new ArrayList<String>();
  for (  Principal p : subject.getPrincipals()) {
    if (p instanceof Group && p.getName().equals("Roles")) {
      Enumeration<? extends Principal> members=((Group)p).members();
      while (members.hasMoreElements())       roles.add(members.nextElement().getName());
    }
  }
  if (gpc != null && gpc.getGroups() != null) {
    for (    String group : gpc.getGroups())     roles.add(group);
  }
  JBossWebRealm realm=(JBossWebRealm)this.getContainer().getRealm();
  Set<String> descriptorRoles=realm.getPrincipalVersusRolesMap().get(principal.getName());
  if (descriptorRoles != null)   roles.addAll(descriptorRoles);
  return new JBossGenericPrincipal(realm,principal.getName(),null,roles,principal,null,null,null,subject);
}
