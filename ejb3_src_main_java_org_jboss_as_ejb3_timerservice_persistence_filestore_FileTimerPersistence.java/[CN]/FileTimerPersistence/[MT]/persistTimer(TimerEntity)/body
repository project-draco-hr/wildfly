{
  final Lock lock=getLock(timerEntity.getTimedObjectId());
  try {
    final int status=transactionManager.getValue().getStatus();
    if (status == Status.STATUS_MARKED_ROLLBACK || status == Status.STATUS_ROLLEDBACK || status == Status.STATUS_ROLLING_BACK) {
      return;
    }
    if (status == Status.STATUS_NO_TRANSACTION || status == Status.STATUS_UNKNOWN || isBeforeCompletion() || status == Status.STATUS_COMMITTED) {
      try {
        lock.lock();
        Map<String,TimerEntity> map=getTimers(timerEntity.getTimedObjectId());
        map.put(timerEntity.getId(),timerEntity);
        writeFile(timerEntity);
      }
  finally {
        lock.unlock();
      }
    }
 else {
      transactionSynchronizationRegistry.getValue().registerInterposedSynchronization(new PersistTransactionSynchronization(timerEntity,lock));
    }
  }
 catch (  SystemException e) {
    throw new RuntimeException(e);
  }
}
