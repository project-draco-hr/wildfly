{
  String namespace=req.getNamespace();
  List<Capability> result=new ArrayList<Capability>();
  if (MODULE_IDENTITY_NAMESPACE.equals(namespace)) {
    String moduleId=(String)req.getAttributes().get(MODULE_IDENTITY_NAMESPACE);
    ModuleIdentifier moduleIdentifier=ModuleIdentifier.fromString(moduleId);
    try {
      File contentFile=getRepositoryEntry(bundlesDir,moduleIdentifier);
      if (contentFile != null) {
        URL contentURL=contentFile.toURI().toURL();
        XResourceBuilder builder=URLResourceBuilderFactory.create(contentURL,null,true);
        result.add(builder.addGenericCapability(MODULE_IDENTITY_NAMESPACE,moduleId));
      }
 else {
        contentFile=getRepositoryEntry(modulesDir,moduleIdentifier);
        if (contentFile != null) {
          URL contentURL=contentFile.toURI().toURL();
          XResourceBuilder builder=URLResourceBuilderFactory.create(contentURL,null,true);
          result.add(builder.addGenericCapability(MODULE_IDENTITY_NAMESPACE,moduleId));
        }
      }
    }
 catch (    RepositoryResolutionException ex) {
      throw ex;
    }
catch (    Exception ex) {
      throw new RepositoryResolutionException(ex);
    }
  }
  return Collections.unmodifiableList(result);
}
