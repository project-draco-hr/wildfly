{
  String namespace=req.getNamespace();
  List<Capability> result=new ArrayList<Capability>();
  if (MODULE_IDENTITY_NAMESPACE.equals(namespace)) {
    String moduleId=(String)req.getAttributes().get(MODULE_IDENTITY_NAMESPACE);
    ModuleIdentifier moduleIdentifier=ModuleIdentifier.fromString(moduleId);
    try {
      File contentFile=getRepositoryEntry(bundlesPath,moduleIdentifier);
      if (contentFile == null) {
        contentFile=getRepositoryEntryFromModuleLoader(moduleIdentifier);
      }
      if (contentFile == null) {
        contentFile=getRepositoryEntry(modulesDir,moduleIdentifier);
      }
      if (contentFile != null) {
        URL contentURL=contentFile.toURI().toURL();
        XResourceBuilder<XResource> builder=URLResourceBuilderFactory.create(contentURL,null);
        XCapability cap=builder.addCapability(MODULE_IDENTITY_NAMESPACE,moduleId);
        builder.getResource();
        result.add(cap);
      }
    }
 catch (    RepositoryResolutionException ex) {
      throw ex;
    }
catch (    Exception ex) {
      throw new RepositoryResolutionException(ex);
    }
  }
  return Collections.unmodifiableList(result);
}
