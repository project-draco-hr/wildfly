{
  final Map<String,DistributionModuleItem> modules=new HashMap<String,DistributionModuleItem>();
  for (  final DistributionModuleItem item : updated) {
    modules.put(item.getFullModuleName(),item);
  }
  for (  final DistributionModuleItem o : original) {
    final DistributionModuleItem n=modules.remove(o.getFullModuleName());
    if (n == null) {
      if (bundle) {
        elementBuilder.removeBundle(o.getName(),o.getSlot(),o.getMetadataHash());
      }
 else {
        elementBuilder.removeModule(o.getName(),o.getSlot(),o.getMetadataHash());
      }
    }
 else     if (!Arrays.equals(n.getComparisonHash(),o.getComparisonHash())) {
      if (bundle) {
        elementBuilder.modifyBundle(n.getName(),n.getSlot(),o.getMetadataHash(),n.getMetadataHash());
      }
 else {
        elementBuilder.modifyModule(n.getName(),n.getSlot(),o.getMetadataHash(),n.getMetadataHash());
      }
    }
  }
  for (  final DistributionModuleItem item : modules.values()) {
    if (bundle) {
      elementBuilder.addBundle(item.getName(),item.getSlot(),item.getMetadataHash());
    }
 else {
      elementBuilder.addModule(item.getName(),item.getSlot(),item.getMetadataHash());
    }
  }
}
