{
  final ModelNode result=context.getResult();
  final PathAddress rootAddress=PathAddress.pathAddress(PathAddress.pathAddress(operation.require(OP_ADDR)).getLastElement());
  final ModelNode subModel=context.readModel(PathAddress.EMPTY_ADDRESS);
  final ModelNode subsystemAdd=new ModelNode();
  subsystemAdd.get(OP).set(ADD);
  subsystemAdd.get(OP_ADDR).set(rootAddress.toModelNode());
  if (subModel.hasDefined(Constants.CONTAINER_CONFIG)) {
    subsystemAdd.get(Constants.CONTAINER_CONFIG).set(subModel.get(Constants.CONTAINER_CONFIG));
  }
  if (subModel.hasDefined(Constants.DEFAULT_VIRTUAL_SERVER)) {
    subsystemAdd.get(Constants.DEFAULT_VIRTUAL_SERVER).set(subModel.get(Constants.DEFAULT_VIRTUAL_SERVER));
  }
  result.add(subsystemAdd);
  if (subModel.hasDefined(Constants.CONNECTOR)) {
    for (    final Property connector : subModel.get(Constants.CONNECTOR).asPropertyList()) {
      final ModelNode address=rootAddress.toModelNode();
      address.add(Constants.CONNECTOR,connector.getName());
      result.add(WebConnectorAdd.getRecreateOperation(address,connector.getValue()));
    }
  }
  if (subModel.hasDefined(Constants.VIRTUAL_SERVER)) {
    for (    final Property host : subModel.get(Constants.VIRTUAL_SERVER).asPropertyList()) {
      final ModelNode address=rootAddress.toModelNode();
      address.add(Constants.VIRTUAL_SERVER,host.getName());
      result.add(WebVirtualHostAdd.getAddOperation(address,host.getValue()));
    }
  }
  context.completeStep();
}
