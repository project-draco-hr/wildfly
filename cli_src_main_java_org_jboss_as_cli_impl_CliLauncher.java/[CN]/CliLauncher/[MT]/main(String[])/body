{
  int exitCode=0;
  CommandContext cmdCtx=null;
  boolean gui=false;
  try {
    String argError=null;
    String[] commands=null;
    File file=null;
    boolean connect=false;
    String defaultControllerHost=null;
    int defaultControllerPort=-1;
    boolean version=false;
    String username=null;
    char[] password=null;
    for (    String arg : args) {
      if (arg.startsWith("--controller=") || arg.startsWith("controller=")) {
        final String value;
        if (arg.startsWith("--")) {
          value=arg.substring(13);
        }
 else {
          value=arg.substring(11);
        }
        String portStr=null;
        int colonIndex=value.lastIndexOf(':');
        if (colonIndex < 0) {
          defaultControllerHost=value;
        }
 else         if (colonIndex == 0) {
          portStr=value.substring(1);
        }
 else {
          final boolean hasPort;
          int closeBracket=value.lastIndexOf(']');
          if (closeBracket != -1) {
            if (closeBracket > colonIndex) {
              hasPort=false;
            }
 else {
              hasPort=true;
            }
          }
 else {
            hasPort=true;
          }
          if (hasPort) {
            defaultControllerHost=value.substring(0,colonIndex).trim();
            portStr=value.substring(colonIndex + 1).trim();
          }
 else {
            defaultControllerHost=value;
          }
        }
        if (portStr != null) {
          int port=-1;
          try {
            port=Integer.parseInt(portStr);
            if (port < 0) {
              argError="The port must be a valid non-negative integer: '" + args + "'";
            }
 else {
              defaultControllerPort=port;
            }
          }
 catch (          NumberFormatException e) {
            argError="The port must be a valid non-negative integer: '" + arg + "'";
          }
        }
      }
 else       if ("--connect".equals(arg) || "-c".equals(arg)) {
        connect=true;
      }
 else       if ("--version".equals(arg)) {
        version=true;
      }
 else       if ("--gui".equals(arg)) {
        gui=true;
      }
 else       if (arg.startsWith("--file=") || arg.startsWith("file=")) {
        if (file != null) {
          argError="Duplicate argument '--file'.";
          break;
        }
        if (commands != null) {
          argError="Only one of '--file', '--commands' or '--command' can appear as the argument at a time.";
          break;
        }
        final String fileName=arg.startsWith("--") ? arg.substring(7) : arg.substring(5);
        if (!fileName.isEmpty()) {
          file=new File(fileName);
          if (!file.exists()) {
            argError="File " + file.getAbsolutePath() + " doesn't exist.";
            break;
          }
        }
 else {
          argError="Argument '--file' is missing value.";
          break;
        }
      }
 else       if (arg.startsWith("--commands=") || arg.startsWith("commands=")) {
        if (file != null) {
          argError="Only one of '--file', '--commands' or '--command' can appear as the argument at a time.";
          break;
        }
        if (commands != null) {
          argError="Duplicate argument '--command'/'--commands'.";
          break;
        }
        final String value=arg.startsWith("--") ? arg.substring(11) : arg.substring(9);
        commands=value.split(",+");
      }
 else       if (arg.startsWith("--command=") || arg.startsWith("command=")) {
        if (file != null) {
          argError="Only one of '--file', '--commands' or '--command' can appear as the argument at a time.";
          break;
        }
        if (commands != null) {
          argError="Duplicate argument '--command'/'--commands'.";
          break;
        }
        final String value=arg.startsWith("--") ? arg.substring(10) : arg.substring(8);
        commands=new String[]{value};
      }
 else       if (arg.startsWith("--user=")) {
        username=arg.startsWith("--") ? arg.substring(7) : arg.substring(5);
      }
 else       if (arg.startsWith("--password=")) {
        password=(arg.startsWith("--") ? arg.substring(11) : arg.substring(9)).toCharArray();
      }
 else       if (arg.equals("--help") || arg.equals("-h")) {
        commands=new String[]{"help"};
      }
 else {
        if (file != null) {
          argError="Only one of '--file', '--commands' or '--command' can appear as the argument at a time.";
          break;
        }
        if (commands != null) {
          argError="Duplicate argument '--command'/'--commands'.";
          break;
        }
        commands=arg.split(",+");
      }
    }
    if (argError != null) {
      System.err.println(argError);
      exitCode=1;
      return;
    }
    if (version) {
      cmdCtx=new CommandContextImpl();
      VersionHandler.INSTANCE.handle(cmdCtx);
      return;
    }
    if (file != null) {
      cmdCtx=initCommandContext(defaultControllerHost,defaultControllerPort,username,password,false,connect);
      processFile(file,cmdCtx);
      return;
    }
    if (commands != null) {
      cmdCtx=initCommandContext(defaultControllerHost,defaultControllerPort,username,password,false,connect);
      processCommands(commands,cmdCtx);
      return;
    }
    if (gui) {
      cmdCtx=initCommandContext(defaultControllerHost,defaultControllerPort,username,password,false,true);
      processGui(cmdCtx);
      return;
    }
    cmdCtx=initCommandContext(defaultControllerHost,defaultControllerPort,username,password,true,connect);
    cmdCtx.interact();
  }
 catch (  Throwable t) {
    t.printStackTrace();
  }
 finally {
    if (cmdCtx != null) {
      exitCode=cmdCtx.getExitCode();
    }
    if (!gui) {
      System.exit(exitCode);
    }
  }
  System.exit(exitCode);
}
