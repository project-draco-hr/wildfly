{
  File jbossCliRcFile=null;
  String jbossCliRc=WildFlySecurityManager.getPropertyPrivileged(JBOSS_CLI_RC_PROPERTY,null);
  if (jbossCliRc == null) {
    String dir=WildFlySecurityManager.getPropertyPrivileged(CURRENT_WORKING_DIRECTORY,null);
    File f=new File(dir,JBOSS_CLI_RC_FILE);
    if (!f.exists()) {
      dir=WildFlySecurityManager.getEnvPropertyPrivileged("JBOSS_HOME",null);
      if (dir != null) {
        f=new File(dir + File.separatorChar + "bin",JBOSS_CLI_RC_FILE);
        if (f.exists()) {
          jbossCliRcFile=f;
        }
      }
    }
 else {
      jbossCliRcFile=f;
    }
  }
 else {
    jbossCliRcFile=new File(jbossCliRc);
    if (!jbossCliRcFile.exists()) {
      throw new CliInitializationException("Property " + JBOSS_CLI_RC_PROPERTY + " points to a file that doesn't exist: "+ jbossCliRcFile.getAbsolutePath());
    }
  }
  if (jbossCliRcFile != null) {
    processFile(jbossCliRcFile,ctx);
    if (ctx.getExitCode() != 0) {
      throw new CliInitializationException("Failed to process " + jbossCliRcFile.getAbsoluteFile());
    }
  }
}
