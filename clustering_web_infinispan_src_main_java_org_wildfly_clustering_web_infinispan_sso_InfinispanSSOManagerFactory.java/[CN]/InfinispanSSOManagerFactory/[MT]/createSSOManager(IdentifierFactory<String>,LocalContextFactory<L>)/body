{
  MarshallingContext marshallingContext=new SimpleMarshallingContextFactory().createMarshallingContext(new AuthenticationMarshallingContext(this.configuration.getModuleLoader()),null);
  MarshalledValueFactory<MarshallingContext> marshalledValueFactory=new SimpleMarshalledValueFactory(marshallingContext);
  Marshaller<A,MarshalledValue<A,MarshallingContext>> marshaller=new MarshalledValueMarshaller<>(marshalledValueFactory,marshallingContext);
  Cache<String,CoarseAuthenticationEntry<A,D,L>> authenticationCache=this.configuration.getCache();
  Cache<CoarseSessionsKey,Map<D,String>> sessionsCache=this.configuration.getCache();
  SSOFactory<CoarseSSOEntry<A,D,L>,A,D,L> factory=new CoarseSSOFactory<>(authenticationCache,sessionsCache,marshaller,localContextFactory);
  IdentifierFactory<String> idFactory=new AffinityIdentifierFactory<>(identifierFactory,authenticationCache,this.configuration.getKeyAffinityServiceFactory());
  Batcher<TransactionBatch> batcher=new InfinispanBatcher(authenticationCache);
  return new InfinispanSSOManager<>(factory,idFactory,batcher);
}
