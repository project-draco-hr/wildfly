{
  try {
    String jbossHomeKey="jboss.home";
    String jbossHomeProp=System.getProperty(jbossHomeKey);
    if (jbossHomeProp == null)     throw new IllegalStateException("Cannot find system property: " + jbossHomeKey);
    File jbossHomeDir=new File(jbossHomeProp).getAbsoluteFile();
    if (jbossHomeDir.isDirectory() == false)     throw new IllegalStateException("Invalid jboss home directory: " + jbossHomeDir);
    File modulesJar=new File(jbossHomeDir + "/jboss-modules.jar");
    if (modulesJar.exists() == false)     throw new IllegalStateException("Cannot find: " + modulesJar);
    Properties sysprops=new Properties();
    sysprops.putAll(System.getProperties());
    sysprops.setProperty("jboss.home.dir",jbossHomeDir.getAbsolutePath());
    sysprops.setProperty("java.util.logging.manager","org.jboss.logmanager.LogManager");
    sysprops.setProperty("logging.configuration","file:" + jbossHomeDir + "/standalone/configuration/logging.properties");
    sysprops.setProperty("org.jboss.boot.log.file",jbossHomeDir + "/standalone/log/boot.log");
    server=EmbeddedServerFactory.create(jbossHomeDir,sysprops);
    server.start();
    long timeout=5000;
    boolean testRunnerMBeanAvailable=false;
    MBeanServerConnection mbeanServer=null;
    while (timeout > 0 && testRunnerMBeanAvailable == false) {
      if (mbeanServer == null) {
        try {
          mbeanServer=getMBeanServerConnection();
        }
 catch (        Exception ex) {
        }
      }
      testRunnerMBeanAvailable=(mbeanServer != null && mbeanServer.isRegistered(JMXTestRunnerMBean.OBJECT_NAME));
      Thread.sleep(100);
      timeout-=100;
    }
  }
 catch (  Throwable th) {
    throw handleStartThrowable(th);
  }
}
