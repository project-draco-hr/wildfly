{
  String deploymentUnitName=deploymentModel.require(NAME).asString();
  final ServiceName deploymentUnitServiceName=Services.deploymentUnitName(deploymentUnitName);
  final ServiceRegistry serviceRegistry=context.getServiceRegistry();
  final ServiceController<?> controller=serviceRegistry.getService(deploymentUnitServiceName);
  if (controller != null) {
    controller.setMode(ServiceController.Mode.ACTIVE);
  }
 else {
    final ServiceTarget serviceTarget=context.getServiceTarget();
    final String runtimeName=deploymentModel.require(RUNTIME_NAME).asString();
    final byte[] hash=deploymentModel.require(HASH).asBytes();
    final RootDeploymentUnitService service=new RootDeploymentUnitService(deploymentUnitName,runtimeName,hash,null);
    serviceTarget.addService(deploymentUnitServiceName,service).addDependency(Services.JBOSS_DEPLOYMENT_CHAINS,DeployerChains.class,service.getDeployerChainsInjector()).addDependency(ServerDeploymentRepository.SERVICE_NAME,ServerDeploymentRepository.class,service.getServerDeploymentRepositoryInjector()).setInitialMode(ServiceController.Mode.ACTIVE).install();
  }
}
