{
  if (operationContext.getRuntimeContext() != null) {
    operationContext.getRuntimeContext().setRuntimeTask(new RuntimeTask(){
      @Override public void execute(      final RuntimeTaskContext runtimeContext) throws OperationFailedException {
        final ServiceController<?> controller=runtimeContext.getServiceRegistry().getService(Services.deploymentUnitName(toReplace));
        if (controller != null) {
          controller.addListener(new AbstractServiceListener<Object>(){
            @Override public void listenerAdded(            ServiceController<? extends Object> serviceController){
              controller.setMode(ServiceController.Mode.REMOVE);
            }
            @Override public void serviceRemoved(            ServiceController<? extends Object> serviceController){
              controller.removeListener(this);
              deploy(deploymentModel,runtimeContext,resultHandler);
            }
          }
);
        }
 else {
          deploy(deploymentModel,runtimeContext,resultHandler);
        }
      }
    }
);
  }
 else {
    resultHandler.handleResultComplete();
  }
}
