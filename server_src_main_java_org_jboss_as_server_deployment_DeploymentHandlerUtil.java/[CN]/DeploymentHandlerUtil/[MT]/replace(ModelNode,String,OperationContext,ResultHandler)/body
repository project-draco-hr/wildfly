{
  if (operationContext.getRuntimeContext() != null) {
    operationContext.getRuntimeContext().setRuntimeTask(new RuntimeTask(){
      public void execute(      RuntimeTaskContext context) throws OperationFailedException {
        final ServiceController<?> controller=context.getServiceRegistry().getService(Services.JBOSS_DEPLOYMENT_UNIT.append(toReplace));
        if (controller != null) {
          controller.addListener(new AbstractServiceListener<Object>(){
            public void listenerAdded(            ServiceController<? extends Object> serviceController){
              controller.setMode(ServiceController.Mode.REMOVE);
            }
            public void serviceRemoved(            ServiceController<? extends Object> serviceController){
              try {
                deploy(deploymentModel,operationContext,resultHandler);
              }
 catch (              OperationFailedException e) {
                throw new RuntimeException(e);
              }
            }
          }
);
        }
 else {
          deploy(deploymentModel,operationContext,resultHandler);
        }
      }
    }
);
  }
 else {
    resultHandler.handleResultComplete();
  }
}
