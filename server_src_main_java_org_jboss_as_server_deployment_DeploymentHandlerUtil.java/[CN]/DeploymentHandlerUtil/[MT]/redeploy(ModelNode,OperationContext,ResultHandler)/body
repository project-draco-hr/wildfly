{
  if (operationContext.getRuntimeContext() != null) {
    operationContext.getRuntimeContext().setRuntimeTask(new RuntimeTask(){
      public void execute(      final RuntimeTaskContext context) throws OperationFailedException {
        final String deploymentUnitName=deploymentModel.require(NAME).asString();
        final ServiceController<?> controller=context.getServiceRegistry().getService(Services.deploymentUnitName(deploymentUnitName));
        if (controller != null) {
          controller.addListener(new AbstractServiceListener<Object>(){
            @Override public void listenerAdded(            ServiceController<?> controller){
              if (!controller.compareAndSetMode(ServiceController.Mode.ACTIVE,ServiceController.Mode.NEVER)) {
                controller.removeListener(this);
              }
            }
            public void serviceStopping(            ServiceController<?> controller){
              controller.removeListener(this);
              controller.compareAndSetMode(ServiceController.Mode.NEVER,ServiceController.Mode.ACTIVE);
            }
          }
);
        }
 else {
          deploy(deploymentModel,context,resultHandler);
        }
      }
    }
);
  }
 else {
    resultHandler.handleResultComplete();
  }
}
