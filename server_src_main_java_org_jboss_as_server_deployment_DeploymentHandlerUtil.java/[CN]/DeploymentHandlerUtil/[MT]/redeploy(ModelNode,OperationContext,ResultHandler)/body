{
  if (operationContext.getRuntimeContext() != null) {
    operationContext.getRuntimeContext().setRuntimeTask(new RuntimeTask(){
      public void execute(      final RuntimeTaskContext context) throws OperationFailedException {
        final String deploymentUnitName=deploymentModel.require(NAME).asString();
        final ServiceController<?> controller=context.getServiceRegistry().getService(Services.JBOSS_DEPLOYMENT_UNIT.append(deploymentUnitName));
        if (controller != null) {
          controller.addListener(new AbstractServiceListener<Object>(){
            @Override public void listenerAdded(            ServiceController<? extends Object> serviceController){
              controller.setMode(ServiceController.Mode.NEVER);
            }
            public void serviceStopped(            ServiceController<? extends Object> serviceController){
              controller.removeListener(this);
              controller.addListener(new ResultHandler.ServiceStartListener(resultHandler));
              controller.setMode(ServiceController.Mode.ACTIVE);
            }
          }
);
        }
 else {
          deploy(deploymentModel,resultHandler,context);
        }
      }
    }
);
  }
 else {
    resultHandler.handleResultComplete();
  }
}
