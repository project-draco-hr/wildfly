{
  int num=0;
  for (  final ModelNode entry : operation.get(REWRITE).asList()) {
    String name="rule-" + num++;
    PathElement rewritepath=PathElement.pathElement(REWRITE,name);
    resource.registerChild(rewritepath,Resource.Factory.create());
    final Resource rewritevalve=resource.getChild(rewritepath);
    ModelNode rule;
    if (entry.hasDefined(name))     rule=entry.get(name);
 else     rule=entry;
    for (    final String attribute : rule.keys()) {
      if (rule.hasDefined(attribute)) {
        if (attribute.equals(CONDITION)) {
          int j=0;
          for (          final ModelNode cond : rule.get(CONDITION).asList()) {
            String condname="condition-" + j++;
            PathElement conditionpath=PathElement.pathElement(CONDITION,condname);
            rewritevalve.registerChild(conditionpath,Resource.Factory.create());
            final Resource condition=rewritevalve.getChild(conditionpath);
            if (cond.hasDefined(condname))             populateModel(condition.getModel(),cond.get(condname));
 else             populateModel(condition.getModel(),cond);
          }
        }
 else {
          rewritevalve.getModel().get(attribute).set(rule.get(attribute));
        }
      }
    }
  }
}
