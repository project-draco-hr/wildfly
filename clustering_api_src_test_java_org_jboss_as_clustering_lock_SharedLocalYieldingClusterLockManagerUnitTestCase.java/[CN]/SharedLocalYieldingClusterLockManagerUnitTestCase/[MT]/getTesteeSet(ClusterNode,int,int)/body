{
  GroupRpcDispatcher rpcDispatcher=mock(GroupRpcDispatcher.class);
  GroupMembershipNotifier notifier=mock(GroupMembershipNotifier.class);
  when(rpcDispatcher.isConsistentWith(notifier)).thenReturn(true);
  when(rpcDispatcher.getClusterNode()).thenReturn(node);
  Vector<ClusterNode> view=getView(node,viewPos,viewSize);
  when(rpcDispatcher.getClusterNodes()).thenReturn(view.toArray(new ClusterNode[view.size()]));
  SharedLocalYieldingClusterLockManager testee=new SharedLocalYieldingClusterLockManager("test",rpcDispatcher,notifier);
  testee.start();
  ArgumentCaptor<RpcTarget> c=ArgumentCaptor.forClass(RpcTarget.class);
  verify(rpcDispatcher).registerRPCHandler(eq("test"),c.capture());
  return new TesteeSet(testee,rpcDispatcher,c.getValue());
}
