{
  List<Callback> toRespondTo=new LinkedList<Callback>();
  String userName=null;
  boolean userFound=false;
  Properties users=getProperties();
  for (  Callback current : callbacks) {
    if (current instanceof AuthorizeCallback) {
      toRespondTo.add(current);
    }
 else     if (current instanceof NameCallback) {
      NameCallback nameCallback=(NameCallback)current;
      userName=nameCallback.getDefaultName();
      userFound=users.containsKey(userName);
    }
 else     if (current instanceof PasswordCallback && plainText) {
      toRespondTo.add(current);
    }
 else     if (current instanceof DigestHashCallback && plainText == false) {
      toRespondTo.add(current);
    }
 else     if (current instanceof VerifyPasswordCallback) {
      toRespondTo.add(current);
    }
 else     if (current instanceof RealmCallback) {
      String realm=((RealmCallback)current).getDefaultText();
      if (this.realm.equals(realm) == false) {
        throw MESSAGES.invalidRealm(realm,this.realm);
      }
    }
 else {
      throw new UnsupportedCallbackException(current);
    }
  }
  for (  Callback current : toRespondTo) {
    if (current instanceof AuthorizeCallback) {
      AuthorizeCallback authorizeCallback=(AuthorizeCallback)current;
      authorizeCallback.setAuthorized(authorizeCallback.getAuthenticationID().equals(authorizeCallback.getAuthorizationID()));
    }
 else     if (current instanceof PasswordCallback) {
      if (userFound == false) {
        throw new UserNotFoundException(userName);
      }
      String password=users.get(userName).toString();
      ((PasswordCallback)current).setPassword(password.toCharArray());
    }
 else     if (current instanceof DigestHashCallback) {
      if (userFound == false) {
        throw new UserNotFoundException(userName);
      }
      String hash=users.get(userName).toString();
      ((DigestHashCallback)current).setHexHash(hash);
    }
 else     if (current instanceof VerifyPasswordCallback) {
      if (userFound == false) {
        throw new UserNotFoundException(userName);
      }
      VerifyPasswordCallback vpc=(VerifyPasswordCallback)current;
      if (plainText) {
        String password=users.get(userName).toString();
        vpc.setVerified(password.equals(vpc.getPassword()));
      }
 else {
        UsernamePasswordHashUtil hashUtil=getHashUtil();
        String hash;
synchronized (hashUtil) {
          hash=hashUtil.generateHashedHexURP(userName,realm,vpc.getPassword().toCharArray());
        }
        String expected=users.get(userName).toString();
        vpc.setVerified(expected.equals(hash));
      }
    }
  }
}
