{
  List<Callback> toRespondTo=new LinkedList<Callback>();
  String userName=null;
  boolean userFound=false;
  for (  Callback current : callbacks) {
    if (current instanceof AuthorizeCallback) {
      toRespondTo.add(current);
    }
 else     if (current instanceof NameCallback) {
      NameCallback nameCallback=(NameCallback)current;
      userName=nameCallback.getDefaultName();
      userFound=users.containsKey(userName);
    }
 else     if (current instanceof PasswordCallback) {
      toRespondTo.add(current);
    }
 else     if (current instanceof RealmCallback) {
      String realm=((RealmCallback)current).getDefaultText();
      if (this.realm.equals(realm) == false) {
        throw new IllegalStateException("Invalid Realm '" + realm + "' expected '"+ this.realm+ "'");
      }
    }
 else {
      throw new UnsupportedCallbackException(current);
    }
  }
  for (  Callback current : toRespondTo) {
    if (current instanceof AuthorizeCallback) {
      AuthorizeCallback authorizeCallback=(AuthorizeCallback)current;
      authorizeCallback.setAuthorized(authorizeCallback.getAuthenticationID().equals(authorizeCallback.getAuthorizationID()));
    }
 else     if (current instanceof PasswordCallback) {
      if (userFound == false) {
        throw new UserNotFoundException(userName);
      }
      String password=users.get(userName).toString();
      ((PasswordCallback)current).setPassword(password.toCharArray());
    }
  }
}
