{
  if (name.isEmpty() || (name.size() == 1 && "".equals(name.get(0)))) {
    return new NamingContext(prefix,namingStore,environment != null ? (Hashtable<String,Object>)environment.clone() : null);
  }
  final Name absoluteName=getAbsoluteName(name);
  Object result;
  try {
    result=namingStore.lookup(absoluteName);
  }
 catch (  CannotProceedException cpe) {
    final Context continuationContext=NamingManager.getContinuationContext(cpe);
    result=continuationContext.lookup(cpe.getRemainingName());
  }
  if (result instanceof ResolveResult) {
    final ResolveResult resolveResult=ResolveResult.class.cast(result);
    final Object resolvedObject=resolveResult.getResolvedObj();
    Object context;
    if (resolvedObject instanceof LinkRef) {
      context=resolveLink(resolvedObject);
    }
 else {
      context=getObjectInstance(resolvedObject,absoluteName,environment);
    }
    if (!(context instanceof Context)) {
      throw new NotContextException(context + " is not a Context");
    }
    final Context namingContext=Context.class.cast(context);
    return namingContext.lookup(resolveResult.getRemainingName());
  }
 else   if (result instanceof LinkRef) {
    result=resolveLink(result);
  }
 else   if (result instanceof Reference) {
    result=getObjectInstance(result,absoluteName,environment);
    if (result instanceof LinkRef) {
      result=resolveLink(result);
    }
  }
  return result;
}
