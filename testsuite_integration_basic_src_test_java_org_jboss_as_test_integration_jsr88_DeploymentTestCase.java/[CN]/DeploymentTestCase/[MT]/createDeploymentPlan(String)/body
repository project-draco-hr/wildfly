{
  boolean webInf=false;
  String jbossDescriptorName=null;
  if (deploymentFile.endsWith(".war")) {
    jbossDescriptorName=WAR_JBOSS_FILE;
    webInf=true;
  }
 else   if (deploymentFile.endsWith(".jar")) {
    jbossDescriptorName=JAR_JBOSS_FILE;
  }
 else   if (deploymentFile.endsWith(".ear")) {
    jbossDescriptorName=EAR_JBOSS_FILE;
  }
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  JarOutputStream plan=new JarOutputStream(baos);
  URL descriptorURL=getClass().getClassLoader().getResource(DeploymentTestCase.class.getPackage().getName().replace(".","/") + jbossDescriptorName);
  File jbossDescriptorFile=new File(descriptorURL.getPath());
  JarUtils.addJarEntry(plan,"!/" + (webInf ? "WEB-INF/" : "META-INF/") + jbossDescriptorName,new FileInputStream(jbossDescriptorFile));
  DeploymentMetaData metaData=new DeploymentMetaData(deploymentFile);
  metaData.addEntry(deploymentFile,jbossDescriptorName);
  String metaStr=metaData.toXMLString();
  JarUtils.addJarEntry(plan,DeploymentMetaData.ENTRY_NAME,new ByteArrayInputStream(metaStr.getBytes()));
  plan.flush();
  plan.close();
  return new ByteArrayInputStream(baos.toByteArray());
}
