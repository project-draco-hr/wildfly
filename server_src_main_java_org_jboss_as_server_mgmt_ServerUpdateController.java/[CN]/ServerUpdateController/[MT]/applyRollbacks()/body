{
  if (rollbacks.size() == 0) {
    transition(false);
    return;
  }
  BatchBuilder batchBuilder=serviceContainer.batchBuilder();
  UpdateContext updateContext=new SimpleUpdateContext(serviceContainer,batchBuilder);
  boolean failed=false;
  try {
    for (    ServerModelUpdateTuple<?,?> update : rollbacks) {
      if (failed) {
        update.handleCancellation();
      }
 else {
        try {
          serverModel.update(update.getUpdate());
        }
 catch (        Exception e) {
          update.handleFailure(e);
        }
 finally {
          try {
            if (allowRuntimeUpdates) {
              update.applyUpdate(updateContext);
            }
 else {
              rollbackComplete();
            }
          }
 catch (          Exception e) {
            update.handleFailure(e);
          }
        }
      }
    }
    batchBuilder.install();
    if (logger.isDebugEnabled()) {
      logger.debugf("%s rollbacks applied",rollbacks.size());
    }
  }
 catch (  Exception e) {
    logger.error("Caught exception applying rollbacks",e);
  }
}
