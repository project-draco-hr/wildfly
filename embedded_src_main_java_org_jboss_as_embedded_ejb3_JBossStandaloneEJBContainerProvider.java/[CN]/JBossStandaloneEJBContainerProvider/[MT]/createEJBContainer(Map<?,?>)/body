{
  String jbossHomeKey="jboss.home";
  String jbossHomeProp=System.getProperty(jbossHomeKey);
  if (jbossHomeProp == null)   throw new EJBException("Cannot find system property: " + jbossHomeKey);
  File jbossHomeDir=new File(jbossHomeProp);
  if (jbossHomeDir.isDirectory() == false)   throw new EJBException("Invalid jboss home directory: " + jbossHomeDir);
  final ModuleLoader moduleLoader=Module.getContextModuleLoader();
  final StandaloneServer server;
  if (moduleLoader == null)   server=EmbeddedServerFactory.create(jbossHomeDir,System.getProperties(),System.getenv(),"org.jboss.logmanager");
 else   server=EmbeddedServerFactory.create(moduleLoader,jbossHomeDir,System.getProperties(),System.getenv());
  try {
    server.start();
    final JBossStandaloneEJBContainer container=new JBossStandaloneEJBContainer(server);
    boolean okay=false;
    try {
      container.init();
      okay=true;
      return container;
    }
  finally {
      if (!okay)       container.close();
    }
  }
 catch (  RuntimeException e) {
    throw e;
  }
catch (  Exception e) {
    throw new EJBException(e);
  }
}
