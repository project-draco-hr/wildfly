{
  final ModelNode model=context.getSubModel();
  final ModelNode compensatingOp=DeploymentAddHandler.getOperation(operation.get(OP_ADDR),model);
  boolean enabled=model.hasDefined(ENABLED) ? model.get(ENABLED).asBoolean() : true;
  if (enabled) {
    String deploymentUnitName=model.require(RUNTIME_NAME).asString();
    DeploymentHandlerUtil.undeploy(context,deploymentUnitName,resultHandler);
  }
 else {
    resultHandler.handleResultComplete();
  }
  return new BasicOperationResult(compensatingOp);
}
