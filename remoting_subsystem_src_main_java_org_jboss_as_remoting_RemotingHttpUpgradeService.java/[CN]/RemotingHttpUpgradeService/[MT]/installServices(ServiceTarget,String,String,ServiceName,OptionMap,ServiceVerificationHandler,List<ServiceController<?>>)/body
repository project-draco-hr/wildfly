{
  final RemotingHttpUpgradeService service=new RemotingHttpUpgradeService(httpConnectorName,endpointName.getSimpleName(),connectorPropertiesOptionMap);
  final ServiceName securityProviderName=RealmSecurityProviderService.createName(remotingConnectorName);
  ServiceBuilder<RemotingHttpUpgradeService> builder=serviceTarget.addService(UPGRADE_SERVICE_NAME.append(remotingConnectorName),service).setInitialMode(ServiceController.Mode.PASSIVE).addDependency(HTTP_UPGRADE_REGISTRY.append(httpConnectorName),ChannelUpgradeHandler.class,service.injectedRegistry).addDependency(HttpListenerRegistryService.SERVICE_NAME,ListenerRegistry.class,service.listenerRegistry).addDependency(endpointName,Endpoint.class,service.injectedEndpoint).addDependency(securityProviderName,RemotingSecurityProvider.class,service.securityProviderValue);
  if (verificationHandler != null) {
    builder.addListener(verificationHandler);
  }
  ServiceController<RemotingHttpUpgradeService> controller=builder.install();
  if (newControllers != null) {
    newControllers.add(controller);
  }
}
