{
  ControllerAddress address=addressResolver.resolveAddress(controller);
  boolean retry;
  do {
    retry=false;
    try {
      ModelControllerClient newClient=null;
      CallbackHandler cbh=new AuthenticationCallbackHandler(username,password);
      if (log.isDebugEnabled()) {
        log.debug("connecting to " + address.getHost() + ':'+ address.getPort()+ " as "+ username);
      }
      ModelControllerClient tempClient=ModelControllerClientFactory.CUSTOM.getClient(address,cbh,disableLocalAuth,sslContext,connectionTimeout,this);
      retry=tryConnection(tempClient,address);
      if (!retry) {
        newClient=tempClient;
      }
      initNewClient(newClient,address);
    }
 catch (    RedirectException e) {
      throw new CommandLineException("Server at " + address.getHost() + ":"+ address.getPort()+ " does not support "+ address.getProtocol());
    }
catch (    IOException e) {
      throw new CommandLineException("Failed to resolve host '" + address.getHost() + "'",e);
    }
  }
 while (retry);
}
