{
  if (name == null || name.isEmpty()) {
    throw new CommandLineException("Variable name can't be null or an empty string");
  }
  if (!Character.isJavaIdentifierStart(name.charAt(0))) {
    throw new CommandLineException("Variable name must be a valid Java identifier (and not contain '$'): '" + name + "'");
  }
  for (int i=1; i < name.length(); ++i) {
    final char c=name.charAt(i);
    if (!Character.isJavaIdentifierPart(c) || c == '$') {
      throw new CommandLineException("Variable name must be a valid Java identifier (and not contain '$'): '" + name + "'");
    }
  }
  if (value == null) {
    if (variables == null) {
      return;
    }
    variables.remove(name);
  }
 else {
    if (variables == null) {
      variables=new HashMap<String,String>();
    }
    variables.put(name,value);
  }
}
