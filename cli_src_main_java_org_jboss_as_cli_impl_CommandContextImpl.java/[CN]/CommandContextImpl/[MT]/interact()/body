{
  if (cmdCompleter == null) {
    throw new IllegalStateException("The console hasn't been initialized at construction time.");
  }
  if (this.client == null) {
    printLine("You are disconnected at the moment. Type 'connect' to connect to the server or" + " 'help' for the list of supported commands.");
  }
  try {
    while (!isTerminated()) {
      final String line=console.readLine(getPrompt());
      if (line == null) {
        terminateSession();
      }
 else {
        handleSafe(line.trim());
      }
    }
    printLine("");
  }
 catch (  Throwable t) {
    t.printStackTrace();
  }
}
