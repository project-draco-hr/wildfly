{
  if (delegate == null) {
    FileInputStream fis=null;
    try {
      KeyStore theTrustStore=KeyStore.getInstance("JKS");
      File trustStoreFile=new File(trustStore);
      if (trustStoreFile.exists()) {
        fis=new FileInputStream(trustStoreFile);
        theTrustStore.load(fis,trustStorePassword.toCharArray());
      }
 else {
        theTrustStore.load(null);
      }
      for (      X509Certificate current : temporarilyTrusted) {
        theTrustStore.setCertificateEntry(current.getSubjectX500Principal().getName(),current);
      }
      TrustManagerFactory trustManagerFactory=TrustManagerFactory.getInstance("SunX509");
      trustManagerFactory.init(theTrustStore);
      TrustManager[] trustManagers=trustManagerFactory.getTrustManagers();
      for (      TrustManager current : trustManagers) {
        if (current instanceof X509TrustManager) {
          delegate=(X509TrustManager)current;
          break;
        }
      }
    }
 catch (    GeneralSecurityException e) {
      throw new IllegalStateException("Unable to operate on trust store.",e);
    }
catch (    IOException e) {
      throw new IllegalStateException("Unable to operate on trust store.",e);
    }
 finally {
      StreamUtils.safeClose(fis);
    }
  }
  if (delegate == null) {
    throw new IllegalStateException("Unable to create delegate trust manager.");
  }
  return delegate;
}
