{
  if (cache.get(ModelKeys.LOCKING,ModelKeys.LOCKING_NAME).isDefined()) {
    writer.writeStartElement(Element.LOCKING.getLocalName());
    ModelNode locking=cache.get(ModelKeys.LOCKING,ModelKeys.LOCKING_NAME);
    LockingResourceDefinition.ISOLATION.marshallAsAttribute(locking,writer);
    LockingResourceDefinition.STRIPING.marshallAsAttribute(locking,writer);
    LockingResourceDefinition.ACQUIRE_TIMEOUT.marshallAsAttribute(locking,writer);
    LockingResourceDefinition.CONCURRENCY_LEVEL.marshallAsAttribute(locking,writer);
    writer.writeEndElement();
  }
  if (cache.get(ModelKeys.TRANSACTION,ModelKeys.TRANSACTION_NAME).isDefined()) {
    writer.writeStartElement(Element.TRANSACTION.getLocalName());
    ModelNode transaction=cache.get(ModelKeys.TRANSACTION,ModelKeys.TRANSACTION_NAME);
    TransactionResourceDefinition.STOP_TIMEOUT.marshallAsAttribute(transaction,writer);
    TransactionResourceDefinition.MODE.marshallAsAttribute(transaction,writer);
    TransactionResourceDefinition.LOCKING.marshallAsAttribute(transaction,writer);
    writer.writeEndElement();
  }
  if (cache.get(ModelKeys.EVICTION,ModelKeys.EVICTION_NAME).isDefined()) {
    writer.writeStartElement(Element.EVICTION.getLocalName());
    ModelNode eviction=cache.get(ModelKeys.EVICTION,ModelKeys.EVICTION_NAME);
    EvictionResourceDefinition.STRATEGY.marshallAsAttribute(eviction,writer);
    EvictionResourceDefinition.MAX_ENTRIES.marshallAsAttribute(eviction,writer);
    writer.writeEndElement();
  }
  if (cache.get(ModelKeys.EXPIRATION,ModelKeys.EXPIRATION_NAME).isDefined()) {
    writer.writeStartElement(Element.EXPIRATION.getLocalName());
    ModelNode expiration=cache.get(ModelKeys.EXPIRATION,ModelKeys.EXPIRATION_NAME);
    ExpirationResourceDefinition.MAX_IDLE.marshallAsAttribute(expiration,writer);
    ExpirationResourceDefinition.LIFESPAN.marshallAsAttribute(expiration,writer);
    ExpirationResourceDefinition.INTERVAL.marshallAsAttribute(expiration,writer);
    writer.writeEndElement();
  }
  if (cache.get(ModelKeys.STATE_TRANSFER,ModelKeys.STATE_TRANSFER_NAME).isDefined()) {
    ModelNode stateTransfer=cache.get(ModelKeys.STATE_TRANSFER,ModelKeys.STATE_TRANSFER_NAME);
    writer.writeStartElement(Element.STATE_TRANSFER.getLocalName());
    StateTransferResourceDefinition.ENABLED.marshallAsAttribute(stateTransfer,writer);
    StateTransferResourceDefinition.TIMEOUT.marshallAsAttribute(stateTransfer,writer);
    StateTransferResourceDefinition.CHUNK_SIZE.marshallAsAttribute(stateTransfer,writer);
    writer.writeEndElement();
  }
  if (cache.get(ModelKeys.STORE,ModelKeys.STORE_NAME).isDefined()) {
    ModelNode store=cache.get(ModelKeys.STORE,ModelKeys.STORE_NAME);
    writer.writeStartElement(Element.STORE.getLocalName());
    CustomStoreResourceDefinition.CLASS.marshallAsAttribute(store,writer);
    writeStoreAttributes(writer,store);
    writeStoreElements(writer,store);
    writer.writeEndElement();
  }
  if (cache.get(ModelKeys.FILE_STORE,ModelKeys.FILE_STORE_NAME).isDefined()) {
    ModelNode store=cache.get(ModelKeys.FILE_STORE,ModelKeys.FILE_STORE_NAME);
    writer.writeStartElement(Element.FILE_STORE.getLocalName());
    writeStoreAttributes(writer,store);
    FileStoreResourceDefinition.RELATIVE_TO.marshallAsAttribute(store,writer);
    FileStoreResourceDefinition.PATH.marshallAsAttribute(store,writer);
    writeStoreElements(writer,store);
    writer.writeEndElement();
  }
  if (cache.get(ModelKeys.STRING_KEYED_JDBC_STORE,ModelKeys.STRING_KEYED_JDBC_STORE_NAME).isDefined()) {
    ModelNode store=cache.get(ModelKeys.STRING_KEYED_JDBC_STORE,ModelKeys.STRING_KEYED_JDBC_STORE_NAME);
    writer.writeStartElement(Element.STRING_KEYED_JDBC_STORE.getLocalName());
    writeJDBCStoreAttributes(writer,store);
    writeStoreElements(writer,store);
    writeJDBCStoreTable(writer,Element.STRING_KEYED_TABLE,store,ModelKeys.STRING_KEYED_TABLE);
    writer.writeEndElement();
  }
  if (cache.get(ModelKeys.BINARY_KEYED_JDBC_STORE,ModelKeys.BINARY_KEYED_JDBC_STORE_NAME).isDefined()) {
    ModelNode store=cache.get(ModelKeys.BINARY_KEYED_JDBC_STORE,ModelKeys.BINARY_KEYED_JDBC_STORE_NAME);
    writer.writeStartElement(Element.BINARY_KEYED_JDBC_STORE.getLocalName());
    writeJDBCStoreAttributes(writer,store);
    writeStoreElements(writer,store);
    writeJDBCStoreTable(writer,Element.BINARY_KEYED_TABLE,store,ModelKeys.BINARY_KEYED_TABLE);
    writer.writeEndElement();
  }
  if (cache.get(ModelKeys.MIXED_KEYED_JDBC_STORE,ModelKeys.MIXED_KEYED_JDBC_STORE_NAME).isDefined()) {
    ModelNode store=cache.get(ModelKeys.MIXED_KEYED_JDBC_STORE,ModelKeys.MIXED_KEYED_JDBC_STORE_NAME);
    writer.writeStartElement(Element.MIXED_KEYED_JDBC_STORE.getLocalName());
    writeJDBCStoreAttributes(writer,store);
    writeStoreElements(writer,store);
    writeJDBCStoreTable(writer,Element.STRING_KEYED_TABLE,store,ModelKeys.STRING_KEYED_TABLE);
    writeJDBCStoreTable(writer,Element.BINARY_KEYED_TABLE,store,ModelKeys.BINARY_KEYED_TABLE);
    writer.writeEndElement();
  }
  if (cache.get(ModelKeys.REMOTE_STORE,ModelKeys.REMOTE_STORE_NAME).isDefined()) {
    ModelNode store=cache.get(ModelKeys.REMOTE_STORE,ModelKeys.REMOTE_STORE_NAME);
    writer.writeStartElement(Element.REMOTE_STORE.getLocalName());
    writeStoreAttributes(writer,store);
    RemoteStoreResourceDefinition.CACHE.marshallAsAttribute(store,writer);
    RemoteStoreResourceDefinition.SOCKET_TIMEOUT.marshallAsAttribute(store,writer);
    RemoteStoreResourceDefinition.TCP_NO_DELAY.marshallAsAttribute(store,writer);
    writeStoreElements(writer,store);
    for (    ModelNode remoteServer : store.get(ModelKeys.REMOTE_SERVERS).asList()) {
      writer.writeStartElement(Element.REMOTE_SERVER.getLocalName());
      RemoteStoreResourceDefinition.OUTBOUND_SOCKET_BINDING.marshallAsAttribute(remoteServer,writer);
      writer.writeEndElement();
    }
    writer.writeEndElement();
  }
  if (cache.get(ModelKeys.INDEXING).isDefined() || cache.get(ModelKeys.INDEXING_PROPERTIES).isDefined()) {
    writer.writeStartElement(Element.INDEXING.getLocalName());
    CacheResourceDefinition.INDEXING.marshallAsAttribute(cache,writer);
    CacheResourceDefinition.INDEXING_PROPERTIES.marshallAsElement(cache,writer);
    writer.writeEndElement();
  }
  if (cache.get(ModelKeys.BACKUP).isDefined()) {
    writer.writeStartElement(Element.BACKUPS.getLocalName());
    for (    Property property : cache.get(ModelKeys.BACKUP).asPropertyList()) {
      writer.writeStartElement(Element.BACKUP.getLocalName());
      writer.writeAttribute(Attribute.SITE.getLocalName(),property.getName());
      ModelNode backup=property.getValue();
      BackupSiteResourceDefinition.FAILURE_POLICY.marshallAsAttribute(backup,writer);
      BackupSiteResourceDefinition.STRATEGY.marshallAsAttribute(backup,writer);
      BackupSiteResourceDefinition.REPLICATION_TIMEOUT.marshallAsAttribute(backup,writer);
      BackupSiteResourceDefinition.ENABLED.marshallAsAttribute(backup,writer);
      if (backup.hasDefined(ModelKeys.TAKE_BACKUP_OFFLINE_AFTER_FAILURES) || backup.hasDefined(ModelKeys.TAKE_BACKUP_OFFLINE_MIN_WAIT)) {
        writer.writeStartElement(Element.TAKE_OFFLINE.getLocalName());
        BackupSiteResourceDefinition.TAKE_OFFLINE_AFTER_FAILURES.marshallAsAttribute(backup,writer);
        BackupSiteResourceDefinition.TAKE_OFFLINE_MIN_WAIT.marshallAsAttribute(backup,writer);
        writer.writeEndElement();
      }
      writer.writeEndElement();
    }
    writer.writeEndElement();
  }
  if (cache.get(ModelKeys.BACKUP_FOR,ModelKeys.BACKUP_FOR_NAME).isDefined()) {
    ModelNode backupFor=cache.get(ModelKeys.BACKUP_FOR,ModelKeys.BACKUP_FOR_NAME);
    writer.writeStartElement(Element.BACKUP_FOR.getLocalName());
    BackupForResourceDefinition.REMOTE_CACHE.marshallAsAttribute(backupFor,writer);
    BackupForResourceDefinition.REMOTE_SITE.marshallAsAttribute(backupFor,writer);
    writer.writeEndElement();
  }
}
