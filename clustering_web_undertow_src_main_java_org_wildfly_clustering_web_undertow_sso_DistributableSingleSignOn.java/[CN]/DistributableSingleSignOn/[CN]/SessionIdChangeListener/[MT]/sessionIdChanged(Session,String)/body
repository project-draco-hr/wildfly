{
  boolean active=this.batch.isActive();
  try (BatchContext context=active ? this.batcher.resumeBatch(this.batch) : null){
    try (Batch batch=active ? this.batch : this.batcher.createBatch()){
      String deployment=session.getSessionManager().getDeploymentName();
      Sessions<String> sessions=this.sso.getSessions();
      sessions.removeSession(deployment);
      sessions.addSession(deployment,session.getId());
    }
   }
 }
