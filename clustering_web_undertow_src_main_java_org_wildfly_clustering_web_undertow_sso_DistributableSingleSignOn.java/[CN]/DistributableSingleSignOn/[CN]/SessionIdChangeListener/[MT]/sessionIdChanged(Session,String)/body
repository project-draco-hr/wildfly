{
  try (BatchContext context=this.closed.compareAndSet(false,true) ? this.batcher.resumeBatch(this.batch) : null){
    try (Batch batch=(context != null) ? this.batch : this.batcher.createBatch()){
      String deployment=session.getSessionManager().getDeploymentName();
      Sessions<String> sessions=this.sso.getSessions();
      sessions.removeSession(deployment);
      sessions.addSession(deployment,session.getId());
    }
   }
 }
