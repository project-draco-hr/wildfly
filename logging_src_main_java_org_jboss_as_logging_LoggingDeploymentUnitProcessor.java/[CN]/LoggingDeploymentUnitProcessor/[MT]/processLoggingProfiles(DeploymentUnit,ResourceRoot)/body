{
  boolean result=false;
  final List<DeploymentUnit> subDeployments=getSubDeployments(deploymentUnit);
  final String loggingProfile=findLoggingProfile(root);
  if (loggingProfile != null) {
    result=true;
    final LoggingProfileContextSelector loggingProfileContext=LoggingProfileContextSelector.getInstance();
    if (loggingProfileContext.exists(loggingProfile)) {
      final Module module=deploymentUnit.getAttachment(Attachments.MODULE);
      final LogContext logContext=loggingProfileContext.get(loggingProfile);
      LoggingExtension.CONTEXT_SELECTOR.registerLogContext(module.getClassLoader(),logContext);
      LoggingLogger.ROOT_LOGGER.tracef("Registering log context '%s' on '%s' for profile '%s'",logContext,root,loggingProfile);
      for (      DeploymentUnit subDeployment : subDeployments) {
        if (subDeployment.hasAttachment(Attachments.MODULE)) {
          if (subDeployment.hasAttachment(Attachments.DEPLOYMENT_ROOT) && processLoggingProfiles(subDeployment,subDeployment.getAttachment(Attachments.DEPLOYMENT_ROOT))) {
            result=true;
          }
 else {
            final Module subDeploymentModule=subDeployment.getAttachment(Attachments.MODULE);
            LoggingExtension.CONTEXT_SELECTOR.registerLogContext(subDeploymentModule.getClassLoader(),logContext);
            LoggingLogger.ROOT_LOGGER.tracef("Registering log context '%s' on '%s' for profile '%s'",logContext,subDeployment.getAttachment(Attachments.DEPLOYMENT_ROOT),loggingProfile);
          }
        }
      }
    }
 else {
      LoggingLogger.ROOT_LOGGER.loggingProfileNotFound(loggingProfile,root);
    }
  }
 else {
    for (    DeploymentUnit subDeployment : subDeployments) {
      if (subDeployment.hasAttachment(Attachments.MODULE) && subDeployment.hasAttachment(Attachments.DEPLOYMENT_ROOT)) {
        if (processLoggingProfiles(subDeployment,subDeployment.getAttachment(Attachments.DEPLOYMENT_ROOT)))         result=true;
      }
    }
  }
  return result;
}
