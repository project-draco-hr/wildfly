{
  if (currentStage == Stage.MODEL || cancelled || contextFlags.contains(ContextFlag.ROLLBACK_ON_FAIL) || isRollbackOnly() || (cause != null && !(cause instanceof OperationFailedException))) {
    return ResultAction.ROLLBACK;
  }
  return ResultAction.KEEP;
}
