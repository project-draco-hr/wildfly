{
  if (isBooting()) {
    return AuthorizationResult.PERMITTED;
  }
 else {
    AuthorizationResponseImpl authResp=authorizations.get(opId);
    if (authResp == null) {
      authResp=getBasicAuthorizationResponse(opId,operation);
    }
    if (authResp == null) {
      return AuthorizationResult.PERMITTED;
    }
    for (    Action.ActionEffect requiredEffect : actionEffects) {
      AuthorizationResult effectResult=authResp.getResourceResult(requiredEffect);
      if (effectResult == null) {
        Action action=authResp.standardAction.limitAction(requiredEffect);
        effectResult=modelController.getAuthorizer().authorize(getCaller(),getCallEnvironment(),action,authResp.targetResource);
        authResp.addResourceResult(requiredEffect,effectResult);
      }
      if (effectResult.getDecision() == AuthorizationResult.Decision.DENY) {
        return effectResult;
      }
    }
    if (allAttributes) {
      ImmutableManagementResourceRegistration mrr=authResp.targetResource.getResourceRegistration();
      ModelNode model=authResp.targetResource.getResource().getModel();
      Set<Action.ActionEffect> attributeEffects=actionEffects.isEmpty() ? authResp.standardAction.getActionEffects() : actionEffects;
      for (      String attr : mrr.getAttributeNames(PathAddress.EMPTY_ADDRESS)) {
        ModelNode currentValue=model.has(attr) ? model.get(attr) : new ModelNode();
        AuthorizationResult attrResult=authorize(opId,attr,currentValue,attributeEffects);
        if (attrResult.getDecision() == AuthorizationResult.Decision.DENY) {
          return attrResult;
        }
      }
      authResp.attributesComplete=true;
    }
    return AuthorizationResult.PERMITTED;
  }
}
