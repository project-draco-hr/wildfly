{
synchronized (realRemovingControllers) {
    boolean intr=false;
    try {
      boolean containsKey=realRemovingControllers.containsKey(name);
      long timeout=getBlockingTimeout().getBlockingTimeout();
      long waitTime=timeout;
      long end=System.currentTimeMillis() + waitTime;
      while (containsKey && waitTime > 0) {
        try {
          realRemovingControllers.wait(waitTime);
        }
 catch (        InterruptedException e) {
          intr=true;
          if (respectInterruption) {
            cancelled=true;
            throw ControllerLogger.ROOT_LOGGER.serviceInstallCancelled();
          }
        }
        containsKey=realRemovingControllers.containsKey(name);
        waitTime=end - System.currentTimeMillis();
      }
      if (containsKey) {
        throw ControllerLogger.ROOT_LOGGER.serviceInstallTimedOut(timeout,name);
      }
      removalSteps.remove(name);
      return realBuilder.install();
    }
  finally {
      if (intr) {
        Thread.currentThread().interrupt();
      }
    }
  }
}
