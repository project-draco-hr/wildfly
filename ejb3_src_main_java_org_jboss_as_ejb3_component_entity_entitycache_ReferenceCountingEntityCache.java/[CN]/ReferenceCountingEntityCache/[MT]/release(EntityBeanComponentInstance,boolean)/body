{
  if (instance.getPrimaryKey() == null)   return;
  final CacheEntry cacheEntry=cache.get(instance.getPrimaryKey());
  if (cacheEntry == null) {
    throw new IllegalArgumentException("Instance [" + instance + "] not found in cache");
  }
  if (cacheEntry.referenceCount.decrementAndGet() == 0) {
    if (!success && instance.isRemoved()) {
      instance.setRemoved(false);
    }
    instance.passivate();
    component.getPool().release(instance);
    cache.remove(instance.getPrimaryKey());
  }
 else   if (instance.isRemoved() && success) {
    component.getPool().release(instance);
    cache.remove(instance.getPrimaryKey());
  }
}
