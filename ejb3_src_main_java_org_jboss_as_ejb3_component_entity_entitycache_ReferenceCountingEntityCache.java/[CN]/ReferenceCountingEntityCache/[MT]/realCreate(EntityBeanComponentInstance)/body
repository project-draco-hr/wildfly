{
  final CacheEntry cacheEntry=new CacheEntry(instance);
  final CacheEntry existing=cache.putIfAbsent(instance.getPrimaryKey(),cacheEntry);
  if (existing != null) {
    if (existing.instance.isRemoved()) {
      existing.replacedInstance=instance;
    }
 else {
      throw MESSAGES.instanceAlreadyRegisteredForPK(instance.getPrimaryKey());
    }
  }
  return cacheEntry;
}
