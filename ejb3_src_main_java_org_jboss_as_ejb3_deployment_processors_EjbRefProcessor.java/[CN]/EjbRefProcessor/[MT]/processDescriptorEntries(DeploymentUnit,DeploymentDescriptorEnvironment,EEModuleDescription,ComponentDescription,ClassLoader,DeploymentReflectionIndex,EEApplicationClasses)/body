{
  final RemoteEnvironment remoteEnvironment=environment.getEnvironment();
  List<BindingConfiguration> bindingDescriptions=new ArrayList<BindingConfiguration>();
  EJBReferencesMetaData ejbRefs=remoteEnvironment.getEjbReferences();
  if (ejbRefs != null) {
    for (    EJBReferenceMetaData ejbRef : ejbRefs) {
      String name=ejbRef.getEjbRefName();
      String ejbName=ejbRef.getLink();
      String lookup=ejbRef.getLookupName();
      String remoteInterface=ejbRef.getRemote();
      Class<?> remoteInterfaceType=null;
      if (!isEmpty(remoteInterface)) {
        try {
          remoteInterfaceType=classLoader.loadClass(remoteInterface);
        }
 catch (        ClassNotFoundException e) {
          throw new DeploymentUnitProcessingException("Could not load local interface type " + remoteInterface,e);
        }
      }
      if (!name.startsWith("java:")) {
        name=environment.getDefaultContext() + name;
      }
      LookupInjectionSource injectionSource=new LookupInjectionSource(name);
      remoteInterfaceType=processInjectionTargets(moduleDescription,applicationClasses,injectionSource,classLoader,deploymentReflectionIndex,ejbRef,remoteInterfaceType);
      if (remoteInterfaceType == null) {
        throw new DeploymentUnitProcessingException("Could not determine type of ejb-ref " + name + " for component "+ componentDescription);
      }
      final BindingConfiguration bindingConfiguration;
      EjbInjectionSource ejbInjectionSource=null;
      if (!isEmpty(lookup)) {
        if (lookup.startsWith("ejb:")) {
          bindingConfiguration=new BindingConfiguration(name,new EjbLookupInjectionSource(lookup));
        }
 else {
          bindingConfiguration=new BindingConfiguration(name,new LookupInjectionSource(lookup));
        }
      }
 else       if (!isEmpty(ejbName)) {
        bindingConfiguration=new BindingConfiguration(name,ejbInjectionSource=new EjbInjectionSource(ejbName,remoteInterfaceType.getName()));
      }
 else {
        bindingConfiguration=new BindingConfiguration(name,ejbInjectionSource=new EjbInjectionSource(remoteInterfaceType.getName()));
      }
      if (ejbInjectionSource != null) {
        deploymentUnit.addToAttachmentList(EjbDeploymentAttachmentKeys.EJB_INJECTIONS,ejbInjectionSource);
      }
      bindingDescriptions.add(bindingConfiguration);
    }
  }
  if (remoteEnvironment instanceof Environment) {
    EJBLocalReferencesMetaData ejbLocalRefs=((Environment)remoteEnvironment).getEjbLocalReferences();
    if (ejbLocalRefs != null) {
      for (      EJBLocalReferenceMetaData ejbRef : ejbLocalRefs) {
        String name=ejbRef.getEjbRefName();
        String ejbName=ejbRef.getLink();
        String lookup=ejbRef.getLookupName();
        String localInterface=ejbRef.getLocal();
        Class<?> localInterfaceType=null;
        if (!isEmpty(localInterface)) {
          try {
            localInterfaceType=classLoader.loadClass(localInterface);
          }
 catch (          ClassNotFoundException e) {
            throw new DeploymentUnitProcessingException("Could not load local interface type " + localInterface,e);
          }
        }
        if (!name.startsWith("java:")) {
          name=environment.getDefaultContext() + name;
        }
        LookupInjectionSource injectionSource=new LookupInjectionSource(name);
        localInterfaceType=processInjectionTargets(moduleDescription,applicationClasses,injectionSource,classLoader,deploymentReflectionIndex,ejbRef,localInterfaceType);
        if (localInterfaceType == null) {
          throw new DeploymentUnitProcessingException("Could not determine type of ejb-local-ref " + name + " for component "+ componentDescription);
        }
        final BindingConfiguration bindingConfiguration;
        EjbInjectionSource ejbInjectionSource=null;
        if (!isEmpty(lookup)) {
          if (lookup.startsWith("ejb:")) {
            bindingConfiguration=new BindingConfiguration(name,new EjbLookupInjectionSource(lookup));
          }
 else {
            bindingConfiguration=new BindingConfiguration(name,new LookupInjectionSource(lookup));
          }
        }
 else         if (!isEmpty(ejbName)) {
          bindingConfiguration=new BindingConfiguration(name,ejbInjectionSource=new EjbInjectionSource(ejbName,localInterfaceType.getName()));
        }
 else {
          bindingConfiguration=new BindingConfiguration(name,ejbInjectionSource=new EjbInjectionSource(localInterfaceType.getName()));
        }
        if (ejbInjectionSource != null) {
          deploymentUnit.addToAttachmentList(EjbDeploymentAttachmentKeys.EJB_INJECTIONS,ejbInjectionSource);
        }
        bindingDescriptions.add(bindingConfiguration);
      }
    }
  }
  return bindingDescriptions;
}
