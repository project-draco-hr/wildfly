{
  try {
    client=ModelControllerClient.Factory.create(InetAddress.getByName("localhost"),9999,getCallbackHandler());
    manager=ServerDeploymentManager.Factory.create(client);
    final String packageName=DeployedXmlJmsTestCase.class.getPackage().getName().replace(".","/");
    final DeploymentPlan plan=manager.newDeploymentPlan().add(DeployedXmlJmsTestCase.class.getResource("/" + packageName + "/"+ TEST_JMS_XML)).andDeploy().build();
    final Future<ServerDeploymentPlanResult> future=manager.execute(plan);
    final ServerDeploymentPlanResult result=future.get(20,TimeUnit.SECONDS);
    final ServerDeploymentActionResult actionResult=result.getDeploymentActionResult(plan.getId());
    if (actionResult != null) {
      if (actionResult.getDeploymentException() != null) {
        throw actionResult.getDeploymentException();
      }
    }
  }
 catch (  Throwable e) {
    if (client != null) {
      client.close();
    }
  }
}
