{
  XBundle bundle=(XBundle)context.getBundle();
  XBundleRevision brev=bundle.getBundleRevision();
  ContextActivator activator=brev.getAttachment(WebExtension.CONTEXT_ACTIVATOR_KEY);
  if (activator != null) {
switch (state) {
case Bundle.ACTIVE:
      try {
        if (!activator.start(ACTIVATOR_TIMEOUT,TimeUnit.MILLISECONDS)) {
          throw new LifecycleInterceptorException(OSGiMessages.MESSAGES.startContextFailed());
        }
        injectBundleContext(activator.getServletContext(),bundle.getBundleContext());
      }
 catch (      TimeoutException ex) {
        throw new LifecycleInterceptorException(ex.getMessage(),ex);
      }
    break;
case Bundle.RESOLVED:
  uninjectBundleContext(activator.getServletContext());
activator.stop(ACTIVATOR_TIMEOUT,TimeUnit.MILLISECONDS);
break;
}
}
}
