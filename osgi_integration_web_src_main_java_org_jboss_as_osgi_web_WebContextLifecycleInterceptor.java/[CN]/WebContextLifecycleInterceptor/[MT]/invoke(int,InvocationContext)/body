{
  XBundle bundle=(XBundle)context.getBundle();
  XBundleRevision brev=bundle.getBundleRevision();
  ContextActivator activator=brev.getAttachment(WebExtension.CONTEXT_ACTIVATOR_KEY);
  if (activator != null) {
switch (state) {
case Bundle.ACTIVE:
      if (!activator.startContext()) {
        throw new LifecycleInterceptorException(OSGiMessages.MESSAGES.startContextFailed());
      }
    injectBundleContext(activator.getServletContext(),bundle.getBundleContext());
  break;
case Bundle.RESOLVED:
uninjectBundleContext(activator.getServletContext());
activator.stopContext();
break;
}
}
}
