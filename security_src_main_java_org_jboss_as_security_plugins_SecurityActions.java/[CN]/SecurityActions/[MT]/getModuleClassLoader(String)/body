{
  if (System.getSecurityManager() != null) {
    try {
      return AccessController.doPrivileged(new PrivilegedExceptionAction<ModuleClassLoader>(){
        public ModuleClassLoader run() throws ModuleLoadException {
          ModuleLoader loader=Module.getCallerModuleLoader();
          ModuleIdentifier identifier=ModuleIdentifier.fromString(moduleSpec);
          return loader.loadModule(identifier).getClassLoader();
        }
      }
);
    }
 catch (    PrivilegedActionException pae) {
      throw new ModuleLoadException(pae);
    }
  }
 else {
    ModuleLoader loader=Module.getCallerModuleLoader();
    ModuleIdentifier identifier=ModuleIdentifier.fromString(moduleSpec);
    return loader.loadModule(identifier).getClassLoader();
  }
}
