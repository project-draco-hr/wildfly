{
  if (newAddOp.hasDefined(WebValveDefinition.CLASS_NAME.getName())) {
    String valveClassName=newAddOp.get(WebValveDefinition.CLASS_NAME.getName()).asString();
    if (VALVES_TO_FILTERS.containsKey(valveClassName)) {
      newAddOperations.putIfAbsent(pathAddress(UndertowExtension.SUBSYSTEM_PATH,PATH_FILTERS),createAddOperation(pathAddress(UndertowExtension.SUBSYSTEM_PATH,PATH_FILTERS)));
      PathAddress filterAddress=pathAddress(UndertowExtension.SUBSYSTEM_PATH,PATH_FILTERS,pathElement(CustomFilterDefinition.INSTANCE.getPathElement().getKey(),address.getLastElement().getValue()));
      if (!newAddOperations.containsKey(filterAddress)) {
        ModelNode filterAdd=createAddOperation(filterAddress);
        filterAdd.get(MODULE).set(VALVES_TO_FILTERS.get(valveClassName).module);
        filterAdd.get(CustomFilterDefinition.CLASS_NAME.getName()).set(VALVES_TO_FILTERS.get(valveClassName).handlerClassName);
        if (newAddOp.hasDefined(WebValveDefinition.PARAMS.getName())) {
          filterAdd.get(CustomFilterDefinition.PARAMETERS.getName()).set(newAddOp.get(WebValveDefinition.PARAMS.getName()));
        }
        newAddOperations.put(filterAddress,filterAdd);
      }
    }
  }
}
