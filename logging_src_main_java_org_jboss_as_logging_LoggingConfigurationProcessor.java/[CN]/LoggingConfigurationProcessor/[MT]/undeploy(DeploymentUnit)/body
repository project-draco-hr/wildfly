{
  if (context.hasAttachment(Attachments.MODULE)) {
    final Module module=context.getAttachment(Attachments.MODULE);
    final ClassLoader current=SecurityActions.getThreadContextClassLoader();
    try {
      SecurityActions.setThreadContextClassLoader(module.getClassLoader());
      LoggingExtension.CONTEXT_SELECTOR.unregisterLogContext(module.getClassLoader(),LogContext.getLogContext());
      context.removeAttachment(LOG_CONTEXT_KEY);
    }
  finally {
      SecurityActions.setThreadContextClassLoader(current);
    }
  }
}
