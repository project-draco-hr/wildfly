{
  if (!reader.hasNext()) {
    throw new XMLStreamException("Expected more elements",reader.getLocation());
  }
  int type=reader.next();
  while (reader.hasNext() && type != START_ELEMENT) {
    type=reader.next();
  }
  if (reader.getEventType() != START_ELEMENT) {
    throw new XMLStreamException("No <" + name + "> found");
  }
  if (!reader.getLocalName().equals("" + name + "")) {
    throw new XMLStreamException("<" + name + "> expected",reader.getLocation());
  }
  if (attributes != null) {
    for (int i=0; i < reader.getAttributeCount(); i++) {
      String attr=reader.getAttributeLocalName(i);
      if (!attributes.containsKey(attr)) {
        throw new XMLStreamException("Unexpected attribute " + attr,reader.getLocation());
      }
      attributes.put(attr,reader.getAttributeValue(i));
    }
  }
  return getElementText ? reader.getElementText() : null;
}
