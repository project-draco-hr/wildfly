{
  KernelServicesBuilder reverseServicesBuilder=createKernelServicesBuilder(TestModelType.DOMAIN).setBootOperations(bootOperations).setModelInitializer(modelInitializer,modelWriteSanitizer);
  for (  String hash : contentRepositoryHashes) {
    reverseServicesBuilder.createContentRepositoryContent(hash);
  }
  KernelServices reverseServices=reverseServicesBuilder.build();
  if (reverseServices.getBootError() != null) {
    Throwable t=reverseServices.getBootError();
    if (t instanceof Exception) {
      throw (Exception)t;
    }
    throw new Exception(t);
  }
  Assert.assertTrue(reverseServices.getBootError() == null ? "error" : reverseServices.getBootError().getMessage(),reverseServices.isSuccessfulBoot());
  ModelNode mainModel=mainServices.readWholeModel();
  if (reverseCheckMainModelFixer != null) {
    mainModel=reverseCheckMainModelFixer.fixModel(mainModel);
  }
  ModelNode reverseModel=reverseServices.readWholeModel();
  if (reverseCheckLegacyModelFixer != null) {
    reverseModel=reverseCheckLegacyModelFixer.fixModel(reverseModel);
  }
  ModelTestUtils.compare(mainModel,reverseModel);
  return reverseServices;
}
