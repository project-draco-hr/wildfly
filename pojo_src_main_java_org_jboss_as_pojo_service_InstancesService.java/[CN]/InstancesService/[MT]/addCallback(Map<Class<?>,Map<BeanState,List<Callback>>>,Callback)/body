{
  final Class<?> type=callback.getType();
synchronized (type) {
    if (map == incallbacks) {
      try {
        callback.dispatch();
      }
 catch (      Throwable t) {
        log.warn("Error invoking incallback: " + callback,t);
      }
    }
    Map<BeanState,List<Callback>> states=map.get(type);
    if (states == null) {
      states=new HashMap<BeanState,List<Callback>>();
      map.put(type,states);
    }
    List<Callback> callbacks=states.get(callback.getState());
    if (callbacks == null) {
      callbacks=new ArrayList<Callback>();
      states.put(callback.getState(),callbacks);
    }
    callbacks.add(callback);
  }
}
