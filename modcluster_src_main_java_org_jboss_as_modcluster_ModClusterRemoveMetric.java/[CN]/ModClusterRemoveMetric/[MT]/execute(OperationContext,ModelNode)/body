{
  final ModelNode dynamicLoadProvider=context.readResourceForUpdate(PathAddress.EMPTY_ADDRESS).getModel().get(CommonAttributes.DYNAMIC_LOAD_PROVIDER);
  String type=null;
  if (dynamicLoadProvider.isDefined()) {
    List<Property> list=operation.asPropertyList();
    Iterator<Property> it=list.iterator();
    while (it.hasNext()) {
      Property prop=it.next();
      if (prop.getName().equals("type")) {
        type=prop.getValue().asString();
        break;
      }
    }
    if (type != null) {
      removeMetric(dynamicLoadProvider,type);
    }
    if (!dynamicLoadProvider.get(CommonAttributes.LOAD_METRIC).isDefined() && !dynamicLoadProvider.get(CommonAttributes.CUSTOM_LOAD_METRIC).isDefined()) {
      context.readResourceForUpdate(PathAddress.EMPTY_ADDRESS).getModel().remove(CommonAttributes.DYNAMIC_LOAD_PROVIDER);
    }
  }
  if (context.isNormalServer()) {
    context.reloadRequired();
  }
  context.completeStep(new OperationContext.RollbackHandler(){
    @Override public void handleRollback(    OperationContext context,    ModelNode operation){
      if (context.isNormalServer()) {
        context.revertReloadRequired();
      }
    }
  }
);
}
