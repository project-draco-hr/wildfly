{
  boolean result=true;
  if (controller.getMode() == ServiceController.Mode.ACTIVE) {
    controller.setMode(ServiceController.Mode.NEVER);
  }
  final StabilityMonitor monitor=new StabilityMonitor();
  monitor.addController(controller);
  try {
    if (!monitor.awaitStability(timeout,unit)) {
      UndertowLogger.ROOT_LOGGER.debugf("Timeout stopping context: %s",controller.getName());
    }
  }
 catch (  final InterruptedException e) {
  }
 finally {
    monitor.removeController(controller);
  }
  return result;
}
