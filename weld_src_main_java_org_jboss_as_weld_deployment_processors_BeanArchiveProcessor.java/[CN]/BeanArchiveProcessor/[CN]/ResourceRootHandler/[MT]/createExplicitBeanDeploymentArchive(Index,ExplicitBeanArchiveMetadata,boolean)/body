{
  Set<String> classNames=new HashSet<String>();
  if (index != null) {
    classNames.addAll(Collections2.transform(index.getKnownClasses(),Indices.CLASS_INFO_TO_FQCN));
  }
  String beanArchiveId=getDeploymentUnitId(deploymentUnit);
  if (beanArchiveMetadata.getResourceRoot() != null) {
    final VirtualFile deploymentRootResource=deploymentUnit.getAttachment(Attachments.DEPLOYMENT_ROOT).getRoot();
    beanArchiveId+="/" + beanArchiveMetadata.getResourceRoot().getRoot().getPathNameRelativeTo(deploymentRootResource);
  }
  return new BeanDeploymentArchiveImpl(classNames,beanArchiveMetadata.getBeansXml(),module,beanArchiveId,BeanArchiveType.EXPLICIT,root);
}
