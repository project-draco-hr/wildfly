{
  final XMLMapper mapper=XMLMapper.Factory.create();
  try {
    final ByteArrayOutputStream baos=new ByteArrayOutputStream();
    try {
      BufferedOutputStream output=new BufferedOutputStream(baos);
      final XMLStreamWriter streamWriter=XMLOutputFactory.newInstance().createXMLStreamWriter(output);
      mapper.deparseDocument(rootDeparser,context.getSubModel(),streamWriter);
      streamWriter.close();
      output.close();
      baos.close();
    }
  finally {
      safeClose(baos);
    }
    String xml=new String(baos.toByteArray());
    ModelNode result=new ModelNode().set(xml);
    resultHandler.handleResultFragment(EMPTY,result);
    resultHandler.handleResultComplete(null);
  }
 catch (  Exception e) {
    resultHandler.handleFailed(new ModelNode().set(e.getLocalizedMessage()));
  }
  return null;
}
