{
  if (context.isNormalServer()) {
    context.addStep(new OperationStepHandler(){
      @Override public void execute(      OperationContext context,      ModelNode operation) throws OperationFailedException {
        final ManagementLookup stats;
        boolean oldSetting=false;
{
          final ModelNode value=operation.get(ModelDescriptionConstants.VALUE).resolve();
          validator.validateResolvedParameter(ModelDescriptionConstants.VALUE,value);
          final boolean setting=value.asBoolean();
          final PathAddress address=PathAddress.pathAddress(operation.get(ModelDescriptionConstants.OP_ADDR));
          final String puName=address.getLastElement().getValue();
          stats=ManagementLookup.create(persistenceUnitRegistry,puName);
          if (stats != null) {
            oldSetting=stats.getStatistics().isStatisticsEnabled();
            stats.getStatistics().setStatisticsEnabled(setting);
          }
        }
        final boolean rollBackValue=oldSetting;
        context.completeStep(new OperationContext.RollbackHandler(){
          @Override public void handleRollback(          OperationContext context,          ModelNode operation){
            if (stats != null) {
              stats.getStatistics().setStatisticsEnabled(rollBackValue);
            }
          }
        }
);
      }
    }
,OperationContext.Stage.RUNTIME);
  }
  context.stepCompleted();
}
