{
  ModelControllerClient client=FrameworkUtils.waitForService(context,ModelControllerClient.class);
  ServerDeploymentHelper server=new ServerDeploymentHelper(client);
  InputStream input=deployer.getDeployment(GOOD_BUNDLE);
  String runtimeName=server.deploy("redeploy",input);
  Bundle bundle=packageAdmin.getBundles(GOOD_BUNDLE,null)[0];
  Assert.assertEquals("Bundle ACTIVE",Bundle.ACTIVE,bundle.getState());
  server.undeploy(runtimeName);
  Assert.assertEquals("Bundle UNINSTALLED",Bundle.UNINSTALLED,bundle.getState());
  input=deployer.getDeployment(GOOD_BUNDLE);
  runtimeName=server.deploy("redeploy",input);
  bundle=packageAdmin.getBundles(GOOD_BUNDLE,null)[0];
  Assert.assertEquals("Bundle ACTIVE",Bundle.ACTIVE,bundle.getState());
  server.undeploy(runtimeName);
  Assert.assertEquals("Bundle UNINSTALLED",Bundle.UNINSTALLED,bundle.getState());
}
