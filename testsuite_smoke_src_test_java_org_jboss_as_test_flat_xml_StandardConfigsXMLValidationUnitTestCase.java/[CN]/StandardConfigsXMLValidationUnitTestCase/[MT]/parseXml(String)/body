{
  SAXParserFactory factory=SAXParserFactory.newInstance();
  if (!factory.isNamespaceAware())   factory.setNamespaceAware(true);
  if (!factory.isValidating())   factory.setValidating(true);
  if (!factory.isXIncludeAware())   factory.setXIncludeAware(true);
  SAXParser parser=factory.newSAXParser();
  XMLReader reader=parser.getXMLReader();
  reader.setFeature("http://apache.org/xml/features/validation/schema",true);
  reader.setErrorHandler(new ErrorHandlerImpl());
  reader.setEntityResolver(new EntityResolver(){
    @Override public InputSource resolveEntity(    String publicId,    String systemId) throws SAXException, IOException {
      if (systemId == null)       Assert.fail("Failed to resolve schema: systemId is null");
      int lastSlash=systemId.lastIndexOf('/');
      if (lastSlash > 0)       systemId=systemId.substring(lastSlash + 1);
      URL xsdUrl=getXsdUrl(systemId);
      return new InputSource(xsdUrl.openStream());
    }
  }
);
  URL xmlUrl=getXmlUrl(xmlName);
  InputSource is=new InputSource();
  is.setByteStream(xmlUrl.openStream());
  reader.parse(is);
}
