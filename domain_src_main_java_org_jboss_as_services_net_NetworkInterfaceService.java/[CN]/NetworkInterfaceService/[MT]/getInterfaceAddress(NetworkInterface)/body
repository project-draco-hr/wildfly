{
  final Enumeration<InetAddress> interfaceAddresses=networkInterface.getInetAddresses();
  while (interfaceAddresses.hasMoreElements()) {
    final InetAddress address=interfaceAddresses.nextElement();
    if (preferIPv4Stack && address instanceof Inet4Address) {
      return address;
    }
 else     if (!preferIPv4Stack) {
      return address;
    }
  }
  return null;
}
