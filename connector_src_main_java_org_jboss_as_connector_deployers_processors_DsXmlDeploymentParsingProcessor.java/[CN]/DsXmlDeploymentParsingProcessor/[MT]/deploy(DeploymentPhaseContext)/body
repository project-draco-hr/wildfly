{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final Set<VirtualFile> files=dataSources(deploymentUnit);
  for (  VirtualFile f : files) {
    InputStream xmlStream=null;
    try {
      xmlStream=new FileInputStream(f.getPhysicalFile());
      DsParser parser=new DsParser();
      DataSources dataSources=parser.parse(xmlStream);
      if (dataSources != null) {
        deploymentUnit.addToAttachmentList(DATA_SOURCES_ATTACHMENT_KEY,dataSources);
      }
    }
 catch (    Exception e) {
      throw new DeploymentUnitProcessingException(e.getMessage(),e);
    }
 finally {
      VFSUtils.safeClose(xmlStream);
    }
  }
}
