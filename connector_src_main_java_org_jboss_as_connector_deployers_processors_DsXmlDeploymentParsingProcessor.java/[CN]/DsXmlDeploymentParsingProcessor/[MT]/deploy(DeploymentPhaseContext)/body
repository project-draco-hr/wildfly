{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final VirtualFile deploymentRoot=deploymentUnit.getAttachment(Attachments.DEPLOYMENT_ROOT).getRoot();
  if (deploymentRoot == null || !deploymentRoot.exists())   return;
  final String deploymentRootName=deploymentRoot.getLowerCaseName();
  if (!deploymentRootName.endsWith("-ds.xml")) {
    return;
  }
  InputStream xmlStream=null;
  try {
    File f=deploymentRoot.getPhysicalFile();
    xmlStream=new FileInputStream(f);
    DsParser parser=new DsParser();
    DataSources dataSources=parser.parse(xmlStream);
    if (dataSources != null) {
      deploymentUnit.putAttachment(DATA_SOURCES_ATTACHMENT_KEY,dataSources);
    }
  }
 catch (  Exception e) {
    throw new DeploymentUnitProcessingException(e.getMessage(),e);
  }
 finally {
    VFSUtils.safeClose(xmlStream);
  }
}
