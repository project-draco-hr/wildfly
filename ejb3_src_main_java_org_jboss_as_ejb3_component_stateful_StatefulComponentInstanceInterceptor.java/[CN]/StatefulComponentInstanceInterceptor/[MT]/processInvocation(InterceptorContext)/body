{
  StatefulSessionComponent component=getComponent(context,StatefulSessionComponent.class);
  SessionID sessionId=(SessionID)context.getPrivateData(SessionID.SESSION_ID_KEY);
  if (sessionId == null) {
    throw MESSAGES.statefulSessionIdIsNull(component.getComponentName());
  }
  ROOT_LOGGER.debug("Looking for stateful component instance with session id: " + sessionId);
  StatefulSessionComponentInstance instance=component.getCache().get(sessionId);
  if (instance == null) {
    throw new NoSuchEJBException("Could not find SFSB " + component.getComponentName() + " with "+ sessionId);
  }
  try {
    context.putPrivateData(ComponentInstance.class,instance);
    return context.proceed();
  }
 catch (  Exception ex) {
    if (component.getApplicationException(ex.getClass(),context.getMethod()) != null) {
      throw ex;
    }
    if (ex instanceof ConcurrentAccessTimeoutException || ex instanceof ConcurrentAccessException) {
      throw ex;
    }
    if (!(ex instanceof RemoveException)) {
      if (ex instanceof RuntimeException || ex instanceof RemoteException) {
        if (ROOT_LOGGER.isTraceEnabled())         ROOT_LOGGER.trace("Removing bean " + sessionId + " because of exception",ex);
        component.getCache().discard(sessionId);
      }
    }
    throw ex;
  }
catch (  final Error e) {
    if (ROOT_LOGGER.isTraceEnabled())     ROOT_LOGGER.trace("Removing bean " + sessionId + " because of error",e);
    component.getCache().discard(sessionId);
    throw e;
  }
catch (  final Throwable t) {
    if (ROOT_LOGGER.isTraceEnabled())     ROOT_LOGGER.trace("Removing bean " + sessionId + " because of Throwable",t);
    component.getCache().discard(sessionId);
    throw new RuntimeException(t);
  }
 finally {
    context.putPrivateData(ComponentInstance.class,null);
  }
}
