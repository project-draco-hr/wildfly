{
  final File file;
  final BufferedWriter writer;
  try {
    file=File.createTempFile("host",".xml",hostConfigFile.getAbsoluteFile().getParentFile());
    file.deleteOnExit();
    writer=new BufferedWriter(new FileWriter(file));
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
  try {
    BufferedReader reader=new BufferedReader(new FileReader(hostConfigFile));
    try {
      String line=reader.readLine();
      while (line != null) {
        int start=line.indexOf("<inet-address value=\"");
        if (start >= 0) {
          StringBuilder sb=new StringBuilder();
          sb.append(line.substring(0,start));
          sb.append("<inet-address value=\"" + masterAddress + "\"/>");
          writer.write(sb.toString());
        }
 else {
          start=line.indexOf("<option value=\"");
          if (start >= 0) {
            StringBuilder sb=new StringBuilder();
            sb.append(line.substring(0,start));
            List<String> opts=new ArrayList<String>();
            TestSuiteEnvironment.getIpv6Args(opts);
            for (            String opt : opts) {
              sb.append("<option value=\"" + opt + "\"/>");
            }
            writer.write(sb.toString());
          }
 else {
            start=line.indexOf("java.net.preferIPv4Stack");
            if (start < 0) {
              writer.write(line);
            }
          }
        }
        writer.write("\n");
        line=reader.readLine();
      }
    }
 catch (    IOException e) {
      throw new RuntimeException(e);
    }
 finally {
      safeClose(reader);
      safeClose(writer);
    }
  }
 catch (  FileNotFoundException e) {
    throw new RuntimeException(e);
  }
  return file;
}
