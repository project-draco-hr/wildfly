{
  final DeploymentUnit depUnit=context.getDeploymentUnit();
  final Deployment deployment=OSGiDeploymentAttachment.getDeployment(depUnit);
  if (deployment != null) {
    if (frameworkActivated.compareAndSet(false,true)) {
      activateFramework(context);
    }
    ServiceName dependency=deploymentTracker.isClosed() ? FRAMEWORK_ACTIVE : AUTOINSTALL_PROVIDER_COMPLETE;
    ServiceName serviceName=BundleInstallService.addService(deploymentTracker,context,deployment,dependency);
    deploymentTracker.registerBundleInstallService(serviceName);
  }
}
