{
  StringBuffer buf=(StringBuffer)data;
  node.setResultType(returnType);
  Object[] args;
  final ASTPath cntPath=(ASTPath)node.jjtGetChild(0);
  if (cntPath.isCMPField()) {
    args=new Object[]{node.distinct,new NodeStringWrapper(cntPath)};
  }
 else {
    JDBCEntityBridge entity=(JDBCEntityBridge)cntPath.getEntity();
    final JDBCFieldBridge[] pkFields=entity.getPrimaryKeyFields();
    if (pkFields.length > 1) {
      countCompositePk=true;
      forceDistinct=node.distinct.length() > 0;
      selectEntity(cntPath,forceDistinct,buf);
      return buf;
    }
 else {
      final String alias=aliasManager.getAlias(cntPath.getPath());
      StringBuffer keyColumn=new StringBuffer(20);
      SQLUtil.getColumnNamesClause(pkFields[0],alias,keyColumn);
      args=new Object[]{node.distinct,keyColumn.toString()};
    }
  }
  return JDBCTypeMappingMetaData.COUNT_FUNC.getFunctionSql(args,buf);
}
