{
  StringBuffer buf=(StringBuffer)data;
  boolean not=(node.opp.equals(SQLUtil.NOT_EQUAL));
  String comparison=node.opp;
  buf.append('(');
  if (not) {
    buf.append(SQLUtil.NOT).append('(');
    comparison="=";
  }
  ASTPath fromPath=(ASTPath)node.jjtGetChild(0);
  addJoinPath(fromPath);
  String fromAlias=aliasManager.getAlias(fromPath.getPath(fromPath.size() - 2));
  JDBCCMPFieldBridge fromCMPField=(JDBCCMPFieldBridge)fromPath.getCMPField();
  Node toNode=node.jjtGetChild(1);
  if (toNode instanceof ASTParameter) {
    ASTParameter toParam=(ASTParameter)toNode;
    Class parameterType=getParameterType(toParam.number);
    if (!(fromCMPField.getFieldType().equals(parameterType))) {
      throw CmpMessages.MESSAGES.onlyLikeTypesCanBeCompared(fromCMPField.getFieldType().getName(),parameterType.getName());
    }
    inputParameters.addAll(QueryParameter.createParameters(toParam.number - 1,fromCMPField));
    SQLUtil.getWhereClause(fromCMPField.getJDBCType(),fromAlias,comparison,buf);
  }
 else {
    ASTPath toPath=(ASTPath)toNode;
    addJoinPath(toPath);
    String toAlias=aliasManager.getAlias(toPath.getPath(toPath.size() - 2));
    JDBCCMPFieldBridge toCMPField=(JDBCCMPFieldBridge)toPath.getCMPField();
    if (!(fromCMPField.getFieldType().equals(toCMPField.getFieldType()))) {
      throw CmpMessages.MESSAGES.onlyLikeTypesCanBeCompared(fromCMPField.getFieldType().getName(),toCMPField.getFieldType().getName());
    }
    SQLUtil.getSelfCompareWhereClause(fromCMPField,toCMPField,fromAlias,toAlias,comparison,buf);
  }
  return (not ? buf.append(')') : buf).append(')');
}
