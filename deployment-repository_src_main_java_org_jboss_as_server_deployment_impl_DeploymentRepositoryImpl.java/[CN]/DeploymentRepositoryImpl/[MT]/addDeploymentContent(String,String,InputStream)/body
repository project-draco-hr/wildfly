{
  log.debugf("Adding content with name %s",name);
  byte[] sha1Bytes=null;
  File tmp=File.createTempFile(name,"tmp",repoRoot);
  FileOutputStream fos=new FileOutputStream(tmp);
synchronized (messageDigest) {
    messageDigest.reset();
    try {
      DigestOutputStream dos=new DigestOutputStream(fos,messageDigest);
      BufferedInputStream bis=new BufferedInputStream(stream);
      byte[] bytes=new byte[8192];
      int read;
      while ((read=bis.read(bytes)) > -1) {
        dos.write(bytes,0,read);
      }
    }
  finally {
      try {
        fos.close();
      }
 catch (      Exception ignored) {
      }
    }
    sha1Bytes=messageDigest.digest();
  }
  File realFile=getDeploymentContentFile(sha1Bytes,true);
  if (realFile.exists()) {
    if (!tmp.delete()) {
      tmp.deleteOnExit();
    }
    log.debugf("Content with name %s was already present in repository at location %s",name,realFile.getAbsolutePath());
  }
 else {
    moveTempToPermanent(tmp,realFile);
    log.infof("Content with name %s added at location %s",name,realFile.getAbsolutePath());
  }
  return sha1Bytes;
}
