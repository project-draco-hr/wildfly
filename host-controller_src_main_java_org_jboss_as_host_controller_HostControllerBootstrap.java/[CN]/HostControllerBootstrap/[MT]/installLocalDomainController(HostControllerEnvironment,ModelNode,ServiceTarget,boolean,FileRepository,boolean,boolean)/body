{
  final String hostName=host.get(NAME).asString();
  final File configDir=environment.getDomainConfigurationDir();
  final ExtensibleConfigurationPersister domainConfigurationPersister=createDomainConfigurationPersister(configDir,isSlave);
  DeploymentRepository deploymentRepository=new DomainDeploymentRepository(environment.getDomainDeploymentDir());
  final DomainControllerService dcService=new DomainControllerService(domainConfigurationPersister,hostName,deploymentRepository,fileRepository,backupDomainFiles,useCachedDc);
  ServiceBuilder<DomainController> builder=serviceTarget.addService(DomainController.SERVICE_NAME,dcService);
  if (isSlave) {
    builder.addDependency(MasterDomainControllerClient.SERVICE_NAME,MasterDomainControllerClient.class,dcService.getMasterDomainControllerClientInjector());
  }
  builder.addDependency(SERVICE_NAME_BASE.append("executor"),ScheduledExecutorService.class,dcService.getScheduledExecutorServiceInjector()).addDependency(HostController.SERVICE_NAME,LocalHostModel.class,dcService.getHostControllerServiceInjector()).install();
  DomainControllerOperationHandlerService operationHandlerService=new DomainControllerOperationHandlerService(isSlave);
  serviceTarget.addService(DomainControllerOperationHandlerService.SERVICE_NAME,operationHandlerService).addDependency(ManagementCommunicationService.SERVICE_NAME,ManagementCommunicationService.class,operationHandlerService.getManagementCommunicationServiceValue()).addDependency(DomainController.SERVICE_NAME,ModelController.class,operationHandlerService.getModelControllerValue()).setInitialMode(ServiceController.Mode.ACTIVE).install();
}
