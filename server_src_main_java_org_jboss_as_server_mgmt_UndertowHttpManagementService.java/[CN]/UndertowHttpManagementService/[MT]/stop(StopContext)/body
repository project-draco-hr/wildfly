{
  ListenerRegistry lr=listenerRegistry.getOptionalValue();
  if (lr != null) {
    lr.removeListener(HTTP_MANAGEMENT);
    lr.removeListener(HTTPS_MANAGEMENT);
  }
  if (serverManagement != null) {
    try {
      serverManagement.stop();
    }
  finally {
      serverManagement=null;
      if (socketBindingManager != null) {
        ManagedBindingRegistry registry=useUnmanagedBindings ? socketBindingManager.getUnnamedRegistry() : socketBindingManager.getNamedRegistry();
        if (basicManagedBinding != null) {
          registry.unregisterBinding(basicManagedBinding);
          basicManagedBinding=null;
        }
        if (secureManagedBinding != null) {
          registry.unregisterBinding(secureManagedBinding);
          secureManagedBinding=null;
        }
        socketBindingManager=null;
        useUnmanagedBindings=false;
      }
    }
  }
}
