{
  try {
    expectHeader(input,Protocol.PARAM_APPLY_UPDATES_RESULT_COUNT);
    final int updateCount=input.readInt();
    final List<DomainUpdateResult<?>> results=new ArrayList<DomainUpdateResult<?>>(updateCount);
    for (int i=0; i < updateCount; i++) {
      expectHeader(input,Protocol.PARAM_APPLY_UPDATE_RESULT);
      byte resultCode=input.readByte();
      if (resultCode == (byte)Protocol.APPLY_UPDATE_RESULT_SUCCESS) {
        expectHeader(input,Protocol.PARAM_APPLY_UPDATE_RESULT_RETURN);
        final Object result=unmarshal(input,Object.class);
        results.add(new DomainUpdateResult<Object>(result));
      }
 else {
        expectHeader(input,Protocol.PARAM_APPLY_UPDATE_RESULT_EXCEPTION);
        final UpdateFailedException updateFailedException=unmarshal(input,UpdateFailedException.class);
        results.add(new DomainUpdateResult<Object>(updateFailedException));
      }
    }
    return results;
  }
 catch (  Exception e) {
    throw new RuntimeException("Failed to read update responses",e);
  }
}
