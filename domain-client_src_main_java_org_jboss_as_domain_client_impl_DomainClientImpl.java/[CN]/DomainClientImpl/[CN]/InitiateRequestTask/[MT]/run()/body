{
  Socket socket=null;
  try {
    socket=new Socket();
    final int timeout=(int)TimeUnit.SECONDS.toMillis(CONNECT_TIMEOUT);
    socket.connect(new InetSocketAddress(address,port),timeout);
    socket.setSoTimeout(timeout);
    final ByteDataInput input=new SimpleByteDataInput(socket.getInputStream());
    final ByteDataOutput output=new SimpleByteDataOutput(socket.getOutputStream());
    writeRequestHeader(output);
    output.flush();
    final int workingVersion=readResponseHeader(input);
    Future<T> resultFuture=executorService.submit(new ExecuteTask<T>(request,workingVersion,socket,input,output));
    initiatingFuture.set(resultFuture);
  }
 catch (  Throwable e) {
    safeClose(socket);
    initiatingFuture.setException(new Exception("Failed to initiate request to remote domain controller",e));
  }
}
