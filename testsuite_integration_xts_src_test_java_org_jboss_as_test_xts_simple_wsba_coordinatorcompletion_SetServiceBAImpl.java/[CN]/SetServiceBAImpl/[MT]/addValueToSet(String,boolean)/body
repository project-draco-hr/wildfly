{
  log.info("[SERVICE] invoked addValueToSet('" + value + "')");
  BusinessActivityManager activityManager=BusinessActivityManagerFactory.businessActivityManager();
  String transactionId;
  try {
    transactionId=activityManager.currentTransaction().toString();
  }
 catch (  SystemException e) {
    throw new SetServiceException("Unable to lookup existing BusinesActivity",e);
  }
  SetParticipantBA participantBA=SetParticipantBA.getParticipant(transactionId);
  if (participantBA == null) {
    try {
      SetParticipantBA participant=new SetParticipantBA(transactionId,value);
      SetParticipantBA.recordParticipant(transactionId,participant);
      log.info("[SERVICE] Enlisting a participant into the BA");
      BAParticipantManager baParticipantManager=activityManager.enlistForBusinessAgreementWithCoordinatorCompletion(participant,"SetServiceBAImpl:" + new Uid().toString());
      if (!complete) {
        baParticipantManager.cannotComplete();
        return;
      }
    }
 catch (    Exception e) {
      log.error("Participant enlistment failed");
      throw new SetServiceException("Error enlisting participant",e);
    }
  }
 else {
    log.info("[SERVICE] Re-using the existing participant, already registered for this BA");
    participantBA.addValue(value);
  }
  log.info("[SERVICE] Invoking the back-end business logic");
  MockSetManager.add(value);
}
