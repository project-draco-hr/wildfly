{
  File binDir=mkdir(env.getInstalledImage().getJbossHome(),"bin");
  File productConf=new File(binDir,"product.conf");
  assertTrue("Failed to create product.conf",productConf.createNewFile());
  Properties props=new Properties();
  props.setProperty("slot",identity);
  FileWriter writer=null;
  try {
    writer=new FileWriter(productConf);
    props.store(writer,null);
  }
  finally {
    StreamUtils.safeClose(writer);
  }
  final File modulesDir=newFile(env.getInstalledImage().getModulesDir(),SYSTEM,LAYERS,BASE);
  if (!modulesDir.exists()) {
    modulesDir.mkdirs();
  }
  final File moduleDir=createModule1(modulesDir,"org.jboss.as.product:" + identity,"product.jar");
  final Manifest manifest=new Manifest();
  manifest.getMainAttributes().putValue(Name.MANIFEST_VERSION.toString(),"xxx");
  manifest.getMainAttributes().putValue("JBoss-Product-Release-Name",productName);
  manifest.getMainAttributes().putValue("JBoss-Product-Release-Version",productVersion);
  final File moduleJar=new File(new File(moduleDir,identity),"product.jar");
  JarOutputStream jar=null;
  try {
    jar=new JarOutputStream(new FileOutputStream(moduleJar),manifest);
    jar.flush();
  }
  finally {
    StreamUtils.safeClose(jar);
  }
  return binDir;
}
