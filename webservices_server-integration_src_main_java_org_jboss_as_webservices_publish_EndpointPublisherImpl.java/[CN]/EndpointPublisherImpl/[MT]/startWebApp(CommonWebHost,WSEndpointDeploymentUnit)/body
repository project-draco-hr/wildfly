{
  CommonWebDeploymentBuilder deployment=new CommonWebDeploymentBuilder();
  CommonWebDeployment handle;
  try {
    JBossWebMetaData jbwebMD=unit.getAttachment(WSAttachmentKeys.JBOSSWEB_METADATA_KEY);
    deployment.setContextRoot(jbwebMD.getContextRoot());
    ServerConfigService config=(ServerConfigService)unit.getServiceRegistry().getService(WSServices.CONFIG_SERVICE).getService();
    File docBase=new File(config.getValue().getServerTempDir(),jbwebMD.getContextRoot());
    if (!docBase.exists()) {
      docBase.mkdirs();
    }
    deployment.setDocumentRoot(docBase);
    deployment.setClassLoader(unit.getAttachment(WSAttachmentKeys.CLASSLOADER_KEY));
    addServlets(jbwebMD,deployment);
    handle=host.addWebDeployment(deployment);
    handle.create();
  }
 catch (  Exception e) {
    throw MESSAGES.createContextPhaseFailed(e);
  }
  try {
    handle.start();
  }
 catch (  LifecycleException e) {
    throw MESSAGES.startContextPhaseFailed(e);
  }
  return handle;
}
