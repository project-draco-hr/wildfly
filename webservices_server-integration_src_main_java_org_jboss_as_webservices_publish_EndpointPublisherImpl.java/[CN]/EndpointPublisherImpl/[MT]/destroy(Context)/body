{
  List<Endpoint> eps=context.getEndpoints();
  if (eps == null || eps.isEmpty()) {
    return;
  }
  Deployment deployment=eps.get(0).getService().getDeployment();
  List<DeploymentAspect> aspects=getDeploymentAspects();
  try {
    stopWebApp(deployment.getAttachment(WebDeploymentController.class));
  }
  finally {
    ClassLoader origClassLoader=WildFlySecurityManager.getCurrentContextClassLoaderPrivileged();
    try {
      WildFlySecurityManager.setCurrentContextClassLoaderPrivileged(ClassLoaderProvider.getDefaultProvider().getServerIntegrationClassLoader());
      DeploymentAspectManager dam=new DeploymentAspectManagerImpl();
      dam.setDeploymentAspects(aspects);
      dam.undeploy(deployment);
    }
  finally {
      WildFlySecurityManager.setCurrentContextClassLoaderPrivileged(origClassLoader);
    }
  }
}
