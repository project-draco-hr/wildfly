{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (deploymentUnit.getParent() == null) {
    return;
  }
  final EarMetaData earConfig=deploymentUnit.getParent().getAttachment(Attachments.EAR_METADATA);
  if (earConfig != null) {
    if (earConfig instanceof Ear6xMetaData) {
      boolean inOrder=((Ear6xMetaData)earConfig).getInitializeInOrder();
      if (inOrder) {
        final ResourceRoot deploymentRoot=deploymentUnit.getAttachment(org.jboss.as.server.deployment.Attachments.DEPLOYMENT_ROOT);
        ModuleMetaData thisModulesMetadata=deploymentRoot.getAttachment(Attachments.MODULE_META_DATA);
        if (thisModulesMetadata != null && thisModulesMetadata.getType() != ModuleMetaData.ModuleType.Client) {
          ModuleMetaData previous=null;
          for (          ModuleMetaData module : earConfig.getModules()) {
            if (module.getFileName().equals(thisModulesMetadata.getFileName())) {
              break;
            }
          }
          if (previous != null) {
            final ServiceName serviceName=deploymentUnit.getParent().getServiceName().append(previous.getFileName());
            phaseContext.addToAttachmentList(org.jboss.as.server.deployment.Attachments.NEXT_PHASE_DEPS,serviceName.append(Phase.INSTALL.name()));
          }
        }
      }
    }
  }
}
