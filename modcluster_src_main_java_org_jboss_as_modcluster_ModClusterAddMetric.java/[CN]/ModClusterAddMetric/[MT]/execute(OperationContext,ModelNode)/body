{
  final ModelNode dynamicLoadProvider=context.readResourceForUpdate(PathAddress.EMPTY_ADDRESS).getModel().get(CommonAttributes.DYNAMIC_LOAD_PROVIDER);
  final ModelNode metric=new ModelNode();
  List<Property> list=operation.asPropertyList();
  Iterator<Property> it=list.iterator();
  while (it.hasNext()) {
    Property prop=it.next();
    if (prop.getName().equals("property")) {
      String properties=prop.getValue().asString();
      ModelNode props=ModelNode.fromString(properties);
      metric.get("property").set(props);
    }
 else     if (prop.getName().equals("type")) {
      metric.get(prop.getName()).set(prop.getValue().asString());
    }
  }
  if (!metric.get("type").isDefined()) {
    throw new OperationFailedException(new ModelNode().set(MESSAGES.typeAttributeRequired("add-metric")));
  }
  if (!dynamicLoadProvider.isDefined()) {
    dynamicLoadProvider.get(CommonAttributes.HISTORY).set(9);
    dynamicLoadProvider.get(CommonAttributes.DECAY).set(2);
  }
  replaceMetric(dynamicLoadProvider,metric);
  if (context.isNormalServer()) {
    context.reloadRequired();
  }
  context.completeStep();
}
