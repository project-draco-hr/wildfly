{
  final byte responseType=input.readByte();
  final ModelNode response=new ModelNode();
  response.readExternal(input);
  final boolean prepared=responseType == ModelControllerProtocol.PARAM_OPERATION_PREPARED;
  final ExecuteRequestContext executeRequestContext=context.getAttachment();
  if (prepared) {
    executeRequestContext.operationPrepared(new ModelController.OperationTransaction(){
      @Override public void rollback(){
        done(false);
      }
      @Override public void commit(){
        done(true);
      }
      private void done(      boolean commit){
        final byte status=commit ? ModelControllerProtocol.PARAM_COMMIT : ModelControllerProtocol.PARAM_ROLLBACK;
        try {
          channelAssociation.executeRequest(context.getOperationId(),new CompleteTxRequest(status));
        }
 catch (        Exception e) {
          resultHandler.failed(e);
        }
      }
    }
,response);
  }
 else {
    executeRequestContext.operationFailed(response);
    resultHandler.done(response);
  }
}
