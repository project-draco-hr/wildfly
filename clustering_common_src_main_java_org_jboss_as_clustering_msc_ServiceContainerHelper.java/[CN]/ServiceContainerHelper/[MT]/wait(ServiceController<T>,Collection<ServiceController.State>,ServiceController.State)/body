{
  if (controller.getState() == targetState)   return true;
  ServiceListener<T> listener=new NotifyingServiceListener<T>();
  controller.addListener(listener);
  try {
synchronized (controller) {
      while (expectedStates.contains(controller.getState())) {
        controller.wait();
      }
    }
  }
 catch (  InterruptedException e) {
    Thread.currentThread().interrupt();
  }
  controller.removeListener(listener);
  return controller.getState() == targetState;
}
