{
  XRepository xrepo=(XRepository)getRepository();
  RepositoryRequirementBuilder reqbuilder=xrepo.getRequirementBuilder();
  MavenCoordinates coordinates=MavenCoordinates.parse("org.apache.felix:org.apache.felix.eventadmin:1.2.6");
  Requirement req=reqbuilder.createArtifactRequirement(coordinates);
  assertNotNull("Requirement not null",req);
  Collection<Capability> caps=xrepo.findProviders(req);
  assertEquals("Capability not null",1,caps.size());
  XIdentityCapability xcap=(XIdentityCapability)caps.iterator().next();
  assertEquals("org.apache.felix.eventadmin",xcap.getSymbolicName());
  InputStream content=xcap.getResource().getContent();
  try {
    Bundle bundle=context.installBundle(xcap.getSymbolicName(),content);
    try {
      bundle.start();
      assertBundleState(Bundle.ACTIVE,bundle.getState());
      ServiceReference sref=context.getServiceReference("org.osgi.service.event.EventAdmin");
      assertNotNull("EventAdmin service not null",sref);
    }
  finally {
      bundle.uninstall();
    }
  }
  finally {
    content.close();
  }
}
