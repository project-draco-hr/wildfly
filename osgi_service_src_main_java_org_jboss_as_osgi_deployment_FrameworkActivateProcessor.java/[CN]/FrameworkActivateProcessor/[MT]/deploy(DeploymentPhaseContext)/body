{
  phaseContext.addDeploymentDependency(Services.SYSTEM_CONTEXT,OSGiConstants.SYSTEM_CONTEXT_KEY);
  phaseContext.addDeploymentDependency(Services.ENVIRONMENT,OSGiConstants.ENVIRONMENT_KEY);
  DeploymentUnit depUnit=phaseContext.getDeploymentUnit();
  if (depUnit.hasAttachment(OSGiConstants.DEPLOYMENT_KEY)) {
    ServiceRegistry serviceRegistry=phaseContext.getServiceRegistry();
    if (serviceRegistry.getService(IntegrationServices.BOOTSTRAP_BUNDLES_INSTALL) == null) {
      ServiceVerificationHandler verificationHandler=depUnit.getAttachment(Attachments.SERVICE_VERIFICATION_HANDLER);
      FrameworkActivationService.addService(deploymentTracker.getServiceTarget(),verificationHandler);
    }
    ServiceName phaseDependency=deploymentTracker.isComplete() ? FRAMEWORK_ACTIVE : BOOTSTRAP_BUNDLES_COMPLETE;
    phaseContext.addDeploymentDependency(phaseDependency,AttachmentKey.create(Object.class));
    phaseContext.addDeploymentDependency(Services.BUNDLE_MANAGER,OSGiConstants.BUNDLE_MANAGER_KEY);
    phaseContext.addDeploymentDependency(Services.RESOLVER,OSGiConstants.RESOLVER_KEY);
  }
}
