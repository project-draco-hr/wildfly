{
  DeploymentUnit depUnit=phaseContext.getDeploymentUnit();
  Deployment deployment=depUnit.getAttachment(OSGiConstants.DEPLOYMENT_KEY);
  boolean hasInjectionPoint=hasValidInjectionPoint(depUnit);
  if (deployment == null && hasInjectionPoint == false)   return;
  ServiceVerificationHandler verificationHandler=depUnit.getAttachment(Attachments.SERVICE_VERIFICATION_HANDLER);
  FrameworkActivationService.activateOnce(verificationHandler);
  ServiceName phaseDependency=deploymentTracker.isComplete() ? FRAMEWORK_ACTIVE : MODULE_REGISTRATION_COMPLETE;
  phaseContext.addDeploymentDependency(phaseDependency,AttachmentKey.create(Object.class));
  phaseContext.addDeploymentDependency(Services.BUNDLE_MANAGER,OSGiConstants.BUNDLE_MANAGER_KEY);
  phaseContext.addDeploymentDependency(Services.RESOLVER,OSGiConstants.RESOLVER_KEY);
  phaseContext.addDeploymentDependency(Services.SYSTEM_CONTEXT,OSGiConstants.SYSTEM_CONTEXT_KEY);
  phaseContext.addDeploymentDependency(Services.ENVIRONMENT,OSGiConstants.ENVIRONMENT_KEY);
}
