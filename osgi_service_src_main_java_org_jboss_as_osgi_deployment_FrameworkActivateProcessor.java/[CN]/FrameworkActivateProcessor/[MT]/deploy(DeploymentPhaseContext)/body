{
  DeploymentUnit depUnit=phaseContext.getDeploymentUnit();
  Deployment deployment=depUnit.getAttachment(OSGiConstants.DEPLOYMENT_KEY);
  boolean hasInjectionPoint=hasValidInjectionPoint(depUnit);
  if (deployment == null && hasInjectionPoint == false)   return;
  FrameworkActivator.activate(depUnit.getAttachment(Attachments.SERVICE_VERIFICATION_HANDLER));
  if (deploymentTracker.isComplete()) {
    phaseContext.addDeploymentDependency(Services.FRAMEWORK_ACTIVE,AttachmentKey.create(Object.class));
  }
 else {
    phaseContext.addDeploymentDependency(MODULE_REGISTRATION_COMPLETE,AttachmentKey.create(Object.class));
    phaseContext.addDeploymentDependency(Services.FRAMEWORK_CREATE,OSGiConstants.SYSTEM_CONTEXT_KEY);
  }
  phaseContext.addDeploymentDependency(Services.BUNDLE_MANAGER,OSGiConstants.BUNDLE_MANAGER_KEY);
  phaseContext.addDeploymentDependency(Services.RESOLVER,OSGiConstants.RESOLVER_KEY);
  phaseContext.addDeploymentDependency(Services.ENVIRONMENT,OSGiConstants.ENVIRONMENT_KEY);
}
