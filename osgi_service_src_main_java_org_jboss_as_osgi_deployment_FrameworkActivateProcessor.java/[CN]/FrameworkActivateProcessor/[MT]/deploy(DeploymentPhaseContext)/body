{
  phaseContext.addDeploymentDependency(Services.SYSTEM_CONTEXT,OSGiConstants.SYSTEM_CONTEXT_KEY);
  phaseContext.addDeploymentDependency(Services.ENVIRONMENT,OSGiConstants.ENVIRONMENT_KEY);
  DeploymentUnit depUnit=phaseContext.getDeploymentUnit();
  if (!depUnit.hasAttachment(OSGiConstants.DEPLOYMENT_KEY) && !hasValidInjectionPoint(depUnit))   return;
  ServiceVerificationHandler verificationHandler=depUnit.getAttachment(Attachments.SERVICE_VERIFICATION_HANDLER);
  FrameworkActivationService.activateOnce(verificationHandler);
  ServiceName phaseDependency=deploymentTracker.isComplete() ? FRAMEWORK_ACTIVE : BOOTSTRAP_BUNDLES_COMPLETE;
  phaseContext.addDeploymentDependency(phaseDependency,AttachmentKey.create(Object.class));
  phaseContext.addDeploymentDependency(Services.BUNDLE_MANAGER,OSGiConstants.BUNDLE_MANAGER_KEY);
  phaseContext.addDeploymentDependency(Services.RESOLVER,OSGiConstants.RESOLVER_KEY);
}
