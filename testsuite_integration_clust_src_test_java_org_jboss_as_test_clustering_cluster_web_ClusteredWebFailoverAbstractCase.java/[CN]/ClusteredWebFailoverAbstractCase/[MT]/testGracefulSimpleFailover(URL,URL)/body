{
  DefaultHttpClient client=org.jboss.as.test.http.util.HttpClientUtils.relaxedCookieHttpClient();
  String url1=baseURL1.toString() + "simple";
  String url2=baseURL2.toString() + "simple";
  try {
    this.establishView(client,baseURL1,NODE_1,NODE_2);
    HttpResponse response=client.execute(new HttpGet(url1));
    try {
      System.out.println("Requested " + url1 + ", got "+ response.getFirstHeader("value").getValue()+ ".");
      Assert.assertEquals(HttpServletResponse.SC_OK,response.getStatusLine().getStatusCode());
      Assert.assertEquals(1,Integer.parseInt(response.getFirstHeader("value").getValue()));
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
    response=client.execute(new HttpGet(url1));
    try {
      System.out.println("Requested " + url1 + ", got "+ response.getFirstHeader("value").getValue()+ ".");
      Assert.assertEquals(HttpServletResponse.SC_OK,response.getStatusLine().getStatusCode());
      Assert.assertEquals(2,Integer.parseInt(response.getFirstHeader("value").getValue()));
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
    stop(CONTAINER_1);
    this.establishView(client,baseURL2,NODE_2);
    response=client.execute(new HttpGet(url2));
    try {
      System.out.println("Requested " + url2 + ", got "+ response.getFirstHeader("value").getValue()+ ".");
      Assert.assertEquals(HttpServletResponse.SC_OK,response.getStatusLine().getStatusCode());
      Assert.assertEquals("Session failed to replicate after container 1 was shutdown.",3,Integer.parseInt(response.getFirstHeader("value").getValue()));
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
    response=client.execute(new HttpGet(url2));
    try {
      System.out.println("Requested " + url2 + ", got "+ response.getFirstHeader("value").getValue()+ ".");
      Assert.assertEquals(HttpServletResponse.SC_OK,response.getStatusLine().getStatusCode());
      Assert.assertEquals(4,Integer.parseInt(response.getFirstHeader("value").getValue()));
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
    start(CONTAINER_1);
    this.establishView(client,baseURL2,NODE_1,NODE_2);
    response=client.execute(new HttpGet(url1));
    try {
      System.out.println("Requested " + url1 + ", got "+ response.getFirstHeader("value").getValue()+ ".");
      Assert.assertEquals(HttpServletResponse.SC_OK,response.getStatusLine().getStatusCode());
      Assert.assertEquals("Session failed to replicate after container 1 was brough up.",5,Integer.parseInt(response.getFirstHeader("value").getValue()));
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
    response=client.execute(new HttpGet(url1));
    try {
      System.out.println("Requested " + url1 + ", got "+ response.getFirstHeader("value").getValue()+ ".");
      Assert.assertEquals(HttpServletResponse.SC_OK,response.getStatusLine().getStatusCode());
      Assert.assertEquals(6,Integer.parseInt(response.getFirstHeader("value").getValue()));
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
  }
  finally {
    HttpClientUtils.closeQuietly(client);
  }
}
