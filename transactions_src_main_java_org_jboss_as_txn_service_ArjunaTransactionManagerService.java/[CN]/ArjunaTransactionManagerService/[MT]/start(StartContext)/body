{
  final JTAEnvironmentBean jtaEnvironmentBean=jtaPropertyManager.getJTAEnvironmentBean();
  jtaEnvironmentBean.setLastResourceOptimisationInterfaceClassName(LastResource.class.getName());
  jtaEnvironmentBean.setXaRecoveryNodes(Collections.singletonList(nodeIdentifier));
  jtaEnvironmentBean.setXaResourceOrphanFilterClassNames(Arrays.asList(JTATransactionLogXAResourceOrphanFilter.class.getName(),JTANodeNameXAResourceOrphanFilter.class.getName()));
  jtaEnvironmentBean.setXAResourceRecordWrappingPlugin(new com.arjuna.ats.internal.jbossatx.jta.XAResourceRecordWrappingPluginImpl());
  final CoordinatorEnvironmentBean coordinatorEnvironmentBean=arjPropertyManager.getCoordinatorEnvironmentBean();
  coordinatorEnvironmentBean.setEnableStatistics(coordinatorEnableStatistics);
  coordinatorEnvironmentBean.setDefaultTimeout(coordinatorDefaultTimeout);
  coordinatorEnvironmentBean.setTransactionStatusManagerEnable(transactionStatusManagerEnable);
  Map<String,String> objStoreBrowserTypes=new HashMap<String,String>();
  objStoreBrowser=new ObjStoreBrowser();
  objStoreBrowserTypes.put("StateManager/BasicAction/TwoPhaseCoordinator/AtomicAction","com.arjuna.ats.internal.jta.tools.osb.mbean.jta.JTAActionBean");
  if (!jts) {
    jtaEnvironmentBean.setTransactionManagerClassName(com.arjuna.ats.jbossatx.jta.TransactionManagerDelegate.class.getName());
    jtaEnvironmentBean.setTransactionSynchronizationRegistryClassName(com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionSynchronizationRegistryImple.class.getName());
    final com.arjuna.ats.jbossatx.jta.TransactionManagerService service=new com.arjuna.ats.jbossatx.jta.TransactionManagerService();
    final ServerVMClientUserTransaction userTransaction=new ServerVMClientUserTransaction(service.getTransactionManager());
    userTransactionRegistry.getValue().addProvider(userTransaction);
    jtaEnvironmentBean.setUserTransaction(userTransaction);
    service.setJbossXATerminator(xaTerminatorInjector.getValue());
    service.setTransactionSynchronizationRegistry(new com.arjuna.ats.internal.jta.transaction.arjunacore.TransactionSynchronizationRegistryImple());
    try {
      service.create();
    }
 catch (    Exception e) {
      throw MESSAGES.managerStartFailure(e,"Transaction");
    }
    service.start();
    value=service;
  }
 else {
    final ORB orb=orbInjector.getValue();
    new PostInitLoader(PostInitLoader.generateORBPropertyName("com.arjuna.orbportability.orb"),orb);
    jtaEnvironmentBean.setTransactionManagerClassName(com.arjuna.ats.jbossatx.jts.TransactionManagerDelegate.class.getName());
    jtaEnvironmentBean.setTransactionSynchronizationRegistryClassName(com.arjuna.ats.internal.jta.transaction.jts.TransactionSynchronizationRegistryImple.class.getName());
    final com.arjuna.ats.jbossatx.jts.TransactionManagerService service=new com.arjuna.ats.jbossatx.jts.TransactionManagerService();
    final ServerVMClientUserTransaction userTransaction=new ServerVMClientUserTransaction(service.getTransactionManager());
    jtaEnvironmentBean.setUserTransaction(userTransaction);
    userTransactionRegistry.getValue().addProvider(userTransaction);
    service.setJbossXATerminator(xaTerminatorInjector.getValue());
    service.setTransactionSynchronizationRegistry(new com.arjuna.ats.internal.jta.transaction.jts.TransactionSynchronizationRegistryImple());
    objStoreBrowserTypes.put("StateManager/BasicAction/TwoPhaseCoordinator/ArjunaTransactionImple","com.arjuna.ats.arjuna.tools.osb.mbean.ActionBean");
    try {
      service.create();
    }
 catch (    Exception e) {
      throw MESSAGES.createFailed(e);
    }
    try {
      service.start(orb);
    }
 catch (    Exception e) {
      throw MESSAGES.startFailure(e);
    }
    value=service;
  }
  try {
    objStoreBrowser.setTypes(objStoreBrowserTypes);
    objStoreBrowser.start();
  }
 catch (  Exception e) {
    throw MESSAGES.objectStoreStartFailure(e);
  }
}
