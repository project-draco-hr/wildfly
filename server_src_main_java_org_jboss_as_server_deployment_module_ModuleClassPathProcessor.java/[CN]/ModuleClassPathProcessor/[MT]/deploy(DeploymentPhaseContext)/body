{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final ModuleSpecification moduleSpecification=deploymentUnit.getAttachment(Attachments.MODULE_SPECIFICATION);
  final ModuleLoader moduleLoader=deploymentUnit.getAttachment(Attachments.SERVICE_MODULE_LOADER);
  final AttachmentList<ModuleIdentifier> entries=deploymentUnit.getAttachment(Attachments.CLASS_PATH_ENTRIES);
  if (entries != null) {
    for (    ModuleIdentifier entry : entries) {
      moduleSpecification.addDependency(new ModuleDependency(moduleLoader,entry,false,false,true));
    }
  }
  final List<AdditionalModule> additionalModules=deploymentUnit.getAttachment(Attachments.ADDITIONAL_MODULES);
  if (additionalModules != null) {
    for (    AdditionalModule additionalModule : additionalModules) {
      final AttachmentList<ModuleIdentifier> dependencies=additionalModule.getAttachment(Attachments.CLASS_PATH_ENTRIES);
      if (dependencies == null || dependencies.isEmpty()) {
        continue;
      }
      for (      ModuleIdentifier entry : dependencies) {
        additionalModule.addDependency(new ModuleDependency(moduleLoader,entry,false,true,true));
      }
      additionalModule.addDependency(new ModuleDependency(moduleLoader,deploymentUnit.getAttachment(Attachments.MODULE_IDENTIFIER),false,false,true));
    }
  }
}
