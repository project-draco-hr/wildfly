{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final AttachmentList<ClassPathEntry> entries=deploymentUnit.getAttachment(Attachments.CLASS_PATH_ENTRIES);
  if (entries == null || entries.isEmpty()) {
    return;
  }
  final AttachmentList<ResourceRoot> resourceRoots=deploymentUnit.getAttachment(Attachments.RESOURCE_ROOTS);
  final DeploymentUnit parent=deploymentUnit.getParent();
  if (parent == null) {
    AttachmentList<ServiceName> deps=phaseContext.getAttachment(Attachments.NEXT_PHASE_DEPS);
    if (deps == null)     phaseContext.putAttachment(Attachments.NEXT_PHASE_DEPS,deps=new AttachmentList<ServiceName>(ServiceName.class));
    for (    ClassPathEntry entry : entries) {
      final String classPath=entry.getRelativeUrl();
      final String deploymentName;
      int firstSlash=classPath.indexOf('/');
      if (firstSlash != -1) {
        deploymentName=classPath.substring(0,firstSlash);
      }
 else {
        deploymentName=classPath;
      }
      if (deploymentName.equals(".") || deploymentName.equals("..")) {
        throw new DeploymentUnitProcessingException("Invalid relative path '" + classPath + "' in class path entry");
      }
      deps.add(ServiceName.JBOSS.append("deployment").append(deploymentName).append(phaseContext.getPhase().name()));
    }
  }
 else {
    throw new DeploymentUnitProcessingException("Class-Path on subdeployments not yet supported");
  }
}
