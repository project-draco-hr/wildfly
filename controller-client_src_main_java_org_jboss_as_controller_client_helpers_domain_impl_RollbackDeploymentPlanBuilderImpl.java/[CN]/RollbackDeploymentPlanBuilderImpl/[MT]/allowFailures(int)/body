{
  DeploymentSetPlanImpl setPlan=getCurrentDeploymentSetPlan();
  ServerGroupDeploymentPlan groupPlan=setPlan.getLatestServerGroupDeploymentPlan();
  if (groupPlan == null) {
    throw new IllegalStateException(String.format("No %s is configured",ServerGroupDeploymentPlan.class.getSimpleName()));
  }
  groupPlan=groupPlan.createAllowFailures(serverFailures);
  setPlan=setPlan.storeServerGroup(groupPlan);
  return new ServerGroupDeploymentPlanBuilderImpl(this,setPlan);
}
