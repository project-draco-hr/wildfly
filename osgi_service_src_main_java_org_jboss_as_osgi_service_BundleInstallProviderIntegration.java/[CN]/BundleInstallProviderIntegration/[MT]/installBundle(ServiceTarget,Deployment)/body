{
  log.tracef("Install deployment: %s",dep);
  try {
    String contextName=DeploymentHolderService.getContextName(dep);
    DeploymentHolderService.addService(serviceTarget,contextName,dep);
    InputStream inputStream=dep.getRoot().openStream();
    DeploymentPlanBuilder builder=deploymentManager.newDeploymentPlan();
    builder=builder.add(contextName,inputStream).andDeploy();
    DeploymentPlan plan=builder.build();
    DeploymentAction deployAction=builder.getLastAction();
    executeDeploymentPlan(plan,deployAction);
  }
 catch (  RuntimeException rte) {
    throw rte;
  }
catch (  BundleException ex) {
    throw ex;
  }
catch (  Exception ex) {
    throw new BundleException("Cannot deploy bundle: " + dep,ex);
  }
}
