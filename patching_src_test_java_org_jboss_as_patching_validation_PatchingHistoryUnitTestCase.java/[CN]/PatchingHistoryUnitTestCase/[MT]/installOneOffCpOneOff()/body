{
  final PatchingTestBuilder builder=createDefaultBuilder();
  final byte[] standaloneHash=new byte[20];
  final byte[] moduleHash=new byte[20];
  final File existing=builder.getFile(FILE_EXISTING);
  touch(existing);
  dump(existing,randomString());
  final byte[] existingHash=hashFile(existing);
  final byte[] initialHash=Arrays.copyOf(existingHash,existingHash.length);
  final PatchingTestStepBuilder oneOff1=builder.createStepBuilder();
  oneOff1.setPatchId(ONE_OFF_1_ID).oneOffPatchIdentity(PRODUCT_VERSION).oneOffPatchElement("base-" + ONE_OFF_1_ID,"base",false).addModuleWithRandomContent("org.jboss.test",moduleHash).getParent().addFileWithRandomContent(standaloneHash,FILE_ONE).updateFileWithRandomContent(Arrays.copyOf(existingHash,existingHash.length),existingHash,FILE_EXISTING);
  ;
  apply(oneOff1);
  final PatchingTestStepBuilder cp1=builder.createStepBuilder();
  cp1.setPatchId(CP_1_ID).upgradeIdentity(PRODUCT_VERSION,PRODUCT_VERSION).upgradeElement("base-" + CP_1_ID,"base",false).updateModuleWithRandomContent("org.jboss.test",Arrays.copyOf(moduleHash,moduleHash.length),moduleHash).getParent().updateFileWithRandomContent(Arrays.copyOf(standaloneHash,standaloneHash.length),standaloneHash,FILE_ONE).updateFileWithRandomContent(initialHash,existingHash,FILE_EXISTING);
  ;
  apply(cp1);
  final PatchingTestStepBuilder oneOff2=builder.createStepBuilder();
  oneOff2.setPatchId(ONE_OFF_2_ID).oneOffPatchIdentity(PRODUCT_VERSION).oneOffPatchElement("base-" + ONE_OFF_2_ID,"base",false).updateModuleWithRandomContent("org.jboss.test",moduleHash,null).getParent().updateFileWithRandomContent(standaloneHash,null,FILE_ONE).updateFileWithRandomContent(Arrays.copyOf(existingHash,existingHash.length),existingHash,FILE_EXISTING);
  ;
  apply(oneOff2);
  return builder;
}
