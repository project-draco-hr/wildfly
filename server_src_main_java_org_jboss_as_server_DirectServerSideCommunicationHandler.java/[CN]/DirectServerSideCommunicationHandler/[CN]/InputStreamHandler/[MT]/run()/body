{
  try {
    InputStream input=getInput();
    while (!shutdown.get()) {
      byte[] bytes=StreamUtils.readBytesWithLength(input);
      handler.handleCommand(bytes);
    }
  }
 catch (  EOFException e) {
    logger.debug("EOF received");
  }
catch (  IOException e) {
    if (isClosed()) {
      logger.info("Socket is closed");
    }
 else {
      logger.info("Error reading from socket ",e);
    }
  }
 finally {
    shutdown();
  }
}
