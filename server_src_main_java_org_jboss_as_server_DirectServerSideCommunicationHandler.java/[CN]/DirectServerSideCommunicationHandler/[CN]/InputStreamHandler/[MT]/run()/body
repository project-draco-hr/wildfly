{
  try {
    while (!shutdown.get()) {
      byte[] bytes=StreamUtils.readBytesWithLength(input);
      handler.handleCommand(bytes);
    }
  }
 catch (  EOFException e) {
    logger.debug("EOF received");
  }
catch (  IOException e) {
    e.printStackTrace();
  }
 finally {
    shutdown();
  }
}
