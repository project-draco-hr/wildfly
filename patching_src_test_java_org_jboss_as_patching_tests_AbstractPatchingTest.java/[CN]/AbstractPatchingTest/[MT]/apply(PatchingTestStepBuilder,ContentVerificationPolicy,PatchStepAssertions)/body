{
  final Patch patch=builder.build();
  final File installation=new File(tempDir,JBOSS_INSTALLATION);
  try {
    assertions.before(installation,patch,installationManager);
  }
 catch (  IOException e) {
    throw new PatchingException(e);
  }
  writePatch(builder.getPatchDir(),patch);
  final PatchTool patchTool=PatchTool.Factory.create(installationManager);
  final PatchingResult result=patchTool.applyPatch(builder.getPatchDir(),verificationPolicy);
  result.commit();
  Assert.assertTrue(installationManager.getAllInstalledPatches().contains(patch.getPatchId()));
  try {
    assertions.after(installation,patch,installationManager);
  }
 catch (  IOException e) {
    throw new PatchingException(e);
  }
  return result;
}
