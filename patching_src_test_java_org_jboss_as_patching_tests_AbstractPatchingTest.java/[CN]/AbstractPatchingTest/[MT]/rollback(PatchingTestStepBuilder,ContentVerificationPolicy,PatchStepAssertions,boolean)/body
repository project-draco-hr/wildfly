{
  final Patch patch=builder.build();
  final File installation=new File(tempDir,JBOSS_INSTALLATION);
  try {
    assertions.before(installation,patch,installationManager);
  }
 catch (  IOException e) {
    throw new PatchingException(e);
  }
  final String patchId=patch.getPatchId();
  final PatchTool patchTool=PatchTool.Factory.create(installationManager);
  final PatchingResult result=patchTool.rollback(patchId,verificationPolicy,rollbackTo,false);
  result.commit();
  Assert.assertFalse(installationManager.getAllInstalledPatches().contains(patch.getPatchId()));
  try {
    assertions.after(installation,patch,installationManager);
  }
 catch (  IOException e) {
    throw new PatchingException(e);
  }
  return result;
}
