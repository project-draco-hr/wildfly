{
  Integer allocationRetry=null;
  Long allocationRetryWaitMillis=null;
  if (dataSourceConfig.getTimeOut() != null) {
    allocationRetry=dataSourceConfig.getTimeOut().getAllocationRetry();
    allocationRetryWaitMillis=dataSourceConfig.getTimeOut().getAllocationRetryWaitMillis();
  }
  final TransactionSupport.TransactionSupportLevel tsl=TransactionSupport.TransactionSupportLevel.LocalTransaction;
  final ConnectionManagerFactory cmf=new ConnectionManagerFactory();
  final ConnectionManager cm=cmf.createTransactional(tsl,pool,null,allocationRetry,allocationRetryWaitMillis,getTransactionManager(),null,null,null,null,null);
  cm.setJndiName(jndiName);
  return cm;
}
