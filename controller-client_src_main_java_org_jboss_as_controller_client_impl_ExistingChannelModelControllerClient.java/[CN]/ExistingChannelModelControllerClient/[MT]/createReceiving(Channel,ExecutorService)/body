{
  final ManagementChannelHandler handler=new ManagementChannelHandler(channel,executorService);
  final ExistingChannelModelControllerClient client=new ExistingChannelModelControllerClient(handler);
  handler.addHandlerFactory(client);
  channel.addCloseHandler(new CloseHandler<Channel>(){
    @Override public void handleClose(    Channel closed,    IOException exception){
      handler.shutdown();
      try {
        handler.awaitCompletion(1,TimeUnit.SECONDS);
      }
 catch (      InterruptedException e) {
        Thread.currentThread().interrupt();
      }
 finally {
        handler.shutdownNow();
      }
    }
  }
);
  channel.receiveMessage(handler.getReceiver());
  return client;
}
