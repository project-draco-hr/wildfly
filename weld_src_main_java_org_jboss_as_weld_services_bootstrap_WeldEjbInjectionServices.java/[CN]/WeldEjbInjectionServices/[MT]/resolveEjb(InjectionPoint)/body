{
  EJB ejb=injectionPoint.getAnnotated().getAnnotation(EJB.class);
  if (ejb == null) {
    throw new RuntimeException("@Ejb annotation not found on " + injectionPoint.getMember());
  }
  if (injectionPoint.getMember() instanceof Method && ((Method)injectionPoint.getMember()).getParameterTypes().length != 1) {
    throw new IllegalArgumentException("Injection point represents a method which doesn't follow JavaBean conventions (must have exactly one parameter) " + injectionPoint);
  }
  if (!ejb.lookup().equals("")) {
    final ServiceName ejbServiceName=ContextNames.serviceNameOfContext(moduleDescription.getApplicationName(),moduleDescription.getModuleName(),moduleDescription.getModuleName(),ejb.lookup());
    ServiceController<?> controller=serviceRegistry.getRequiredService(ejbServiceName);
    ManagedReferenceFactory factory=(ManagedReferenceFactory)controller.getValue();
    return factory.getReference().getInstance();
  }
 else {
    throw new RuntimeException("Currently only the lookup attribute is supported on CDI @EJB injection " + injectionPoint);
  }
}
