{
  final ServiceRegistry serviceRegistry=deploymentUnit.getServiceRegistry();
  final List<ResourceRoot> childRoots=deploymentUnit.getAttachmentList(Attachments.RESOURCE_ROOTS);
  for (  final ResourceRoot childRoot : childRoots) {
    if (!SubDeploymentMarker.isSubDeployment(childRoot)) {
      continue;
    }
    final ServiceName serviceName=Services.deploymentUnitName(deploymentUnit.getName(),childRoot.getRootName());
    final ServiceController<?> serviceController=serviceRegistry.getService(serviceName);
    if (serviceController != null) {
      serviceController.setMode(ServiceController.Mode.REMOVE);
    }
  }
}
