{
  final List<ResourceRoot> childRoots=deploymentUnit.getAttachment(Attachments.RESOURCE_ROOTS);
  if (childRoots != null) {
    final ServiceRegistry serviceRegistry=deploymentUnit.getServiceRegistry();
    for (    final ResourceRoot childRoot : childRoots) {
      if (!ResourceRootTypeMarker.isSubDeployment(childRoot)) {
        continue;
      }
      final ServiceName serviceName=deploymentUnit.getServiceName().append(childRoot.getRootName());
      final ServiceController<?> serviceController=serviceRegistry.getService(serviceName);
      if (serviceController != null) {
        serviceController.setMode(ServiceController.Mode.REMOVE);
      }
    }
  }
}
