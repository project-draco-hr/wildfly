{
  DeploymentUnit unit=phaseContext.getDeploymentUnit();
  DeploymentUnit top=DeploymentUtils.getTopDeploymentUnit(unit);
  if (top.hasAttachment(ADDED))   return;
  final ResourceRoot mainRoot=unit.getAttachment(Attachments.DEPLOYMENT_ROOT);
  if (mainRoot == null)   return;
  VirtualFile root=mainRoot.getRoot();
  for (  String path : SEAM_FILES) {
    if (root.getChild(path).exists()) {
      top.putAttachment(ADDED,true);
      final ModuleSpecification moduleSpecification=top.getAttachment(Attachments.MODULE_SPECIFICATION);
      final ModuleLoader moduleLoader=Module.getBootModuleLoader();
      moduleSpecification.addDependency(new ModuleDependency(moduleLoader,VFS_MODULE,false,false,false));
      moduleSpecification.addResourceLoader(getSeamIntResourceLoader());
      break;
    }
  }
}
