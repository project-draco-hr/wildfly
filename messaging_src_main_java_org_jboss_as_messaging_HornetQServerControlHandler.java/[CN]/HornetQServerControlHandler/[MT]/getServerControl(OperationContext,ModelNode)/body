{
  final ServiceName hqServiceName=MessagingServices.getHornetQServiceName(PathAddress.pathAddress(operation.get(ModelDescriptionConstants.OP_ADDR)));
  ServiceController<?> hqService=context.getServiceRegistry(false).getService(hqServiceName);
  if (hqService == null || hqService.getState() != ServiceController.State.UP) {
    throw MessagingLogger.ROOT_LOGGER.hornetQServerNotInstalled(hqServiceName.getSimpleName());
  }
  HornetQServer hqServer=HornetQServer.class.cast(hqService.getValue());
  return hqServer.getHornetQServerControl();
}
