{
  final List<ParsedCmpField> keyFields=parsedRole.getKeyFields();
  if (keyFields == null) {
    return loadKeyFields();
  }
  if (keyFields.isEmpty()) {
    return Collections.EMPTY_MAP;
  }
  if (relationMetaData.isForeignKeyMappingStyle() && isMultiplicityMany()) {
    throw CmpMessages.MESSAGES.relationshipRoleCanNotHaveKeyFields(relationshipRoleName);
  }
  Map<String,JDBCCMPFieldMetaData> defaultFields=getPrimaryKeyFields();
  Map<String,JDBCCMPFieldMetaData> fields=new HashMap<String,JDBCCMPFieldMetaData>(defaultFields.size());
  for (  ParsedCmpField keyField : keyFields) {
    String fieldName=keyField.getFieldName();
    JDBCCMPFieldMetaData cmpField=defaultFields.remove(fieldName);
    if (cmpField == null) {
      throw MESSAGES.cmpFieldNotFoundForRole(relationshipRoleName,entity.getName(),fieldName);
    }
    genIndex=keyField.getGenIndex() != null && keyField.getGenIndex();
    cmpField=new JDBCCMPFieldMetaData(entity,keyField,cmpField,false,relationMetaData.isTableMappingStyle(),relationMetaData.isReadOnly(),relationMetaData.getReadTimeOut(),relationMetaData.isTableMappingStyle());
    fields.put(cmpField.getFieldName(),cmpField);
  }
  if (!defaultFields.isEmpty()) {
    throw MESSAGES.mappingsNotProvidedForAllFieldsForRole(defaultFields.keySet(),relationshipRoleName);
  }
  return Collections.unmodifiableMap(fields);
}
