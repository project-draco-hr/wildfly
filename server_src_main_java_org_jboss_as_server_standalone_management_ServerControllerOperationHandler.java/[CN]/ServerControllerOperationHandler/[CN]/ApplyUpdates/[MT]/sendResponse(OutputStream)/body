{
  List<ResultHandler<?,Void>> results=new ArrayList<ResultHandler<?,Void>>(updates.size());
  for (  final AbstractServerModelUpdate<?> update : updates) {
    results.add(processUpdate(update));
  }
  final Marshaller marshaller=getMarshaller();
  marshaller.start(createByteOutput(output));
  marshaller.writeByte(StandaloneClientProtocol.PARAM_APPLY_UPDATES_RESULT_COUNT);
  marshaller.writeInt(results.size());
  for (  ResultHandler<?,Void> result : results) {
    marshaller.writeByte(StandaloneClientProtocol.PARAM_APPLY_UPDATE_RESULT);
    if (result.e != null) {
      marshaller.writeByte(StandaloneClientProtocol.PARAM_APPLY_UPDATE_RESULT_EXCEPTION);
      marshaller.writeObject(result.e);
    }
 else {
      marshaller.writeByte(StandaloneClientProtocol.APPLY_UPDATE_RESULT_SERVER_MODEL_SUCCESS);
      marshaller.writeObject(result.result);
    }
  }
  marshaller.finish();
}
