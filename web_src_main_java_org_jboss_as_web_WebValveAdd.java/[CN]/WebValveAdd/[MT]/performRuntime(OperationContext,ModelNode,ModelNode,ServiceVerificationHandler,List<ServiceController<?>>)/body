{
  ModelNode operation=Resource.Tools.readModel(context.readResource(PathAddress.EMPTY_ADDRESS));
  final PathAddress address=PathAddress.pathAddress(baseOperation.get(OP_ADDR));
  final String name=address.getLastElement().getValue();
  String classname=null;
  if (WebValveDefinition.CLASS_NAME.resolveModelAttribute(context,operation).isDefined())   classname=WebValveDefinition.CLASS_NAME.resolveModelAttribute(context,operation).asString();
  String module=null;
  if (WebValveDefinition.MODULE.resolveModelAttribute(context,operation).isDefined())   module=WebValveDefinition.MODULE.resolveModelAttribute(context,operation).asString();
  final boolean enabled=WebValveDefinition.ENABLED.resolveModelAttribute(context,operation).asBoolean();
  final WebValveService service=new WebValveService(name,classname,module);
  final ServiceTarget serviceTarget=context.getServiceTarget();
  final ServiceBuilder<?> serviceBuilder=serviceTarget.addService(WebSubsystemServices.JBOSS_WEB_VALVE.append(name),service).addDependency(WebSubsystemServices.JBOSS_WEB,WebServer.class,service.getWebServer());
  if (operation.hasDefined(PARAM)) {
    service.setParam(operation.get(PARAM).clone());
  }
  serviceBuilder.setInitialMode(enabled ? Mode.ACTIVE : Mode.NEVER);
  if (enabled)   serviceBuilder.addListener(verificationHandler);
  newControllers.add(serviceBuilder.install());
}
