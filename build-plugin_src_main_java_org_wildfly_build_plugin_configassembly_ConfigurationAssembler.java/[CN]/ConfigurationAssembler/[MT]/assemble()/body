{
  TemplateParser templateParser=new TemplateParser(templateFile,templateRootElementName);
  templateParser.parse();
  SubsystemsParser subsystemsParser=new SubsystemsParser(subsystemsFile,new BuildPropertyReplacer(properties));
  subsystemsParser.parse();
  populateTemplate(templateParser,subsystemsParser);
  if (outputFile.exists()) {
    outputFile.delete();
  }
  if (!outputFile.getParentFile().exists()) {
    if (!outputFile.getParentFile().mkdirs()) {
      throw new IllegalStateException("Could not create " + outputFile.getParentFile());
    }
  }
  FormattingXMLStreamWriter writer=new FormattingXMLStreamWriter(XMLOutputFactory.newInstance().createXMLStreamWriter(new BufferedWriter(new FileWriter(outputFile))));
  try {
    writer.writeStartDocument();
    templateParser.getRootNode().marshall(writer);
    writer.writeEndDocument();
  }
  finally {
    try {
      writer.close();
    }
 catch (    Exception ignore) {
    }
  }
}
