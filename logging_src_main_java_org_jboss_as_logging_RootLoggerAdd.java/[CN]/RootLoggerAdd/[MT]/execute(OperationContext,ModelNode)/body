{
  final String level=operation.require(LEVEL.getName()).asString();
  final ModelNode handlers=operation.get(HANDLERS.getName());
  final ModelNode subModel=context.readResourceForUpdate(PathAddress.EMPTY_ADDRESS).getModel();
  subModel.get(ROOT_LOGGER,LEVEL.getName()).set(level);
  subModel.get(ROOT_LOGGER,HANDLERS.getName()).set(handlers);
  if (context.getType() == OperationContext.Type.SERVER) {
    context.addStep(new OperationStepHandler(){
      @Override public void execute(      OperationContext context,      ModelNode operation) throws OperationFailedException {
        final ServiceTarget target=context.getServiceTarget();
        final ServiceVerificationHandler verificationHandler=new ServiceVerificationHandler();
        try {
          final RootLoggerService service=new RootLoggerService();
          service.setLevel(Level.parse(LEVEL.validateResolvedOperation(operation).asString()));
          target.addService(LogServices.ROOT_LOGGER,service).addListener(verificationHandler).setInitialMode(ServiceController.Mode.ACTIVE).install();
        }
 catch (        Throwable t) {
          throw new OperationFailedException(new ModelNode().set(t.getLocalizedMessage()));
        }
        Collection<ServiceController<?>> loggerControllers=null;
        try {
          if (handlers.isDefined()) {
            loggerControllers=LogServices.installLoggerHandlers(target,"",handlers,verificationHandler);
          }
        }
 catch (        Throwable t) {
          throw new OperationFailedException(new ModelNode().set(t.getLocalizedMessage()));
        }
        context.addStep(verificationHandler,OperationContext.Stage.VERIFY);
        if (context.completeStep() == OperationContext.ResultAction.ROLLBACK) {
          context.removeService(LogServices.ROOT_LOGGER);
          if (loggerControllers != null)           for (          ServiceController<?> loggerController : loggerControllers) {
            context.removeService(loggerController.getName());
          }
        }
      }
    }
,OperationContext.Stage.RUNTIME);
  }
  context.completeStep();
}
