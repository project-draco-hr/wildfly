{
  final ManagementChannelHandler handler=new ManagementChannelHandler(ManagementClientChannelStrategy.create(channel),getExecutor());
  handler.addHandlerFactory(new HostControllerRegistrationHandler(handler,getController(),domainController));
  handler.addHandlerFactory(new ModelControllerClientOperationHandler(getController(),handler));
  handler.addHandlerFactory(new MasterDomainControllerOperationHandlerImpl(domainController));
  final Channel.Key key=channel.addCloseHandler(new CloseHandler<Channel>(){
    @Override public void handleClose(    Channel closed,    IOException exception){
      handler.shutdown();
      try {
        handler.awaitCompletion(100,TimeUnit.MILLISECONDS);
      }
 catch (      Exception e) {
        ROOT_LOGGER.serviceShutdownIncomplete(e);
      }
 finally {
        handler.shutdownNow();
      }
    }
  }
);
  channel.receiveMessage(handler.getReceiver());
  return key;
}
