{
  long end=System.currentTimeMillis() + unit.toMillis(timeout);
  while (System.currentTimeMillis() < end) {
    wait(end - System.currentTimeMillis());
  }
  if (!done) {
    throw new TimeoutException();
  }
  if (cancelled) {
    throw new CancellationException();
  }
  if (exception != null) {
    throw new ExecutionException(exception);
  }
  return value;
}
