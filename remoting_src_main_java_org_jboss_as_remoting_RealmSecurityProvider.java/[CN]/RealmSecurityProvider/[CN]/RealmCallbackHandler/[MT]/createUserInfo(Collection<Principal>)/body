{
  Subject subject=this.subject == null ? new Subject() : this.subject;
  subject.getPrincipals().addAll(remotingPrincipals);
  Set<UserPrincipal> remotingUsers=subject.getPrincipals(UserPrincipal.class);
  Set<RealmUser> realmUsers=new HashSet<RealmUser>(remotingUsers.size());
  for (  UserPrincipal current : remotingUsers) {
    if (realm != null) {
      realmUsers.add(new RealmUser(realm.getName(),current.getName()));
    }
 else {
      realmUsers.add(new RealmUser(current.getName()));
    }
  }
  subject.getPrincipals().addAll(realmUsers);
  if (subjectSupplemental != null) {
    subjectSupplemental.supplementSubject(subject);
  }
  return new RealmSubjectUserInfo(subject);
}
