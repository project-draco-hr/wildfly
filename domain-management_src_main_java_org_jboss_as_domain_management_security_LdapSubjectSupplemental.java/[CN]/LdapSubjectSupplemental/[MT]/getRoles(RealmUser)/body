{
  Set<RealmRole> response=new HashSet<RealmRole>();
  try {
    HashSet<String> ldapRole=(HashSet<String>)searchLdap(user.getName());
    ROOT_LOGGER.trace("Retrieved roles [" + user.getName() + "] :");
    for (    String role : ldapRole) {
      if (pattern != null) {
        Pattern compilePattern=Pattern.compile(pattern);
        Matcher ldapRoleMatch=compilePattern.matcher(role);
        if (ldapRoleMatch.groupCount() > 0) {
          String parsedRole=replaceGroups(ldapRoleMatch);
          if (parsedRole.length() > 0) {
            response.add(new RealmRole(parsedRole));
          }
        }
      }
 else {
        ROOT_LOGGER.trace("   role:" + role);
        response.add(new RealmRole(role));
      }
    }
  }
 catch (  Exception e) {
    ROOT_LOGGER.failedRetrieveLdapRoles(e);
  }
  return response;
}
