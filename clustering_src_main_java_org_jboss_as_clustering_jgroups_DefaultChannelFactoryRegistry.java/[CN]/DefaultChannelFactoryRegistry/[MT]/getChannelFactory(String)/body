{
  ChannelFactory factory=this.stacks.get((stack != null) ? stack : this.getDefaultStack());
  if (factory == null) {
    throw new IllegalArgumentException(String.format("No channel factory found for %s stack",stack));
  }
  return factory;
}
