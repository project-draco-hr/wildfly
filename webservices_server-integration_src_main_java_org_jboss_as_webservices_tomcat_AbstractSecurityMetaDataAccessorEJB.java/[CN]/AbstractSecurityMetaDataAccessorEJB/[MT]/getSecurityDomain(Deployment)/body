{
  String securityDomain=null;
  for (  final EJBEndpoint ejbEndpoint : getEjbEndpoints(dep)) {
    final String nextSecurityDomain=ejbEndpoint.getSecurityDomain();
    securityDomain=getDomain(securityDomain,nextSecurityDomain);
  }
  if (securityDomain == null) {
    final DeploymentUnit unit=WSHelper.getRequiredAttachment(dep,DeploymentUnit.class);
    if (unit.getParent() != null) {
      final JBossAppMetaData jbossAppMD=unit.getParent().getAttachment(Attachments.JBOSS_APP_METADATA);
      return jbossAppMD != null ? jbossAppMD.getSecurityDomain() : null;
    }
  }
  return securityDomain;
}
