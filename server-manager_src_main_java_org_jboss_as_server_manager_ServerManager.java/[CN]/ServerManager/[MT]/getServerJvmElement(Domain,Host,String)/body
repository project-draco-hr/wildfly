{
  ServerElement server=host.getServer(serverName);
  if (server == null)   throw new IllegalStateException("Server " + serverName + " is not listed in Host");
  String serverGroupName=server.getServerGroup();
  ServerGroupElement serverGroup=domain.getServerGroup(serverGroupName);
  if (serverGroup == null)   throw new IllegalStateException("Server group" + serverGroupName + " is not listed in Domain");
  JvmElement serverVM=server.getJvm();
  String serverVMName=serverVM != null ? serverVM.getName() : null;
  JvmElement groupVM=serverGroup.getJvm();
  String groupVMName=groupVM != null ? groupVM.getName() : null;
  String ourVMName=serverVMName != null ? serverVMName : groupVMName;
  if (ourVMName == null) {
    throw new IllegalStateException("Neither " + Element.SERVER_GROUP.getLocalName() + " nor "+ Element.SERVER.getLocalName()+ " has declared a JVM configuration; one or the other must");
  }
  if (!ourVMName.equals(groupVMName)) {
    groupVM=null;
  }
  JvmElement hostVM=host.getJvm(ourVMName);
  return new JvmElement(groupVM,hostVM,serverVM);
}
