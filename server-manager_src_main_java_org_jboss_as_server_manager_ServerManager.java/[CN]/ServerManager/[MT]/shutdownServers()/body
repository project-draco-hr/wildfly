{
  log.info("Shutting down servers");
  System.out.println();
  if (shutdownLatch != null) {
    throw new IllegalStateException("Already shutting down");
  }
  shutdownLatch=new ShutdownLatch();
  Map<String,Server> serversCopy;
synchronized (servers) {
    serversCopy=new HashMap<String,Server>(servers);
  }
  for (  Map.Entry<String,Server> entry : serversCopy.entrySet()) {
    try {
      Server server=entry.getValue();
      if (server.getState() == ServerState.STOPPED)       continue;
      shutdownLatch.add(entry.getKey());
      log.infof("Stopping %s",server.getServerProcessName());
      server.stop();
      server.setState(ServerState.STOPPING);
    }
 catch (    Exception e) {
    }
  }
  shutdownLatch.addedAll();
  try {
    shutdownLatch.waitForAll();
  }
 catch (  InterruptedException e) {
    log.errorf("Wait for server shutdown was interrupted");
  }
  try {
    processManagerSlave.serversShutdown();
  }
 catch (  IOException e) {
    log.error("Error confiriming servers shutdown",e);
  }
}
