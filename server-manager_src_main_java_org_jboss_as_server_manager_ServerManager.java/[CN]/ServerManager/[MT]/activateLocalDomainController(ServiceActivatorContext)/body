{
  final DomainController domainController=new DomainController();
  try {
    final XMLMapper mapper=XMLMapper.Factory.create();
    extensionRegistrar.registerStandardDomainReaders(mapper);
    domainController.start(hostConfig,mapper,environment.getDomainConfigurationDir());
    setDomainControllerConnection(new LocalDomainControllerConnection(this,domainController));
    final BatchBuilder batchBuilder=serviceActivatorContext.getBatchBuilder();
    final ManagementOperationHandlerService<DomainControllerOperationHandler> operationHandlerService=new ManagementOperationHandlerService<DomainControllerOperationHandler>(new DomainControllerOperationHandler(domainController));
    batchBuilder.addService(ManagementCommunicationService.SERVICE_NAME.append("domain","controller"),operationHandlerService).addDependency(ManagementCommunicationService.SERVICE_NAME,ManagementCommunicationService.class,new ManagementCommunicationServiceInjector(operationHandlerService));
  }
 catch (  Exception e) {
    throw new RuntimeException("Exception starting local domain controller",e);
  }
}
