{
  final BatchBuilder batchBuilder=serviceActivatorContext.getBatchBuilder();
  final ManagementElement managementElement=hostConfig.getManagementElement();
  final Set<ServerInterfaceElement> hostInterfaces=hostConfig.getInterfaces();
  if (hostInterfaces != null) {
    for (    ServerInterfaceElement interfaceElement : hostInterfaces) {
      if (interfaceElement.getName().equals(managementElement.getInterfaceName())) {
        interfaceElement.activate(serviceActivatorContext);
        break;
      }
    }
  }
  final ServiceName threadFactoryServiceName=SERVICE_NAME_BASE.append("thread-factory");
  batchBuilder.addService(threadFactoryServiceName,new ThreadFactoryService());
  final ServiceName executorServiceName=SERVICE_NAME_BASE.append("executor");
  final ThreadFactoryExecutorService executorService=new ThreadFactoryExecutorService(20,false);
  batchBuilder.addService(executorServiceName,executorService).addDependency(threadFactoryServiceName,ThreadFactory.class,executorService.getThreadFactoryInjector());
  final ManagementCommunicationService managementCommunicationService=new ManagementCommunicationService();
  batchBuilder.addService(ManagementCommunicationService.SERVICE_NAME,managementCommunicationService).addDependency(NetworkInterfaceService.JBOSS_NETWORK_INTERFACE.append(managementElement.getInterfaceName()),NetworkInterfaceBinding.class,managementCommunicationService.getInterfaceInjector()).addInjection(managementCommunicationService.getPortInjector(),managementElement.getPort()).addDependency(executorServiceName,ExecutorService.class,managementCommunicationService.getExecutorServiceInjector()).setInitialMode(ServiceController.Mode.IMMEDIATE);
  final ManagementOperationHandlerService<ServerManagerOperationHandler> operationHandlerService=new ManagementOperationHandlerService<ServerManagerOperationHandler>(new ServerManagerOperationHandler(this));
  batchBuilder.addService(ManagementCommunicationService.SERVICE_NAME.append("server","manager"),operationHandlerService).addDependency(ManagementCommunicationService.SERVICE_NAME,ManagementCommunicationService.class,new ManagementCommunicationServiceInjector(operationHandlerService));
}
