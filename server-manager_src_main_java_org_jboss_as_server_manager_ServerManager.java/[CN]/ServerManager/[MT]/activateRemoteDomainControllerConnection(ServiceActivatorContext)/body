{
  final BatchBuilder batchBuilder=serviceActivatorContext.getBatchBuilder();
  final DomainControllerConnectionService domainControllerClientService=new DomainControllerConnectionService(this,fileRepository,10L);
  final BatchServiceBuilder<Void> serviceBuilder=batchBuilder.addService(DomainControllerConnectionService.SERVICE_NAME,domainControllerClientService).addListener(new AbstractServiceListener<Void>(){
    @Override public void serviceFailed(    ServiceController<? extends Void> serviceController,    StartException reason){
      log.error("Failed to register with domain controller.",reason);
    }
  }
).setInitialMode(ServiceController.Mode.IMMEDIATE);
  HostModel hostConfig=getHostModel();
  final RemoteDomainControllerElement remoteDomainControllerElement=hostConfig.getRemoteDomainControllerElement();
  final InetAddress hostAddress;
  try {
    hostAddress=InetAddress.getByName(remoteDomainControllerElement.getHost());
  }
 catch (  UnknownHostException e) {
    throw new RuntimeException("Failed to get remote domain controller address",e);
  }
  serviceBuilder.addInjection(domainControllerClientService.getDomainControllerAddressInjector(),hostAddress);
  serviceBuilder.addInjection(domainControllerClientService.getDomainControllerPortInjector(),remoteDomainControllerElement.getPort());
  final ManagementElement managementElement=hostConfig.getManagementElement();
  serviceBuilder.addDependency(NetworkInterfaceService.JBOSS_NETWORK_INTERFACE.append(managementElement.getInterfaceName()),NetworkInterfaceBinding.class,domainControllerClientService.getLocalManagementInterfaceInjector());
  serviceBuilder.addInjection(domainControllerClientService.getLocalManagementPortInjector(),managementElement.getPort());
  serviceBuilder.addDependency(SERVICE_NAME_BASE.append("executor"),ScheduledExecutorService.class,domainControllerClientService.getExecutorServiceInjector());
  serviceBuilder.addDependency(SERVICE_NAME_BASE.append("thread-factory"),ThreadFactory.class,domainControllerClientService.getThreadFactoryInjector());
}
