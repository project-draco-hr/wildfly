{
  modelManager.start();
  launchProcessManagerSlave();
  final BatchBuilder batchBuilder=serviceContainer.batchBuilder();
  batchBuilder.addListener(new AbstractServiceListener<Object>(){
    @Override public void serviceFailed(    ServiceController<?> serviceController,    StartException reason){
      log.errorf(reason,"Service [%s] failed.",serviceController.getName());
    }
  }
);
  final ServiceActivatorContext serviceActivatorContext=new ServiceActivatorContextImpl(batchBuilder);
  activateManagementCommunication(serviceActivatorContext);
  if (getHostModel().getLocalDomainControllerElement() != null) {
    activateLocalDomainController(serviceActivatorContext);
  }
 else {
    activateRemoteDomainControllerConnection(serviceActivatorContext);
  }
  final ManagementElement managementElement=getHostModel().getManagementElement();
  final ServerManagerService serverManagerService=new ServerManagerService(this);
  batchBuilder.addService(SERVICE_NAME_BASE,serverManagerService).addDependency(NetworkInterfaceService.JBOSS_NETWORK_INTERFACE.append(managementElement.getInterfaceName()),NetworkInterfaceBinding.class,serverManagerService.getManagementInterfaceInjector()).addInjection(serverManagerService.getManagementPortInjector(),managementElement.getPort()).addDependency(DomainControllerConnection.SERVICE_NAME,DomainControllerConnection.class,serverManagerService.getDomainControllerConnectionInjector()).setInitialMode(ServiceController.Mode.ACTIVE);
  try {
    batchBuilder.install();
  }
 catch (  ServiceRegistryException e) {
    throw new RuntimeException(e);
  }
}
