{
  output.writeByte(protocol.fileStart());
  output.writeByte(protocol.paramFilePath());
  output.writeUTF(getRelativePath(localPath,file));
  output.writeByte(protocol.paramFileSize());
  output.writeLong(file.length());
  InputStream inputStream=null;
  try {
    inputStream=new FileInputStream(file);
    byte[] buffer=new byte[8192];
    int len;
    while ((len=inputStream.read(buffer)) != -1) {
      output.write(buffer,0,len);
    }
  }
  finally {
    if (inputStream != null) {
      try {
        inputStream.close();
      }
 catch (      IOException ignored) {
      }
    }
  }
  output.writeByte(protocol.fileEnd());
}
