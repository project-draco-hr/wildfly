{
  JDBCCMPFieldBridge2[] pkFields=(JDBCCMPFieldBridge2[])entity.getPrimaryKeyFields();
  Connection con=null;
  PreparedStatement ps=null;
  try {
    if (log.isDebugEnabled()) {
      log.debug("executing : " + deleteSql);
    }
    con=dataSource.getConnection();
    ps=con.prepareStatement(deleteSql);
    int batchCount=0;
    while (view.deleted != null) {
      Row row=view.deleted;
      int paramInd=1;
      for (int pkInd=0; pkInd < pkFields.length; ++pkInd) {
        JDBCCMPFieldBridge2 pkField=pkFields[pkInd];
        Object fieldValue=row.fields[pkField.getRowIndex()];
        paramInd=pkField.setArgumentParameters(ps,paramInd,fieldValue);
      }
      deleteStrategy.executeUpdate(ps);
      ++batchCount;
      row.flushStatus();
    }
    deleteStrategy.executeBatch(ps);
    if (view.deleted != null) {
      throw CmpMessages.MESSAGES.stillRowsToDelete();
    }
    if (log.isTraceEnabled()) {
      log.trace("deleted rows: " + batchCount);
    }
  }
 catch (  SQLException e) {
    throw CmpMessages.MESSAGES.failedToDeleteView(e);
  }
 finally {
    JDBCUtil.safeClose(ps);
    JDBCUtil.safeClose(con);
  }
}
