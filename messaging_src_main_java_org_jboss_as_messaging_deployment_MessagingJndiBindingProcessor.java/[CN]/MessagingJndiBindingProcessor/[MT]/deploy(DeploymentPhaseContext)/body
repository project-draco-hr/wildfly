{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final EEModuleDescription moduleDescription=deploymentUnit.getAttachment(Attachments.EE_MODULE_DESCRIPTION);
  if (moduleDescription == null) {
    return;
  }
  final BindInfo defaultConnectionFactoryBindInfo=ContextNames.bindInfoFor(JBOSS_DEFAULT_JMS_CONNECTION_FACTORY_LOOKUP);
  final ServiceName serviceName=defaultConnectionFactoryBindInfo.getBinderServiceName();
  if (phaseContext.getServiceRegistry().getService(serviceName) == null) {
    return;
  }
  if (!DeploymentTypeMarker.isType(EAR,deploymentUnit)) {
    moduleDescription.getBindingConfigurations().add(new BindingConfiguration(DEFAULT_JMS_CONNECTION_FACTORY,new ServiceInjectionSource(serviceName)));
  }
  for (  ComponentDescription component : moduleDescription.getComponentDescriptions()) {
    if (component.getNamingMode() == ComponentNamingMode.CREATE) {
      component.getBindingConfigurations().add(new BindingConfiguration(DEFAULT_JMS_CONNECTION_FACTORY,new ServiceInjectionSource(serviceName)));
    }
  }
}
