{
  if (controller.isStarted(CONTAINER))   controller.stop(CONTAINER);
  if (doCleanup) {
    if (IoUtils.recursiveDelete(tempDir)) {
      tempDir.deleteOnExit();
    }
  }
  final boolean success=CliUtilsForPatching.rollbackAll();
  if (!success) {
    final File home=new File(PatchingTestUtil.AS_DISTRIBUTION);
    PatchingTestUtil.resetInstallationState(home,BASE_MODULE_DIRECTORY);
    Assert.fail("failed to rollback all patches " + CliUtilsForPatching.info());
  }
}
