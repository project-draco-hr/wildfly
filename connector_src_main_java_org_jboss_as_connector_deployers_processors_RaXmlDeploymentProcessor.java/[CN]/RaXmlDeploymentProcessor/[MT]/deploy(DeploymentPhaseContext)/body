{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final ManagementResourceRegistration registration=deploymentUnit.getAttachment(DeploymentModelUtils.MUTABLE_REGISTRATION_ATTACHMENT);
  final ConnectorXmlDescriptor connectorXmlDescriptor=deploymentUnit.getAttachment(ConnectorXmlDescriptor.ATTACHMENT_KEY);
  if (connectorXmlDescriptor == null) {
    return;
  }
  ResourceAdaptersService.ModifiableResourceAdaptors raxmls=null;
  final ServiceController<?> raService=phaseContext.getServiceRegistry().getService(ConnectorServices.RESOURCEADAPTERS_SERVICE);
  if (raService != null)   raxmls=((ResourceAdaptersService.ModifiableResourceAdaptors)raService.getValue());
  if (raxmls == null)   return;
  ROOT_LOGGER.tracef("processing Raxml");
  Module module=deploymentUnit.getAttachment(Attachments.MODULE);
  if (module == null)   throw MESSAGES.failedToGetModuleAttachment(deploymentUnit);
  try {
    final ServiceTarget serviceTarget=phaseContext.getServiceTarget();
    String deploymentUnitPrefix="";
    if (deploymentUnit.getParent() != null) {
      deploymentUnitPrefix=deploymentUnit.getParent().getName() + "#";
    }
    final String deploymentUnitName=deploymentUnitPrefix + deploymentUnit.getName();
    final String deployment;
    if (deploymentUnitName.lastIndexOf('.') == -1) {
      deployment=deploymentUnitName;
    }
 else {
      deployment=deploymentUnitName.substring(0,deploymentUnitName.lastIndexOf('.'));
    }
    for (    ResourceAdapter raxml : raxmls.getResourceAdapters()) {
      String rarName=raxml.getArchive();
      Integer identifier=null;
      if (rarName.contains("#")) {
        rarName=rarName.substring(0,rarName.indexOf("#"));
      }
      if (deploymentUnitName.equals(rarName)) {
        RaServicesFactory.createDeploymnetService(registration,connectorXmlDescriptor,module,serviceTarget,deploymentUnitName,deployment,raxml);
      }
    }
    ServiceName serviceName=ConnectorServices.INACTIVE_RESOURCE_ADAPTER_SERVICE.append(deploymentUnitName);
    InactiveResourceAdapterDeploymentService service=new InactiveResourceAdapterDeploymentService(connectorXmlDescriptor,module,deployment,deploymentUnitName,registration);
    ServiceBuilder builder=serviceTarget.addService(serviceName,service);
    builder.setInitialMode(Mode.ACTIVE).install();
  }
 catch (  Throwable t) {
    throw new DeploymentUnitProcessingException(t);
  }
}
