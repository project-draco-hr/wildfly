{
  final Process process;
synchronized (lock) {
    process=ManagedProcess.this.process;
  }
  int exitCode;
  for (; ; )   try {
    exitCode=process.waitFor();
    log.processFinished(processName,Integer.valueOf(exitCode));
    break;
  }
 catch (  InterruptedException e) {
  }
  boolean respawn=false;
  int respawnCount=0;
synchronized (lock) {
    final long endTime=System.currentTimeMillis();
    processController.processStopped(processName,endTime - startTime);
    state=State.DOWN;
    if (shutdown) {
      processController.removeProcess(processName);
    }
 else     if (isPrivileged() && exitCode == ExitCodes.HOST_CONTROLLER_ABORT_EXIT_CODE) {
      processController.removeProcess(processName);
      new Thread(new Runnable(){
        public void run(){
          processController.shutdown();
          System.exit(0);
        }
      }
).start();
    }
 else {
      if (!stopRequested) {
        respawn=true;
        respawnCount=ManagedProcess.this.incrementAndGetRespawnCount();
      }
    }
    stopRequested=false;
  }
  if (respawn) {
    respawnPolicy.respawn(respawnCount,ManagedProcess.this);
  }
}
