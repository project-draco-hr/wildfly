{
  final Process process;
synchronized (lock) {
    process=ManagedProcess.this.process;
  }
  int exitCode;
  for (; ; )   try {
    exitCode=process.waitFor();
    log.infof("Process '%s' finished with an exit status of %d",processName,Integer.valueOf(exitCode));
    break;
  }
 catch (  InterruptedException e) {
  }
synchronized (lock) {
    final long endTime=System.currentTimeMillis();
    state=State.DOWN;
    if (shutdown) {
      processController.removeProcess(processName);
    }
 else     if (isInitial() && exitCode == 99) {
      processController.removeProcess(processName);
      new Thread(new Runnable(){
        public void run(){
          processController.shutdown();
          System.exit(0);
        }
      }
).start();
    }
 else {
      processController.processStopped(processName,endTime - startTime);
      if (isInitial()) {
        doStart(true);
      }
    }
  }
}
