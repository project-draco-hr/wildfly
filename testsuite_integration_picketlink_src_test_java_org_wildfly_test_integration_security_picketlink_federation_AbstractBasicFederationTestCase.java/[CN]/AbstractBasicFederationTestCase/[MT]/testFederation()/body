{
  WebConversation conversation=new WebConversation();
  HttpUnitOptions.setLoggingHttpHeaders(true);
  WebRequest request=new GetMethodWebRequest(formatUrl(this.serviceProvider1));
  WebResponse response=conversation.getResponse(request);
  assertTrue(response.getURL().getPath().startsWith("/idp"));
  assertEquals(1,response.getForms().length);
  WebForm webForm=response.getForms()[0];
  webForm.setParameter("j_username","tomcat");
  webForm.setParameter("j_password","tomcat");
  webForm.getSubmitButtons()[0].click();
  response=conversation.getCurrentPage();
  assertTrue(response.getText().contains("Welcome to " + formatContextPath(this.serviceProvider1)));
  request=new GetMethodWebRequest(formatUrl(this.serviceProvider2));
  response=conversation.getResponse(request);
  assertTrue(response.getText().contains("Welcome to " + formatContextPath(this.serviceProvider2)));
}
