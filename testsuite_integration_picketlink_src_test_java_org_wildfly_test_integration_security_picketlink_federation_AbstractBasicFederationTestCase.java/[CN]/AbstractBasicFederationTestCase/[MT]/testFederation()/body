{
  WebConversation conversation=new WebConversation();
  HttpUnitOptions.setLoggingHttpHeaders(true);
  WebRequest request=new GetMethodWebRequest(formatUrl(this.serviceProvider1));
  WebResponse response=conversation.getResponse(request);
  assertTrue(response.getURL().getPath().startsWith("/idp"));
  assertEquals(1,response.getForms().length);
  WebForm webForm=response.getForms()[0];
  webForm.setParameter("j_username","tomcat");
  webForm.setParameter("j_password","tomcat");
  webForm.getSubmitButtons()[0].click();
  response=conversation.getCurrentPage();
  assertTrue(response.getText().contains("Welcome to " + formatContextPath(this.serviceProvider1)));
  request=new GetMethodWebRequest(formatUrl(this.serviceProvider2));
  response=conversation.getResponse(request);
  assertTrue(response.getText().contains("Welcome to " + formatContextPath(this.serviceProvider2)));
  response=conversation.getResponse(formatUrl(this.serviceProvider2) + LOGOUT_URL);
  LOGGER.debug("GLO response(" + this.serviceProvider2 + "):"+ response.getText());
  assertTrue("cannot reach logged out page",response.getText().contains("Logout"));
  request=new GetMethodWebRequest(formatUrl(this.serviceProvider1));
  response=conversation.getResponse(request);
  assertTrue("cannot reach IDP",response.getURL().getPath().startsWith("/idp"));
  assertEquals("no form present on supposed IDP login page",1,response.getForms().length);
}
