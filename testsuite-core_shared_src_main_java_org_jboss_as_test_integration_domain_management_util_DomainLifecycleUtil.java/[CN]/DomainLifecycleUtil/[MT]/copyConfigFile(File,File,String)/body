{
  prefix=prefix == null ? "" : prefix;
  File newFile=new File(dir,prefix + file.getName());
  if (newFile.exists()) {
    newFile.delete();
  }
  try {
    InputStream in=new BufferedInputStream(new FileInputStream(file));
    try {
      OutputStream out=new BufferedOutputStream(new FileOutputStream(newFile));
      try {
        int i=in.read();
        while (i != -1) {
          out.write(i);
          i=in.read();
        }
      }
  finally {
        IoUtils.safeClose(out);
      }
    }
  finally {
      IoUtils.safeClose(in);
    }
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
  return newFile.getName();
}
