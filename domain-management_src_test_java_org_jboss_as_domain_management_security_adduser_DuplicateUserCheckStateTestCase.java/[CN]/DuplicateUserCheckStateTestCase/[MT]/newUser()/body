{
  values.setExistingUser(false);
  values.setGroups(ROLES);
  PreModificationState userCheckState=new PreModificationState(consoleMock,values);
  AssertConsoleBuilder consoleBuilder=new AssertConsoleBuilder().expectedDisplayText(MESSAGES.aboutToAddUser(values.getUserName(),values.getRealm())).expectedDisplayText(AddUser.NEW_LINE).expectedDisplayText(MESSAGES.isCorrectPrompt() + " " + MESSAGES.yes()+ "/"+ MESSAGES.no()+ "?").expectedDisplayText(" ").expectedInput(MESSAGES.yes()).expectedDisplayText(MESSAGES.addedUser(values.getUserName(),values.getUserFiles().get(0).getCanonicalPath())).expectedDisplayText(AddUser.NEW_LINE).expectedDisplayText(MESSAGES.addedGroups(values.getUserName(),values.getGroups(),values.getGroupFiles().get(0).getCanonicalPath())).expectedDisplayText(AddUser.NEW_LINE);
  consoleMock.setResponses(consoleBuilder);
  State nextState=userCheckState.execute();
  assertTrue(nextState instanceof ConfirmationChoice);
  nextState=nextState.execute();
  assertTrue(nextState instanceof AddUserState);
  nextState.execute();
  consoleBuilder.validate();
}
