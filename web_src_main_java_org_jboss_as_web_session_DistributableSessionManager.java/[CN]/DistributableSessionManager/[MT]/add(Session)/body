{
  if (session == null)   return;
  try {
    boolean inLockingValve=SessionReplicationContext.isLocallyActive();
    if (inLockingValve || this.valveLock.tryLock(0,TimeUnit.SECONDS)) {
      try {
        add(this.cast(session),false);
      }
  finally {
        if (!inLockingValve) {
          this.valveLock.unlock();
        }
      }
    }
 else {
      log.trace("add(): ignoring add -- Manager is not actively handling requests");
    }
  }
 catch (  InterruptedException e) {
    Thread.currentThread().interrupt();
  }
}
