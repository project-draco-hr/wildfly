{
  EnumSet<EJB3SubsystemXMLAttribute> parsedAttributes=EnumSet.noneOf(EJB3SubsystemXMLAttribute.class);
  if (requiredAttributes == null) {
    requiredAttributes=EnumSet.noneOf(EJB3SubsystemXMLAttribute.class);
  }
  for (int i=0; i < reader.getAttributeCount(); i++) {
    requireNoNamespaceAttribute(reader,i);
    final String attrValue=reader.getAttributeValue(i);
    final EJB3SubsystemXMLAttribute attribute=EJB3SubsystemXMLAttribute.forName(reader.getAttributeLocalName(i));
    if (!expectedAttributes.contains(attribute))     throw unexpectedAttribute(reader,i);
    if (!parsedAttributes.add(attribute)) {
      throw duplicateAttribute(reader,attribute.getLocalName());
    }
    requiredAttributes.remove(attribute);
    node.get(attribute.getLocalName()).set(attrValue);
  }
  if (!requiredAttributes.isEmpty()) {
    throw missingRequired(reader,requiredAttributes);
  }
}
