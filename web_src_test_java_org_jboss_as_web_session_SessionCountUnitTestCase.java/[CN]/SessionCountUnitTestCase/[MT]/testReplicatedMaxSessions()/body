{
  System.out.println("Enter testReplicatedMaxSessions");
  String warName="test" + ++managerIndex;
  JBossWebMetaData webMetaData=SessionTestUtil.createWebMetaData(1);
  for (int i=0; i < cacheContainers.length; ++i) {
    cacheContainers[i]=SessionTestUtil.createCacheContainer(false,null,false,false);
    cacheContainers[i].start();
    managers[i]=SessionTestUtil.createManager(webMetaData,warName,1,cacheContainers[i],null);
    managers[i].start();
    assertFalse("Passivation is disabled",managers[i].isPassivationEnabled());
    assertEquals("Correct max active count",1,managers[i].getMaxActiveAllowed());
    assertEquals("Correct max inactive interval",1,managers[i].getMaxInactiveInterval());
  }
  Session session=createAndUseSession(managers[0],"1",true,true);
  assertEquals("Session count correct",1,managers[0].getActiveSessionCount());
  assertEquals("Local session count correct",1,managers[0].getLocalActiveSessionCount());
  assertEquals("Session count correct",1,managers[1].getActiveSessionCount());
  assertEquals("Local session count correct",0,managers[1].getLocalActiveSessionCount());
  createAndUseSession(managers[1],"2",false,false);
  session.setMaxInactiveInterval(1);
  useSession(managers[0],"1");
  SessionTestUtil.sleepThread(managers[0].getMaxInactiveInterval() * 1000 + 100);
  createAndUseSession(managers[1],"2",true,true);
  assertEquals("Session count correct",2,managers[0].getActiveSessionCount());
  assertEquals("Local session count correct",1,managers[0].getLocalActiveSessionCount());
  assertEquals("Created session count correct",1,managers[0].getCreatedSessionCount());
  assertEquals("Expired session count correct",0,managers[0].getExpiredSessionCount());
  assertEquals("Session count correct",1,managers[1].getActiveSessionCount());
  assertEquals("Local session count correct",1,managers[0].getLocalActiveSessionCount());
  assertEquals("Created session count correct",1,managers[0].getCreatedSessionCount());
  assertEquals("Expired session count correct",0,managers[0].getExpiredSessionCount());
}
