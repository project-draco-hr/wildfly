{
  ClassLoader oldTccl=Thread.currentThread().getContextClassLoader();
  try {
    Thread.currentThread().setContextClassLoader(module.getClassLoader());
    DeploymentInfo deploymentInfo=createServletConfig();
    handleDistributable(deploymentInfo);
    handleIdentityManager(deploymentInfo);
    SessionConfigMetaData sessionConfig=mergedMetaData.getSessionConfig();
    SessionCookieConfig config=null;
    SessionCookieConfigService defaultSessionConfig=defaultSessionCookieConfig.getOptionalValue();
    if (defaultSessionConfig != null) {
      config=new SessionCookieConfigImpl();
      if (defaultSessionConfig.getName() != null) {
        config.setName(defaultSessionConfig.getName());
      }
      if (defaultSessionConfig.getDomain() != null) {
        config.setDomain(defaultSessionConfig.getDomain());
      }
      if (defaultSessionConfig.getHttpOnly() != null) {
        config.setHttpOnly(defaultSessionConfig.getHttpOnly());
      }
      if (defaultSessionConfig.getSecure() != null) {
        config.setSecure(defaultSessionConfig.getSecure());
      }
      if (defaultSessionConfig.getMaxAge() != null) {
        config.setMaxAge(defaultSessionConfig.getMaxAge());
      }
      if (defaultSessionConfig.getComment() != null) {
        config.setComment(defaultSessionConfig.getComment());
      }
    }
    if (sessionConfig != null) {
      if (sessionConfig.getSessionTimeoutSet()) {
        deploymentInfo.setDefaultSessionTimeout(sessionConfig.getSessionTimeout() * 60);
      }
      CookieConfigMetaData cookieConfig=sessionConfig.getCookieConfig();
      if (cookieConfig != null) {
        if (config == null) {
          config=new SessionCookieConfigImpl();
        }
        if (cookieConfig.getName() != null) {
          config.setName(cookieConfig.getName());
        }
        if (cookieConfig.getDomain() != null) {
          config.setDomain(cookieConfig.getDomain());
        }
        if (cookieConfig.getComment() != null) {
          config.setComment(cookieConfig.getComment());
        }
        config.setSecure(cookieConfig.getSecure());
        config.setPath(cookieConfig.getPath());
        config.setMaxAge(cookieConfig.getMaxAge());
        config.setHttpOnly(cookieConfig.getHttpOnly());
      }
    }
    if (config != null) {
      deploymentInfo.setSessionCookieConfig(config);
    }
    for (    final SetupAction action : setupActions) {
      deploymentInfo.addThreadSetupAction(new ThreadSetupAction(){
        private final Handle handle=new Handle(){
          @Override public void tearDown(){
            action.teardown(Collections.<String,Object>emptyMap());
          }
        }
;
        @Override public Handle setup(        final HttpServerExchange exchange){
          action.setup(Collections.<String,Object>emptyMap());
          return handle;
        }
      }
);
    }
    this.deploymentInfo=deploymentInfo;
  }
  finally {
    Thread.currentThread().setContextClassLoader(oldTccl);
  }
}
