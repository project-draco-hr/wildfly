{
  final List<ThreadSetupAction> setup=new ArrayList<ThreadSetupAction>();
  setup.add(new ContextClassLoaderSetupAction(deploymentInfo.getClassLoader()));
  setup.addAll(deploymentInfo.getThreadSetupActions());
  final CompositeThreadSetupAction threadSetupAction=new CompositeThreadSetupAction(setup);
  SecurityDomainContext sdc=securityDomainContextValue.getValue();
  deploymentInfo.setIdentityManager(new JAASIdentityManagerImpl(sdc,mergedMetaData.getPrincipalVersusRolesMap(),threadSetupAction));
  AuditManager auditManager=sdc.getAuditManager();
  if (auditManager != null) {
    deploymentInfo.addNotificationReceiver(new AuditNotificationReceiver(auditManager));
  }
  deploymentInfo.setConfidentialPortManager(getConfidentialPortManager());
}
