{
  req.login("guest","guest");
  Principal principal=req.getUserPrincipal();
  String moduleName=null;
  try {
    moduleName=(String)new InitialContext().lookup("java:module/ModuleName");
  }
 catch (  NamingException e) {
    throw new ServletException(e);
  }
  final Runnable runnable=new TestServletRunnable(moduleName);
  final Runnable contextualProxy=contextService.createContextualProxy(runnable,Runnable.class);
  final ExecutorService executorService=Executors.newSingleThreadExecutor();
  try {
    executorService.submit(contextualProxy).get();
  }
 catch (  Throwable e) {
    throw new ServletException(e);
  }
 finally {
    executorService.shutdown();
  }
}
