{
  final Collection<String> all=getAllCandidates(ctx);
  if (all.isEmpty()) {
    return -1;
  }
  candidates.addAll(all);
  if (buffer.isEmpty()) {
    return 0;
  }
  final String[] specified=buffer.split(",+");
  candidates.removeAll(Arrays.asList(specified));
  if (buffer.charAt(buffer.length() - 1) == ',') {
    return buffer.length();
  }
  final String chunk=specified[specified.length - 1];
  for (int i=0; i < candidates.size(); ++i) {
    if (!candidates.get(i).startsWith(chunk)) {
      candidates.remove(i);
    }
  }
  return buffer.length() - chunk.length();
}
