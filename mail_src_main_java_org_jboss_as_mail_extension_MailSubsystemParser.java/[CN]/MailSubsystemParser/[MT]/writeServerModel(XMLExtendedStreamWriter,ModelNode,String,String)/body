{
  boolean credentials=server.hasDefined(USER_NAME);
  final boolean properties=server.hasDefined(PROPERTIES);
  boolean shouldWriteEnd=false;
  if (credentials || properties) {
    writer.writeStartElement(Element.forName(elementName).getLocalName());
    shouldWriteEnd=true;
  }
 else {
    writer.writeEmptyElement(Element.forName(elementName).getLocalName());
  }
  if (name != null) {
    writer.writeAttribute(NAME,name);
  }
  SSL.marshallAsAttribute(server,false,writer);
  TLS.marshallAsAttribute(server,false,writer);
  OUTBOUND_SOCKET_BINDING_REF.marshallAsAttribute(server,false,writer);
  if (credentials) {
    writer.writeEmptyElement(Element.LOGIN.getLocalName());
    USERNAME.marshallAsAttribute(server,false,writer);
    PASSWORD.marshallAsAttribute(server,false,writer);
  }
  if (properties) {
    MailServerDefinition.PROPERTIES.marshallAsElement(server,writer);
  }
  if (shouldWriteEnd) {
    writer.writeEndElement();
  }
}
