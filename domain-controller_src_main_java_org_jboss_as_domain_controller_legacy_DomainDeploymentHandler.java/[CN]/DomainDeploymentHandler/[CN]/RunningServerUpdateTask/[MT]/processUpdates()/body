{
  try {
    logger.debugf("Applying %s updates to  %s",updates.getServerUpdates().size(),serverId);
    List<UpdateResultHandlerResponse<?>> rsps=domainController.applyUpdatesToServer(serverId,serverUpdates,allowOverallRollback);
    if (!forRollback) {
      updates.serverResults.put(serverId,rsps);
    }
    updatePolicy.recordServerResult(serverId,rsps);
    DeploymentAction lastResponseAction=null;
    for (int i=0; i < rsps.size(); i++) {
      UpdateResultHandlerResponse<?> urhr=rsps.get(i);
      boolean sendResponse=urhr.getFailureResult() != null;
      if (!sendResponse) {
        sendResponse=forRollback ? updates.isLastServerRollbackUpdateForAction(i) : updates.isLastServerUpdateForAction(i);
      }
      if (sendResponse) {
        DeploymentAction action=forRollback ? updates.getDeploymentActionForServerRollbackUpdate(i) : updates.getDeploymentActionForServerUpdate(i);
        if (action != lastResponseAction) {
          sendServerUpdateResult(action.getId(),urhr);
          lastResponseAction=action;
        }
      }
    }
  }
 catch (  Exception e) {
    logger.errorf(e,"Caught exception applying updates to %s",serverId);
  }
}
