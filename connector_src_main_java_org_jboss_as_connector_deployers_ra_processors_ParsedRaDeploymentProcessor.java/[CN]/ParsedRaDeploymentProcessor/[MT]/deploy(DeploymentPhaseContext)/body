{
  final ConnectorXmlDescriptor connectorXmlDescriptor=phaseContext.getDeploymentUnit().getAttachment(ConnectorXmlDescriptor.ATTACHMENT_KEY);
  final ManagementResourceRegistration registration;
  final ManagementResourceRegistration baseRegistration=phaseContext.getDeploymentUnit().getAttachment(DeploymentModelUtils.MUTABLE_REGISTRATION_ATTACHMENT);
  final Resource deploymentResource=phaseContext.getDeploymentUnit().getAttachment(DeploymentModelUtils.DEPLOYMENT_RESOURCE);
  if (connectorXmlDescriptor == null) {
    return;
  }
  final ServiceTarget serviceTarget=phaseContext.getServiceTarget();
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (deploymentUnit.getParent() != null) {
    registration=baseRegistration.getSubModel(PathAddress.pathAddress(PathElement.pathElement("subdeployment")));
  }
 else {
    registration=baseRegistration;
  }
  final IronJacamarXmlDescriptor ironJacamarXmlDescriptor=deploymentUnit.getAttachment(IronJacamarXmlDescriptor.ATTACHMENT_KEY);
  final Module module=deploymentUnit.getAttachment(Attachments.MODULE);
  if (module == null)   throw MESSAGES.failedToGetModuleAttachment(phaseContext.getDeploymentUnit());
  DEPLOYMENT_CONNECTOR_LOGGER.debugf("ParsedRaDeploymentProcessor: Processing=%s",deploymentUnit);
  final ClassLoader classLoader=module.getClassLoader();
  Map<ResourceRoot,Index> annotationIndexes=AnnotationIndexUtils.getAnnotationIndexes(deploymentUnit);
  ServiceBuilder builder=process(connectorXmlDescriptor,ironJacamarXmlDescriptor,classLoader,serviceTarget,annotationIndexes,deploymentUnit.getServiceName(),null);
  if (builder != null) {
    builder.addListener(new AbstractResourceAdapterDeploymentServiceListener(registration,deploymentUnit.getName(),deploymentResource){
      @Override protected void registerIronjacamar(      final ServiceController<? extends Object> controller,      final ManagementResourceRegistration subRegistration,      final Resource subsystemResource){
        try {
          subRegistration.registerSubModel(new IronJacamarResourceDefinition());
        }
 catch (        IllegalArgumentException iae) {
        }
        AS7MetadataRepository mdr=((ResourceAdapterDeploymentService)controller.getService()).getMdr();
        IronJacamarResourceCreator.INSTANCE.execute(subsystemResource,mdr);
      }
      @Override protected CommonDeployment getDeploymentMetadata(      final ServiceController<? extends Object> controller){
        return ((ResourceAdapterDeploymentService)controller.getService()).getRaDeployment();
      }
    }
);
    builder.setInitialMode(Mode.ACTIVE).install();
  }
}
