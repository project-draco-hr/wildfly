{
  final PatchDirectoryStructure structure=context.getStructure();
  final File jbossHome=structure.getInstalledImage().getJbossHome();
  final File historyDir=structure.getHistoryDir(patch.getPatchId());
  final List<PatchingRecord> records=new ArrayList<PatchingRecord>();
  for (  final ContentItem item : contentItems) {
    final File target=PatchingRecord.getTargetFile(jbossHome,item);
    final File backup=PatchingRecord.getTargetFile(historyDir,item);
    final PatchingRecord record=new PatchingRecord(item);
    record.prepare(target,backup);
    records.add(record);
  }
  final PatchContentLoader loader=context.getLoader();
  for (  final PatchingRecord record : records) {
    context.record(record);
    final File target=PatchingRecord.getTargetFile(jbossHome,record.item);
    record.execute(loader,target);
  }
}
