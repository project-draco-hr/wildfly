{
  InputStream input=deployer.getDeployment(BUNDLE_D_WAB);
  Bundle bundle=context.installBundle(BUNDLE_D_WAB,input);
  try {
    Assert.assertEquals("INSTALLED",Bundle.INSTALLED,bundle.getState());
    try {
      QName serviceName=new QName("http://osgi.smoke.test.as.jboss.org","EndpointService");
      Service service=Service.create(getWsdl("/bundle-d"),serviceName);
      Endpoint port=service.getPort(Endpoint.class);
      port.echo("Foo");
      Assert.fail("WebServiceException expected");
    }
 catch (    WebServiceException ex) {
    }
    try {
      bundle.start();
      Assert.fail("BundleException expected");
    }
 catch (    BundleException ex) {
    }
    Assert.assertEquals("RESOLVED",Bundle.RESOLVED,bundle.getState());
    try {
      QName serviceName=new QName("http://osgi.smoke.test.as.jboss.org","EndpointService");
      Service service=Service.create(getWsdl("/bundle-d"),serviceName);
      Endpoint port=service.getPort(Endpoint.class);
      port.echo("Foo");
      Assert.fail("WebServiceException expected");
    }
 catch (    WebServiceException ex) {
    }
    bundle.start();
    Assert.assertEquals("ACTIVE",Bundle.ACTIVE,bundle.getState());
    QName serviceName=new QName("http://osgi.smoke.test.as.jboss.org","EndpointService");
    Service service=Service.create(getWsdl("/bundle-d"),serviceName);
    Endpoint port=service.getPort(Endpoint.class);
    Assert.assertEquals("Foo",port.echo("Foo"));
  }
  finally {
    bundle.uninstall();
  }
}
