{
  requireNoAttributes(reader);
  final ExtensionContext extensionContext=new ExtensionContextImpl(reader);
  final Set<String> found=new LinkedHashSet<String>();
  while (reader.nextTag() != END_ELEMENT) {
    final String moduleName=readStringAttributeElement(reader,Attribute.MODULE.getLocalName());
    if (!found.add(moduleName)) {
      throw invalidAttributeValue(reader,0);
    }
    try {
      Module module=Module.getSystemModuleLoader().loadModule(ModuleIdentifier.fromString(moduleName));
      boolean initialized=false;
      for (      Extension extension : module.loadService(Extension.class)) {
        extension.initialize(extensionContext);
        if (!initialized) {
          initialized=true;
        }
      }
      if (!initialized) {
        throw new IllegalStateException("No META-INF/services/" + Extension.class.getName() + " found for "+ module.getIdentifier());
      }
    }
 catch (    ModuleLoadException e) {
      throw new XMLStreamException("Failed to load module",e);
    }
  }
  return found;
}
