{
  if (messageInputStream == null) {
    throw new IllegalArgumentException("Cannot read from null message inputstream");
  }
  final DataInputStream dataInputStream=new DataInputStream(messageInputStream);
  final short invocationId=dataInputStream.readShort();
  String appName=dataInputStream.readUTF();
  if (appName.isEmpty()) {
    appName=null;
  }
  final String moduleName=dataInputStream.readUTF();
  final String distinctName=dataInputStream.readUTF();
  final String beanName=dataInputStream.readUTF();
  final String viewClassName=dataInputStream.readUTF();
  final EjbDeploymentInformation ejbDeploymentInformation=this.findEJB(appName,moduleName,distinctName,beanName);
  if (ejbDeploymentInformation == null) {
    this.writeNoSuchEJBFailureMessage(channel,invocationId,appName,moduleName,distinctName,beanName,viewClassName);
    return;
  }
  final Component component=ejbDeploymentInformation.getEjbComponent();
  if (!(component instanceof StatefulSessionComponent)) {
    final String failureMessage="EJB " + beanName + " is not a Stateful Session bean in app: "+ appName+ " module: "+ moduleName+ " distinct name:"+ distinctName;
    this.writeInvocationFailure(channel,invocationId,failureMessage);
    return;
  }
  final RemotingAttachments attachments=this.readAttachments(dataInputStream);
  final StatefulSessionComponent statefulSessionComponent=(StatefulSessionComponent)component;
  final SessionID sessionID=statefulSessionComponent.createSession();
  try {
    this.writeSessionId(channel,invocationId,sessionID,attachments);
  }
 catch (  IOException ioe) {
    this.writeInvocationFailure(channel,invocationId,"Server failed to send back session id");
  }
}
