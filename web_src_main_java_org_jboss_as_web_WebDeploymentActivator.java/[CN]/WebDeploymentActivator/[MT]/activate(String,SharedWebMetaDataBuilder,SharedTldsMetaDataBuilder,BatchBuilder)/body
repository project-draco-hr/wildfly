{
  batchBuilder.addServiceValueIfNotExist(DeploymentChainProviderService.SERVICE_NAME,new DeploymentChainProviderService());
  final Value<DeploymentChain> deploymentChainValue=Values.immediateValue((DeploymentChain)new DeploymentChainImpl(WAR_DEPLOYMENT_CHAIN_SERVICE_NAME.toString()));
  final DeploymentChainService deploymentChainService=new DeploymentChainService(deploymentChainValue);
  batchBuilder.addService(WAR_DEPLOYMENT_CHAIN_SERVICE_NAME,deploymentChainService).addDependency(DeploymentChainProviderService.SERVICE_NAME,DeploymentChainProvider.class,new DeploymentChainProviderInjector<DeploymentChain>(deploymentChainValue,new WarDeploymentChainSelector(),WAR_DEPLOYMENT_CHAIN_PRIORITY));
  addDeploymentProcessor(batchBuilder,new ModuleDependencyProcessor(),ModuleDependencyProcessor.PRIORITY);
  final InjectedValue<DeploymentModuleLoader> moduleLoaderInjector=new InjectedValue<DeploymentModuleLoader>();
  addDeploymentProcessor(batchBuilder,new DeploymentModuleLoaderProcessor(moduleLoaderInjector),DeploymentModuleLoaderProcessor.PRIORITY).addDependency(DeploymentModuleLoaderService.SERVICE_NAME,DeploymentModuleLoader.class,moduleLoaderInjector);
  addDeploymentProcessor(batchBuilder,new ModuleDeploymentProcessor(),ModuleDeploymentProcessor.PRIORITY);
  addDeploymentProcessor(batchBuilder,new ModuleContextProcessor(),ModuleContextProcessor.PRIORITY);
  addDeploymentProcessor(batchBuilder,new WarStructureDeploymentProcessor(sharedWebBuilder.create(),sharedTldsBuilder.create()),WarStructureDeploymentProcessor.PRIORITY);
  addDeploymentProcessor(batchBuilder,new WarAnnotationIndexProcessor(),WarAnnotationIndexProcessor.PRIORITY);
  addDeploymentProcessor(batchBuilder,new WarModuleConfigProcessor(),WarModuleConfigProcessor.PRIORITY);
  addDeploymentProcessor(batchBuilder,new WebParsingDeploymentProcessor(),WebParsingDeploymentProcessor.PRIORITY);
  addDeploymentProcessor(batchBuilder,new WebFragmentParsingDeploymentProcessor(),WebFragmentParsingDeploymentProcessor.PRIORITY);
  addDeploymentProcessor(batchBuilder,new JBossWebParsingDeploymentProcessor(),JBossWebParsingDeploymentProcessor.PRIORITY);
  addDeploymentProcessor(batchBuilder,new TldParsingDeploymentProcessor(),TldParsingDeploymentProcessor.PRIORITY);
  addDeploymentProcessor(batchBuilder,new WarClassloadingDependencyProcessor(),WarClassloadingDependencyProcessor.PRIORITY);
  addDeploymentProcessor(batchBuilder,new WarAnnotationDeploymentProcessor(),WarAnnotationDeploymentProcessor.PRIORITY);
  addDeploymentProcessor(batchBuilder,new ServletContainerInitializerDeploymentProcessor(),ServletContainerInitializerDeploymentProcessor.PRIORITY);
  addDeploymentProcessor(batchBuilder,new WarMetaDataProcessor(),WarMetaDataProcessor.PRIORITY);
  addDeploymentProcessor(batchBuilder,new WarDeploymentProcessor(defaultHost),WarDeploymentProcessor.PRIORITY);
}
