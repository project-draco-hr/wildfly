{
  final PatchOperationTarget target;
  boolean connected=ctx.getControllerHost() != null;
  if (connected) {
    if (ctx.isDomainMode()) {
      String hostName=host.getValue(ctx.getParsedCommandLine(),true);
      target=PatchOperationTarget.createHost(hostName,ctx.getModelControllerClient());
    }
 else {
      target=PatchOperationTarget.createStandalone(ctx.getModelControllerClient());
    }
  }
 else {
    final ParsedCommandLine args=ctx.getParsedCommandLine();
    final String jbossHome=getJBossHome(args);
    final File root=new File(jbossHome);
    final List<File> modules=getFSArgument(modulePath,args,root,"modules");
    final List<File> bundles=getFSArgument(bundlePath,args,root,"bundles");
    try {
      target=PatchOperationTarget.createLocal(root,modules,bundles);
    }
 catch (    Exception e) {
      throw new CommandLineException("Unable to apply patch to local JBOSS_HOME=" + jbossHome,e);
    }
  }
  return target;
}
