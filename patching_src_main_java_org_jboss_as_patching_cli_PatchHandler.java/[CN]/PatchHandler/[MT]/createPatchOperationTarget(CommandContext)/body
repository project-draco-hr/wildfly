{
  final PatchOperationTarget target;
  boolean connected=ctx.getControllerHost() != null;
  if (connected) {
    if (ctx.isDomainMode()) {
      String hostName=host.getValue(ctx.getParsedCommandLine(),true);
      target=PatchOperationTarget.createHost(hostName,ctx.getModelControllerClient());
    }
 else {
      target=PatchOperationTarget.createStandalone(ctx.getModelControllerClient());
    }
  }
 else {
    final String jbossHome=getJBossHome(ctx.getParsedCommandLine());
    try {
      final File root=new File(jbossHome);
      final File modules=new File(root,"modules");
      final File bundles=new File(root,"bundles");
      target=PatchOperationTarget.createLocal(root,Collections.singletonList(modules),Collections.singletonList(bundles));
    }
 catch (    Exception e) {
      throw new CommandLineException("Unable to apply patch to local JBOSS_HOME=" + jbossHome,e);
    }
  }
  return target;
}
