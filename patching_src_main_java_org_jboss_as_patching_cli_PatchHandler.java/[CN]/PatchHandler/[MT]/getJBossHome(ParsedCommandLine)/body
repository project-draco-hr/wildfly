{
  final String targetDistro=distribution.getValue(args);
  if (targetDistro != null) {
    return targetDistro;
  }
  final String env="JBOSS_HOME";
  String resolved;
  if (System.getSecurityManager() == null) {
    resolved=System.getenv(env);
  }
 else {
    resolved=(String)AccessController.doPrivileged(new PrivilegedAction<Object>(){
      public Object run(){
        return System.getenv(env);
      }
    }
);
  }
  if (resolved == null) {
    if (System.getSecurityManager() == null) {
      resolved=System.getProperty("jboss.home.dir");
    }
 else {
      resolved=(String)AccessController.doPrivileged(new PrivilegedAction<Object>(){
        public Object run(){
          return System.getProperty("jboss.home.dir");
        }
      }
);
    }
  }
  if (resolved == null) {
    throw new RuntimeException("failed to resolve the home.dir use the --distribution attribute to point to the home.dir");
  }
  final File home=new File(resolved);
  final File modules=new File(home,"modules");
  if (!modules.isDirectory()) {
    throw new RuntimeException("failed to resolve the home.dir use the --distribution attribute to point to the home.dir: " + resolved);
  }
  return resolved;
}
