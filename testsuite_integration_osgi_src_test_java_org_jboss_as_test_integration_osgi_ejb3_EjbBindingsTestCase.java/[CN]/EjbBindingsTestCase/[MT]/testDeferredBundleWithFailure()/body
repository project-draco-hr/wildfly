{
  InputStream input=deployer.getDeployment(EJB3_BUNDLE_B_JAR);
  Bundle bundle=context.installBundle(EJB3_BUNDLE_B_JAR,input);
  try {
    Assert.assertEquals("INSTALLED",Bundle.INSTALLED,bundle.getState());
    try {
      bundle.start();
      Assert.fail("BundleException expected");
    }
 catch (    BundleException e) {
    }
    Assert.assertEquals("RESOLVED",Bundle.RESOLVED,bundle.getState());
    bundle.start();
    Assert.assertEquals("ACTIVE",Bundle.ACTIVE,bundle.getState());
    ServiceReference<?> sref=context.getServiceReference(Callable.class.getName());
    Callable<Boolean> service=(Callable<Boolean>)context.getService(sref);
    Assert.assertTrue(service.call());
  }
  finally {
    deployer.undeploy(EJB3_BUNDLE_A_JAR);
  }
}
