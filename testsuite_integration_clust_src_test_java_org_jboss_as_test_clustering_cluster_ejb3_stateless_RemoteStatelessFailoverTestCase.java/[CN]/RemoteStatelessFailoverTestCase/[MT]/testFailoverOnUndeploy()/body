{
  undeploy(DEPLOYMENT_2);
  EJBClientContextSelector.setup(CLIENT_PROPERTIES);
  try {
    ViewChangeListener listener=context.lookupStateless(ViewChangeListenerBean.class,ViewChangeListener.class);
    this.establishView(listener,NODES[0]);
    Stateless bean=context.lookupStateless(StatelessBean.class,Stateless.class);
    assertEquals(NODES[0],bean.getNodeName());
    deploy(DEPLOYMENT_2);
    this.establishView(listener,NODES);
    List<String> results=new ArrayList<String>(10);
    for (int i=0; i < 10; ++i) {
      results.add(bean.getNodeName());
    }
    for (    String NODE : NODES) {
      int frequency=Collections.frequency(results,NODE);
      Assert.assertTrue(String.valueOf(frequency),frequency > 0);
    }
    undeploy(DEPLOYMENT_1);
    this.establishView(listener,NODES[1]);
    assertEquals(NODES[1],bean.getNodeName());
  }
  finally {
    EJBClientContext.getCurrent().close();
  }
}
