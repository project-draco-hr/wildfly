{
  this.start(0);
  this.deploy(0);
  final ContextSelector<EJBClientContext> selector=EJBClientContextSelector.setup(CLIENT_PROPERTIES);
  try {
    Stateless bean=context.lookupStateless(StatelessBean.class,Stateless.class);
    assertEquals(NODES[0],bean.getNodeName());
    this.start(1);
    this.deploy(1);
    Thread.sleep(GRACE_TIME_TO_MEMBERSHIP_CHANGE);
    List<String> results=new ArrayList<String>(10);
    for (int i=0; i < 10; ++i) {
      results.add(bean.getNodeName());
    }
    for (int i=0; i < NODES.length; ++i) {
      int frequency=Collections.frequency(results,NODES[i]);
      Assert.assertTrue(String.valueOf(frequency),frequency > 0);
    }
    this.stop(0);
    assertEquals(NODES[1],bean.getNodeName());
  }
  finally {
    if (selector != null) {
      EJBClientContext.setSelector(selector);
    }
    for (int i=0; i < NODES.length; ++i) {
      this.undeploy(i);
      this.stop(i);
    }
  }
}
