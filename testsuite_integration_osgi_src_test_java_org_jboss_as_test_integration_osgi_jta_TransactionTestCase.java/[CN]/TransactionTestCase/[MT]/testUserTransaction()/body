{
  bundle.start();
  BundleContext context=bundle.getBundleContext();
  Transactional txObj=new Transactional();
  UserTransaction userTx=FrameworkUtils.waitForService(context,UserTransaction.class);
  assertNotNull("UserTransaction not null",userTx);
  userTx.begin();
  try {
    TransactionManager tm=FrameworkUtils.waitForService(context,TransactionManager.class);
    assertNotNull("TransactionManager not null",tm);
    Transaction tx=tm.getTransaction();
    assertNotNull("Transaction not null",tx);
    tx.registerSynchronization(txObj);
    txObj.setMessage("Donate $1.000.000");
    assertNull("Uncommited message null",txObj.getMessage());
    userTx.commit();
  }
 catch (  Exception ex) {
    userTx.setRollbackOnly();
    throw ex;
  }
  assertEquals("Donate $1.000.000",txObj.getMessage());
}
