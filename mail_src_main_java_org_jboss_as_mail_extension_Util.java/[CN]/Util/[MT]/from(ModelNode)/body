{
  MailSessionConfig cfg=new MailSessionConfig();
  cfg.setJndiName(model.require(JNDI_NAME).asString());
  cfg.setUsername(model.require(USERNAME).asString());
  cfg.setPassword(model.require(PASSWORD).asString());
  cfg.setDebug(model.get(DEBUG).asBoolean(false));
  ModelNode server=model.get(SMTP_SERVER);
  cfg.setSmtpServer(new MailSessionServer(server.require(SERVER_ADDRESS).asString(),server.require(SERVER_PORT).asString()));
  if (server.hasDefined(POP3_SERVER)) {
    server=model.get(POP3_SERVER);
    cfg.setPop3Server(new MailSessionServer(server.require(SERVER_ADDRESS).asString(),server.require(SERVER_PORT).asString()));
  }
  if (server.hasDefined(IMAP_SERVER)) {
    server=model.get(IMAP_SERVER);
    cfg.setImapServer(new MailSessionServer(server.require(SERVER_ADDRESS).asString(),server.require(SERVER_PORT).asString()));
  }
  return cfg;
}
