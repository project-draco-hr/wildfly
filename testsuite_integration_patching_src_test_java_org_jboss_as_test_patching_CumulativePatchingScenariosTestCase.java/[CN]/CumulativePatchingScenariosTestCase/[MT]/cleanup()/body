{
  if (controller.isStarted(CONTAINER))   controller.stop(CONTAINER);
  final boolean success=CliUtilsForPatching.rollbackAll();
  if (IoUtils.recursiveDelete(tempDir)) {
    tempDir.deleteOnExit();
  }
  if (!success) {
    final File home=new File(PatchingTestUtil.AS_DISTRIBUTION);
    PatchingTestUtil.resetInstallationState(home,baseModuleDir);
    Assert.fail("failed to rollback all patches " + CliUtilsForPatching.info(false));
  }
}
