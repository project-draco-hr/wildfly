{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final List<DataSources> dataSourcesList=deploymentUnit.getAttachmentList(DsXmlDeploymentParsingProcessor.DATA_SOURCES_ATTACHMENT_KEY);
  for (  DataSources dataSources : dataSourcesList) {
    if (dataSources.getDrivers() != null && dataSources.getDrivers().size() > 0) {
      ConnectorLogger.DS_DEPLOYER_LOGGER.driversElementNotSupported(deploymentUnit.getName());
    }
    ServiceTarget serviceTarget=phaseContext.getServiceTarget();
    ServiceVerificationHandler verificationHandler=new ServiceVerificationHandler();
    if (dataSources.getDataSource() != null && dataSources.getDataSource().size() > 0) {
      for (      DataSource ds : dataSources.getDataSource()) {
        if (ds.isEnabled() && ds.getDriver() != null) {
          try {
            final String jndiName=cleanupJavaContext(ds.getJndiName());
            LocalDataSourceService lds=new LocalDataSourceService(jndiName);
            lds.getDataSourceConfigInjector().inject(buildDataSource(ds));
            final PathAddress addr=getDataSourceAddress(ds.getJndiName(),deploymentUnit,false);
            installManagementModel(ds,deploymentUnit,addr);
            startDataSource(lds,jndiName,ds.getDriver(),serviceTarget,verificationHandler,getRegistration(false,deploymentUnit),ds.getJndiName());
          }
 catch (          Exception e) {
            throw ConnectorMessages.MESSAGES.exceptionDeployingDatasource(e,ds.getJndiName());
          }
        }
 else {
          ConnectorLogger.DS_DEPLOYER_LOGGER.debugf("Ignoring: %s",ds.getJndiName());
        }
      }
    }
    if (dataSources.getXaDataSource() != null && dataSources.getXaDataSource().size() > 0) {
      for (      XaDataSource xads : dataSources.getXaDataSource()) {
        if (xads.isEnabled() && xads.getDriver() != null) {
          try {
            String jndiName=cleanupJavaContext(xads.getJndiName());
            XaDataSourceService xds=new XaDataSourceService(jndiName);
            xds.getDataSourceConfigInjector().inject(buildXaDataSource(xads));
            final PathAddress addr=getDataSourceAddress(xads.getJndiName(),deploymentUnit,true);
            installManagementModel(xads,deploymentUnit,addr);
            startDataSource(xds,jndiName,xads.getDriver(),serviceTarget,verificationHandler,getRegistration(false,deploymentUnit),xads.getJndiName());
          }
 catch (          Exception e) {
            throw ConnectorMessages.MESSAGES.exceptionDeployingDatasource(e,xads.getJndiName());
          }
        }
 else {
          ConnectorLogger.DS_DEPLOYER_LOGGER.debugf("Ignoring %s",xads.getJndiName());
        }
      }
    }
  }
}
