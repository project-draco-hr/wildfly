{
  final Resource root=unit.getAttachment(DeploymentModelUtils.DEPLOYMENT_RESOURCE);
synchronized (root) {
    final PathAddress subsystemAddress=PathAddress.pathAddress(PathElement.pathElement(ModelDescriptionConstants.SUBSYSTEM,DataSourcesExtension.SUBSYSTEM_NAME));
    getOrCreate(root,subsystemAddress);
    final PathAddress address;
    if (xa) {
      address=subsystemAddress.append(PathElement.pathElement(XA_DATA_SOURCE));
    }
 else {
      address=subsystemAddress.append(PathElement.pathElement(DATA_SOURCE));
    }
    ManagementResourceRegistration registration=unit.getAttachment(DeploymentModelUtils.MUTABLE_REGISTRATION_ATTACHMENT);
    ManagementResourceRegistration subModel=registration.getSubModel(address);
    if (subModel == null) {
      throw new IllegalStateException(address.toString());
    }
    return subModel;
  }
}
