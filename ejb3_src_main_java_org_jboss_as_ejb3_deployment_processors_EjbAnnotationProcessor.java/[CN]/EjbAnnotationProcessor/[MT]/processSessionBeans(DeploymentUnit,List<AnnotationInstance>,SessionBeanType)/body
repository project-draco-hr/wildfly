{
  final EEModuleDescription moduleDescription=deploymentUnit.getAttachment(org.jboss.as.ee.component.Attachments.EE_MODULE_DESCRIPTION);
  EjbJarDescription ejbJarDescription=deploymentUnit.getAttachment(EjbDeploymentAttachmentKeys.EJB_JAR_DESCRIPTION);
  if (ejbJarDescription == null) {
    ejbJarDescription=new EjbJarDescription(moduleDescription,deploymentUnit.getName().endsWith(".war"));
    deploymentUnit.putAttachment(EjbDeploymentAttachmentKeys.EJB_JAR_DESCRIPTION,ejbJarDescription);
  }
  final String applicationName=moduleDescription.getApplicationName();
  final ServiceName deploymentUnitServiceName=deploymentUnit.getServiceName();
  for (  final AnnotationInstance sessionBeanAnnotation : sessionBeanAnnotations) {
    final AnnotationTarget target=sessionBeanAnnotation.target();
    if (!(target instanceof ClassInfo)) {
      logger.warn(sessionBeanAnnotation.name() + " annotation is expected to be only on classes. " + target+ " is not a class");
      continue;
    }
    final ClassInfo sessionBeanClassInfo=(ClassInfo)target;
    final String beanClassName=sessionBeanClassInfo.name().toString();
    final String ejbName=sessionBeanClassInfo.name().local();
    final AnnotationValue nameValue=sessionBeanAnnotation.value("name");
    final String beanName=nameValue == null || nameValue.asString().isEmpty() ? ejbName : nameValue.asString();
    SessionBeanComponentDescription sessionBeanDescription=null;
switch (sessionBeanType) {
case STATELESS:
      sessionBeanDescription=new StatelessComponentDescription(beanName,beanClassName,ejbJarDescription,deploymentUnitServiceName);
    break;
case STATEFUL:
  sessionBeanDescription=new StatefulComponentDescription(beanName,beanClassName,ejbJarDescription,deploymentUnitServiceName);
break;
case SINGLETON:
sessionBeanDescription=new SingletonComponentDescription(beanName,beanClassName,ejbJarDescription,deploymentUnitServiceName);
break;
default :
throw new IllegalArgumentException("Unknown session bean type: " + sessionBeanType);
}
if (ejbJarDescription.getEEModuleDescription().getComponentByName(sessionBeanDescription.getComponentName()) == null) {
ejbJarDescription.getEEModuleDescription().addComponent(sessionBeanDescription);
}
}
}
