{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (DeploymentTypeMarker.isType(DeploymentType.EAR,deploymentUnit)) {
    return;
  }
  final CompositeIndex compositeIndex=deploymentUnit.getAttachment(Attachments.COMPOSITE_ANNOTATION_INDEX);
  if (compositeIndex == null) {
    if (logger.isTraceEnabled()) {
      logger.trace("Skipping EJB annotation processing since no composite annotation index found in unit: " + deploymentUnit);
    }
    return;
  }
  final List<AnnotationInstance> slsbAnnotations=compositeIndex.getAnnotations(STATELESS_ANNOTATION);
  if (!slsbAnnotations.isEmpty()) {
    processSessionBeans(deploymentUnit,slsbAnnotations,SessionBeanType.STATELESS);
    EjbDeploymentMarker.mark(deploymentUnit);
  }
  final List<AnnotationInstance> sfsbAnnotations=compositeIndex.getAnnotations(STATEFUL_ANNOTATION);
  if (!sfsbAnnotations.isEmpty()) {
    processSessionBeans(deploymentUnit,sfsbAnnotations,SessionBeanType.STATEFUL);
    EjbDeploymentMarker.mark(deploymentUnit);
  }
  final List<AnnotationInstance> sbAnnotations=compositeIndex.getAnnotations(SINGLETON_ANNOTATION);
  if (!sbAnnotations.isEmpty()) {
    processSessionBeans(deploymentUnit,sbAnnotations,SessionBeanType.SINGLETON);
    EjbDeploymentMarker.mark(deploymentUnit);
  }
}
