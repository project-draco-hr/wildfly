{
  BufferedReader reader=new BufferedReader(new InputStreamReader(stream));
  Connection connection=datasource.getConnection();
  if (connection == null) {
    log.errorf("Cannot obtain connection");
    return;
  }
  try {
    String nextLine;
    StringBuffer nextStatement=new StringBuffer();
    while ((nextLine=reader.readLine()) != null) {
      nextLine=nextLine.trim();
      if (nextLine.startsWith("--")) {
        continue;
      }
      nextStatement.append(nextLine);
      if (nextLine.endsWith(";")) {
        String sqlStatement=nextStatement.substring(0,nextStatement.indexOf(";"));
        log.debugf("Statement to execute: '%s'",sqlStatement);
        try {
          Statement statement=connection.createStatement();
          statement.execute(sqlStatement);
          statement.close();
        }
 catch (        SQLException e) {
          String msg="Could not execute statement: %s";
          log.errorf(msg,e.getLocalizedMessage());
        }
 finally {
          nextStatement=new StringBuffer();
        }
      }
    }
  }
  finally {
    connection.close();
  }
}
