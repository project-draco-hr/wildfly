{
switch (transition) {
case STARTING_to_UP:
{
      CommonDeployment deploymentMD=((AbstractDataSourceService)controller.getService()).getDeploymentMD();
      StatisticsPlugin jdbcStats=deploymentMD.getDataSources()[0].getStatistics();
      StatisticsPlugin poolStats=deploymentMD.getDataSources()[0].getPool().getStatistics();
      int jdbcStatsSize=jdbcStats.getNames().size();
      int poolStatsSize=poolStats.getNames().size();
      if (jdbcStatsSize > 0 || poolStatsSize > 0) {
        ManagementResourceRegistration subRegistration=registration.isAllowsOverride() ? registration.registerOverrideModel(dsName,DataSourcesSubsystemProviders.OVERRIDE_DS_DESC) : registration;
        if (jdbcStatsSize > 0) {
          ManagementResourceRegistration jdbcRegistration=subRegistration.registerSubModel(JDBC_STATISTICS,new StatisticsDescriptionProvider(DataSourcesSubsystemProviders.RESOURCE_NAME,"statistics",jdbcStats));
          jdbcRegistration.setRuntimeOnly(true);
          jdbcRegistration.registerOperationHandler("clear-statistics",new ClearStatisticsHandler(jdbcStats),DataSourcesSubsystemProviders.CLEAR_STATISTICS_DESC,false);
          for (          String statName : jdbcStats.getNames()) {
            jdbcRegistration.registerMetric(statName,new PoolMetrics.ParametrizedPoolMetricsHandler(jdbcStats));
          }
          resource.registerChild(JDBC_STATISTICS,new PlaceholderResource.PlaceholderResourceEntry(JDBC_STATISTICS));
        }
        if (poolStatsSize > 0) {
          ManagementResourceRegistration poolRegistration=subRegistration.registerSubModel(POOL_STATISTICS,new StatisticsDescriptionProvider(DataSourcesSubsystemProviders.RESOURCE_NAME,"statistics",poolStats));
          poolRegistration.setRuntimeOnly(true);
          poolRegistration.registerOperationHandler("clear-statistics",new ClearStatisticsHandler(poolStats),DataSourcesSubsystemProviders.CLEAR_STATISTICS_DESC,false);
          for (          String statName : poolStats.getNames()) {
            poolRegistration.registerMetric(statName,new PoolMetrics.ParametrizedPoolMetricsHandler(poolStats));
          }
          resource.registerChild(POOL_STATISTICS,new PlaceholderResource.PlaceholderResourceEntry(JDBC_STATISTICS));
        }
      }
      break;
    }
case UP_to_STOP_REQUESTED:
{
    ManagementResourceRegistration subRegistration=registration.getOverrideModel(dsName);
    if (subRegistration != null) {
      subRegistration.unregisterSubModel(JDBC_STATISTICS);
      subRegistration.unregisterSubModel(POOL_STATISTICS);
      registration.unregisterOverrideModel(dsName);
    }
    if (resource.hasChild(JDBC_STATISTICS)) {
      resource.removeChild(JDBC_STATISTICS);
    }
    if (resource.hasChild(POOL_STATISTICS)) {
      resource.removeChild(POOL_STATISTICS);
    }
    break;
  }
}
}
