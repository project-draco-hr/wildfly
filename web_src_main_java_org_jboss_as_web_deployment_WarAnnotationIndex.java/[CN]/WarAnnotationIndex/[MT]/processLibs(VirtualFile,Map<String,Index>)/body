{
  final VirtualFile webInfLib=deploymentRoot.getChild(WarStructureDeploymentProcessor.WEB_INF_LIB);
  if (webInfLib.exists()) {
    try {
      final List<VirtualFile> archives=webInfLib.getChildren(WarStructureDeploymentProcessor.DEFAULT_WEB_INF_LIB_FILTER);
      for (      final VirtualFile archive : archives) {
        final Indexer indexer=new Indexer();
        final List<VirtualFile> classChildren=archive.getChildren(new SuffixMatchFilter(".class",VisitorAttributes.RECURSE_LEAVES_ONLY));
        for (        VirtualFile classFile : classChildren) {
          InputStream inputStream=null;
          try {
            inputStream=classFile.openStream();
            indexer.index(inputStream);
          }
  finally {
            VFSUtils.safeClose(inputStream);
          }
        }
        indexes.put(archive.getName(),indexer.complete());
      }
    }
 catch (    Exception e) {
      throw new DeploymentUnitProcessingException("Failed to index deployment root for annotations");
    }
  }
}
