{
  DefaultHttpClient httpclient=new DefaultHttpClient();
  HttpResponse response;
  HttpGet httpget=new HttpGet(URL);
  response=httpclient.execute(httpget);
  HttpEntity entity=response.getEntity();
  if (entity != null)   EntityUtils.consume(entity);
  StatusLine statusLine=response.getStatusLine();
  System.out.println("Login form get: " + statusLine);
  assertEquals(200,statusLine.getStatusCode());
  System.out.println("Initial set of cookies:");
  List<Cookie> cookies=httpclient.getCookieStore().getCookies();
  if (cookies.isEmpty()) {
    System.out.println("None");
  }
 else {
    for (int i=0; i < cookies.size(); i++) {
      System.out.println("- " + cookies.get(i).toString());
    }
  }
  HttpPost httpost=new HttpPost(URL + "/j_security_check");
  List<NameValuePair> nvps=new ArrayList<NameValuePair>();
  nvps.add(new BasicNameValuePair("j_username",user));
  nvps.add(new BasicNameValuePair("j_password",pass));
  httpost.setEntity(new UrlEncodedFormEntity(nvps,HTTP.UTF_8));
  response=httpclient.execute(httpost);
  int statusCode=response.getStatusLine().getStatusCode();
  assertTrue((302 == statusCode) || (200 == statusCode));
  if (302 == statusCode) {
    entity=response.getEntity();
    if (entity != null) {
      EntityUtils.consume(entity);
    }
    Header locationHeader=response.getFirstHeader("Location");
    String location=locationHeader.getValue();
    HttpGet httpGet=new HttpGet(location);
    response=httpclient.execute(httpGet);
  }
  return response;
}
