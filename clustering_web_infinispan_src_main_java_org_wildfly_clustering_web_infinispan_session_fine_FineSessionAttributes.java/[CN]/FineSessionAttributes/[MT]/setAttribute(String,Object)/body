{
  if (attribute == null) {
    return this.removeAttribute(name);
  }
  final SessionAttributeCacheKey key=this.createKey(name);
  final V value=this.marshaller.write(attribute);
  Operation<SessionAttributeCacheKey,V,V> operation=new Operation<SessionAttributeCacheKey,V,V>(){
    @Override public V invoke(    Cache<SessionAttributeCacheKey,V> cache){
      return cache.put(key,value);
    }
  }
;
  return this.marshaller.read(this.invoker.invoke(this.cache,operation,this.attributes.add(name) ? new Flag[]{Flag.IGNORE_RETURN_VALUES,Flag.SKIP_LOCKING} : new Flag[]{Flag.SKIP_LOCKING}));
}
