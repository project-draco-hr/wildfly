{
  ServerDeploymentActionResult actionResult;
  try {
    DeploymentPlanBuilder builder=deploymentManager.newDeploymentPlan();
    builder=builder.add(runtimeName,input).andReplace(replaceName);
    if (removeUndeployed) {
      builder=((ReplaceDeploymentPlanBuilder)builder).andRemoveUndeployed();
    }
    DeploymentPlan plan=builder.build();
    DeploymentAction action=builder.getLastAction();
    Future<ServerDeploymentPlanResult> future=deploymentManager.execute(plan);
    ServerDeploymentPlanResult planResult=future.get();
    actionResult=planResult.getDeploymentActionResult(action.getId());
  }
 catch (  Exception ex) {
    throw new ServerDeploymentException(ex);
  }
  if (actionResult.getDeploymentException() != null)   throw new ServerDeploymentException(actionResult);
  return runtimeName;
}
