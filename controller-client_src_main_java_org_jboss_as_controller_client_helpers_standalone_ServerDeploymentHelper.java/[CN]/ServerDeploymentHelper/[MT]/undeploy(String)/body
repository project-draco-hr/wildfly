{
  ServerDeploymentPlanResult planResult;
  List<DeploymentAction> actions=new ArrayList<DeploymentAction>();
  try {
    DeploymentPlanBuilder builder=deploymentManager.newDeploymentPlan();
    UndeployDeploymentPlanBuilder undeployBuilder=builder.undeploy(runtimeName);
    actions.add(undeployBuilder.getLastAction());
    builder=undeployBuilder.andRemoveUndeployed();
    actions.add(builder.getLastAction());
    DeploymentPlan plan=builder.build();
    Future<ServerDeploymentPlanResult> future=deploymentManager.execute(plan);
    planResult=future.get();
  }
 catch (  Exception ex) {
    throw new ServerDeploymentException(ex);
  }
  for (  DeploymentAction action : actions) {
    ServerDeploymentActionResult actionResult=planResult.getDeploymentActionResult(action.getId());
    if (actionResult.getDeploymentException() != null)     throw new ServerDeploymentException(actionResult);
  }
}
