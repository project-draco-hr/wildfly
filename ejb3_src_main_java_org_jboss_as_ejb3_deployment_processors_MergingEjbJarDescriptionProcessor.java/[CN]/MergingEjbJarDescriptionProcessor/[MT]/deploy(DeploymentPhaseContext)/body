{
  DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (!EjbDeploymentMarker.isEjbDeployment(deploymentUnit)) {
    return;
  }
  EjbJarDescription ddBasedEjbJarDescription=deploymentUnit.getAttachment(EjbDeploymentAttachmentKeys.DD_EJB_JAR_DESCRIPTION);
  EjbJarDescription annotationBasedEjbJarDescription=deploymentUnit.getAttachment(EjbDeploymentAttachmentKeys.ANNOTATION_EJB_JAR_DESCRIPTION);
  if (ddBasedEjbJarDescription == null && annotationBasedEjbJarDescription == null) {
    return;
  }
  EjbJarDescription mergedEjbJarDescription=null;
  if (ddBasedEjbJarDescription == null) {
    mergedEjbJarDescription=annotationBasedEjbJarDescription;
  }
 else   if (annotationBasedEjbJarDescription == null) {
    mergedEjbJarDescription=ddBasedEjbJarDescription;
  }
 else {
    mergedEjbJarDescription=new EjbJarDescription();
    EjbJarDescriptionMergingUtil.merge(mergedEjbJarDescription,annotationBasedEjbJarDescription,ddBasedEjbJarDescription);
  }
  deploymentUnit.putAttachment(EjbDeploymentAttachmentKeys.MERGED_EJB_JAR_DESCRIPTION,mergedEjbJarDescription);
  final EEModuleDescription moduleDescription=deploymentUnit.getAttachment(org.jboss.as.ee.component.Attachments.EE_MODULE_DESCRIPTION);
  for (  SessionBeanComponentDescription sessionBean : mergedEjbJarDescription.getSessionBeans()) {
    moduleDescription.addComponent(sessionBean);
  }
  for (  MessageDrivenComponentDescription mdb : mergedEjbJarDescription.getMessageDrivenBeans()) {
    moduleDescription.addComponent(mdb);
  }
}
