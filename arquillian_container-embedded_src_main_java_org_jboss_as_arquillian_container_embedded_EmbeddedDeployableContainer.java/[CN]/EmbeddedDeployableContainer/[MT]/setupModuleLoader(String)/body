{
  if (modulePath == null || modulePath.isEmpty()) {
    throw new IllegalStateException("Module path must be defined in the configuration");
  }
  final File modulesDir=new File(modulePath);
  if (!modulesDir.isDirectory()) {
    throw new IllegalStateException("Invalid modules directory: " + modulesDir);
  }
  final String classPath=SecurityActions.getSystemProperty(SYSPROP_KEY_CLASS_PATH);
  try {
    SecurityActions.clearSystemProperty(SYSPROP_KEY_CLASS_PATH);
    SecurityActions.setSystemProperty(SYSPROP_KEY_MODULE_PATH,modulesDir.getAbsolutePath());
    final ModuleLoader moduleLoader=Module.getBootModuleLoader();
    return moduleLoader;
  }
  finally {
    SecurityActions.setSystemProperty(SYSPROP_KEY_CLASS_PATH,classPath);
  }
}
