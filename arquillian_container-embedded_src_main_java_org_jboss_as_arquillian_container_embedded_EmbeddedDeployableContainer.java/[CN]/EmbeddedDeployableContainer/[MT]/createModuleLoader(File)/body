{
  if (modulePath == null || !modulePath.isDirectory()) {
    throw new RuntimeException("Invalid module path: " + modulePath);
  }
  final String classPath=SecurityActions.getSystemProperty(SYSPROP_KEY_CLASS_PATH);
  try {
    SecurityActions.clearSystemProperty(SYSPROP_KEY_CLASS_PATH);
    SecurityActions.setSystemProperty(SYSPROP_KEY_MODULE_PATH,modulePath.getAbsolutePath());
    final ModuleLoader moduleLoader=Module.getBootModuleLoader();
    return moduleLoader;
  }
  finally {
    SecurityActions.setSystemProperty(SYSPROP_KEY_CLASS_PATH,classPath);
  }
}
