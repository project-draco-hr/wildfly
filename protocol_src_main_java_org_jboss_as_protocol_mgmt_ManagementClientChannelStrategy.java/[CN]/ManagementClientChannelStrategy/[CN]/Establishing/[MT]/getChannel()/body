{
  final ProtocolChannelClient.Configuration<ManagementChannel> configuration=new ProtocolChannelClient.Configuration<ManagementChannel>();
  try {
    configuration.setEndpoint(endpoint);
    configuration.setUri(new URI("remote://" + hostName + ":"+ port));
    configuration.setChannelFactory(new ManagementChannelFactory(receiverFactory.createReceiver()));
    client=ProtocolChannelClient.create(configuration);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
  boolean ok=false;
  try {
    try {
      client.connect(callbackHandler,saslOptions);
    }
 catch (    ConnectException e) {
      throw e;
    }
    channel=client.openChannel("management");
    channel.startReceiving();
    ok=true;
  }
  finally {
    if (!ok) {
      IoUtils.safeClose(channel);
      IoUtils.safeClose(client);
    }
  }
  return channel;
}
