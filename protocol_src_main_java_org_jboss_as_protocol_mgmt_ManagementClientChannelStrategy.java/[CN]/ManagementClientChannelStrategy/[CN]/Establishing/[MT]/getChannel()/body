{
  AccessController.doPrivileged(new PrivilegedAction<Object>(){
    public Object run(){
      if (Security.getProvider(saslProvider.getName()) == null) {
        Security.insertProviderAt(saslProvider,1);
      }
      return null;
    }
  }
);
  final ProtocolChannelClient.Configuration<ManagementChannel> configuration=new ProtocolChannelClient.Configuration<ManagementChannel>();
  try {
    addConfigurationProperties(configuration);
    configuration.setUri(new URI("remote://" + hostName + ":"+ port));
    configuration.setChannelFactory(new ManagementChannelFactory());
    configuration.setConnectTimeoutProperty(CONNECT_TIME_OUT_PROPERTY);
    client=ProtocolChannelClient.create(configuration);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
  boolean ok=false;
  try {
    try {
      client.connect(callbackHandler);
    }
 catch (    ConnectException e) {
      throw MESSAGES.couldNotConnect(configuration.getUri(),configuration.getConnectTimeout(),CONNECT_TIME_OUT_PROPERTY);
    }
    channel=client.openChannel("management");
    channel.setOperationHandler(handler);
    channel.startReceiving();
    ok=true;
  }
  finally {
    if (!ok) {
      IoUtils.safeClose(channel);
      IoUtils.safeClose(client);
    }
  }
  return channel;
}
