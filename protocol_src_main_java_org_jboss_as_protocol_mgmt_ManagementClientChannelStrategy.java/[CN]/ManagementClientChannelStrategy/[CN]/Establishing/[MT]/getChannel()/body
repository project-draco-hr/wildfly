{
  try {
    final ProtocolChannelClient.Configuration<ManagementChannel> configuration=new ProtocolChannelClient.Configuration<ManagementChannel>();
    addConfigurationProperties(configuration);
    configuration.setUri(new URI("remote://" + hostName + ":"+ port));
    configuration.setChannelFactory(new ManagementChannelFactory());
    client=ProtocolChannelClient.create(configuration);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
  boolean ok=false;
  try {
    client.connect();
    channel=client.openChannel("management");
    channel.setOperationHandler(handler);
    channel.startReceiving();
    ok=true;
  }
  finally {
    if (!ok) {
      IoUtils.safeClose(channel);
      IoUtils.safeClose(client);
    }
  }
  return channel;
}
