{
  log.infof("Starting '%s' Security Realm Service",name);
  if (authentication != null && authentication.hasDefined(USERS)) {
    callbackHandler=new UserDomainCallbackHandler(name,authentication.require(USERS));
  }
 else   if (authentication != null && authentication.hasDefined(LDAP)) {
    callbackHandler=new UserLdapCallbackHandler(connectionManagerValue.getValue(),authentication.require(LDAP));
  }
 else {
    callbackHandler=new DomainCallbackHandler(){
      public Class[] getSupportedCallbacks(){
        return new Class[0];
      }
      public void handle(      Callback[] callbacks) throws IOException, UnsupportedCallbackException {
        throw new IllegalStateException("No authentication mechanism defined in security realm.");
      }
    }
;
  }
}
