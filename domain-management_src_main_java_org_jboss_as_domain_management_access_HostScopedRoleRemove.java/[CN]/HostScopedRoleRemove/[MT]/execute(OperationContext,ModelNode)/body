{
  final ModelNode model=Resource.Tools.readModel(context.readResource(PathAddress.EMPTY_ADDRESS));
  context.removeResource(PathAddress.EMPTY_ADDRESS);
  context.addStep(new OperationStepHandler(){
    @Override public void execute(    OperationContext context,    ModelNode operation) throws OperationFailedException {
      final String roleName=PathAddress.pathAddress(operation.require(ModelDescriptionConstants.OP_ADDR)).getLastElement().getValue();
      final String baseRole=ServerGroupScopedRoleResourceDefinition.BASE_ROLE.resolveModelAttribute(context,model).asString();
      ModelNode hostsAttribute=HostScopedRolesResourceDefinition.HOSTS.resolveModelAttribute(context,model);
      final List<ModelNode> hostNodes=hostsAttribute.isDefined() ? hostsAttribute.asList() : Collections.<ModelNode>emptyList();
      authorizerConfiguration.removeScopedRole(roleName);
      constraintMap.remove(roleName);
      context.completeStep(new OperationContext.RollbackHandler(){
        @Override public void handleRollback(        OperationContext context,        ModelNode operation){
          HostScopedRoleAdd.addScopedRole(roleName,baseRole,hostNodes,authorizerConfiguration,constraintMap);
        }
      }
);
    }
  }
,OperationContext.Stage.RUNTIME);
  context.stepCompleted();
}
