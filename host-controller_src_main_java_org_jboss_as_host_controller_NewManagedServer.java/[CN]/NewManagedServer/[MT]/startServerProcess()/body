{
synchronized (lock) {
    setState(ServerState.BOOTING);
    final int portOffSet=bootConfiguration.getPortOffSet();
    final List<ModelNode> bootUpdates=bootConfiguration.getBootUpdates();
    processControllerClient.startProcess(serverProcessName);
    ServiceActivator hostControllerCommActivator=NewHostCommunicationServices.createServerCommuncationActivator(serverProcessName,managementSocket);
    ServerStartTask startTask=new ServerStartTask(serverName,portOffSet,Collections.<ServiceActivator>singletonList(hostControllerCommActivator),bootUpdates);
    final Marshaller marshaller=MARSHALLER_FACTORY.createMarshaller(CONFIG);
    final OutputStream os=processControllerClient.sendStdin(serverProcessName);
    marshaller.start(Marshalling.createByteOutput(os));
    marshaller.writeObject(startTask);
    marshaller.finish();
    marshaller.close();
    os.close();
    setState(ServerState.STARTING);
  }
}
