{
  BundleInfo info=BundleInfoAttachment.getBundleInfoAttachment(context);
  if (info != null)   return;
  VirtualFile virtualFile=VirtualFileAttachment.getVirtualFileAttachment(context);
  Manifest manifest=ManifestAttachment.getManifestAttachment(context);
  if (manifest == null) {
    try {
      manifest=VFSUtils.getManifest(virtualFile);
      if (manifest != null)       ManifestAttachment.attachManifest(context,manifest);
    }
 catch (    IOException ex) {
      throw new DeploymentUnitProcessingException("Cannot read manifest from: " + virtualFile);
    }
  }
  if (BundleInfo.isValidateBundleManifest(manifest)) {
    try {
      String location=InstallBundleInitiatorService.getLocation(serviceContainer,context.getName());
      info=BundleInfo.createBundleInfo(AbstractVFS.adapt(virtualFile),location);
      BundleInfoAttachment.attachBundleInfo(context,info);
    }
 catch (    BundleException ex) {
      throw new DeploymentUnitProcessingException("Cannot create bundle deployment from: " + virtualFile);
    }
  }
}
