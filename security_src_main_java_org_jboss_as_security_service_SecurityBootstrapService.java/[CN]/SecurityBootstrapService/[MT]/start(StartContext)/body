{
  if (log.isDebugEnabled())   log.debug("Starting SecurityBootstrapService");
  try {
    oldPolicy=Policy.getPolicy();
    String provider=SecurityActions.getSystemProperty(JACC_POLICY_PROVIDER,"org.jboss.security.jacc.DelegatingPolicy");
    Class<?> providerClass=SecurityActions.loadClass(provider);
    try {
      Class<?>[] ctorSig={Policy.class};
      Constructor<?> ctor=providerClass.getConstructor(ctorSig);
      Object[] ctorArgs={oldPolicy};
      jaccPolicy=(Policy)ctor.newInstance(ctorArgs);
    }
 catch (    NoSuchMethodException e) {
      log.debug("Provider does not support ctor(Policy)");
      try {
        jaccPolicy=(Policy)providerClass.newInstance();
      }
 catch (      Exception e1) {
        throw new StartException(e1);
      }
    }
catch (    Exception e) {
      throw new StartException(e);
    }
    Policy.setPolicy(jaccPolicy);
    jaccPolicy.refresh();
    SubjectPolicyContextHandler handler=new SubjectPolicyContextHandler();
    PolicyContext.registerHandler(SecurityConstants.SUBJECT_CONTEXT_KEY,handler,true);
    CallbackHandlerPolicyContextHandler chandler=new CallbackHandlerPolicyContextHandler();
    PolicyContext.registerHandler(CallbackHandlerPolicyContextHandler.CALLBACK_HANDLER_KEY,chandler,true);
    if (securityProperty != null) {
      Enumeration<Object> keys=securityProperty.keys();
      while (keys.hasMoreElements()) {
        String key=(String)keys.nextElement();
        String value=securityProperty.getProperty(key);
        SecurityActions.setSecurityProperty(key,value);
      }
    }
  }
 catch (  Exception e) {
    throw new StartException(e);
  }
}
