{
  long deadline=unit.toMillis(timeout) + System.currentTimeMillis();
  lock.lock();
  try {
    assert shutdown;
    while (activeCount != 0) {
      long remaining=deadline - System.currentTimeMillis();
      if (remaining <= 0) {
        return activeCount == 0;
      }
      condition.await(remaining,TimeUnit.MILLISECONDS);
    }
    return activeCount == 0;
  }
  finally {
    lock.unlock();
  }
}
