{
  ProfileElement pe=element.getProfile(profileName);
  if (pe != null && (pe.getIncludedProfiles().size() > 0 || pe.getSubsystems().size() > 0)) {
    throw new UpdateFailedException("Profile '" + profileName + "' is not empty and cannot be removed");
  }
  StringBuilder illegal=null;
  for (  String serverGroupName : element.getServerGroupNames()) {
    ServerGroupElement sge=element.getServerGroup(serverGroupName);
    if (profileName.equals(sge.getName())) {
      if (illegal == null) {
        illegal=new StringBuilder(sge.getName());
      }
 else {
        illegal.append(", ");
        illegal.append(sge.getName());
      }
    }
  }
  if (illegal != null) {
    throw new UpdateFailedException(String.format("Profile %s cannot be removed as it is still used by server groups %s",profileName,illegal.toString()));
  }
  element.removeProfile(profileName);
}
