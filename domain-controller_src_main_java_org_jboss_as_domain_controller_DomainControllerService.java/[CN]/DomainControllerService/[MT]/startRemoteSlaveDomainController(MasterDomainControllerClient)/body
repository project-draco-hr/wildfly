{
  FallbackRepository fileRepository=new FallbackRepository(localFileRepository,masterClient.getRemoteFileRepository());
  domainModel.initialiseAsSlaveDC(configurationPersister,contentRepository,fileRepository,hostRegistry.getValue());
  final DomainControllerImpl controller=new DomainControllerImpl(scheduledExecutorService.getValue(),domainModel,localHostName,localFileRepository,masterClient,hostRegistry.getValue());
  try {
    masterClient.register(hostController.getValue().getName(),mgmtInterface.getValue().getAddress(),mgmtPort,controller);
  }
 catch (  IllegalStateException e) {
    return null;
  }
  try {
    configurationPersister.store(domainModel.getDomainModel(),Collections.singleton(PathAddress.EMPTY_ADDRESS));
  }
 catch (  ConfigurationPersistenceException e) {
    log.error("Could not cache domain model",e);
  }
  return controller;
}
