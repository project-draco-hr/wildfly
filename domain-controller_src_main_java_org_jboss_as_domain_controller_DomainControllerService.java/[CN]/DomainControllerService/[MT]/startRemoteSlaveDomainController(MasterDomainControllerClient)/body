{
  FallbackRepository fileRepository=new FallbackRepository(localFileRepository,masterClient.getRemoteFileRepository());
  final DomainModelImpl domainModel=new DomainModelImpl(new ModelNode(),configurationPersister,hostController.getValue(),deploymentRepository,fileRepository,hostRegistry.getValue());
  final DomainControllerImpl controller=new DomainControllerImpl(scheduledExecutorService.getValue(),domainModel,localHostName,localFileRepository,masterClient,hostRegistry.getValue());
  try {
    masterClient.register(hostController.getValue().getName(),mgmtInterface.getValue().getAddress(),mgmtPort,controller);
  }
 catch (  IllegalStateException e) {
    return null;
  }
  try {
    configurationPersister.store(domainModel.getDomainModel());
  }
 catch (  ConfigurationPersistenceException e) {
    log.error("Could not cache domain model",e);
  }
  return controller;
}
