{
  FallbackRepository fileRepository=new FallbackRepository(localFileRepository,masterClient.getRemoteFileRepository());
  final DomainModelImpl domainModel=new DomainModelImpl(new ModelNode(),configurationPersister,hostController.getValue(),deploymentRepository,fileRepository);
  final DomainControllerSlave controller=new DomainControllerImpl(scheduledExecutorService.getValue(),domainModel,localHostName,localFileRepository,masterClient);
  try {
    masterClient.register(hostController.getValue().getName(),controller);
  }
 catch (  IllegalStateException e) {
    return null;
  }
  try {
    configurationPersister.store(domainModel.getDomainModel());
  }
 catch (  ConfigurationPersistenceException e) {
    log.error("Could not cache domain model",e);
  }
  return controller;
}
