{
  if (org.apache.tomcat.util.Constants.ENABLE_MODELER) {
    final MBeanServer mbeanServer=this.mbeanServer.getOptionalValue();
    if (mbeanServer != null) {
      Registry.getRegistry(null,null).setMBeanServer(mbeanServer);
    }
  }
  System.setProperty("catalina.home",pathInjector.getValue());
  final StandardServer server=new StandardServer();
  final StandardService service=new StandardService();
  service.setName(JBOSS_WEB);
  service.setServer(server);
  server.addService(service);
  final Engine engine=new StandardEngine();
  engine.setName(JBOSS_WEB);
  engine.setService(service);
  engine.setDefaultHost(defaultHost);
  service.setContainer(engine);
  if (useNative) {
    final AprLifecycleListener apr=new AprLifecycleListener();
    apr.setSSLEngine("on");
    server.addLifecycleListener(apr);
  }
  server.addLifecycleListener(new JasperListener());
  try {
    server.init();
    server.start();
  }
 catch (  Exception e) {
    throw new StartException(e);
  }
  this.server=server;
  this.service=service;
  this.engine=engine;
}
