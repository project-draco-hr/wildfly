{
  Engine engine=new MockEngine();
  engine.setName("jboss.web");
  Host host=new MockHost();
  host.setName("localhost");
  engine.addChild(host);
  StandardContext context=new StandardContext();
  context.setName("test");
  host.addChild(context);
  DistributableSessionManager<?> mgr=new DistributableSessionManager<OutgoingDistributableSessionData>(new MockDistributedCacheManagerFactory(),context,SessionTestUtil.createWebMetaData(10));
  context.setManager(mgr);
  mgr.start();
  mgr.getReplicationConfig().setReplicationGranularity(ReplicationGranularity.SESSION);
  ClusteredSession<?> sess=(ClusteredSession<?>)mgr.createEmptySession();
  assertTrue(sess.isOutdated());
  sess.setCreationTime(System.currentTimeMillis());
  assertFalse(sess.isOutdated());
  mgr.getReplicationConfig().setReplicationGranularity(ReplicationGranularity.ATTRIBUTE);
  sess=(ClusteredSession<?>)mgr.createEmptySession();
  assertTrue(sess.isOutdated());
  sess.setCreationTime(System.currentTimeMillis());
  assertFalse(sess.isOutdated());
}
