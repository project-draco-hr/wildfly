{
  int result=getCandidates(buffer,candidates);
  int correction=0;
  if (buffer.length() > 0) {
    final int lastSeparator=buffer.lastIndexOf(File.separatorChar);
    if (lastSeparator > 0) {
      final String path=buffer.substring(0,lastSeparator);
      final String escaped=Util.escapeString(path,ESCAPE_SELECTOR);
      correction=escaped.length() - path.length();
    }
  }
  if (candidates.size() == 1) {
    candidates.set(0,Util.escapeString(candidates.get(0),ESCAPE_SELECTOR));
  }
 else {
    Util.sortAndEscape(candidates,ESCAPE_SELECTOR);
  }
  return result + correction;
}
