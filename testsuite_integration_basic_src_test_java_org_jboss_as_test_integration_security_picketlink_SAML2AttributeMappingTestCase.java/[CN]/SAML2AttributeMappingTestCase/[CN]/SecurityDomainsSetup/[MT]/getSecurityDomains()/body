{
  List<SecurityDomain> res=new LinkedList<SecurityDomain>();
  res.add(new SecurityDomain.Builder().name(SERVER_SECURITY_DOMAIN).cacheType("default").loginModules(new SecurityModule.Builder().name(Krb5LoginConfiguration.getLoginModule()).flag(Constants.REQUIRED).options(Krb5LoginConfiguration.getOptions(KerberosServerSetupTask.getHttpServicePrincipal(managementClient),AbstractKrb5ConfServerSetupTask.HTTP_KEYTAB_FILE,true)).build()).build());
  res.add(new SecurityDomain.Builder().name(IDP).loginModules(new SecurityModule.Builder().name("SPNEGO").flag(Constants.REQUISITE).putOption("password-stacking","useFirstPass").putOption("serverSecurityDomain",SERVER_SECURITY_DOMAIN).putOption("removeRealmFromPrincipal","true").build(),new SecurityModule.Builder().name("org.jboss.security.auth.spi.LdapExtLoginModule").flag(Constants.REQUIRED).putOption("password-stacking","useFirstPass").putOption(Context.PROVIDER_URL,"ldap://" + NetworkUtils.formatPossibleIpv6Address(Utils.getCannonicalHost(managementClient)) + ":"+ KerberosServerSetupTask.LDAP_PORT).putOption("baseCtxDN","ou=People,dc=jboss,dc=org").putOption("baseFilter","(uid={0})").putOption("rolesCtxDN","ou=Roles,dc=jboss,dc=org").putOption("roleFilter","(|(objectClass=referral)(member={1}))").putOption("roleAttributeID","cn").putOption("referralUserAttributeIDToCheck","member").putOption("bindDN",KerberosServerSetupTask.SECURITY_PRINCIPAL).putOption("bindCredential",KerberosServerSetupTask.SECURITY_CREDENTIALS).putOption(Context.INITIAL_CONTEXT_FACTORY,"com.sun.jndi.ldap.LdapCtxFactory").putOption(Context.SECURITY_AUTHENTICATION,"simple").putOption(Context.REFERRAL,"follow").putOption("throwValidateError","true").putOption("roleRecursion","5").build()).mappingModules(new SecurityModule.Builder().name("org.jboss.security.mapping.providers.attribute.LdapAttributeMappingProvider").flag("attribute").putOption(Context.PROVIDER_URL,"ldap://" + NetworkUtils.formatPossibleIpv6Address(Utils.getCannonicalHost(managementClient)) + ":"+ KerberosServerSetupTask.LDAP_PORT).putOption("bindDN",KerberosServerSetupTask.SECURITY_PRINCIPAL).putOption("bindCredential",KerberosServerSetupTask.SECURITY_CREDENTIALS).putOption("baseCtxDN","ou=People,dc=jboss,dc=org").putOption("baseFilter","(uid={0})").putOption("attributeList","cn,sn").putOption("searchTimeLimit","10000").build()).build());
  res.add(new SecurityDomain.Builder().name(SP).loginModules(new SecurityModule.Builder().name("org.picketlink.identity.federation.bindings.jboss.auth.SAML2LoginModule").flag(Constants.REQUIRED).build()).build());
  return res.toArray(new SecurityDomain[0]);
}
