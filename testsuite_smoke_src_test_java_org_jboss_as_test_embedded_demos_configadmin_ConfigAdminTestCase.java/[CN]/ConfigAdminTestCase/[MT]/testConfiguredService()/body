{
  Dictionary<String,String> config=new Hashtable<String,String>();
  config.put("foo","bar");
  ConfigAdminService configAdmin=getConfigAdminService();
  configAdmin.putConfiguration(ConfiguredService.SERVICE_PID,config);
  try {
    ConfiguredService.addService(serviceContainer);
    ServiceController<?> controller=serviceContainer.getService(ConfiguredService.SERVICE_NAME);
    while (controller == null || controller.getState() != State.UP) {
      Thread.sleep(200);
      controller=serviceContainer.getService(ConfiguredService.SERVICE_NAME);
    }
    ConfiguredService service=(ConfiguredService)controller.getValue();
    assertEquals("bar",service.getConfigValue("foo"));
  }
  finally {
    configAdmin.removeConfiguration(ConfiguredService.SERVICE_PID);
  }
}
