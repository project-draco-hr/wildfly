{
  final String stubClassName=classData.getMyClass() + "_Stub";
  ClassLoader cl=SecurityActions.getContextClassLoader();
  if (cl == null) {
    cl=classData.getMyClass().getClassLoader();
  }
  if (cl == null) {
    throw EjbMessages.MESSAGES.couldNotFindClassLoaderForStub(stubClassName);
  }
  Class<?> theClass;
  try {
    theClass=cl.loadClass(stubClassName);
  }
 catch (  ClassNotFoundException e) {
    try {
      final ClassFile clazz=IIOPStubCompiler.compile(classData.getMyClass(),stubClassName);
      theClass=clazz.define(cl);
    }
 catch (    RuntimeException ex) {
      try {
        theClass=cl.loadClass(stubClassName);
      }
 catch (      ClassNotFoundException e1) {
        EjbLogger.EJB3_LOGGER.dynamicStubCreationFailed(stubClassName,ex);
        throw ex;
      }
    }
  }
  return new StubFactory(classData,theClass);
}
