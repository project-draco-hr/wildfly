{
  final ModelNode rootResource=context.getRootResource().getChild(PathElement.pathElement(ModelDescriptionConstants.SUBSYSTEM,EJB3Extension.SUBSYSTEM_NAME)).getModel();
  final boolean lite=rootResource.hasDefined(EJB3SubsystemModel.LITE) && rootResource.get(EJB3SubsystemModel.LITE).asBoolean();
  if (!lite) {
    final ModelNode pathNode=TimerServiceResourceDefinition.PATH.validateResolvedOperation(model);
    final String path=pathNode.isDefined() ? pathNode.asString() : null;
    final ModelNode relativeToNode=TimerServiceResourceDefinition.RELATIVE_TO.validateResolvedOperation(model);
    final String relativeTo=relativeToNode.isDefined() ? relativeToNode.asString() : null;
    final int coreThreadCount=TimerServiceResourceDefinition.CORE_THREADS.validateResolvedOperation(model).asInt();
    final int maxThreadCount=TimerServiceResourceDefinition.CORE_THREADS.validateResolvedOperation(model).asInt(Runtime.getRuntime().availableProcessors());
    context.addStep(new AbstractDeploymentChainStep(){
      protected void execute(      DeploymentProcessorTarget processorTarget){
        logger.debug("Configuring timers");
        ModelNode timerServiceModel=model;
        if (path != null) {
          if (relativeTo != null) {
            RelativePathService.addService(TimerServiceFactoryService.PATH_SERVICE_NAME,path,false,relativeTo,context.getServiceTarget(),newControllers,verificationHandler);
          }
 else {
            AbsolutePathService.addService(TimerServiceFactoryService.PATH_SERVICE_NAME,path,context.getServiceTarget(),newControllers,verificationHandler);
          }
        }
        processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_TIMEOUT_ANNOTATION,new TimerServiceAnnotationProcessor());
        processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_AROUNDTIMEOUT_ANNOTATION,new AroundTimeoutAnnotationParsingProcessor());
        processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_TIMER_METADATA_MERGE,new TimerMethodMergingProcessor());
        processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_TIMER_SERVICE,new TimerServiceDeploymentProcessor(coreThreadCount,maxThreadCount,true));
      }
    }
,OperationContext.Stage.RUNTIME);
  }
}
