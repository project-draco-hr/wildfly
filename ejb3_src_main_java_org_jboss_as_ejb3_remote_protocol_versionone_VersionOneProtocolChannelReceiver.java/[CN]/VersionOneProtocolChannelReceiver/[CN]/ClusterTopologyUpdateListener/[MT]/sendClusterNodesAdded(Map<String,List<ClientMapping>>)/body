{
  final DataOutputStream outputStream;
  final MessageOutputStream messageOutputStream;
  try {
    messageOutputStream=channelAssociation.acquireChannelMessageOutputStream();
  }
 catch (  Exception e) {
    throw EjbMessages.MESSAGES.failedToOpenMessageOutputStream(e);
  }
  outputStream=new DataOutputStream(messageOutputStream);
  final ClusterTopologyWriter clusterTopologyWriter=new ClusterTopologyWriter();
  try {
    EjbLogger.ROOT_LOGGER.debug(addedNodes.size() + " nodes added to cluster " + clusterName+ ", writing a protocol message to channel "+ this.channelReceiver.channelAssociation.getChannel());
    clusterTopologyWriter.writeNewNodesAdded(outputStream,clusterName,addedNodes);
  }
  finally {
    channelAssociation.releaseChannelMessageOutputStream(messageOutputStream);
    outputStream.close();
  }
}
