{
  try {
    final int header=messageInputStream.read();
    if (EjbLogger.ROOT_LOGGER.isTraceEnabled()) {
      EjbLogger.ROOT_LOGGER.trace("Got message with header 0x" + Integer.toHexString(header) + " on channel "+ channel);
    }
    final MessageHandler messageHandler=getMessageHandler((byte)header);
    if (messageHandler == null) {
      EjbLogger.ROOT_LOGGER.unsupportedMessageHeader(Integer.toHexString(header),channel);
      return;
    }
    messageHandler.processMessage(channelAssociation,messageInputStream);
    channel.receiveMessage(this);
  }
 catch (  Throwable e) {
    EjbLogger.ROOT_LOGGER.exceptionOnChannel(e,channel,messageInputStream);
    IoUtils.safeClose(channel);
  }
 finally {
    IoUtils.safeClose(messageInputStream);
  }
}
