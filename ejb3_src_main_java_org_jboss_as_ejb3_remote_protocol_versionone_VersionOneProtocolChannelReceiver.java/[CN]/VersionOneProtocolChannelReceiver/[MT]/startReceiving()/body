{
  final Channel channel=this.channelAssociation.getChannel();
  channel.addCloseHandler(new ChannelCloseHandler());
  channel.receiveMessage(this);
  this.deploymentRepository.addListener(this);
  this.clientMappingRegistryCollector.addListener(this);
  final Collection<Registry<String,List<ClientMapping>>> clusters=this.clientMappingRegistryCollector.getRegistries();
  try {
    this.sendNewClusterFormedMessage(clusters);
  }
 catch (  IOException ioe) {
    logger.warn("Could not send cluster formation message to the client on channel " + channel,ioe);
  }
  for (  final Registry<String,List<ClientMapping>> cluster : clusters) {
    final ClusterTopologyUpdateListener clusterTopologyUpdateListener=new ClusterTopologyUpdateListener(cluster,this);
    cluster.addListener(clusterTopologyUpdateListener);
    this.clusterTopologyUpdateListeners.add(clusterTopologyUpdateListener);
  }
}
