{
  lockedValidator.validate(operation);
  ThreadMXBean mbean=ManagementFactory.getThreadMXBean();
  try {
    ThreadInfo[] infos=mbean.dumpAllThreads(operation.require(PlatformMBeanConstants.LOCKED_MONITORS).asBoolean(),operation.require(PlatformMBeanConstants.LOCKED_SYNCHRONIZERS).asBoolean());
    final ModelNode result=context.getResult();
    if (infos != null) {
      result.setEmptyList();
      for (      ThreadInfo info : infos) {
        result.add(PlatformMBeanUtil.getDetypedThreadInfo(info,mbean.isThreadCpuTimeSupported()));
      }
    }
  }
 catch (  SecurityException e) {
    throw new OperationFailedException(new ModelNode().set(e.toString()));
  }
catch (  UnsupportedOperationException e) {
    throw new OperationFailedException(new ModelNode().set(e.toString()));
  }
  context.completeStep();
}
