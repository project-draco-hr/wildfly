{
  PathAddress ourAddress=PathAddress.pathAddress(operation.require(OP_ADDR));
  final Resource subsystemRootResource=context.getRootResource().navigate(ourAddress.subAddress(0,ourAddress.size() - 1));
  if (subsystemRootResource.hasChildren(CommonAttributes.GROUPING_HANDLER)) {
    throw new OperationFailedException(new ModelNode().set(MESSAGES.childResourceAlreadyExists(CommonAttributes.GROUPING_HANDLER)));
  }
  final Resource resource=context.createResource(PathAddress.EMPTY_ADDRESS);
  final ModelNode model=resource.getModel();
  for (  final AttributeDefinition attributeDefinition : CommonAttributes.GROUPING_HANDLER_ATTRIBUTES) {
    attributeDefinition.validateAndSet(operation,model);
  }
  if (context.getType() == OperationContext.Type.SERVER) {
    context.addStep(new OperationStepHandler(){
      public void execute(      OperationContext context,      ModelNode operation) throws OperationFailedException {
        ServiceRegistry registry=context.getServiceRegistry(false);
        ServiceController<?> hqService=registry.getService(MessagingServices.JBOSS_MESSAGING);
        if (hqService != null) {
          context.reloadRequired();
        }
        if (context.completeStep() == OperationContext.ResultAction.ROLLBACK) {
          context.revertReloadRequired();
        }
      }
    }
,OperationContext.Stage.RUNTIME);
  }
  context.completeStep();
}
