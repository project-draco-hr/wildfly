{
  PathAddress ourAddress=PathAddress.pathAddress(operation.require(OP_ADDR));
  final Resource subsystemRootResource=context.readResourceFromRoot(ourAddress.subAddress(0,ourAddress.size() - 1));
  if (subsystemRootResource.hasChildren(CommonAttributes.GROUPING_HANDLER)) {
    throw new OperationFailedException(new ModelNode().set(MESSAGES.childResourceAlreadyExists(CommonAttributes.GROUPING_HANDLER)));
  }
  if (context.isNormalServer()) {
    context.addStep(new OperationStepHandler(){
      public void execute(      OperationContext context,      ModelNode operation) throws OperationFailedException {
        ServiceRegistry registry=context.getServiceRegistry(false);
        final ServiceName hqServiceName=MessagingServices.getHornetQServiceName(PathAddress.pathAddress(operation.get(ModelDescriptionConstants.OP_ADDR)));
        ServiceController<?> hqService=registry.getService(hqServiceName);
        if (hqService != null) {
          context.reloadRequired();
        }
        if (context.completeStep() == OperationContext.ResultAction.ROLLBACK) {
          context.revertReloadRequired();
        }
      }
    }
,OperationContext.Stage.RUNTIME);
  }
  context.completeStep();
}
