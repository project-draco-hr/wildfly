{
  ServiceRegistry registry=context.getServiceRegistry(true);
  final ServiceName hqServiceName=MessagingServices.getHornetQServiceName(PathAddress.pathAddress(operation.get(ModelDescriptionConstants.OP_ADDR)));
  ServiceController<?> hqService=registry.getService(hqServiceName);
  if (hqService != null) {
    final HornetQServer hqServer=HornetQServer.class.cast(hqService.getValue());
    if (hqServer.getGroupingHandler() != null) {
      throw new OperationFailedException(new ModelNode().set(MessagingLogger.ROOT_LOGGER.childResourceAlreadyExists(CommonAttributes.GROUPING_HANDLER)));
    }
    if (context.isNormalServer()) {
      context.addStep(new OperationStepHandler(){
        public void execute(        OperationContext context,        ModelNode operation) throws OperationFailedException {
          context.reloadRequired();
          context.completeStep(OperationContext.RollbackHandler.REVERT_RELOAD_REQUIRED_ROLLBACK_HANDLER);
        }
      }
,OperationContext.Stage.RUNTIME);
    }
    context.stepCompleted();
  }
}
