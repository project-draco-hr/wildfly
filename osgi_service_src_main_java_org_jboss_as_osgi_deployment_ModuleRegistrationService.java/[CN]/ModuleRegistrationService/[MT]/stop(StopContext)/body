{
  log.tracef("Uninstalling deployment: %s",deployment);
  try {
    BundleManager bundleManager=injectedBundleManager.getValue();
    bundleManager.uninstallBundle(deployment);
    ServiceController<?> controller=context.getController();
    ServiceContainer serviceContainer=controller.getServiceContainer();
    controller.setMode(Mode.REMOVE);
    ServiceName serviceName=Services.JBOSS_DEPLOYMENT.append(controller.getName().getSimpleName());
    ServiceController<?> deploymentController=serviceContainer.getService(serviceName);
    if (deploymentController != null) {
      deploymentController.setMode(Mode.REMOVE);
    }
  }
 catch (  Throwable t) {
    log.errorf(t,"Failed to uninstall deployment: %s",deployment);
  }
}
