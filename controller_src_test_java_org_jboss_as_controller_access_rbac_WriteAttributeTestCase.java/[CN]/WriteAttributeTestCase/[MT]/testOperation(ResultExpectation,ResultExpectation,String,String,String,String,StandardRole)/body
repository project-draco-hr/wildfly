{
  ModelNode operation=Util.createOperation(READ_ATTRIBUTE_OPERATION,pathAddress(resourceName,FOO));
  operation.get(NAME).set(attributeName);
  ModelNode result=executeWithRoles(operation,roles);
  assertOperationResult(result,readResultExpectation);
  if (readResultExpectation == ResultExpectation.PERMITTED) {
    assertEquals(oldAttributeValue,result.get(RESULT).asString());
  }
  operation=Util.createOperation(WRITE_ATTRIBUTE_OPERATION,pathAddress(resourceName,FOO));
  operation.get(NAME).set(attributeName);
  operation.get(VALUE).set(newAttributeValue);
  result=executeWithRoles(operation,roles);
  assertOperationResult(result,writeResultExpectation);
  if (writeResultExpectation != ResultExpectation.PERMITTED) {
    return;
  }
  operation=Util.createOperation(READ_ATTRIBUTE_OPERATION,pathAddress(resourceName,FOO));
  operation.get(NAME).set(attributeName);
  result=executeWithRoles(operation,roles);
  assertOperationResult(result,readResultExpectation);
  if (readResultExpectation == ResultExpectation.PERMITTED) {
    assertEquals(newAttributeValue,result.get(RESULT).asString());
  }
}
