{
  final Transaction tx=this.getTransaction();
  if (tx != null) {
    try {
      int status=tx.getStatus();
      if (status == Status.STATUS_MARKED_ROLLBACK || status == Status.STATUS_ROLLEDBACK || status == Status.STATUS_ROLLING_BACK || status == Status.STATUS_NO_TRANSACTION || status == Status.STATUS_UNKNOWN || status == Status.STATUS_COMMITTED || isBeforeCompletion()) {
        return;
      }
      tx.registerSynchronization(new TimerCreationTransactionSynchronization(timer));
    }
 catch (    RollbackException e) {
      throw new EJBException(e);
    }
catch (    SystemException e) {
      throw new EJBException(e);
    }
  }
}
