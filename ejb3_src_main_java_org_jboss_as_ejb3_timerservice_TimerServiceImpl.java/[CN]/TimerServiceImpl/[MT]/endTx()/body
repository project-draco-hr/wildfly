{
  try {
    Transaction tx=this.transactionManager.getTransaction();
    if (tx == null) {
      throw MESSAGES.noTransactionInProgress();
    }
    if (tx.getStatus() == Status.STATUS_MARKED_ROLLBACK) {
      this.transactionManager.rollback();
    }
 else     if (tx.getStatus() == Status.STATUS_ACTIVE) {
      this.transactionManager.commit();
    }
  }
 catch (  Exception e) {
    throw MESSAGES.failToEndTransaction(e);
  }
}
