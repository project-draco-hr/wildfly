{
  final Map<VirtualFile,ResourceRoot> resourceRoots=resourceRoots(deploymentUnit);
  moduleSpec.addUserDependencies(rootDeploymentSpecification.getModuleDependencies());
  moduleSpec.addExclusions(rootDeploymentSpecification.getExclusions());
  moduleSpec.addAliases(rootDeploymentSpecification.getAliases());
  moduleSpec.addModuleSystemDependencies(rootDeploymentSpecification.getSytemDependencies());
  for (  final ResourceRoot additionalResourceRoot : rootDeploymentSpecification.getResourceRoots()) {
    final ResourceRoot existingRoot=resourceRoots.get(additionalResourceRoot.getRoot());
    if (existingRoot != null) {
      existingRoot.merge(additionalResourceRoot);
    }
 else {
      deploymentUnit.addToAttachmentList(Attachments.RESOURCE_ROOTS,additionalResourceRoot);
      ResourceRootIndexer.indexResourceRoot(additionalResourceRoot);
    }
  }
  for (  final String classFileTransformer : rootDeploymentSpecification.getClassFileTransformers()) {
    moduleSpec.addClassFileTransformer(classFileTransformer);
  }
  moduleSpec.setLocalLast(rootDeploymentSpecification.isLocalLast());
}
