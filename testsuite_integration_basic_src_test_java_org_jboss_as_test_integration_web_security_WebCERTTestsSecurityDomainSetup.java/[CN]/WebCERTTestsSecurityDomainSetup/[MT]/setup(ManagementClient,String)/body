{
  super.setup(managementClient,containerId);
  log.debug("start of the domain creation");
  ClassLoader tccl=Thread.currentThread().getContextClassLoader();
  URL keystore=tccl.getResource("security/jsse.keystore");
  URL roles=getClass().getResource("cert/roles.properties");
  final List<ModelNode> updates=new ArrayList<ModelNode>();
  PathAddress address=PathAddress.pathAddress().append(SUBSYSTEM,"security").append(SECURITY_DOMAIN,APP_SECURITY_DOMAIN);
  updates.add(Util.createAddOperation(address));
  address=address.append(Constants.AUTHENTICATION,Constants.CLASSIC);
  updates.add(Util.createAddOperation(address));
  ModelNode loginModule=Util.createAddOperation(address.append(LOGIN_MODULE,"CertificateRoles"));
  loginModule.get(CODE).set("CertificateRoles");
  loginModule.get(FLAG).set("required");
  ModelNode moduleOptions=loginModule.get(MODULE_OPTIONS);
  moduleOptions.add("securityDomain",APP_SECURITY_DOMAIN);
  moduleOptions.add("rolesProperties",roles.getPath());
  loginModule.get(OPERATION_HEADERS).get(ALLOW_RESOURCE_SERVICE_RESTART).set(true);
  updates.add(loginModule);
  address=PathAddress.pathAddress().append(SUBSYSTEM,"security").append(SECURITY_DOMAIN,APP_SECURITY_DOMAIN);
  ModelNode op=Util.createAddOperation(address.append(JSSE,Constants.CLASSIC));
  op.get(TRUSTSTORE,PASSWORD).set("changeit");
  op.get(TRUSTSTORE,URL).set(keystore.getPath());
  op.get(OPERATION_HEADERS).get(ALLOW_RESOURCE_SERVICE_RESTART).set(true);
  updates.add(op);
  op=new ModelNode();
  op.get(OP).set(ADD);
  op.get(OP_ADDR).add("socket-binding-group","standard-sockets");
  op.get(OP_ADDR).add("socket-binding","https-test");
  op.get("interface").set("public");
  op.get("port").set(8380);
  updates.add(op);
  final ModelNode composite=Util.getEmptyOperation(COMPOSITE,new ModelNode());
  final ModelNode steps=composite.get(STEPS);
  op=new ModelNode();
  op.get(OP).set(ADD);
  op.get(OP_ADDR).add(SUBSYSTEM,"undertow");
  op.get(OP_ADDR).add("server","default-server");
  op.get(OP_ADDR).add("https-listener","testConnector");
  op.get("socket-binding").set("https-test");
  op.get("enabled").set(true);
  op.get("security-realm").set("ssl-realm");
  steps.add(op);
  updates.add(composite);
  applyUpdates(managementClient.getControllerClient(),updates);
  log.debug("end of the domain creation");
}
