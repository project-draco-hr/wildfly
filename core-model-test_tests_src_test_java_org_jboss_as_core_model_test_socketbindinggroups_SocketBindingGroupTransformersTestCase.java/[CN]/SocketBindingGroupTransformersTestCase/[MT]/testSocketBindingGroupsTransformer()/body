{
  boolean below14=ModelVersion.compare(ModelVersion.create(1,4,0),modelVersion) < 0;
  KernelServicesBuilder builder=createKernelServicesBuilder(TestModelType.DOMAIN).setXmlResource(below14 ? "domain-transformers-1.3.xml" : "domain.xml");
  LegacyKernelServicesInitializer legacyInit=builder.createLegacyKernelServicesBuilder(modelVersion,testControllerVersion);
  if (below14) {
    ExcludeCommonOperations.excludeBadOps_7_1_x(legacyInit);
  }
  KernelServices mainServices=builder.build();
  Assert.assertTrue(mainServices.isSuccessfulBoot());
  KernelServices legacyServices=mainServices.getLegacyServices(modelVersion);
  Assert.assertTrue(legacyServices.isSuccessfulBoot());
  checkCoreModelTransformation(mainServices,modelVersion);
}
