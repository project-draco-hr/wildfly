{
  boolean below14=modelVersion.getMajor() == 1 && modelVersion.getMinor() <= 3;
  KernelServicesBuilder builder=createKernelServicesBuilder(TestModelType.DOMAIN).setXmlResource(below14 ? "domain-transformers-1.3.xml" : "domain.xml");
  LegacyKernelServicesInitializer legacyInit=builder.createLegacyKernelServicesBuilder(modelVersion,testControllerVersion);
  if (below14) {
    legacyInit.setDontValidateOperations();
  }
  KernelServices mainServices=builder.build();
  Assert.assertTrue(mainServices.isSuccessfulBoot());
  KernelServices legacyServices=mainServices.getLegacyServices(modelVersion);
  Assert.assertTrue(legacyServices.isSuccessfulBoot());
  checkCoreModelTransformation(mainServices,modelVersion);
}
