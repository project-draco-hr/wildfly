{
  KernelServices legacy=kernelServices.getLegacyServices(modelVersion);
  PathAddress pathAddress=PathAddress.pathAddress(PathElement.pathElement(SUBSYSTEM,mainSubsystemName));
  ModelNode desc=((KernelServicesInternal)legacy).readFullModelDescription(pathAddress.toModelNode());
  File file=new File("target/test-classes").getAbsoluteFile();
  Assert.assertTrue(file.exists());
  for (  String part : this.getClass().getPackage().getName().split("\\.")) {
    file=new File(file,part);
    if (!file.exists()) {
      file.mkdir();
    }
  }
  File dmrFile=new File(file,mainSubsystemName + "-" + modelVersion.getMajor()+ "."+ modelVersion.getMinor()+ "."+ modelVersion.getMicro()+ ".dmr");
  PrintWriter pw=new PrintWriter(dmrFile);
  try {
    desc.writeString(pw,false);
  }
  finally {
    IoUtils.safeClose(pw);
  }
}
