{
  StringConfigurationPersister persister=new StringConfigurationPersister(Collections.<ModelNode>emptyList(),testParser,true);
  ExtensionRegistry outputExtensionRegistry=new ExtensionRegistry(ProcessType.HOST_CONTROLLER,new RunningModeControl(RunningMode.NORMAL),null,null);
  outputExtensionRegistry.setSubsystemParentResourceRegistrations(MOCK_RESOURCE_REG,MOCK_RESOURCE_REG);
  outputExtensionRegistry.setWriterRegistry(persister);
  Extension extension=mainExtension.getClass().newInstance();
  extension.initialize(outputExtensionRegistry.getExtensionContext("Test",false));
  ConfigurationPersister.PersistenceResource resource=persister.store(model,Collections.<PathAddress>emptySet());
  resource.commit();
  return persister.getMarshalled();
}
