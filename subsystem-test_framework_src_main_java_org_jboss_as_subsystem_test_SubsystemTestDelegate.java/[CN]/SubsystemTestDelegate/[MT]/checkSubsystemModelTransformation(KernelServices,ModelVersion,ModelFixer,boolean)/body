{
  ModelNode legacyReadResource=Util.createOperation(ModelDescriptionConstants.READ_RESOURCE_OPERATION,PathAddress.EMPTY_ADDRESS);
  legacyReadResource.get(ModelDescriptionConstants.RECURSIVE).set(true);
  legacyReadResource.get(ModelDescriptionConstants.INCLUDE_ALIASES).set(false);
  legacyReadResource.get(ModelDescriptionConstants.INCLUDE_RUNTIME).set(false);
  legacyReadResource.get(ModelDescriptionConstants.INCLUDE_DEFAULTS).set(includeDefaults);
  ModelNode legacyModel=ModelTestUtils.checkResultAndGetContents(kernelServices.executeOperation(modelVersion,kernelServices.transformOperation(modelVersion,legacyReadResource)));
  ModelNode legacySubsystem=legacyModel.require(SUBSYSTEM);
  legacySubsystem=legacySubsystem.require(mainSubsystemName);
  if (legacyModelFixer != null) {
    legacySubsystem=legacyModelFixer.fixModel(legacySubsystem);
  }
  ModelNode transformed=kernelServices.readTransformedModel(modelVersion,includeDefaults).get(SUBSYSTEM,mainSubsystemName);
  ModelTestUtils.compare(legacySubsystem,transformed,true);
  ResourceDefinition rd=TransformerRegistry.loadSubsystemDefinitionFromFile(this.getClass(),mainSubsystemName,modelVersion);
  Assert.assertNotNull("Could not load legacy dmr for subsystem '" + mainSubsystemName + "' version: '"+ modelVersion+ "' please add it",rd);
  ManagementResourceRegistration rr=ManagementResourceRegistration.Factory.create(rd);
  ModelTestUtils.checkModelAgainstDefinition(transformed,rr);
  return legacyModel;
}
