{
  if (version.isEap()) {
    Assume.assumeTrue(EAPRepositoryReachableUtil.isReachable());
  }
  bootOperationBuilder.validateNotAlreadyBuilt();
  if (legacyControllerInitializers.containsKey(modelVersion)) {
    throw new IllegalArgumentException("There is already a legacy controller for " + modelVersion);
  }
  if (additionalInit != null) {
    if (additionalInit.getRunningMode() != RunningMode.ADMIN_ONLY) {
      throw new IllegalArgumentException("The additional initialization must have a running mode of ADMIN_ONLY, it was " + additionalInit.getRunningMode());
    }
  }
  LegacyKernelServiceInitializerImpl initializer=new LegacyKernelServiceInitializerImpl(additionalInit,version,modelVersion);
  legacyControllerInitializers.put(modelVersion,initializer);
  return initializer;
}
