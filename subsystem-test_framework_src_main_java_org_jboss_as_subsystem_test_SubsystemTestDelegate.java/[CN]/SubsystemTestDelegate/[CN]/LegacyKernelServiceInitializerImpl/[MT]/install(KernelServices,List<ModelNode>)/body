{
  if (!skipReverseCheck) {
    bootCurrentVersionWithLegacyBootOperations(bootOperations,mainServices);
  }
  classLoaderBuilder.addParentFirstClassPattern("org.jboss.as.subsystem.bridge.shared.*");
  classLoaderBuilder.addMavenResourceURL("org.wildfly:wildfly-subsystem-test-framework:" + ModelTestControllerVersion.CurrentVersion.VERSION);
  classLoaderBuilder.addMavenResourceURL("org.wildfly:wildfly-model-test:" + ModelTestControllerVersion.CurrentVersion.VERSION);
  if (testControllerVersion != ModelTestControllerVersion.MASTER) {
    String groupId=testControllerVersion.getMavenGavVersion().startsWith("7.") ? "org.jboss.as" : "org.wildfly";
    String serverArtifactId=testControllerVersion.getMavenGavVersion().startsWith("7.") ? "jboss-as-server" : "wildfly-server";
    classLoaderBuilder.addRecursiveMavenResourceURL(groupId + ":" + serverArtifactId+ ":"+ testControllerVersion.getMavenGavVersion());
    classLoaderBuilder.addParentFirstClassPattern("__redirected.*");
    classLoaderBuilder.addParentFirstClassPattern("org.jboss.modules.*");
    classLoaderBuilder.addMavenResourceURL("org.wildfly:wildfly-subsystem-test-controller-" + testControllerVersion.getTestControllerVersion() + ":"+ ModelTestControllerVersion.CurrentVersion.VERSION);
  }
  ClassLoader legacyCl=classLoaderBuilder.build();
  ScopedKernelServicesBootstrap scopedBootstrap=new ScopedKernelServicesBootstrap(legacyCl);
  return scopedBootstrap.createKernelServices(mainSubsystemName,extensionClassName != null ? extensionClassName : mainExtension.getClass().getName(),additionalInit,getOperationValidationFilter(),bootOperations,modelVersion,persistXml);
}
