{
  final VirtualFile deploymentRoot=deploymentUnit.getAttachment(Attachments.DEPLOYMENT_ROOT).getRoot();
  final VirtualFile descriptor=getDescriptor(deploymentRoot,JBOSS_EJB3_XML);
  if (descriptor == null) {
    return null;
  }
  MetaDataElementParser.DTDInfo dtdInfo=new MetaDataElementParser.DTDInfo();
  InputStream stream=open(descriptor);
  try {
    XMLStreamReader reader=getXMLStreamReader(stream,descriptor,dtdInfo);
    Map<String,AbstractMetaDataParser<?>> parsers=new HashMap<String,AbstractMetaDataParser<?>>();
    parsers.put(EJBBoundClusteringMetaDataParser.NAMESPACE_URI,new EJBBoundClusteringMetaDataParser());
    parsers.put("urn:security",new EJBBoundSecurityMetaDataParser());
    parsers.put("urn:security-role",new SecurityRoleMetaDataParser());
    parsers.put("urn:resource-adapter-binding",new EJBBoundResourceAdapterBindingMetaDataParser());
    parsers.put("urn:iiop",new IIOPMetaDataParser());
    parsers.put("urn:trans-timeout",new TransactionTimeoutMetaDataParser());
    parsers.put(EJBBoundPoolParser.NAMESPACE_URI,new EJBBoundPoolParser());
    final JBossEjb3MetaDataParser parser=new JBossEjb3MetaDataParser(parsers);
    final EjbJarMetaData ejbJarMetaData=parser.parse(reader,dtdInfo);
    return ejbJarMetaData;
  }
 catch (  XMLStreamException xmlse) {
    throw new DeploymentUnitProcessingException("Exception while parsing " + JBOSS_EJB3_XML + ": "+ descriptor.getPathName(),xmlse);
  }
 finally {
    try {
      stream.close();
    }
 catch (    IOException ioe) {
      logger.warn("Ignoring exception while closing the InputStream ",ioe);
    }
  }
}
