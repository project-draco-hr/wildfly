{
  DeploymentUnit depUnit=phaseContext.getDeploymentUnit();
  OSGiMetaData metadata=depUnit.getAttachment(OSGiConstants.OSGI_METADATA_KEY);
  Deployment dep=BundleLifecycleIntegration.getDeployment(depUnit.getName());
  if (metadata != null || dep != null)   return;
  VirtualFile virtualFile=depUnit.getAttachment(Attachments.DEPLOYMENT_ROOT).getRoot();
  VirtualFile xserviceFile=virtualFile.getChild(XSERVICE_PROPERTIES_NAME);
  if (xserviceFile.exists() == false)   return;
  try {
    Properties props=new Properties();
    props.load(xserviceFile.openStream());
    metadata=OSGiMetaDataBuilder.load(props);
  }
 catch (  IOException ex) {
    throw MESSAGES.cannotParseOSGiMetadata(ex,xserviceFile);
  }
  depUnit.putAttachment(OSGiConstants.OSGI_METADATA_KEY,metadata);
  depUnit.putAttachment(OSGiConstants.DEPLOYMENT_TYPE_KEY,DeploymentType.Module);
}
