{
  final CommandContext ctx=CommandContextFactory.getInstance().newCommandContext();
  try {
    ctx.connectController();
    ctx.handle("deploy " + cliArchiveFile.getAbsolutePath());
    String response=HttpRequest.get(getBaseURL(url) + "deployment0/SimpleServlet",10,TimeUnit.SECONDS);
    assertTrue("Invalid response: " + response,response.indexOf("SimpleServlet") >= 0);
    response=HttpRequest.get(getBaseURL(url) + "deployment1/SimpleServlet",10,TimeUnit.SECONDS);
    assertTrue("Invalid response: " + response,response.indexOf("SimpleServlet") >= 0);
    assertTrue(checkUndeployed(getBaseURL(url) + "deployment2/SimpleServlet"));
    ctx.handle("deploy " + cliArchiveFile.getAbsolutePath() + " --script=undeploy.scr");
    assertTrue(checkUndeployed(getBaseURL(url) + "deployment0/SimpleServlet"));
    assertTrue(checkUndeployed(getBaseURL(url) + "deployment1/SimpleServlet"));
  }
  finally {
    ctx.terminateSession();
  }
}
