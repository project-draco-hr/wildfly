{
  String permission=null;
  final Set<Attribute> required=EnumSet.of(Attribute.VALUE);
  final int count=reader.getAttributeCount();
  for (int i=0; i < count; i++) {
    final Attribute attribute=Attribute.of(reader.getAttributeName(i));
    required.remove(attribute);
switch (attribute) {
case VALUE:
      permission=propertyReplacer.replaceProperties(reader.getAttributeValue(i));
    break;
default :
  throw unexpectedContent(reader);
}
}
if (!required.isEmpty()) {
throw missingAttributes(reader.getLocation(),required);
}
FilePermission filePermission=new FilePermission(permission);
result.getFilePermissions().add(filePermission);
while (reader.hasNext()) {
switch (reader.nextTag()) {
case XMLStreamConstants.END_ELEMENT:
{
  return;
}
case XMLStreamConstants.START_ELEMENT:
{
final Element element=Element.of(reader.getName());
switch (element) {
case FILTER:
  parseFilter(reader,filePermission.getFilters());
break;
default :
throw unexpectedContent(reader);
}
break;
}
default :
{
throw unexpectedContent(reader);
}
}
}
throw endOfDocument(reader.getLocation());
}
