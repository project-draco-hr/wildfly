{
  String xml=readResource(resourceFileName);
  KernelServices services=super.installInController(new AdditionalInitialization(){
    @Override protected Type getType(){
      return Type.MANAGEMENT;
    }
  }
,xml);
  ModelNode model=services.readWholeModel();
  ConnectorServices.unregisterResourceIdentifiers("some.rar");
  String marshalled=services.getPersistedSubsystemXml();
  if (checkMarshalledXML)   Assert.assertEquals(normalizeXML(xml),normalizeXML(marshalled));
  services=super.installInController(new AdditionalInitialization(){
    @Override protected Type getType(){
      return Type.MANAGEMENT;
    }
  }
,marshalled);
  ModelNode modelReloaded=services.readWholeModel();
  compare(model,modelReloaded);
  assertRemoveSubsystemResources(services);
  return model;
}
