{
  final String subsystemXml=getSubsystemXml();
  final ModelVersion modelVersion=ModelVersion.create(1,1,0);
  final KernelServicesBuilder builder=createKernelServicesBuilder(createAdditionalInitialization()).setSubsystemXml(subsystemXml);
  builder.createLegacyKernelServicesBuilder(LoggingTestEnvironment.getManagementInstance(),modelVersion).addMavenResourceURL("org.jboss.as:jboss-as-logging:7.1.2.Final");
  final KernelServices kernelServices=builder.build();
  assertTrue(kernelServices.isSuccessfulBoot());
  assertTrue(kernelServices.getLegacyServices(modelVersion).isSuccessfulBoot());
  final ModelNode handlerAddress=createFileHandlerAddress("FILE").toModelNode();
  TransformedOperation transformedOperation=kernelServices.transformOperation(modelVersion,Operations.createWriteAttributeOperation(handlerAddress,CommonAttributes.ENABLED,false));
  assertEquals(AbstractHandlerDefinition.DISABLE_HANDLER.getName(),Operations.getOperationName(transformedOperation.getTransformedOperation()));
  executeTransformOperation(kernelServices,modelVersion,Operations.createWriteAttributeOperation(handlerAddress,CommonAttributes.ENABLED,false));
  transformedOperation=kernelServices.transformOperation(modelVersion,Operations.createWriteAttributeOperation(handlerAddress,CommonAttributes.ENABLED,true));
  assertEquals(AbstractHandlerDefinition.ENABLE_HANDLER.getName(),Operations.getOperationName(transformedOperation.getTransformedOperation()));
  executeTransformOperation(kernelServices,modelVersion,Operations.createWriteAttributeOperation(handlerAddress,CommonAttributes.ENABLED,true));
}
