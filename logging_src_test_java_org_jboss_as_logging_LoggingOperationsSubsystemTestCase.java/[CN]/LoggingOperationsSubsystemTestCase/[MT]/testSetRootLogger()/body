{
  KernelServices kernelServices=installInController(new LoggingAdditionalInitialization(),readResource("/operations.xml"));
  File logFile=new File(logDir,"test-fh.log");
  if (logFile.exists())   assertTrue(logFile.delete());
  addFileHandler(kernelServices,"test-logger","TRACE",logFile,false);
  ModelNode op=createOpNode("subsystem=logging","read-attribute");
  op.get("name").set("root-logger");
  ModelNode rootLogger=kernelServices.executeOperation(op);
  List<String> handlers=modelNodeAsStringList(rootLogger.get("handlers"));
  op=createOpNode("subsystem=logging","set-root-logger");
  op.get("level").set(rootLogger.get("level"));
  for (  String handler : handlers)   op.get("handlers").add(handler);
  op.get("handlers").add("test-logger");
  kernelServices.executeOperation(op);
  for (  Logger.Level lvl : Logger.Level.values())   log.log(lvl,"Test123");
  op=createOpNode("subsystem=logging","set-root-logger");
  op.get("level").set(rootLogger.get("level"));
  op.get("handlers").set(rootLogger.get("handlers"));
  kernelServices.executeOperation(op);
  removeFileHandler(kernelServices,"test-logger",false);
  String log=FileUtils.readFileToString(logFile);
  assertTrue(log.contains("Test123."));
  assertTrue(logFile.delete());
}
