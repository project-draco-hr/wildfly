{
  final int timeout=(int)TimeUnit.SECONDS.toMillis(5L);
  final ProtocolClient.Configuration config=new ProtocolClient.Configuration();
  config.setMessageHandler(new InitiatingMessageHandler<T>(this));
  config.setConnectTimeout(timeout);
  config.setReadExecutor(executorService);
  config.setSocketFactory(SocketFactory.getDefault());
  config.setServerAddress(new InetSocketAddress(address,port));
  config.setThreadFactory(threadFactory);
  final ProtocolClient protocolClient=new ProtocolClient(config);
  OutputStream dataOutput=null;
  ByteDataOutput output=null;
  try {
    final Connection connection=protocolClient.connect();
    dataOutput=connection.writeMessage();
    output=new SimpleByteDataOutput(dataOutput);
    writeRequestHeader(output);
    output.close();
    dataOutput.close();
  }
  finally {
    safeClose(output);
    safeClose(dataOutput);
  }
  return future;
}
