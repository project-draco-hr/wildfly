{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (!DeploymentTypeMarker.isType(DeploymentType.EAR,deploymentUnit)) {
    return;
  }
  final List<DeploymentUnit> appClients=new ArrayList<DeploymentUnit>();
  for (  DeploymentUnit subDeployment : deploymentUnit.getAttachmentList(org.jboss.as.server.deployment.Attachments.SUB_DEPLOYMENTS)) {
    if (DeploymentTypeMarker.isType(DeploymentType.APPLICATION_CLIENT,subDeployment)) {
      if (deploymentName != null && deploymentName.equals(subDeployment.getName())) {
        subDeployment.putAttachment(AppClientAttachments.START_APP_CLIENT,true);
        return;
      }
      appClients.add(subDeployment);
    }
  }
  if (deploymentName != null && !deploymentName.isEmpty()) {
    throw new RuntimeException("Could not find application client " + deploymentName);
  }
  if (appClients.size() == 1) {
    appClients.get(0).putAttachment(AppClientAttachments.START_APP_CLIENT,true);
  }
 else   if (appClients.isEmpty()) {
    throw new RuntimeException("Could not find application client to start");
  }
 else {
    throw new RuntimeException("More than one application client found and no app client name specified");
  }
}
