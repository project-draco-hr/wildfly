{
  final ReadableByteChannel src=Channels.newChannel(in);
  final WritableByteChannel dest=Channels.newChannel(out);
  try {
    final ByteBuffer buffer=ByteBuffer.allocate(8 * 1024);
    while (src.read(buffer) != -1) {
      buffer.flip();
      dest.write(buffer);
      buffer.compact();
    }
    buffer.flip();
    while (buffer.hasRemaining()) {
      dest.write(buffer);
    }
  }
  finally {
    safeClose(src);
    safeClose(dest);
  }
}
