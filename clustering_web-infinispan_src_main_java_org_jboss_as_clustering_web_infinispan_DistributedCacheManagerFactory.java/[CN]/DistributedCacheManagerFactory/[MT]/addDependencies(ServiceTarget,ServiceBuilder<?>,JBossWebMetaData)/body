{
  ServiceName baseServiceName=EmbeddedCacheManagerService.getServiceName(null);
  ReplicationConfig config=metaData.getReplicationConfig();
  String cacheName=(config != null) ? config.getCacheName() : null;
  ServiceName serviceName=ServiceName.parse((cacheName != null) ? cacheName : DEFAULT_CACHE_CONTAINER);
  if (!baseServiceName.isParentOf(serviceName)) {
    serviceName=baseServiceName.append(serviceName);
  }
  if (serviceName.length() < 4) {
    serviceName=serviceName.append(CacheContainer.DEFAULT_CACHE_NAME);
  }
  if (CurrentServiceContainer.getServiceContainer().getService(serviceName) == null) {
    return false;
  }
  ServiceName containerServiceName=serviceName.getParent();
  String container=containerServiceName.getSimpleName();
  ServiceName lockManagerServiceName=SharedLocalYieldingClusterLockManagerService.getServiceName(container);
  ServiceName registryServiceName=serviceName.append("registry");
synchronized (this) {
    if (CurrentServiceContainer.getServiceContainer().getService(lockManagerServiceName) == null) {
      new CoreGroupCommunicationServiceService(SCOPE_ID).build(target,container).setInitialMode(ServiceController.Mode.ON_DEMAND).install();
      new SharedLocalYieldingClusterLockManagerService(container).build(target).setInitialMode(ServiceController.Mode.ON_DEMAND).install();
    }
  }
  new RegistryService<String,Void>(this.registryEntryProvider).build(target,registryServiceName,serviceName).install();
  builder.addDependency(containerServiceName,EmbeddedCacheManager.class,this.container);
  builder.addDependency(CacheConfigurationService.getServiceName(container,serviceName.getSimpleName()),Configuration.class,this.config);
  builder.addDependency(registryServiceName,Registry.class,this.registry);
  builder.addDependency(SharedLocalYieldingClusterLockManagerService.getServiceName(container),SharedLocalYieldingClusterLockManager.class,this.lockManager);
  return true;
}
