{
  @SuppressWarnings("unchecked") Registry<String,Void> jvmRouteRegistry=this.registry.getValue();
  @SuppressWarnings("unchecked") AdvancedCache<String,Map<Object,Object>> cache=this.cache.getValue().getAdvancedCache();
  if (!cache.getCacheConfiguration().invocationBatching().enabled()) {
    ServiceName cacheServiceName=this.getCacheServiceName(manager.getReplicationConfig());
    throw new ClusteringNotSupportedException(MESSAGES.failedToConfigureWebApp(cacheServiceName.getParent().getSimpleName(),cacheServiceName.getSimpleName()));
  }
  BatchingManager batchingManager=new TransactionBatchingManager(cache.getTransactionManager());
  SessionAttributeStorage<T> storage=this.storageFactory.createStorage(manager.getReplicationConfig().getReplicationGranularity(),this.marshallerFactory.createMarshaller(manager));
  return new DistributedCacheManager<T>(manager,new AtomicMapCache<String,Object,Object>(cache),jvmRouteRegistry,this.lockManager.getOptionalValue(),storage,batchingManager,this.invoker,this.affinityFactory.getValue());
}
