{
  @SuppressWarnings("unchecked") AdvancedCache<SessionKeyImpl,Map<Object,Object>> sessionCache=this.sessionCache.getValue().getAdvancedCache().with(this.getClass().getClassLoader());
  if (!sessionCache.getCacheConfiguration().invocationBatching().enabled()) {
    throw new ClusteringNotSupportedException(MESSAGES.failedToConfigureWebApp(sessionCache.getCacheManager().getGlobalConfiguration().getCacheManagerName(),sessionCache.getName()));
  }
  @SuppressWarnings("unchecked") Cache<Address,String> jvmRouteCache=this.sessionCache.getValue();
  BatchingManager batchingManager=new TransactionBatchingManager(sessionCache.getTransactionManager());
  SessionAttributeStorage<T> storage=this.storageFactory.createStorage(manager.getReplicationConfig().getReplicationGranularity(),this.marshallerFactory.createMarshaller(manager));
  return new DistributedCacheManager<T,SessionKeyImpl>(manager,new AtomicMapCache<SessionKeyImpl,Object,Object>(sessionCache),jvmRouteCache,this.lockManager.getValue(),storage,batchingManager,new SessionKeyFactoryImpl(manager),this.invoker);
}
