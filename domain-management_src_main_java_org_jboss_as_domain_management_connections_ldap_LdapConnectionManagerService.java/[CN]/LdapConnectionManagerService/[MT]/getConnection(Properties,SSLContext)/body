{
  try {
    if (sslContext != null) {
      ThreadLocalSSLSocketFactory.setSSLSocketFactory(sslContext.getSocketFactory());
      properties.put("java.naming.ldap.factory.socket",ThreadLocalSSLSocketFactory.class.getName());
    }
    return new InitialDirContext(properties);
  }
  finally {
    if (sslContext != null) {
      ThreadLocalSSLSocketFactory.removeSSLSocketFactory();
    }
  }
}
