{
  if (readUnsignedByte(dataStream) != Protocol.AUTH) {
    connection.close();
    return;
  }
  final int version=StreamUtils.readUnsignedByte(dataStream);
  if (version < 1) {
    connection.close();
    return;
  }
  final byte[] authCode=new byte[16];
  StreamUtils.readFully(dataStream,authCode);
  dataStream.close();
  final OutputStream os=connection.writeMessage();
  os.write(1);
  os.close();
  final ManagedProcess process=processManager.getServerByAuthCode(authCode);
  if (process == null) {
    log.warnf("Received connection with unknown credentials from %s",connection.getPeerAddress());
    StreamUtils.safeClose(connection);
    return;
  }
  connection.setMessageHandler(new ConnectedMessageHandler(processManager,process.isInitial()));
}
