{
  if (item.getContentType() == ContentType.MISC) {
    return IdentityPatchContext.this.getTargetFile((MiscContentItem)item);
  }
  if (applyPatchId == null || state == State.ROLLBACK_ONLY) {
    throw new IllegalStateException("cannot process rollback tasks for modules/bundles");
  }
  final File root;
  final DirectoryStructure structure=delegate.getDirectoryStructure();
  if (item.getContentType() == ContentType.BUNDLE) {
    root=structure.getBundlesPatchDirectory(applyPatchId);
  }
 else {
    root=structure.getModulePatchDirectory(applyPatchId);
  }
  return PatchContentLoader.getModulePath(root,(ModuleItem)item);
}
