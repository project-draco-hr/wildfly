{
  final List<PatchElement> elements=new ArrayList<PatchElement>();
  for (  final PatchEntry entry : getLayers()) {
    final PatchElement element=createRollbackElement(entry);
    elements.add(element);
  }
  for (  final PatchEntry entry : getAddOns()) {
    final PatchElement element=createRollbackElement(entry);
    elements.add(element);
  }
  final InstalledIdentity installedIdentity=modification.getUnmodifiedInstallationState();
  final String name=installedIdentity.getIdentity().getName();
  final Collection<String> appliesTo=Collections.singletonList(modification.getVersion());
  final Identity identity=new IdentityImpl(name,modification.getVersion());
  final List<ContentModification> modifications=identityEntry.rollbackActions;
  final Collection<String> incompatibleWith=Collections.emptyList();
  final Patch delegate=new PatchImpl(patchId,"rollback patch",patchType,identity,resultingVersion,appliesTo,incompatibleWith,elements,modifications);
  return new PatchImpl.RollbackPatchImpl(delegate,installedIdentity);
}
