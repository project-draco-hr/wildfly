{
  final List<PatchElement> elements=new ArrayList<PatchElement>();
  for (  final PatchEntry entry : getLayers()) {
    final PatchElement element=createRollbackElement(entry);
    elements.add(element);
  }
  for (  final PatchEntry entry : getAddOns()) {
    final PatchElement element=createRollbackElement(entry);
    elements.add(element);
  }
  return new RollbackPatch(){
    @Override public InstalledIdentity getIdentityState(){
      return modification.getUnmodifiedInstallationState();
    }
    @Override public Identity getIdentity(){
      final String name=getIdentityState().getIdentity().getName();
      return new IdentityImpl(name,modification.getVersion());
    }
    @Override public List<PatchElement> getElements(){
      return elements;
    }
    @Override public String getPatchId(){
      return patchId;
    }
    @Override public String getDescription(){
      return "rollback patch";
    }
    @Override public PatchType getPatchType(){
      return patchType;
    }
    @Override public String getResultingVersion(){
      return resultingVersion;
    }
    @Override public List<String> getAppliesTo(){
      return Collections.singletonList(modification.getVersion());
    }
    @Override public Collection<String> getIncompatibleWith(){
      return Collections.emptyList();
    }
    @Override public List<ContentModification> getModifications(){
      return identityEntry.rollbackActions;
    }
  }
;
}
