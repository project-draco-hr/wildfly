{
  final String layerName=element.getLayerName();
  final IdentityPatch.LayerType layerType=element.getLayerType();
  final Map<String,PatchEntry> map;
  if (layerType == IdentityPatch.LayerType.Layer) {
    map=layers;
  }
 else {
    map=addOns;
  }
  PatchEntry entry=map.get(layerName);
  if (entry == null) {
    final InstallationManager.MutablePatchingTarget target=modification.resolve(layerName,layerType);
    entry=new PatchEntry(target);
    map.put(layerName,entry);
  }
  if (entry == null) {
    throw new PatchingException("failed to resolve target for " + element);
  }
  return entry;
}
