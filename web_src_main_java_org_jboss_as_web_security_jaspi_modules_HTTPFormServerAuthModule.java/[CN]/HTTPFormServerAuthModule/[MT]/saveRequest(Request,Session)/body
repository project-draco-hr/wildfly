{
  SavedRequest saved=new SavedRequest();
  Cookie[] cookies=request.getCookies();
  if (cookies != null) {
    for (    Cookie cookie : cookies)     saved.addCookie(cookie);
  }
  Enumeration names=request.getHeaderNames();
  while (names.hasMoreElements()) {
    String name=(String)names.nextElement();
    Enumeration values=request.getHeaders(name);
    while (values.hasMoreElements()) {
      String value=(String)values.nextElement();
      saved.addHeader(name,value);
    }
  }
  Enumeration locales=request.getLocales();
  while (locales.hasMoreElements()) {
    Locale locale=(Locale)locales.nextElement();
    saved.addLocale(locale);
  }
  if ("POST".equalsIgnoreCase(request.getMethod())) {
    ByteChunk body=new ByteChunk();
    body.setLimit(request.getConnector().getMaxSavePostSize());
    byte[] buffer=new byte[4096];
    int bytesRead;
    InputStream is=request.getInputStream();
    while ((bytesRead=is.read(buffer)) >= 0) {
      body.append(buffer,0,bytesRead);
    }
    saved.setBody(body);
    saved.setContentType(request.getContentType());
  }
  saved.setMethod(request.getMethod());
  saved.setQueryString(request.getQueryString());
  saved.setRequestURI(request.getRequestURI());
  session.setNote(Constants.FORM_REQUEST_NOTE,saved);
}
