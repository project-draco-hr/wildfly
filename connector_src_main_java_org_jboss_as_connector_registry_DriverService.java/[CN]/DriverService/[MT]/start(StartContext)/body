{
  DriverRegistry registry=injectedDriverRegistry.getValue();
  boolean ok=false;
  registry.registerInstalledDriver(driverMetaData);
  try {
    DriverManager.registerDriver(driver);
    ok=true;
  }
 catch (  SQLException e) {
    throw new StartException(e);
  }
 finally {
    if (!ok)     try {
      registry.unregisterInstalledDriver(driverMetaData);
    }
 catch (    Throwable t) {
      log.error("Failed to unregister JDBC driver from JCA registry after service failed",t);
    }
  }
}
