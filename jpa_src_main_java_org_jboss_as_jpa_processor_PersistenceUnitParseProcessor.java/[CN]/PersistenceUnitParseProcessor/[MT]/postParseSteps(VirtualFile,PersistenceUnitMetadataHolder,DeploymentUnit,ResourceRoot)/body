{
  final Map<URL,Index> annotationIndexes=new HashMap<URL,Index>();
  for (  ResourceRoot root : DeploymentUtils.allResourceRoots(deploymentUnit)) {
    final Index index=root.getAttachment(Attachments.ANNOTATION_INDEX);
    if (index != null) {
      try {
        annotationIndexes.put(root.getRoot().toURL(),index);
      }
 catch (      MalformedURLException e) {
        throw new RuntimeException(e);
      }
    }
  }
  for (  PersistenceUnitMetadata pu : puHolder.getPersistenceUnits()) {
    List<URL> jarfilesUrls=new ArrayList<URL>();
    if (pu.getJarFiles() != null) {
      for (      String jar : pu.getJarFiles()) {
        jarfilesUrls.add(getRelativeURL(persistence_xml,jar));
      }
    }
    pu.setJarFileUrls(jarfilesUrls);
    URL url=getPersistenceUnitURL(persistence_xml);
    pu.setPersistenceUnitRootUrl(url);
    pu.setScopedPersistenceUnitName(createBeanName(deploymentUnit,pu.getPersistenceUnitName()));
    pu.setAnnotationIndex(annotationIndexes);
  }
}
