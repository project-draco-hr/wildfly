{
  Map<String,PersistenceUnitMetadata> flattened=new HashMap<String,PersistenceUnitMetadata>();
  for (  PersistenceUnitMetadataHolder puHolder : listPUHolders) {
    for (    PersistenceUnitMetadata pu : puHolder.getPersistenceUnits()) {
      if (!flattened.containsKey(pu.getPersistenceUnitName()))       flattened.put(pu.getPersistenceUnitName(),pu);
 else       log.info("ignoring duplicate Persistence Unit definition for " + pu.getPersistenceUnitName());
    }
  }
  PersistenceUnitMetadataHolder holder=new PersistenceUnitMetadataHolder();
  holder.setPersistenceUnits(new ArrayList<PersistenceUnitMetadata>(flattened.values()));
  return holder;
}
