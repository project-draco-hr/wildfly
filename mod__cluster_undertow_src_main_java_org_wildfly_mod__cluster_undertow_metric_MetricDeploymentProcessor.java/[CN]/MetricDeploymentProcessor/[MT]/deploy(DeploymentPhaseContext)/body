{
  DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  List<HandlerWrapper> handlerAttachment=deploymentUnit.getAttachment(UndertowHandlerWrapperDeploymentProcessor.UNDERTOW_INITIAL_HANDLER_CHAIN_WRAPPERS);
  if (handlerAttachment == null) {
    handlerAttachment=new LinkedList<HandlerWrapper>();
    deploymentUnit.putAttachment(UndertowHandlerWrapperDeploymentProcessor.UNDERTOW_INITIAL_HANDLER_CHAIN_WRAPPERS,handlerAttachment);
  }
  handlerAttachment.add(new HandlerWrapper(){
    @Override public HttpHandler wrap(    final HttpHandler handler){
      return new RequestCountHttpHandler(handler);
    }
  }
);
  handlerAttachment.add(new HandlerWrapper(){
    @Override public HttpHandler wrap(    final HttpHandler handler){
      return new BytesSentHttpHandler(handler);
    }
  }
);
  handlerAttachment.add(new HandlerWrapper(){
    @Override public HttpHandler wrap(    final HttpHandler handler){
      return new BytesReceivedHttpHandler(handler);
    }
  }
);
  List<ThreadSetupAction> setupAttachment=deploymentUnit.getAttachment(UndertowThreadSetupActionDeploymentProcessor.UNDERTOW_THREAD_SETUP_ACTIONS);
  if (setupAttachment == null) {
    setupAttachment=new LinkedList<ThreadSetupAction>();
    deploymentUnit.putAttachment(UndertowThreadSetupActionDeploymentProcessor.UNDERTOW_THREAD_SETUP_ACTIONS,setupAttachment);
  }
  setupAttachment.add(new RunningRequestsThreadSetupAction());
}
