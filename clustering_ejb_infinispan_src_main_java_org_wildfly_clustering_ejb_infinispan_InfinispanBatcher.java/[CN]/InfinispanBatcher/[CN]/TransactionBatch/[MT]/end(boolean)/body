{
  try {
    Transaction existingTx=this.tm.suspend();
    this.tm.resume(this.tx);
    try {
      if (success) {
        try {
          this.tm.commit();
        }
 catch (        RollbackException|HeuristicMixedException|HeuristicRollbackException e) {
          throw new CacheException(e);
        }
      }
 else {
        this.tm.rollback();
      }
    }
  finally {
      if ((existingTx != null) && !existingTx.equals(this.tx)) {
        this.tm.resume(existingTx);
      }
    }
  }
 catch (  SystemException|InvalidTransactionException e) {
    throw new CacheException(e);
  }
}
