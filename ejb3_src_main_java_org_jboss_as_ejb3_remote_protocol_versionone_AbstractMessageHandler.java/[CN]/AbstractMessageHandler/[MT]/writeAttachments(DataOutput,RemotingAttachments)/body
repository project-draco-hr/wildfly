{
  if (attachments == null) {
    output.writeByte(0);
    return;
  }
  output.writeByte(attachments.size());
  for (  RemotingAttachments.RemotingAttachment attachment : attachments.entries()) {
    output.writeShort(attachment.getKey());
    final byte[] data=attachment.getValue();
    PackedInteger.writePackedInteger(output,data.length);
    output.write(data);
  }
}
