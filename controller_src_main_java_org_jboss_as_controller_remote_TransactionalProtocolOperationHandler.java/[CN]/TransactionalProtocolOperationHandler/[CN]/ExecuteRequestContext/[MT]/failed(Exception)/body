{
  if (prepared) {
    final ModelController.OperationTransaction transaction=activeTx;
    if (transaction != null) {
      transaction.rollback();
      txCompletedLatch.countDown();
    }
  }
 else   if (responseChannel != null) {
    rollbackOnPrepare=true;
    final String message=e.getMessage() != null ? e.getMessage() : "failure before rollback " + e.getClass().getName();
    final ModelNode response=new ModelNode();
    response.get(OUTCOME).set(FAILED);
    response.get(FAILURE_DESCRIPTION).set(message);
    ControllerLogger.MGMT_OP_LOGGER.tracef("sending pre-prepare failed response for %d  --- interrupted: %s",getOperationId(),Thread.currentThread().isInterrupted());
    try {
      sendResponse(responseChannel,ModelControllerProtocol.PARAM_OPERATION_FAILED,response);
    }
 catch (    IOException ignored) {
      ControllerLogger.MGMT_OP_LOGGER.debugf(ignored,"failed to process message");
    }
  }
}
