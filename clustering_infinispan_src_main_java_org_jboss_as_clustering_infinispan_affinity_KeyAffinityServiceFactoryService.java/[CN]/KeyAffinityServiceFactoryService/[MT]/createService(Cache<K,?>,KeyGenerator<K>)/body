{
  boolean clustered=cache.getCacheConfiguration().clustering().cacheMode().isClustered();
  return clustered ? new KeyAffinityServiceImpl<>(this.executor,cache,generator,this.bufferSize,Collections.singleton(cache.getCacheManager().getAddress()),false) : new SimpleKeyAffinityService<>(generator);
}
