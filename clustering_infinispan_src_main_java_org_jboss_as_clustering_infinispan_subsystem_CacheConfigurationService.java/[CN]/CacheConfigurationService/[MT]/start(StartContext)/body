{
  TransactionManager tm=this.dependencies.getTransactionManager();
  if (tm != null) {
    this.builder.transaction().transactionManagerLookup(new TransactionManagerProvider(tm));
  }
  TransactionSynchronizationRegistry tsr=this.dependencies.getTransactionSynchronizationRegistry();
  if (tsr != null) {
    this.builder.transaction().transactionSynchronizationRegistryLookup(new TransactionSynchronizationRegistryProvider(tsr));
  }
  this.config=this.builder.build();
  EmbeddedCacheManager container=this.dependencies.getCacheContainer();
  CacheMode mode=this.config.clustering().cacheMode();
  if (mode.isClustered() && (container.getTransport() == null)) {
    throw InfinispanMessages.MESSAGES.transportRequired(mode,this.name,container.getCacheManagerConfiguration().globalJmxStatistics().cacheManagerName());
  }
  container.defineConfiguration(this.name,this.config);
}
