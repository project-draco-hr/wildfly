{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (deploymentUnit.getParent() != null) {
    return;
  }
  final ResourceRoot deploymentRoot=deploymentUnit.getAttachment(Attachments.DEPLOYMENT_ROOT);
  final Set<String> paths=new HashSet<String>();
  for (  final DeploymentOverlayService deploymentOverlay : indexService.getOverrides(deploymentUnit.getName())) {
    for (    final ContentService override : deploymentOverlay.getContentServices()) {
      if (!paths.contains(override.getPath())) {
        paths.add(override.getPath());
        try {
          Closeable handle=VFS.mountReal(override.getContentHash().getPhysicalFile(),deploymentRoot.getRoot().getChild(override.getPath()));
          deploymentUnit.addToAttachmentList(MOUNTED_FILES,handle);
        }
 catch (        IOException e) {
          throw ServerMessages.MESSAGES.deploymentOverlayFailed(e,deploymentOverlay.getName(),override.getPath());
        }
      }
    }
  }
}
