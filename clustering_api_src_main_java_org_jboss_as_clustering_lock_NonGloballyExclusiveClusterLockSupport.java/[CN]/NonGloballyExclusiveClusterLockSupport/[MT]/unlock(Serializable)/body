{
  ClusterNode myself=getLocalClusterNode();
  if (myself == null) {
    throw new IllegalStateException("Must call start() before first call to unlock()");
  }
  ClusterLockState lockState=getClusterLockState(lockId,false);
  if (lockState != null && myself.equals(lockState.getHolder())) {
    getLocalHandler().unlockFromCluster(lockId,myself);
    lockState.release();
    try {
      getGroupRpcDispatcher().callMethodOnCluster(getServiceHAName(),"releaseRemoteLock",new Object[]{lockId,myself},RELEASE_REMOTE_LOCK_TYPES,true);
    }
 catch (    RuntimeException e) {
      throw e;
    }
catch (    Exception e) {
      throw new RuntimeException("Failed releasing remote lock",e);
    }
  }
}
