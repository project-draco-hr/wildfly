{
  String realmName=null;
  boolean forAuthentication=false;
  boolean forUserSearch=false;
  PathAddress address=PathAddress.pathAddress(operation.get(OP_ADDR));
  for (  PathElement current : address) {
    String key=current.getKey();
    if (SECURITY_REALM.equals(key)) {
      realmName=current.getValue();
    }
 else     if (AUTHENTICATION.equals(key)) {
      forAuthentication=true;
      forUserSearch=true;
    }
 else     if (AUTHORIZATION.equals(key)) {
      forAuthentication=false;
    }
 else     if (USERNAME_TO_DN.equals(key)) {
      forUserSearch=true;
    }
 else     if (GROUP_SEARCH.equals(key)) {
      forUserSearch=false;
    }
  }
  ServiceName serviceName=LdapSearcherCache.ServiceUtil.createServiceName(forAuthentication,forUserSearch,realmName);
  ServiceRegistry registry=context.getServiceRegistry(true);
  ServiceController<LdapSearcherCache<?,K>> service=(ServiceController<LdapSearcherCache<?,K>>)registry.getRequiredService(serviceName);
  try {
    return service.awaitValue();
  }
 catch (  InterruptedException e) {
    throw new OperationFailedException(e);
  }
}
