{
  final State continuingState;
  if (stateValues.isExistingUser()) {
    continuingState=new UpdateUser(theConsole,stateValues);
  }
 else {
    State addState=new AddUser(theConsole,stateValues);
    if (stateValues.isSilentOrNonInteractive()) {
      continuingState=addState;
    }
 else {
      String message=MESSAGES.aboutToAddUser(stateValues.getUserName(),stateValues.getRealm());
      String prompt=MESSAGES.isCorrectPrompt() + " " + MESSAGES.yes()+ "/"+ MESSAGES.no()+ "?";
      continuingState=new ConfirmationChoice(theConsole,message,prompt,addState,new PromptNewUserState(theConsole,stateValues));
    }
  }
  return continuingState;
}
