{
  try (InputStream input=new ByteArrayInputStream(message.getRawBuffer(),message.getOffset(),message.getLength())){
    int version=input.read();
    try (Unmarshaller unmarshaller=this.marshallingContext.createUnmarshaller(version)){
      unmarshaller.start(Marshalling.createByteInput(input));
      Object clientId=unmarshaller.readObject();
      @SuppressWarnings("unchecked") Command<Object,Object> command=(Command<Object,Object>)unmarshaller.readObject();
      AtomicReference<Object> context=this.contexts.get(clientId);
      if (context == null)       return NoSuchService.INSTANCE;
      return command.execute(context.get());
    }
   }
 }
