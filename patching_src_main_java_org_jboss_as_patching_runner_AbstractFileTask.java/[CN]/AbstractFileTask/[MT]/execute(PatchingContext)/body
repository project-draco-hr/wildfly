{
  if (item.isDirectory()) {
    if (!target.mkdir()) {
      throw new IOException();
    }
    final MiscContentItem backupItem=new MiscContentItem(item.getName(),item.getPath(),backupHash,item.isDirectory(),item.isAffectsRuntime());
    final ContentModification rollback=createRollback(context,item,backupItem,NO_CONTENT);
    context.recordRollbackAction(rollback);
  }
 else {
    final InputStream is=context.getLoader().openContentStream(item);
    try {
      final byte[] hash=PatchUtils.copy(is,target);
      final MiscContentItem backupItem=new MiscContentItem(item.getName(),item.getPath(),backupHash,item.isDirectory(),item.isAffectsRuntime());
      final ContentModification rollback=createRollback(context,item,backupItem,hash);
      context.recordRollbackAction(rollback);
    }
  finally {
      PatchUtils.safeClose(is);
    }
  }
}
