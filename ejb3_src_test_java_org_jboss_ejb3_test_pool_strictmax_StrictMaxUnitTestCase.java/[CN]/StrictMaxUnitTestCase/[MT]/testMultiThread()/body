{
  StatelessObjectFactory<MockBean> factory=new MockFactory();
  final Pool<MockBean> pool=new StrictMaxPool<MockBean>(factory,10,1,TimeUnit.SECONDS);
  pool.start();
  Callable<Void> task=new Callable<Void>(){
    public Void call() throws Exception {
      for (int i=0; i < 20; i++) {
        MockBean bean=pool.get();
        Thread.sleep(50);
        pool.release(bean);
        bean=null;
        used.incrementAndGet();
      }
      return null;
    }
  }
;
  ExecutorService service=Executors.newFixedThreadPool(20);
  Future<?> results[]=new Future<?>[20];
  for (int i=0; i < results.length; i++) {
    results[i]=service.submit(task);
  }
  for (  Future<?> result : results) {
    result.get(5,TimeUnit.SECONDS);
  }
  service.shutdown();
  pool.stop();
  assertEquals(400,used.intValue());
  assertEquals(10,MockBean.getPostConstructs());
  assertEquals(10,MockBean.getPreDestroys());
}
