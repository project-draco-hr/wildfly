{
  IllegalStateException ise=null;
  boolean connected=false;
  final long timeout=30000;
  final long endTime=System.currentTimeMillis() + timeout;
  int retries=0;
  while (!connected) {
    try {
      connect();
      connected=true;
      break;
    }
 catch (    IllegalStateException e) {
      if (System.currentTimeMillis() > endTime) {
        throw new IllegalStateException("Could not connect to master in " + retries + "attempts within  "+ timeout+ " ms",e);
      }
      ise=e;
      try {
        ReconnectPolicy.CONNECT.wait(retries);
      }
 catch (      InterruptedException ie) {
        throw new IllegalStateException("Interrupted while trying to connect to master");
      }
    }
catch (    HostAlreadyExistsException e) {
      throw new IllegalStateException(e.getMessage());
    }
  }
  this.connected.set(true);
  registered.set(true);
}
