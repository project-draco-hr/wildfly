{
  RemoteDomainConnectionService service;
  try {
    service=new RemoteDomainConnectionService(controller,localHostName,InetAddress.getByName(remoteDcHost),remoteDcPort,remoteFileRepository);
  }
 catch (  UnknownHostException e) {
    throw new RuntimeException(e);
  }
  ServiceBuilder builder=serviceTarget.addService(MasterDomainControllerClient.SERVICE_NAME,service).addDependency(RemotingServices.ENDPOINT,Endpoint.class,service.endpointInjector).setInitialMode(ServiceController.Mode.ACTIVE);
  if (securityRealm != null) {
    ServiceName callbackHandlerService=SecurityRealmService.BASE_SERVICE_NAME.append(securityRealm).append(SecretIdentityService.SERVICE_SUFFIX);
    builder.addDependency(callbackHandlerService,CallbackHandlerFactory.class,service.callbackFactoryInjector);
  }
  builder.install();
  return service.futureClient;
}
