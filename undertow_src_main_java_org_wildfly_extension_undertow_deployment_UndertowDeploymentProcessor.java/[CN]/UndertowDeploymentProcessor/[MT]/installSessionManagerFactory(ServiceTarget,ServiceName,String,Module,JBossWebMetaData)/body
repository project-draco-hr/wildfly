{
  ServiceName name=deploymentServiceName.append("session");
  if (metaData.getDistributable() != null) {
    DistributableSessionManagerFactoryBuilder sessionManagerFactoryBuilder=new DistributableSessionManagerFactoryBuilderValue().getValue();
    if (sessionManagerFactoryBuilder != null) {
      sessionManagerFactoryBuilder.build(target,name,new SimpleDistributableSessionManagerConfiguration(metaData,deploymentName,module)).setInitialMode(Mode.ON_DEMAND).install();
      return name;
    }
    UndertowLogger.ROOT_LOGGER.clusteringNotSupported();
  }
  Integer maxActiveSessions=metaData.getMaxActiveSessions();
  InMemorySessionManagerFactory factory=(maxActiveSessions != null) ? new InMemorySessionManagerFactory(maxActiveSessions.intValue()) : new InMemorySessionManagerFactory();
  target.addService(name,new ValueService<>(new ImmediateValue<>(factory))).setInitialMode(Mode.ON_DEMAND).install();
  return name;
}
