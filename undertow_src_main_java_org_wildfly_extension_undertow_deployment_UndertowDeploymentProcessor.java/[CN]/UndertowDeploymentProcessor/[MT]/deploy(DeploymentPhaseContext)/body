{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (RequestControllerActivationMarker.isRequestControllerEnabled(deploymentUnit)) {
    if (deploymentUnit.getParent() == null) {
      ControlPointService.install(phaseContext.getServiceTarget(),deploymentUnit.getName(),UndertowExtension.SUBSYSTEM_NAME);
    }
  }
  final WarMetaData warMetaData=deploymentUnit.getAttachment(WarMetaData.ATTACHMENT_KEY);
  if (warMetaData == null) {
    return;
  }
  String deploymentName;
  if (deploymentUnit.getParent() == null) {
    deploymentName=deploymentUnit.getName();
  }
 else {
    deploymentName=deploymentUnit.getParent().getName() + "." + deploymentUnit.getName();
  }
  final Map.Entry<String,String> severHost=defaultModuleMappingProvider.getMapping(deploymentName);
  String defaultHostForDeployment;
  String defaultServerForDeployment;
  if (severHost != null) {
    defaultServerForDeployment=severHost.getKey();
    defaultHostForDeployment=severHost.getValue();
  }
 else {
    defaultServerForDeployment=this.defaultServer;
    defaultHostForDeployment=this.defaultHost;
  }
  String serverInstanceName=warMetaData.getMergedJBossWebMetaData().getServerInstanceName() == null ? defaultServerForDeployment : warMetaData.getMergedJBossWebMetaData().getServerInstanceName();
  String hostName=hostNameOfDeployment(warMetaData,defaultHostForDeployment);
  processDeployment(warMetaData,deploymentUnit,phaseContext.getServiceTarget(),deploymentName,hostName,serverInstanceName);
}
