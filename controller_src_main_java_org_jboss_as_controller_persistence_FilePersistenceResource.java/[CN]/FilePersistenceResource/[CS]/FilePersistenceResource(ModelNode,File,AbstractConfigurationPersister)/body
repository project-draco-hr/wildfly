{
  this.fileName=fileName;
  tempFileName=new File(fileName.getParentFile(),fileName.getName() + ".tmp");
  tempFileName.deleteOnExit();
  this.persister=persister;
  marshalled=new ExposedByteArrayOutputStream(1024 * 8);
  try {
    try {
      BufferedOutputStream output=new BufferedOutputStream(marshalled);
      persister.marshallAsXml(model,output);
      output.close();
      marshalled.close();
    }
  finally {
      safeClose(marshalled);
    }
  }
 catch (  Exception e) {
    throw MESSAGES.failedToMarshalConfiguration(e);
  }
}
