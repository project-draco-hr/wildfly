{
  ServiceRegistry registry=context.getServiceRegistry(true);
  final ServiceName hqServiceName=MessagingServices.getHornetQServiceName(PathAddress.pathAddress(operation.get(ModelDescriptionConstants.OP_ADDR)));
  ServiceController<?> hqService=registry.getService(hqServiceName);
  if (hqService != null) {
    PathAddress address=PathAddress.pathAddress(operation.get(OP_ADDR));
    final String queueName=address.getLastElement().getValue();
    final CoreQueueConfiguration queueConfiguration=createCoreQueueConfiguration(context,queueName,model);
    final QueueService service=new QueueService(queueConfiguration,false);
    final ServiceName queueServiceName=MessagingServices.getQueueBaseServiceName(hqServiceName).append(queueName);
    newControllers.add(context.getServiceTarget().addService(queueServiceName,service).addDependency(HornetQActivationService.getHornetQActivationServiceName(hqServiceName)).addDependency(hqServiceName,HornetQServer.class,service.getHornetQService()).addListener(verificationHandler).setInitialMode(Mode.PASSIVE).install());
  }
}
