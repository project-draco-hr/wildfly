{
  if (value == null) {
    throw CmpMessages.MESSAGES.cannotSetCmrCollectionToNull(entity.getEntityName(),getFieldName());
  }
  destroyExistingRelationships(ctx);
  Collection newValue=(Collection)value;
  if (!newValue.isEmpty()) {
    Set copy=new HashSet(newValue);
    for (Iterator iter=copy.iterator(); iter.hasNext(); ) {
      Object relatedId=getPrimaryKey(iter.next());
      addRelatedId(ctx,relatedId);
      relatedCMRField.invokeAddRelatedId(ctx,relatedId,ctx.getPrimaryKeyUnchecked());
      loader.addRelatedId(ctx,relatedId);
    }
  }
}
