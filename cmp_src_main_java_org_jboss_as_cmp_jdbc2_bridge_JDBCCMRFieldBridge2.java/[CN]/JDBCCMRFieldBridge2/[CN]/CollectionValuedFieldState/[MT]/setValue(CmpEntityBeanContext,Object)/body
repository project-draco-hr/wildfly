{
  if (value == null) {
    throw new IllegalArgumentException("Can't set collection-valued CMR field to null: " + entity.getEntityName() + "."+ getFieldName());
  }
  destroyExistingRelationships(ctx);
  Collection newValue=(Collection)value;
  if (!newValue.isEmpty()) {
    Set copy=new HashSet(newValue);
    for (Iterator iter=copy.iterator(); iter.hasNext(); ) {
      Object relatedId=getPrimaryKey(iter.next());
      addRelatedId(ctx,relatedId);
      relatedCMRField.invokeAddRelatedId(ctx,relatedId,ctx.getPrimaryKey());
      loader.addRelatedId(ctx,relatedId);
    }
  }
}
