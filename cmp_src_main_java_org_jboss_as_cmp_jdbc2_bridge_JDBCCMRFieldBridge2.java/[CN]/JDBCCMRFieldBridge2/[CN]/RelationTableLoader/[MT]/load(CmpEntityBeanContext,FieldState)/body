{
  Object value;
  EntityTable relatedTable=relatedEntity.getTable();
  Connection con=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    if (log.isDebugEnabled()) {
      log.debug("executing: " + loadSql);
    }
    con=relatedTable.getDataSource().getConnection();
    ps=con.prepareStatement(loadSql);
    JDBCCMPFieldBridge2[] pkFields=(JDBCCMPFieldBridge2[])entity.getPrimaryKeyFields();
    Object myPk=ctx.getPrimaryKeyUnchecked();
    int paramInd=1;
    for (int i=0; i < pkFields.length; ++i) {
      JDBCCMPFieldBridge2 pkField=pkFields[i];
      Object fieldValue=pkField.getPrimaryKeyValue(myPk);
      JDBCCMPFieldBridge2 relatedFkField=tableKeyFields[i];
      relatedFkField.setArgumentParameters(ps,paramInd++,fieldValue);
    }
    rs=ps.executeQuery();
    while (rs.next()) {
      value=relatedTable.loadRow(rs,false);
      state.addLoadedPk(value);
    }
  }
 catch (  SQLException e) {
    throw CmpMessages.MESSAGES.failedToLoadRelatedRole(entity.getEntityName(),getFieldName(),e);
  }
 finally {
    JDBCUtil.safeClose(rs);
    JDBCUtil.safeClose(ps);
    JDBCUtil.safeClose(con);
  }
}
