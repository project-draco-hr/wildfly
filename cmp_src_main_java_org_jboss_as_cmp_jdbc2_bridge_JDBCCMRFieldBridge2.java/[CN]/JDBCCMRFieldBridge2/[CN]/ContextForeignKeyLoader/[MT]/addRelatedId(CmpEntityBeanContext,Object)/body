{
  final boolean markDirty=relatedId != null || fkConstraint == null;
  for (int i=0; i < foreignKeyFields.length; ++i) {
    JDBCCMPFieldBridge2 relatedPKField=relatedPKFields[i];
    Object fieldValue=relatedPKField.getPrimaryKeyValue(relatedId);
    foreignKeyFields[i].setValueInternal(ctx,fieldValue,markDirty);
  }
  if (fkConstraint != null) {
    PersistentContext pctx=(PersistentContext)ctx.getPersistenceContext();
    if (relatedId == null) {
      pctx.nullForeignKey(fkConstraint);
    }
 else {
      pctx.nonNullForeignKey(fkConstraint);
    }
  }
}
