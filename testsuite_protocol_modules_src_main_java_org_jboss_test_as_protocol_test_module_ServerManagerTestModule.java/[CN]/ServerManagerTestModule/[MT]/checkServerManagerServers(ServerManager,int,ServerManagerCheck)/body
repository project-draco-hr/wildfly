{
  long end=System.currentTimeMillis() + timeoutMs;
  while (System.currentTimeMillis() < end) {
    Map<String,ManagedServer> servers=sm.getServers();
    boolean allMatched=true;
    for (    ServerManagerCheck check : checks) {
      ManagedServer server=servers.get(check.getServerName());
      if (server == null || server.getState() != check.getState()) {
        allMatched=false;
        break;
      }
    }
    if (allMatched)     break;
  }
  Map<String,ManagedServer> servers=sm.getServers();
  for (  ServerManagerCheck check : checks) {
    ManagedServer server=servers.get(check.getServerName());
    Assert.assertNotNull(server);
    Assert.assertSame("Actual state of " + check.getServerName() + " was: "+ server.getState(),check.getState(),server.getState());
  }
  return servers;
}
