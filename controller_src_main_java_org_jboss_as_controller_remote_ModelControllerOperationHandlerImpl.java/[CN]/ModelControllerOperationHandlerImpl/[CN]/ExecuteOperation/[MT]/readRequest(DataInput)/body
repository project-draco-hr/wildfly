{
  expectHeader(input,ModelControllerClientProtocol.PARAM_OPERATION);
  builder=OperationBuilder.Factory.create(readNode(input));
  byte cmd=input.readByte();
  if (cmd == ModelControllerClientProtocol.PARAM_REQUEST_END) {
    return;
  }
  if (cmd != ModelControllerClientProtocol.PARAM_INPUT_STREAM) {
    throw new IllegalArgumentException("Expected " + ModelControllerClientProtocol.PARAM_INPUT_STREAM + " received "+ cmd);
  }
  while (cmd == ModelControllerClientProtocol.PARAM_INPUT_STREAM) {
    int length=input.readInt();
    ByteArrayOutputStream bout=new ByteArrayOutputStream();
    for (int i=0; i < length; i++) {
      int b=input.readByte();
      if (b == -1) {
        throw new IllegalArgumentException("Unexpected end of file");
      }
      bout.write(b);
    }
    builder.addInputStream(new ByteArrayInputStream(bout.toByteArray()));
    cmd=input.readByte();
  }
  if (cmd != ModelControllerClientProtocol.PARAM_REQUEST_END) {
    throw new IllegalArgumentException("Expected " + ModelControllerClientProtocol.PARAM_REQUEST_END + " received "+ cmd);
  }
}
