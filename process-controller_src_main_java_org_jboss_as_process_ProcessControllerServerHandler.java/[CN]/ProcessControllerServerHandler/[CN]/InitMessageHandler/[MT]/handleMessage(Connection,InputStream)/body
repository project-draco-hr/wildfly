{
  final int cmd=readUnsignedByte(dataStream);
  if (cmd != Protocol.AUTH) {
    log.warnf("Received unrecognized greeting code 0x%02x from %s",Integer.valueOf(cmd),connection.getPeerAddress());
    connection.close();
    return;
  }
  final int version=StreamUtils.readUnsignedByte(dataStream);
  if (version < 1) {
    log.warnf("Received connection with invalid version from %s",connection.getPeerAddress());
    connection.close();
    return;
  }
  final byte[] authCode=new byte[16];
  StreamUtils.readFully(dataStream,authCode);
  final ManagedProcess process=processController.getServerByAuthCode(authCode);
  if (process == null) {
    log.warnf("Received connection with unknown credentials from %s",connection.getPeerAddress());
    StreamUtils.safeClose(connection);
    return;
  }
  log.tracef("Received authentic connection from %s",connection.getPeerAddress());
  connection.setMessageHandler(new ConnectedMessageHandler(processController,process.isInitial()));
  dataStream.close();
}
