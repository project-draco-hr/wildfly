{
  JChannel channel=new MuxChannel(this);
  TP transport=channel.getProtocolStack().getTransport();
  if (transport.isSingleton()) {
synchronized (transport) {
      this.init(transport);
    }
  }
 else {
    this.init(transport);
  }
  channel.setName(configuration.getEnvironment().getNodeName());
  TransportConfiguration transportConfiguration=this.configuration.getTransport();
  if (transportConfiguration.hasTopology()) {
    channel.setAddressGenerator(new TopologyAddressGenerator(channel,transportConfiguration.getSiteId(),transportConfiguration.getRackId(),transportConfiguration.getMachineId()));
  }
  MBeanServer server=this.configuration.getMBeanServer();
  if (server != null) {
    try {
      this.channels.put(channel,id);
      JmxConfigurator.registerChannel(channel,server,id);
    }
 catch (    Exception e) {
      ROOT_LOGGER.warn(e.getMessage(),e);
    }
    channel.addChannelListener(this);
  }
  return channel;
}
