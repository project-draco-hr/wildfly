{
  JChannel channel=new MuxChannel(this);
  TP transport=channel.getProtocolStack().getTransport();
  if (transport.isSingleton()) {
synchronized (transport) {
      this.init(transport);
    }
  }
 else {
    this.init(transport);
  }
  channel.setName(this.configuration.getEnvironment().getNodeName() + "/" + id);
  TransportConfiguration.Topology topology=this.configuration.getTransport().getTopology();
  if (topology != null) {
    channel.setAddressGenerator(new TopologyAddressGenerator(channel,topology.getSite(),topology.getRack(),topology.getMachine()));
  }
  MBeanServer server=this.configuration.getMBeanServer();
  if (server != null) {
    try {
      this.channels.put(channel,id);
      JmxConfigurator.registerChannel(channel,server,id);
    }
 catch (    Exception e) {
      ROOT_LOGGER.warn(e.getMessage(),e);
    }
    channel.addChannelListener(this);
  }
  return channel;
}
