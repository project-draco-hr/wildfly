{
  List<ProtocolConfiguration> protocols=stack.getProtocols();
  List<org.jgroups.conf.ProtocolConfiguration> result=new ArrayList<>(protocols.size());
  TransportConfiguration transport=stack.getTransport();
  boolean supportsMulticast=transport.hasProperty("mcast_addr");
  for (  ProtocolConfiguration protocol : protocols) {
    org.jgroups.conf.ProtocolConfiguration config=createProtocol(stack,protocol);
    SocketBinding binding=protocol.getSocketBinding();
    if (binding != null) {
      configureBindAddress(protocol,config,binding);
      configureServerSocket(protocol,config,"bind_port",binding);
      configureServerSocket(protocol,config,"start_port",binding);
      configureMulticastSocket(protocol,config,"mcast_addr","mcast_port",binding);
    }
 else     if (transport.getSocketBinding() != null) {
      configureBindAddress(protocol,config,transport.getSocketBinding());
    }
    if (!supportsMulticast) {
      setProperty(protocol,config,"use_mcast_xmit",String.valueOf(false));
    }
    result.add(config);
  }
  return result;
}
