{
  List<org.jgroups.conf.ProtocolConfiguration> configs=new ArrayList<org.jgroups.conf.ProtocolConfiguration>(this.configuration.getProtocols().size() + 1);
  TransportConfiguration transport=this.configuration.getTransport();
  org.jgroups.conf.ProtocolConfiguration config=this.createProtocol(transport);
  Map<String,String> properties=config.getProperties();
  if (transport.isShared()) {
    properties.put(Global.SINGLETON_NAME,this.configuration.getName());
  }
  SocketBinding binding=transport.getSocketBinding();
  if (binding != null) {
    configureBindAddress(transport,config,binding);
    configureServerSocket(transport,config,"bind_port",binding);
    configureMulticastSocket(transport,config,"mcast_addr","mcast_port",binding);
  }
  SocketBinding diagnosticsSocketBinding=transport.getDiagnosticsSocketBinding();
  boolean diagnostics=(diagnosticsSocketBinding != null);
  properties.put("enable_diagnostics",String.valueOf(diagnostics));
  if (diagnostics) {
    configureMulticastSocket(transport,config,"diagnostics_addr","diagnostics_port",diagnosticsSocketBinding);
  }
  configs.add(config);
  boolean supportsMulticast=transport.hasProperty("mcast_addr");
  for (  ProtocolConfiguration protocol : this.configuration.getProtocols()) {
    config=this.createProtocol(protocol);
    binding=protocol.getSocketBinding();
    if (binding != null) {
      configureBindAddress(protocol,config,binding);
      configureServerSocket(protocol,config,"bind_port",binding);
      configureServerSocket(protocol,config,"start_port",binding);
      configureMulticastSocket(protocol,config,"mcast_addr","mcast_port",binding);
    }
 else     if (transport.getSocketBinding() != null) {
      configureBindAddress(protocol,config,transport.getSocketBinding());
    }
    if (!supportsMulticast) {
      setProperty(protocol,config,"use_mcast_xmit",String.valueOf(false));
    }
    configs.add(config);
  }
  return configs;
}
