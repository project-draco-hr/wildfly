{
  if (receivedByeBye) {
    return;
  }
  if (!byeByeSent.compareAndSet(false,true)) {
    return;
  }
  ROOT_LOGGER.tracef("Closing %s by sending bye bye",this);
  ManagementByeByeHeader byeByeHeader=new ManagementByeByeHeader(ManagementProtocol.VERSION);
  try {
    SimpleDataOutput out=new SimpleDataOutput(Marshalling.createByteOutput(writeMessage()));
    try {
      byeByeHeader.write(out);
    }
  finally {
      IoUtils.safeClose(out);
    }
  }
 catch (  IOException ignore) {
  }
 finally {
    ROOT_LOGGER.tracef("Invoking close on %s",this);
    super.close();
  }
}
