{
  responseReceiver.registerResponseHandler(request.getCurrentRequestId(),responseHandler);
  FlushableDataOutputImpl output=FlushableDataOutputImpl.create(this.writeMessage());
  try {
    request.writeRequest(this,output);
  }
  finally {
    IoUtils.safeClose(output);
  }
}
