{
  responseReceiver.registerResponseHandler(request.getCurrentRequestId(),responseHandler);
  FlushableDataOutputImpl output=FlushableDataOutputImpl.create(this.writeMessage());
  try {
    final ManagementRequestHeader managementRequestHeader=new ManagementRequestHeader(ManagementProtocol.VERSION,request.getCurrentRequestId(),request.getBatchId(),request.getRequestCode());
    managementRequestHeader.write(output);
    request.writeRequest(this,output);
  }
  finally {
    IoUtils.safeClose(output);
  }
}
