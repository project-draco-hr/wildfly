{
  final int workingVersion=Math.min(ManagementProtocol.VERSION,header.getVersion());
  try {
    final ManagementResponseHeader responseHeader=new ManagementResponseHeader(workingVersion,header.getRequestId(),formatException(exception));
    responseHeader.write(output);
  }
 catch (  IOException e) {
    throw e;
  }
catch (  Throwable t) {
    throw new IOException("Failed to write management response headers",t);
  }
}
