{
  closed=true;
  if (spy)   spyLogger.debugf("%s [%s] close()",jndiName,Constants.SPY_LOGGER_PREFIX_CONNECTION);
  if (mc != null) {
    if (trackStatements != BaseWrapperManagedConnectionFactory.TRACK_STATEMENTS_FALSE_INT) {
synchronized (this) {
        if (statements != null && statements.size() > 0) {
          for (Iterator<Map.Entry<WrappedStatement,Throwable>> i=statements.entrySet().iterator(); i.hasNext(); ) {
            Map.Entry<WrappedStatement,Throwable> entry=i.next();
            WrappedStatement ws=entry.getKey();
            if (trackStatements == BaseWrapperManagedConnectionFactory.TRACK_STATEMENTS_TRUE_INT) {
              Throwable stackTrace=entry.getValue();
              log.warn("Closing a statement you left open, please do your own housekeeping",stackTrace);
            }
            try {
              ws.internalClose();
            }
 catch (            Throwable t) {
              log.warn("Exception trying to close statement:",t);
            }
          }
        }
      }
    }
    mc.closeHandle(this);
  }
  mc=null;
  dataSource=null;
}
