{
  boolean isPassivated=true;
  DMRUtil.setPassivationIdleTimeout(client1.getControllerClient());
  DMRUtil.setPassivationOnReplicate(client1.getControllerClient(),isPassivated);
  DMRUtil.setPassivationIdleTimeout(client2.getControllerClient());
  DMRUtil.setPassivationOnReplicate(client2.getControllerClient(),isPassivated);
  log.info("Setting context selector...");
  setupEJBClientContextSelector();
  final StatefulBeanChildRemote sb=context.lookupStateful(StatefulBeanChild.class,StatefulBeanChildRemote.class);
  String stringData="42";
  int intData=42;
  String calledNodeName=sb.getNodeName();
  node2client.put(container2node.get(CONTAINER_1),client1);
  node2client.put(container2node.get(CONTAINER_2),client2);
  sb.setInt(intData);
  sb.setDTOStringData(stringData);
  sb.setDTONumberData(intData);
  sb.setTransientDTOStringData(stringData);
  sb.setTransientDTONumberData(intData);
  sb.setParentDTOStringData(stringData);
  sb.setParentDTOTransientStringData(stringData);
  Thread.sleep(WAIT_FOR_PASSIVATION_MS);
  unsetPassivationAttributes(node2client.get(calledNodeName).getControllerClient());
  undeploy(node2deployment.get(calledNodeName));
  stop(node2container.get(calledNodeName));
  log.info("Node " + calledNodeName + " was stopped.");
  Assert.assertEquals("Int sfsb data wasn't passivated correctly",intData,sb.getInt());
  Assert.assertEquals("String data of dto defined in sfsb wasn't passivated correctly",stringData,sb.getDTOStringData());
  Assert.assertEquals("Int data of dto defined in sfsb wasn't passivated correctly",intData,sb.getDTONumberData());
  Assert.assertNull("String data of transient dto defined in sfsb has to be null after passivation",sb.getTransientDTOStringData());
  Assert.assertEquals("Int data of transient dto has to be 0 after passivation",0,sb.getTransientDTONumberData());
  Assert.assertEquals("String data of dto defined in parent of sfsb wasn't passivated correctly",stringData,sb.getParentDTOStringData());
  Assert.assertNull("Transient string data of dto defined in parent of sfsb has to be null after passivation",sb.getParentDTOTransientStringData());
}
