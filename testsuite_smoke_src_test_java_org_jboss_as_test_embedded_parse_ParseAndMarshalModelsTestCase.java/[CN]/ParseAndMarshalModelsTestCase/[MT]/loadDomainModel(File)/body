{
  final QName rootElement=new QName(Namespace.CURRENT.getUriString(),"domain");
  final DomainXml parser=new DomainXml(Module.getBootModuleLoader());
  final XmlConfigurationPersister persister=new XmlConfigurationPersister(file,rootElement,parser,parser);
  final List<ModelNode> ops=persister.load();
  final ModelNode model=new ModelNode();
  final NewModelController controller=createController(model,new Setup(){
    public void setup(    ModelNode model,    ModelNodeRegistration rootRegistration){
      NewDomainModelUtil.updateCoreModel(model);
      NewDomainModelUtil.initializeMasterDomainRegistry(rootRegistration,persister,null,new MockFileRepository(),null,null);
    }
  }
);
  final ModelNode caputreModelOp=new ModelNode();
  caputreModelOp.get(OP_ADDR).set(PathAddress.EMPTY_ADDRESS.toModelNode());
  caputreModelOp.get(OP).set("capture-model");
  final List<ModelNode> toRun=new ArrayList<ModelNode>(ops);
  toRun.add(caputreModelOp);
  executeOperations(controller,toRun);
  executeOperations(controller,toRun);
  persister.store(model,null);
  return model;
}
