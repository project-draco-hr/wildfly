{
  File file=new File(javaHome);
  if (!file.exists()) {
    throw new IllegalStateException("Java home '" + file.getAbsolutePath() + "' does not exist.");
  }
  file=new File(file,"bin");
  if (!file.exists()) {
    throw new IllegalStateException("Java home's bin '" + file.getAbsolutePath() + "' does not exist. The home directory was determined to be "+ file.getParentFile().getAbsolutePath()+ ".");
  }
  File java=new File(file,"java");
  if (!java.exists()) {
    java=new File(file,"java.exe");
  }
  if (!java.exists()) {
    throw new IllegalStateException("Could not find java executable under " + file.getAbsolutePath());
  }
  return java.getAbsolutePath();
}
