{
  final ModelNode address=operation.require(OP_ADDR);
  final String dsName=PathAddress.pathAddress(address).getLastElement().getValue();
  final String jndiName=model.get(JNDINAME.getName()).asString();
  final ServiceTarget serviceTarget=context.getServiceTarget();
  boolean enabled=false;
  ModelNode node=operation.require(DATASOURCE_DRIVER.getName());
  AbstractDataSourceService dataSourceService=createDataSourceService(dsName);
  final ManagementResourceRegistration registration=context.getResourceRegistrationForUpdate();
  final ServiceName dataSourceServiceName=AbstractDataSourceService.SERVICE_NAME_BASE.append(jndiName);
  final ServiceBuilder<?> dataSourceServiceBuilder=serviceTarget.addService(dataSourceServiceName,dataSourceService).addDependency(ConnectorServices.TRANSACTION_INTEGRATION_SERVICE,TransactionIntegration.class,dataSourceService.getTransactionIntegrationInjector()).addDependency(ConnectorServices.MANAGEMENT_REPOSITORY_SERVICE,ManagementRepository.class,dataSourceService.getManagementRepositoryInjector()).addDependency(SubjectFactoryService.SERVICE_NAME,SubjectFactory.class,dataSourceService.getSubjectFactoryInjector()).addDependency(ConnectorServices.JDBC_DRIVER_REGISTRY_SERVICE,DriverRegistry.class,dataSourceService.getDriverRegistryInjector()).addDependency(ConnectorServices.CCM_SERVICE,CachedConnectionManager.class,dataSourceService.getCcmInjector()).addDependency(ConnectorServices.IDLE_REMOVER_SERVICE).addDependency(ConnectorServices.CONNECTION_VALIDATOR_SERVICE).addDependency(NamingService.SERVICE_NAME);
  dataSourceServiceBuilder.addListener(new DataSourceStatisticsListener(registration,dsName));
  startConfigAndAddDependency(dataSourceServiceBuilder,dataSourceService,dsName,serviceTarget,operation,verificationHandler);
  final String driverName=node.asString();
  final ServiceName driverServiceName=ServiceName.JBOSS.append("jdbc-driver",driverName.replaceAll("\\.","_"));
  if (!context.isBooting()) {
    final ServiceRegistry registry=context.getServiceRegistry(true);
    final ServiceController<?> dataSourceController=registry.getService(driverServiceName);
    if (driverServiceName != null && dataSourceController != null) {
      dataSourceServiceBuilder.addDependency(driverServiceName,Driver.class,dataSourceService.getDriverInjector());
    }
 else {
      throw new OperationFailedException(MESSAGES.driverNotPresent(driverName));
    }
  }
 else {
    dataSourceServiceBuilder.addDependency(driverServiceName,Driver.class,dataSourceService.getDriverInjector());
  }
  dataSourceServiceBuilder.setInitialMode(ServiceController.Mode.NEVER);
  controllers.add(dataSourceServiceBuilder.install());
}
