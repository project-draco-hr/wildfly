{
  Date nextExpiration=timer.getNextExpiration();
  if (nextExpiration == null) {
    logger.info("Next expiration is null. No tasks will be scheduled for timer " + timer);
    return;
  }
  final Runnable timerTask=timer.getTimerTask();
  long delay=nextExpiration.getTime() - System.currentTimeMillis();
  if (delay < 0) {
    delay=0;
  }
  long intervalDuration=timer.getInterval();
  if (intervalDuration > 0) {
    logger.debug("Scheduling timer " + timer + " at fixed rate, starting at "+ delay+ " milli seconds from now with repeated interval="+ intervalDuration);
    final Task task=new Task(timerTask);
    this.timer.scheduleAtFixedRate(task,delay,intervalDuration);
    this.scheduledTimerFutures.put(timer.getTimerHandle(),task);
  }
 else {
    logger.debug("Scheduling a single action timer " + timer + " starting at "+ delay+ " milli seconds from now");
    this.timer.schedule(new Task(timerTask),delay);
    final Task task=new Task(timerTask);
    this.scheduledTimerFutures.put(timer.getTimerHandle(),task);
  }
}
