{
  final CompositeIndex compositeIndex=getDeploymentUnit().getAttachment(Attachments.COMPOSITE_ANNOTATION_INDEX);
  if (compositeIndex == null) {
    log.infof("Cannot find composite annotation index in: %s",getDeploymentUnit());
    return null;
  }
  final DotName dotName=DotName.createSimple(Inject.class.getName());
  final List<AnnotationInstance> annotationList=compositeIndex.getAnnotations(dotName);
  if (annotationList.isEmpty()) {
    return this;
  }
  for (  AnnotationInstance instance : annotationList) {
    final AnnotationTarget target=instance.target();
    if (target instanceof FieldInfo) {
      final FieldInfo fieldInfo=(FieldInfo)target;
      ClassInfo declaringClass=fieldInfo.declaringClass();
      DotName name=declaringClass.name();
      if ("org.osgi.framework.BundleContext".equals(name.toString())) {
        Framework framework=awaitActiveOSGiFramework();
        bundleContext=framework.getBundleContext();
        BundleContextAssociation.setBundleContext(bundleContext);
      }
    }
  }
  return this;
}
