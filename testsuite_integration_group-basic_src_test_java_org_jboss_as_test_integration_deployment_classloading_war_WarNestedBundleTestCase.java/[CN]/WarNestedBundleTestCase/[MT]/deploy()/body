{
  final WebArchive war=ShrinkWrap.create(WebArchive.class,"as945.war");
  war.addClass(WarNestedBundleTestCase.class);
  final JavaArchive libJar=ShrinkWrap.create(JavaArchive.class,"nested-bundle.jar");
  libJar.addClass(WebInfLibClass.class);
  libJar.setManifest(new Asset(){
    public InputStream openStream(){
      OSGiManifestBuilder builder=OSGiManifestBuilder.newInstance();
      builder.addBundleSymbolicName(libJar.getName());
      builder.addBundleManifestVersion(2);
      return builder.openStream();
    }
  }
);
  war.addAsLibraries(libJar);
  return war;
}
