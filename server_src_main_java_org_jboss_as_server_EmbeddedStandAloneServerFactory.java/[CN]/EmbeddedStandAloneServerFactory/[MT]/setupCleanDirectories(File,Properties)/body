{
  File tempRoot=getTempRoot(props);
  if (tempRoot == null) {
    return;
  }
  File originalConfigDir=getFileUnderAsRoot(jbossHomeDir,props,ServerEnvironment.SERVER_CONFIG_DIR,"configuration",true);
  File originalDataDir=getFileUnderAsRoot(jbossHomeDir,props,ServerEnvironment.SERVER_DATA_DIR,"data",false);
  File configDir=new File(tempRoot,"config");
  configDir.mkdir();
  File dataDir=new File(tempRoot,"data");
  dataDir.mkdir();
  File deploymentsDir=new File(tempRoot,"deployments");
  deploymentsDir.mkdir();
  copyDirectory(originalConfigDir,configDir);
  if (originalDataDir.exists()) {
    copyDirectory(originalDataDir,dataDir);
  }
  props.put(ServerEnvironment.SERVER_BASE_DIR,tempRoot.getAbsolutePath());
  props.put(ServerEnvironment.SERVER_CONFIG_DIR,configDir.getAbsolutePath());
  props.put(ServerEnvironment.SERVER_DATA_DIR,dataDir.getAbsolutePath());
}
