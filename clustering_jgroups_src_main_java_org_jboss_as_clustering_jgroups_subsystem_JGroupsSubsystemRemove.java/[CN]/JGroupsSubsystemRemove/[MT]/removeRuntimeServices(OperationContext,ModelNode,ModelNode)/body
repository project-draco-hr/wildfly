{
  if (model.hasDefined(ModelKeys.STACK)) {
    List<Property> stacks=model.get(ModelKeys.STACK).asPropertyList();
    for (    Property stack : stacks) {
      PathAddress address=PathAddress.pathAddress(JGroupsExtension.SUBSYSTEM_PATH).append(ModelKeys.STACK,stack.getName());
      ModelNode removeStack=Util.createOperation(REMOVE,address);
      ProtocolStackAdd.INSTANCE.removeRuntimeServices(context,removeStack,stack.getValue());
    }
  }
  ServiceName protocolDefaultsService=ProtocolDefaultsService.SERVICE_NAME;
  context.removeService(protocolDefaultsService);
  ServiceName defaultChannelFactoryService=ChannelFactoryService.getServiceName(null);
  context.removeService(defaultChannelFactoryService);
}
