{
  ConstraintFactory constraintFactory=new TestConstraintFactory(allowedRoles);
  TestRoleMapper roleMapper=new TestRoleMapper(userRoles);
  DefaultPermissionFactory permissionFactory=new DefaultPermissionFactory(combinationPolicy,roleMapper,Collections.singleton(constraintFactory),null);
  Action action=new Action(null,null,EnumSet.of(Action.ActionEffect.ADDRESS));
  TargetResource targetResource=TargetResource.forStandalone(PathAddress.EMPTY_ADDRESS,ROOT_RR,null);
  TargetAttribute targetAttribute=new TargetAttribute(null,new ModelNode(),targetResource);
  PermissionCollection userPermissions=permissionFactory.getUserPermissions(caller,environment,action,targetAttribute);
  PermissionCollection requiredPermissions=permissionFactory.getRequiredPermissions(action,targetAttribute);
  for (  Permission requiredPermission : toSet(requiredPermissions)) {
    assertEquals(accessExpectation,userPermissions.implies(requiredPermission));
  }
}
