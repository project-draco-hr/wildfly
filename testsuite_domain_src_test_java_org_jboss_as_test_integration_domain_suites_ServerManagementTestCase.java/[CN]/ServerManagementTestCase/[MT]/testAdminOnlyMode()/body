{
  final DomainClient masterClient=domainMasterLifecycleUtil.getDomainClient();
  ModelNode op=new ModelNode();
  op.get(OP_ADDR).add(HOST,"master");
  op.get(OP).set("reload");
  op.get("admin-only").set(true);
  domainMasterLifecycleUtil.executeAwaitConnectionClosed(op);
  domainMasterLifecycleUtil.connect();
  op=new ModelNode();
  op.get(OP).set(READ_ATTRIBUTE_OPERATION);
  op.get(OP_ADDR).add(HOST,"master");
  op.get(NAME).set("running-mode");
  final ModelNode result=executeForResult(masterClient,op);
  Assert.assertEquals("ADMIN_ONLY",result.asString());
  op=new ModelNode();
  op.get(OP_ADDR).add(HOST,"master");
  op.get(OP).set("reload");
  op.get("admin-only").set(false);
  domainMasterLifecycleUtil.executeAwaitConnectionClosed(op);
  domainMasterLifecycleUtil.connect();
  domainMasterLifecycleUtil.awaitServers(System.currentTimeMillis());
  waitForHost(masterClient,"slave");
  domainSlaveLifecycleUtil.awaitServers(System.currentTimeMillis());
}
