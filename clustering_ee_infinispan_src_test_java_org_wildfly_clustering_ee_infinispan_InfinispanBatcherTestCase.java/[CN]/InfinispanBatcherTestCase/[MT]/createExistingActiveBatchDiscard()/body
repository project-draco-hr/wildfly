{
  Transaction tx=mock(Transaction.class);
  when(this.tm.getTransaction()).thenReturn(tx);
  when(tx.getStatus()).thenReturn(Status.STATUS_ACTIVE,Status.STATUS_ACTIVE,Status.STATUS_MARKED_ROLLBACK);
  try (TransactionBatch batch=this.batcher.createBatch()){
    verify(this.tm,never()).begin();
    assertSame(tx,batch.getTransaction());
    batch.discard();
    verify(tx).setRollbackOnly();
  }
   verify(tx,never()).rollback();
}
