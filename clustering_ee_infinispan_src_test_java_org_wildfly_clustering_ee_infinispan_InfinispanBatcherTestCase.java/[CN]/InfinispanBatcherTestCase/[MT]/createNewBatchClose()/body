{
  Transaction tx=mock(Transaction.class);
  when(this.tm.getTransaction()).thenReturn(null,tx);
  try (TransactionBatch batch=this.batcher.createBatch()){
    verify(this.tm).begin();
    assertSame(tx,batch.getTransaction());
  }
   verify(tx).commit();
}
