{
  final String nodeIdentifier=NODE_IDENTIFIER.validateResolvedOperation(coreEnvModel).asString();
  final CoreEnvironmentService coreEnvironmentService=new CoreEnvironmentService(nodeIdentifier);
  String socketBindingName=null;
  if (PROCESS_ID_UUID.validateResolvedOperation(coreEnvModel).asBoolean()) {
    UuidProcessId id=new UuidProcessId();
    coreEnvironmentService.setProcessImplementation(id);
  }
 else {
    coreEnvironmentService.setProcessImplementationClassName(ProcessIdType.SOCKET.getClazz());
    socketBindingName=PROCESS_ID_SOCKET_BINDING.validateResolvedOperation(coreEnvModel).asString();
    int ports=PROCESS_ID_SOCKET_MAX_PORTS.validateResolvedOperation(coreEnvModel).asInt();
    coreEnvironmentService.setSocketProcessIdMaxPorts(ports);
  }
  String varDirPathRef=null;
  final ModelNode relativePathNode=coreEnvModel.get(RELATIVE_TO.getName());
  if (!relativePathNode.isDefined() || relativePathNode.asString().length() > 0) {
    varDirPathRef=RELATIVE_TO.validateResolvedOperation(coreEnvModel).asString();
  }
  final String varDirPath=PATH.validateResolvedOperation(coreEnvModel).asString();
  if (ROOT_LOGGER.isDebugEnabled()) {
    ROOT_LOGGER.debugf("nodeIdentifier=%s\n",nodeIdentifier);
    ROOT_LOGGER.debugf("varDirPathRef=%s, varDirPath=%s\n",varDirPathRef,varDirPath);
  }
  ServiceTarget target=context.getServiceTarget();
  ServiceController<String> varDirRPS=varDirPathRef != null ? RelativePathService.addService(INTERNAL_CORE_ENV_VAR_PATH,varDirPath,varDirPathRef,target) : AbsolutePathService.addService(INTERNAL_CORE_ENV_VAR_PATH,varDirPath,target);
  controllers.add(varDirRPS);
  ServiceBuilder<?> coreEnvBuilder=context.getServiceTarget().addService(TxnServices.JBOSS_TXN_CORE_ENVIRONMENT,coreEnvironmentService);
  if (socketBindingName != null) {
    ServiceName bindingName=SocketBinding.JBOSS_BINDING_NAME.append(socketBindingName);
    coreEnvBuilder.addDependency(bindingName,SocketBinding.class,coreEnvironmentService.getSocketProcessBindingInjector());
  }
  controllers.add(coreEnvBuilder.addDependency(INTERNAL_CORE_ENV_VAR_PATH,String.class,coreEnvironmentService.getPathInjector()).addListener(verificationHandler).setInitialMode(ServiceController.Mode.ACTIVE).install());
}
