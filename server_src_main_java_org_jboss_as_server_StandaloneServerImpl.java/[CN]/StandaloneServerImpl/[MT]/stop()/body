{
  if (serviceContainer == null)   throw new IllegalStateException("Server not started");
  startStopLatch=new CountDownLatch(1);
  ServiceController<?> controller=serviceContainer.getService(ServerStartTask.AS_SERVER_SERVICE_NAME);
  ServiceListener<Object> listener=new AbstractServiceListener<Object>(){
    @Override public void serviceStopped(    ServiceController<? extends Object> controller){
      startStopLatch.countDown();
      serviceContainer=null;
    }
    @Override public void serviceFailed(    ServiceController<? extends Object> controller,    StartException reason){
      startStopLatch.countDown();
      serviceContainer=null;
    }
  }
;
  controller.addListener(listener);
  controller.setMode(Mode.REMOVE);
  try {
    startStopLatch.await(30,TimeUnit.SECONDS);
  }
 catch (  InterruptedException e) {
  }
}
