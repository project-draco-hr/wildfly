{
  if (serviceContainer == null) {
    throw new IllegalStateException("Server not started");
  }
  final CountDownLatch startStopLatch=new CountDownLatch(1);
  ServiceController<?> controller=serviceContainer.getService(ServerStartTask.AS_SERVER_SERVICE_NAME);
  controller.addListener(new AbstractServiceListener<Object>(){
    @Override public void listenerAdded(    ServiceController<? extends Object> controller){
      controller.setMode(Mode.REMOVE);
    }
    @Override public void serviceStopped(    ServiceController<? extends Object> controller){
      startStopLatch.countDown();
      serviceContainer=null;
    }
    @Override public void serviceFailed(    ServiceController<? extends Object> controller,    StartException reason){
      startStopLatch.countDown();
      serviceContainer=null;
    }
  }
);
  try {
    startStopLatch.await(30,TimeUnit.SECONDS);
  }
 catch (  InterruptedException e) {
  }
}
