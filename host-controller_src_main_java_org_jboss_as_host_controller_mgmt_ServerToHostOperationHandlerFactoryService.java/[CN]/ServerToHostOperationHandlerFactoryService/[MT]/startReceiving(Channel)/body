{
  final ManagementChannelHandler channelHandler=new ManagementChannelHandler(channel,executorService);
  channelHandler.getAttachments().attach(ManagementChannelHandler.TEMP_DIR,tempDir);
  final ServerToHostProtocolHandler registrationHandler=new ServerToHostProtocolHandler(serverInventory.getValue(),operationExecutor,domainController,channelHandler,registrations,expressionResolver);
  channelHandler.addHandlerFactory(new ManagementPongRequestHandler());
  channelHandler.addHandlerFactory(registrationHandler);
  channel.receiveMessage(channelHandler.getReceiver());
  return channelHandler;
}
