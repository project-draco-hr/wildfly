{
  ServiceName ldapServiceName=realmServiceName.append(UserLdapCallbackHandler.SERVICE_SUFFIX);
  UserLdapCallbackHandler ldapCallbackHandler=new UserLdapCallbackHandler(ldap);
  ServiceBuilder ldapBuilder=serviceTarget.addService(ldapServiceName,ldapCallbackHandler);
  String connectionManager=ldap.require(CONNECTION).asString();
  ldapBuilder.addDependency(LdapConnectionManagerService.BASE_SERVICE_NAME.append(connectionManager),ConnectionManager.class,ldapCallbackHandler.getConnectionManagerInjector());
  newControllers.add(ldapBuilder.setInitialMode(ServiceController.Mode.ON_DEMAND).install());
  return ldapServiceName;
}
