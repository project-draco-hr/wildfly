{
  ModelNode operationAddress=operation.require(OP_ADDR);
  PathAddress address=PathAddress.pathAddress(operationAddress);
  final String securityRealm=address.getLastElement().getValue();
  final ModelNode authentication=operation.hasDefined(AUTHENTICATION) ? operation.get(AUTHENTICATION) : null;
  final ModelNode serverIdentities=operation.hasDefined(SERVER_IDENTITIES) ? operation.get(SERVER_IDENTITIES) : null;
  final ModelNode subModel=context.getSubModel();
  if (serverIdentities != null) {
    subModel.get(SERVER_IDENTITIES).set(serverIdentities);
  }
  if (authentication != null) {
    subModel.get(AUTHENTICATION).set(authentication);
  }
  final ModelNode compensatingOperation=new ModelNode();
  if (context.getRuntimeContext() != null) {
    context.getRuntimeContext().setRuntimeTask(new SecurityRealmAddTask(securityRealm,serverIdentities,authentication));
  }
 else {
    resultHandler.handleResultComplete();
  }
  return new BasicOperationResult(compensatingOperation);
}
