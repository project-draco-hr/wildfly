{
  if (context.getAttachment(ModuleConfig.ATTACHMENT_KEY) != null)   return;
  final VirtualFile deploymentRoot=getVirtualFileAttachment(context);
  final MountHandle deploymentRootMountHandler=context.getAttachment(MountHandle.ATTACHMENT_KEY);
  final ModuleIdentifier moduleIdentifier=ModuleIdentifier.create("deployment." + deploymentRoot.getName());
  final ModuleConfig.ResourceRoot[] resourceRoots=new ModuleConfig.ResourceRoot[]{new ModuleConfig.ResourceRoot(deploymentRoot,deploymentRootMountHandler)};
  final ModuleDependencies dependenciesAttachment=getAttachedDependencies(context);
  final ModuleConfig.Dependency[] dependencies=dependenciesAttachment != null ? dependenciesAttachment.getDependencies() : NO_DEPS;
  final ModuleConfig moduleConfig=new ModuleConfig(moduleIdentifier,dependencies,resourceRoots);
  context.putAttachment(ModuleConfig.ATTACHMENT_KEY,moduleConfig);
}
