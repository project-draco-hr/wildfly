{
  long timeout=operationTimeout * 1000;
  long sleep=100;
  while (timeout > 0) {
    if (shouldBeStarted == client.isServerStarted(server)) {
      break;
    }
    try {
      Thread.sleep(sleep);
      timeout-=sleep;
    }
 catch (    InterruptedException e) {
      throw new RuntimeException("Failed waiting for server to " + (shouldBeStarted ? "start" : "stop"),e);
    }
  }
  if (timeout <= 0) {
    throw new RuntimeException("Server did not " + (shouldBeStarted ? "start" : "stop") + " within set timeout [serverOperationTimeoutInSeconds="+ operationTimeout+ "]. "+ server);
  }
}
