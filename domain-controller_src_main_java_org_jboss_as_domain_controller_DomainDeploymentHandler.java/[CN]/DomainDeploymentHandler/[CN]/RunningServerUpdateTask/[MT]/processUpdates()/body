{
  try {
    logger.debugf("Applying %s updates to  %s",updates.getServerUpdates().size(),serverId);
    List<UpdateResultHandlerResponse<?>> rsps=domainController.applyUpdatesToServer(serverId,updates.getServerUpdates(),allowOverallRollback);
    updates.serverResults.put(serverId,rsps);
    updatePolicy.recordServerResult(serverId,rsps);
    DeploymentAction lastResponseAction=null;
    for (int i=0; i < rsps.size(); i++) {
      UpdateResultHandlerResponse<?> urhr=rsps.get(i);
      if (urhr.getFailureResult() != null || updates.isLastServerUpdateForAction(i)) {
        DeploymentAction action=updates.getDeploymentActionForServerUpdate(i);
        if (action != lastResponseAction) {
          sendServerUpdateResult(action.getId(),urhr);
          lastResponseAction=action;
        }
      }
    }
  }
 catch (  Exception e) {
    logger.errorf(e,"Caught exception applying updates to %s",serverId);
  }
}
