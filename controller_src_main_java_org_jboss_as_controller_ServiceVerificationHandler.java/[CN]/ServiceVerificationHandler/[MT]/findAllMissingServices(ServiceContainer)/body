{
  Set<ServiceName> result=new HashSet<ServiceName>();
  for (  ServiceName serviceName : container.getServiceNames()) {
    ServiceController<?> controller=container.getService(serviceName);
    if (controller != null && controller.getMode() != ServiceController.Mode.NEVER && controller.getMode() != ServiceController.Mode.REMOVE && controller.getSubstate() == ServiceController.Substate.PROBLEM) {
      result.addAll(controller.getImmediateUnavailableDependencies());
    }
  }
  return result;
}
