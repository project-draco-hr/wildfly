{
  String identifier=operation.get(ModelDescriptionConstants.OP_ADDR).asObject().get(CommonAttributes.MODULE).asString();
  SubsystemState stateService=(SubsystemState)context.getServiceRegistry(true).getRequiredService(SubsystemState.SERVICE_NAME).getValue();
  OSGiModule prevModule=stateService.removeModule(identifier);
  if (context.completeStep() == OperationContext.ResultAction.ROLLBACK) {
    stateService.addModule(prevModule);
  }
}
