{
  final AdditionalInitialization additionalInit=createAdditionalInitialization();
  final String subsystemXml=configId == null ? getSubsystemXml() : getSubsystemXml(configId);
  final KernelServices servicesA=super.installInController(additionalInit,subsystemXml);
  Assert.assertNotNull(servicesA);
  final ModelNode modelA=servicesA.readWholeModel();
  Assert.assertNotNull(modelA);
  final String marshalled=servicesA.getPersistedSubsystemXml();
  servicesA.shutdown();
  String normalizedSubsystem=normalizeXML(subsystemXml);
  compareXml(configId,normalizedSubsystem,normalizeXML(marshalled));
  final KernelServices servicesB=super.installInController(additionalInit,marshalled);
  final ModelNode modelB=servicesB.readWholeModel();
  super.compare(modelA,modelB);
  final ModelNode operation=createDescribeOperation();
  final ModelNode result=servicesB.executeOperation(operation);
  Assert.assertTrue("the subsystem describe operation has to generate a list of operations to recreate the subsystem",!result.hasDefined(ModelDescriptionConstants.FAILURE_DESCRIPTION));
  final List<ModelNode> operations=result.get(ModelDescriptionConstants.RESULT).asList();
  servicesB.shutdown();
  final KernelServices servicesC=super.installInController(additionalInit,operations);
  final ModelNode modelC=servicesC.readWholeModel();
  super.compare(modelA,modelC);
  super.assertRemoveSubsystemResources(servicesA,getIgnoredChildResourcesForRemovalTest());
}
