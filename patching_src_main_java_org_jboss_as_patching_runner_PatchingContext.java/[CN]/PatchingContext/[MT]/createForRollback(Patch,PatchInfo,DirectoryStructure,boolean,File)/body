{
  final File backup=workDir;
  final String patchId=patch.getPatchId();
  final File historyDir=structure.getHistoryDir(patchId);
  final File miscRoot=new File(historyDir,PatchContentLoader.MISC);
  final File modulesRoot=structure.getModulePatchDirectory(patchId);
  final File bundlesRoot=structure.getBundlesPatchDirectory(patchId);
  final PatchContentLoader loader=new PatchContentLoader(miscRoot,bundlesRoot,modulesRoot);
  final ContentVerificationPolicy policy=overrideAll ? ContentVerificationPolicy.OVERRIDE_ALL : ContentVerificationPolicy.STRICT;
  return new PatchingContext(patch,current,structure,backup,policy,loader);
}
