{
  final File parent=file.getParentFile();
  if (!parent.isDirectory()) {
    if (!parent.mkdirs() && !parent.exists()) {
      throw PatchMessages.MESSAGES.cannotCreateDirectory(file.getAbsolutePath());
    }
  }
  try {
    final OutputStream os=new FileOutputStream(file);
    try {
      PatchXml.marshal(os,patch);
    }
  finally {
      IoUtils.safeClose(os);
    }
  }
 catch (  XMLStreamException e) {
    throw new IOException(e);
  }
}
