{
  if (cursor != buffer.length()) {
    return -1;
  }
  int cmdFirstIndex=0;
  while (cmdFirstIndex < buffer.length()) {
    if (!Character.isWhitespace(buffer.charAt(cmdFirstIndex))) {
      break;
    }
    ++cmdFirstIndex;
  }
  if (cmdFirstIndex == buffer.length()) {
    for (    String cmd : cmdRegistry.getTabCompletionCommands()) {
      CommandHandler handler=cmdRegistry.getCommandHandler(cmd);
      if (handler.isAvailable(ctx)) {
        candidates.add(cmd);
      }
    }
    return cmdFirstIndex;
  }
  final DefaultCallbackHandler parsedCmd=(DefaultCallbackHandler)ctx.getParsedCommandLine();
  try {
    parsedCmd.parse(ctx.getPrefix(),buffer);
  }
 catch (  CommandFormatException e) {
    if (!parsedCmd.endsOnAddressOperationNameSeparator() || !parsedCmd.endsOnSeparator()) {
      return -1;
    }
  }
  final OperationCandidatesProvider candidatesProvider;
  char firstChar=buffer.charAt(cmdFirstIndex);
  if (firstChar == '.' || firstChar == ':' || firstChar == '/') {
    candidatesProvider=ctx.getOperationCandidatesProvider();
  }
 else {
    candidatesProvider=cmdProvider;
  }
  return OperationRequestCompleter.INSTANCE.complete(ctx,parsedCmd,candidatesProvider,buffer,cursor,candidates);
}
