{
  int firstCharIndex=0;
  while (firstCharIndex < buffer.length()) {
    if (!Character.isWhitespace(buffer.charAt(firstCharIndex))) {
      break;
    }
    ++firstCharIndex;
  }
  if (firstCharIndex == buffer.length()) {
    candidates.addAll(commands);
    return firstCharIndex;
  }
  char firstChar=buffer.charAt(firstCharIndex);
  if (firstChar == '.' || firstChar == ':' || firstChar == '/') {
    return -1;
  }
  if (buffer.startsWith("cd ",firstCharIndex) || buffer.startsWith("cn ",firstCharIndex)) {
    String opBuffer=buffer.substring(firstCharIndex + 3);
    int result=opCompleter.doComplete(opBuffer,candidates,false);
    if (result >= 0) {
      return firstCharIndex + 3 + result;
    }
 else {
      return result;
    }
  }
  String cmdChunk=buffer.substring(firstCharIndex);
  for (  String command : commands) {
    if (command.startsWith(cmdChunk))     candidates.add(command);
  }
  return buffer.length() - cmdChunk.length();
}
