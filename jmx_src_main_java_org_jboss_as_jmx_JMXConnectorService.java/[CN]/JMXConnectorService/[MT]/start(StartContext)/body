{
  log.info("Starting remote JMX connector");
  setRmiServerProperty(serverPortBinding.getValue().getAddress().getHostAddress());
  try {
    SocketBinding registryBinding=registryPortBinding.getValue();
    RMIServerSocketFactory registrySocketFactory=new JMXServerSocketFactory(registryBinding);
    SocketBinding rmiServerBinding=serverPortBinding.getValue();
    RMIServerSocketFactory serverSocketFactory=new JMXServerSocketFactory(rmiServerBinding);
    registry=LocateRegistry.createRegistry(getRmiRegistryPort(),null,registrySocketFactory);
    HashMap<String,Object> env=new HashMap<String,Object>();
    rmiServer=new RMIJRMPServerImpl(getRmiServerPort(),null,serverSocketFactory,env);
    JMXServiceURL url=buildJMXServiceURL();
    adapter=new RMIConnectorServer(url,env,rmiServer,injectedMBeanServer.getValue());
    adapter.start();
    registry.rebind(RMI_BIND_NAME,rmiServer.toStub());
  }
 catch (  Exception e) {
    throw new StartException(e);
  }
}
