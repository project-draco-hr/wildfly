{
  if (path.startsWith("/"))   return getPersistenceUnit(getTopLevel(current),path.substring(1));
  if (path.startsWith("./"))   return getPersistenceUnit(current,path.substring(2));
  if (path.startsWith("../"))   return getPersistenceUnit(current.getParent(),path.substring(3));
  int i=path.indexOf('/');
  String name;
  if (i == -1)   name=path;
 else   name=path.substring(0,i);
  List<ResourceRoot> resourceRoots=current.getAttachmentList(Attachments.RESOURCE_ROOTS);
  for (  ResourceRoot resourceRoot : resourceRoots) {
    PersistenceUnitMetadataHolder holder=resourceRoot.getAttachment(PersistenceUnitMetadataHolder.PERSISTENCE_UNITS);
    if (holder != null) {
      for (      PersistenceUnitMetadata pu : holder.getPersistenceUnits()) {
        if (pu.getPersistenceUnitName().equals(name)) {
          return pu;
        }
      }
    }
  }
  throw new IllegalArgumentException("Can't find a deployment unit named " + name + " at "+ current);
}
