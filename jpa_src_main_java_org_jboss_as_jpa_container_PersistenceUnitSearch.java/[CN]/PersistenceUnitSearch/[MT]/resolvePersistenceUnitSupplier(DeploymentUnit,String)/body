{
  if (traceEnabled) {
    log.tracef("pu search for name '%s' inside of %s",persistenceUnitName,deploymentUnit.getName());
  }
  int i=(persistenceUnitName == null ? -1 : persistenceUnitName.indexOf('#'));
  if (i != -1) {
    String path=persistenceUnitName.substring(0,i);
    PersistenceUnitMetadata pu=getPersistenceUnit(deploymentUnit,path);
    if (traceEnabled) {
      log.trace("pu search found " + pu.getScopedPersistenceUnitName());
    }
    return pu.getScopedPersistenceUnitName();
  }
 else {
    String name=findPersistenceUnitSupplier(deploymentUnit,persistenceUnitName);
    if (traceEnabled) {
      if (name != null) {
        log.trace("pu search found " + name);
      }
    }
    return name;
  }
}
