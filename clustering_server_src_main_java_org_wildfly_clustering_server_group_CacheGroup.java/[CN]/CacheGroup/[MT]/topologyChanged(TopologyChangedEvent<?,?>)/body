{
  if (event.isPre())   return;
  List<Address> oldAddresses=event.getConsistentHashAtStart().getMembers();
  List<Node> oldNodes=this.getNodes(oldAddresses);
  List<Address> newAddresses=event.getConsistentHashAtEnd().getMembers();
  List<Node> newNodes=this.getNodes(newAddresses);
  Set<Address> obsolete=new HashSet<>(oldAddresses);
  obsolete.removeAll(newAddresses);
  this.factory.invalidate(obsolete);
  int viewId=event.getCache().getCacheManager().getTransport().getViewId();
  Boolean status=this.views.get(viewId);
  boolean merged=(status != null) ? status.booleanValue() : false;
  for (  Listener listener : this.listeners) {
    listener.membershipChanged(oldNodes,newNodes,merged);
  }
  this.views.headMap(viewId).clear();
}
