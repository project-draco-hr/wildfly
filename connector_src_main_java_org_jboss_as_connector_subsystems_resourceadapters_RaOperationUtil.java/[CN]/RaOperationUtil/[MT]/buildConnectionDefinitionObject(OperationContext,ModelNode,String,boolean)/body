{
  Map<String,String> configProperties=new HashMap<String,String>(0);
  String className=ModelNodeUtil.getResolvedStringIfSetOrGetDefault(context,recoveryEnvModel,CLASS_NAME);
  String jndiName=ModelNodeUtil.getResolvedStringIfSetOrGetDefault(context,recoveryEnvModel,JNDINAME);
  boolean enabled=ModelNodeUtil.getBooleanIfSetOrGetDefault(context,recoveryEnvModel,ENABLED);
  boolean useJavaContext=ModelNodeUtil.getBooleanIfSetOrGetDefault(context,recoveryEnvModel,USE_JAVA_CONTEXT);
  boolean useCcm=ModelNodeUtil.getBooleanIfSetOrGetDefault(context,recoveryEnvModel,USE_CCM);
  int maxPoolSize=ModelNodeUtil.getIntIfSetOrGetDefault(context,recoveryEnvModel,MAX_POOL_SIZE);
  int minPoolSize=ModelNodeUtil.getIntIfSetOrGetDefault(context,recoveryEnvModel,MIN_POOL_SIZE);
  boolean prefill=ModelNodeUtil.getBooleanIfSetOrGetDefault(context,recoveryEnvModel,POOL_PREFILL);
  boolean useStrictMin=ModelNodeUtil.getBooleanIfSetOrGetDefault(context,recoveryEnvModel,POOL_USE_STRICT_MIN);
  String flushStrategyString=POOL_FLUSH_STRATEGY.resolveModelAttribute(context,recoveryEnvModel).asString();
  final FlushStrategy flushStrategy=FlushStrategy.forName(flushStrategyString);
  Boolean isSameRM=ModelNodeUtil.getBooleanIfSetOrGetDefault(context,recoveryEnvModel,SAME_RM_OVERRIDE);
  boolean interlivng=ModelNodeUtil.getBooleanIfSetOrGetDefault(context,recoveryEnvModel,INTERLEAVING);
  boolean padXid=ModelNodeUtil.getBooleanIfSetOrGetDefault(context,recoveryEnvModel,PAD_XID);
  boolean wrapXaResource=ModelNodeUtil.getBooleanIfSetOrGetDefault(context,recoveryEnvModel,WRAP_XA_RESOURCE);
  boolean noTxSeparatePool=ModelNodeUtil.getBooleanIfSetOrGetDefault(context,recoveryEnvModel,NOTXSEPARATEPOOL);
  Integer allocationRetry=ModelNodeUtil.getIntIfSetOrGetDefault(context,recoveryEnvModel,ALLOCATION_RETRY);
  Long allocationRetryWaitMillis=ModelNodeUtil.getLongIfSetOrGetDefault(context,recoveryEnvModel,ALLOCATION_RETRY_WAIT_MILLIS);
  Long blockingTimeoutMillis=ModelNodeUtil.getLongIfSetOrGetDefault(context,recoveryEnvModel,BLOCKING_TIMEOUT_WAIT_MILLIS);
  Long idleTimeoutMinutes=ModelNodeUtil.getLongIfSetOrGetDefault(context,recoveryEnvModel,IDLETIMEOUTMINUTES);
  Integer xaResourceTimeout=ModelNodeUtil.getIntIfSetOrGetDefault(context,recoveryEnvModel,XA_RESOURCE_TIMEOUT);
  CommonTimeOut timeOut=new CommonTimeOutImpl(blockingTimeoutMillis,idleTimeoutMinutes,allocationRetry,allocationRetryWaitMillis,xaResourceTimeout);
  CommonPool pool;
  if (isXa) {
    pool=new CommonXaPoolImpl(minPoolSize,maxPoolSize,prefill,useStrictMin,flushStrategy,isSameRM,interlivng,padXid,wrapXaResource,noTxSeparatePool);
  }
 else {
    pool=new CommonPoolImpl(minPoolSize,maxPoolSize,prefill,useStrictMin,flushStrategy);
  }
  String securityDomain=ModelNodeUtil.getResolvedStringIfSetOrGetDefault(context,recoveryEnvModel,SECURITY_DOMAIN);
  String securityDomainAndApplication=ModelNodeUtil.getResolvedStringIfSetOrGetDefault(context,recoveryEnvModel,SECURITY_DOMAIN_AND_APPLICATION);
  boolean application=ModelNodeUtil.getBooleanIfSetOrGetDefault(context,recoveryEnvModel,APPLICATION);
  CommonSecurity security=null;
  if (securityDomain != null || securityDomainAndApplication != null || application) {
    security=new CommonSecurityImpl(securityDomain,securityDomainAndApplication,application);
  }
  Long backgroundValidationMillis=ModelNodeUtil.getLongIfSetOrGetDefault(context,recoveryEnvModel,BACKGROUNDVALIDATIONMILLIS);
  boolean backgroundValidation=ModelNodeUtil.getBooleanIfSetOrGetDefault(context,recoveryEnvModel,BACKGROUNDVALIDATION);
  boolean useFastFail=ModelNodeUtil.getBooleanIfSetOrGetDefault(context,recoveryEnvModel,USE_FAST_FAIL);
  CommonValidation validation=new CommonValidationImpl(backgroundValidation,backgroundValidationMillis,useFastFail);
  final String recoveryUsername=ModelNodeUtil.getResolvedStringIfSetOrGetDefault(context,recoveryEnvModel,RECOVERY_USERNAME);
  final String recoveryPassword=ModelNodeUtil.getResolvedStringIfSetOrGetDefault(context,recoveryEnvModel,RECOVERY_PASSWORD);
  final String recoverySecurityDomain=ModelNodeUtil.getResolvedStringIfSetOrGetDefault(context,recoveryEnvModel,RECOVERY_SECURITY_DOMAIN);
  boolean noRecovery=ModelNodeUtil.getBooleanIfSetOrGetDefault(context,recoveryEnvModel,NO_RECOVERY);
  Recovery recovery=null;
  if ((recoveryUsername != null && recoveryPassword != null) || recoverySecurityDomain != null) {
    Credential credential=null;
    credential=new CredentialImpl(recoveryUsername,recoveryPassword,recoverySecurityDomain);
    Extension recoverPlugin=ModelNodeUtil.extractExtension(context,recoveryEnvModel,RECOVERLUGIN_CLASSNAME,RECOVERLUGIN_PROPERTIES);
    recovery=new Recovery(credential,recoverPlugin,noRecovery);
  }
  ModifiableConnDef connectionDefinition=new ModifiableConnDef(configProperties,className,jndiName,poolName,enabled,useJavaContext,useCcm,pool,timeOut,validation,security,recovery);
  return connectionDefinition;
}
