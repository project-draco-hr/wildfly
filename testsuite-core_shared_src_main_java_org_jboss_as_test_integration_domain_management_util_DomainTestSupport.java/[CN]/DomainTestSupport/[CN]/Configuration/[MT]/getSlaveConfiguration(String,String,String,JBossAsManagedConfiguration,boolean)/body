{
  File domains=getBaseDir(testName);
  File extraModules=getAddedModulesDir(testName);
  File overrideModules=getHostOverrideModulesDir(testName,hostName);
  ClassLoader tccl=Thread.currentThread().getContextClassLoader();
  final JBossAsManagedConfiguration slaveConfig=baseConfig == null ? new JBossAsManagedConfiguration() : baseConfig;
  configureModulePath(slaveConfig,overrideModules,extraModules);
  slaveConfig.setHostName(hostName);
  slaveConfig.setHostControllerManagementAddress(slaveAddress);
  slaveConfig.setHostControllerManagementPort(19999);
  slaveConfig.setHostCommandLineProperties("-Djboss.test.host.master.address=" + masterAddress + " -Djboss.test.host.slave.address="+ slaveAddress);
  slaveConfig.setReadOnlyHost(readOnlyHost);
  URL url=tccl.getResource(hostConfigPath);
  slaveConfig.setHostConfigFile(new File(toURI(url)).getAbsolutePath());
  File slaveDir=new File(domains,hostName);
  new File(slaveDir,"configuration").mkdirs();
  slaveConfig.setDomainDirectory(slaveDir.getAbsolutePath());
  if (slaveJvmHome != null)   slaveConfig.setJavaHome(slaveJvmHome);
  if (slaveControllerJvmHome != null)   slaveConfig.setControllerJavaHome(slaveControllerJvmHome);
  return slaveConfig;
}
