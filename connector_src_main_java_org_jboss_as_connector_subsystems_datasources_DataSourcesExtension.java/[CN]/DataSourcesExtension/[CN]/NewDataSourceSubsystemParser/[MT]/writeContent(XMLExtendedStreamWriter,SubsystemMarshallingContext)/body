{
  context.startSubsystemElement(Namespace.CURRENT.getUriString(),false);
  ModelNode node=context.getModelNode();
  writer.writeStartElement(DATASOURCES);
  if (node.hasDefined(DATA_SOURCE) || node.hasDefined(XA_DATASOURCE)) {
    List<Property> propertyList=node.hasDefined(DATA_SOURCE) ? node.get(DATA_SOURCE).asPropertyList() : new LinkedList<Property>();
    if (node.hasDefined(XA_DATASOURCE)) {
      propertyList.addAll(node.get(XA_DATASOURCE).asPropertyList());
    }
    for (    Property property : propertyList) {
      final ModelNode dataSourceNode=property.getValue();
      boolean isXADataSource=hasAnyOf(dataSourceNode,XA_RESOURCE_TIMEOUT,XADATASOURCECLASS,XADATASOURCE_PROPERTIES);
      writer.writeStartElement(isXADataSource ? DataSources.Tag.XA_DATASOURCE.getLocalName() : DataSources.Tag.DATASOURCE.getLocalName());
      JNDINAME.marshallAsAttribute(dataSourceNode,false,writer);
      POOLNAME.marshallAsAttribute(dataSourceNode,false,writer);
      ENABLED.marshallAsAttribute(dataSourceNode,false,writer);
      JTA.marshallAsAttribute(dataSourceNode,false,writer);
      USE_JAVA_CONTEXT.marshallAsAttribute(dataSourceNode,false,writer);
      SPY.marshallAsAttribute(dataSourceNode,false,writer);
      USE_CCM.marshallAsAttribute(dataSourceNode,false,writer);
      if (!isXADataSource) {
        CONNECTION_URL.marshallAsElement(dataSourceNode,false,writer);
        DRIVER_CLASS.marshallAsElement(dataSourceNode,false,writer);
        DATASOURCE_CLASS.marshallAsElement(dataSourceNode,false,writer);
        if (dataSourceNode.hasDefined(CONNECTION_PROPERTIES.getName())) {
          for (          Property connectionProperty : dataSourceNode.get(CONNECTION_PROPERTIES.getName()).asPropertyList()) {
            writeProperty(writer,dataSourceNode,connectionProperty.getName(),connectionProperty.getValue().get("value").asString(),DataSource.Tag.CONNECTION_PROPERTY.getLocalName());
          }
        }
      }
      if (isXADataSource) {
        if (dataSourceNode.hasDefined(XADATASOURCE_PROPERTIES.getName())) {
          for (          Property prop : dataSourceNode.get(XADATASOURCE_PROPERTIES.getName()).asPropertyList()) {
            writer.writeStartElement(XaDataSource.Tag.XA_DATASOURCE_PROPERTY.getLocalName());
            writer.writeAttribute("name",prop.getName());
            writer.writeCharacters(prop.getValue().asString());
            writer.writeEndElement();
          }
        }
        XADATASOURCECLASS.marshallAsElement(dataSourceNode,false,writer);
      }
      DATASOURCE_DRIVER.marshallAsElement(dataSourceNode,false,writer);
      if (isXADataSource) {
        URL_DELIMITER.marshallAsElement(dataSourceNode,false,writer);
        URL_SELECTOR_STRATEGY_CLASS_NAME.marshallAsElement(dataSourceNode,false,writer);
      }
      NEW_CONNECTION_SQL.marshallAsElement(dataSourceNode,false,writer);
      TRANSACTION_ISOLATION.marshallAsElement(dataSourceNode,false,writer);
      if (!isXADataSource) {
        URL_DELIMITER.marshallAsElement(dataSourceNode,false,writer);
        URL_SELECTOR_STRATEGY_CLASS_NAME.marshallAsElement(dataSourceNode,false,writer);
      }
      boolean poolRequired=hasAnyOf(dataSourceNode,MIN_POOL_SIZE,MAX_POOL_SIZE,POOL_PREFILL,POOL_USE_STRICT_MIN,POOL_FLUSH_STRATEGY);
      if (isXADataSource) {
        poolRequired=poolRequired || hasAnyOf(dataSourceNode,SAME_RM_OVERRIDE,INTERLEAVING,NOTXSEPARATEPOOL,PAD_XID,WRAP_XA_RESOURCE);
      }
      if (poolRequired) {
        writer.writeStartElement(isXADataSource ? XaDataSource.Tag.XA_POOL.getLocalName() : DataSource.Tag.POOL.getLocalName());
        MIN_POOL_SIZE.marshallAsElement(dataSourceNode,false,writer);
        MAX_POOL_SIZE.marshallAsElement(dataSourceNode,false,writer);
        POOL_PREFILL.marshallAsElement(dataSourceNode,false,writer);
        POOL_USE_STRICT_MIN.marshallAsElement(dataSourceNode,false,writer);
        POOL_FLUSH_STRATEGY.marshallAsElement(dataSourceNode,false,writer);
        if (isXADataSource) {
          SAME_RM_OVERRIDE.marshallAsElement(dataSourceNode,false,writer);
          INTERLEAVING.marshallAsElement(dataSourceNode,false,writer);
          NOTXSEPARATEPOOL.marshallAsElement(dataSourceNode,false,writer);
          PAD_XID.marshallAsElement(dataSourceNode,false,writer);
          WRAP_XA_RESOURCE.marshallAsElement(dataSourceNode,false,writer);
        }
        writer.writeEndElement();
      }
      boolean securityRequired=hasAnyOf(dataSourceNode,USERNAME,PASSWORD,SECURITY_DOMAIN,REAUTHPLUGIN_CLASSNAME,REAUTHPLUGIN_PROPERTIES);
      if (securityRequired) {
        writer.writeStartElement(DataSource.Tag.SECURITY.getLocalName());
        USERNAME.marshallAsElement(dataSourceNode,false,writer);
        PASSWORD.marshallAsElement(dataSourceNode,false,writer);
        SECURITY_DOMAIN.marshallAsElement(dataSourceNode,false,writer);
        if (dataSourceNode.hasDefined(REAUTHPLUGIN_CLASSNAME.getName())) {
          writer.writeStartElement(DsSecurity.Tag.REAUTH_PLUGIN.getLocalName());
          writer.writeAttribute(org.jboss.jca.common.api.metadata.common.Extension.Attribute.CLASS_NAME.getLocalName(),dataSourceNode.get(REAUTHPLUGIN_CLASSNAME.getName()).asString());
          if (dataSourceNode.hasDefined(REAUTHPLUGIN_PROPERTIES.getName())) {
            for (            Property connectionProperty : dataSourceNode.get(REAUTHPLUGIN_PROPERTIES.getName()).asPropertyList()) {
              writeProperty(writer,dataSourceNode,connectionProperty.getName(),connectionProperty.getValue().asString(),org.jboss.jca.common.api.metadata.common.Extension.Tag.CONFIG_PROPERTY.getLocalName());
            }
          }
          writer.writeEndElement();
        }
        writer.writeEndElement();
      }
      boolean recoveryRequired=hasAnyOf(dataSourceNode,RECOVERY_USERNAME,RECOVERY_PASSWORD,RECOVERY_SECURITY_DOMAIN,RECOVERLUGIN_CLASSNAME,NO_RECOVERY,RECOVERLUGIN_PROPERTIES);
      if (recoveryRequired) {
        writer.writeStartElement(XaDataSource.Tag.RECOVERY.getLocalName());
        NO_RECOVERY.marshallAsAttribute(dataSourceNode,false,writer);
        if (hasAnyOf(dataSourceNode,RECOVERY_USERNAME,RECOVERY_PASSWORD,RECOVERY_SECURITY_DOMAIN)) {
          writer.writeStartElement(Recovery.Tag.RECOVER_CREDENTIAL.getLocalName());
          RECOVERY_USERNAME.marshallAsElement(dataSourceNode,false,writer);
          RECOVERY_PASSWORD.marshallAsElement(dataSourceNode,false,writer);
          RECOVERY_SECURITY_DOMAIN.marshallAsElement(dataSourceNode,false,writer);
          writer.writeEndElement();
        }
        if (hasAnyOf(dataSourceNode,RECOVERLUGIN_CLASSNAME)) {
          writer.writeStartElement(Recovery.Tag.RECOVER_PLUGIN.getLocalName());
          writer.writeAttribute(org.jboss.jca.common.api.metadata.common.Extension.Attribute.CLASS_NAME.getLocalName(),dataSourceNode.get(RECOVERLUGIN_CLASSNAME.getName()).asString());
          if (dataSourceNode.hasDefined(RECOVERLUGIN_PROPERTIES.getName())) {
            for (            Property connectionProperty : dataSourceNode.get(RECOVERLUGIN_PROPERTIES.getName()).asPropertyList()) {
              writeProperty(writer,dataSourceNode,connectionProperty.getName(),connectionProperty.getValue().asString(),org.jboss.jca.common.api.metadata.common.Extension.Tag.CONFIG_PROPERTY.getLocalName());
            }
          }
          writer.writeEndElement();
        }
        writer.writeEndElement();
      }
      boolean validationRequired=hasAnyOf(dataSourceNode,VALIDCONNECTIONCHECKERCLASSNAME,VALIDCONNECTIONCHECKER_PROPERTIES,CHECKVALIDCONNECTIONSQL,VALIDATEONMATCH,BACKGROUNDVALIDATION,BACKGROUNDVALIDATIONMILLIS,USE_FAST_FAIL,STALECONNECTIONCHECKERCLASSNAME,STALECONNECTIONCHECKER_PROPERTIES,EXCEPTIONSORTERCLASSNAME,EXCEPTIONSORTER_PROPERTIES);
      if (validationRequired) {
        writer.writeStartElement(DataSource.Tag.VALIDATION.getLocalName());
        if (dataSourceNode.hasDefined(VALIDCONNECTIONCHECKERCLASSNAME.getName())) {
          writer.writeStartElement(Validation.Tag.VALID_CONNECTION_CHECKER.getLocalName());
          writer.writeAttribute(org.jboss.jca.common.api.metadata.common.Extension.Attribute.CLASS_NAME.getLocalName(),dataSourceNode.get(VALIDCONNECTIONCHECKERCLASSNAME.getName()).asString());
          if (dataSourceNode.hasDefined(VALIDCONNECTIONCHECKER_PROPERTIES.getName())) {
            for (            Property connectionProperty : dataSourceNode.get(VALIDCONNECTIONCHECKER_PROPERTIES.getName()).asPropertyList()) {
              writeProperty(writer,dataSourceNode,connectionProperty.getName(),connectionProperty.getValue().asString(),org.jboss.jca.common.api.metadata.common.Extension.Tag.CONFIG_PROPERTY.getLocalName());
            }
          }
          writer.writeEndElement();
        }
        CHECKVALIDCONNECTIONSQL.marshallAsElement(dataSourceNode,false,writer);
        VALIDATEONMATCH.marshallAsElement(dataSourceNode,false,writer);
        BACKGROUNDVALIDATION.marshallAsElement(dataSourceNode,false,writer);
        BACKGROUNDVALIDATIONMILLIS.marshallAsElement(dataSourceNode,false,writer);
        USE_FAST_FAIL.marshallAsElement(dataSourceNode,false,writer);
        if (dataSourceNode.hasDefined(STALECONNECTIONCHECKERCLASSNAME.getName())) {
          writer.writeStartElement(Validation.Tag.STALE_CONNECTION_CHECKER.getLocalName());
          writer.writeAttribute(org.jboss.jca.common.api.metadata.common.Extension.Attribute.CLASS_NAME.getLocalName(),dataSourceNode.get(STALECONNECTIONCHECKERCLASSNAME.getName()).asString());
          if (dataSourceNode.hasDefined(STALECONNECTIONCHECKER_PROPERTIES.getName())) {
            for (            Property connectionProperty : dataSourceNode.get(STALECONNECTIONCHECKER_PROPERTIES.getName()).asPropertyList()) {
              writeProperty(writer,dataSourceNode,connectionProperty.getName(),connectionProperty.getValue().asString(),org.jboss.jca.common.api.metadata.common.Extension.Tag.CONFIG_PROPERTY.getLocalName());
            }
          }
          writer.writeEndElement();
        }
        if (dataSourceNode.hasDefined(EXCEPTIONSORTERCLASSNAME.getName())) {
          writer.writeStartElement(Validation.Tag.EXCEPTION_SORTER.getLocalName());
          writer.writeAttribute(org.jboss.jca.common.api.metadata.common.Extension.Attribute.CLASS_NAME.getLocalName(),dataSourceNode.get(EXCEPTIONSORTERCLASSNAME.getName()).asString());
          if (dataSourceNode.hasDefined(EXCEPTIONSORTER_PROPERTIES.getName())) {
            for (            Property connectionProperty : dataSourceNode.get(EXCEPTIONSORTER_PROPERTIES.getName()).asPropertyList()) {
              writeProperty(writer,dataSourceNode,connectionProperty.getName(),connectionProperty.getValue().asString(),org.jboss.jca.common.api.metadata.common.Extension.Tag.CONFIG_PROPERTY.getLocalName());
            }
          }
          writer.writeEndElement();
        }
        writer.writeEndElement();
      }
      boolean timeoutRequired=hasAnyOf(dataSourceNode,BLOCKING_TIMEOUT_WAIT_MILLIS,IDLETIMEOUTMINUTES,SETTXQUERYTIMEOUT,QUERYTIMEOUT,USETRYLOCK,ALLOCATION_RETRY,ALLOCATION_RETRY_WAIT_MILLIS,XA_RESOURCE_TIMEOUT);
      if (timeoutRequired) {
        writer.writeStartElement(DataSource.Tag.TIMEOUT.getLocalName());
        BLOCKING_TIMEOUT_WAIT_MILLIS.marshallAsElement(dataSourceNode,false,writer);
        IDLETIMEOUTMINUTES.marshallAsElement(dataSourceNode,false,writer);
        SETTXQUERYTIMEOUT.marshallAsAttribute(dataSourceNode,false,writer);
        QUERYTIMEOUT.marshallAsElement(dataSourceNode,false,writer);
        USETRYLOCK.marshallAsElement(dataSourceNode,false,writer);
        ALLOCATION_RETRY.marshallAsElement(dataSourceNode,false,writer);
        ALLOCATION_RETRY_WAIT_MILLIS.marshallAsElement(dataSourceNode,false,writer);
        XA_RESOURCE_TIMEOUT.marshallAsElement(dataSourceNode,false,writer);
        writer.writeEndElement();
      }
      boolean statementRequired=hasAnyOf(dataSourceNode,TRACKSTATEMENTS,PREPAREDSTATEMENTSCACHESIZE,SHAREPREPAREDSTATEMENTS);
      if (statementRequired) {
        writer.writeStartElement(DataSource.Tag.STATEMENT.getLocalName());
        TRACKSTATEMENTS.marshallAsElement(dataSourceNode,false,writer);
        PREPAREDSTATEMENTSCACHESIZE.marshallAsElement(dataSourceNode,false,writer);
        SHAREPREPAREDSTATEMENTS.marshallAsElement(dataSourceNode,false,writer);
        writer.writeEndElement();
      }
      writer.writeEndElement();
    }
  }
  if (node.hasDefined(JDBC_DRIVER_NAME)) {
    writer.writeStartElement(DataSources.Tag.DRIVERS.getLocalName());
    for (    Property driverProperty : node.get(JDBC_DRIVER_NAME).asPropertyList()) {
      writer.writeStartElement(DataSources.Tag.DRIVER.getLocalName());
      writer.writeAttribute(Driver.Attribute.NAME.getLocalName(),driverProperty.getValue().require(DRIVER_NAME.getName()).asString());
      writeAttributeIfHas(writer,driverProperty.getValue(),Driver.Attribute.MODULE,DRIVER_MODULE_NAME.getName());
      writeAttributeIfHas(writer,driverProperty.getValue(),Driver.Attribute.MAJOR_VERSION,DRIVER_MAJOR_VERSION.getName());
      writeAttributeIfHas(writer,driverProperty.getValue(),Driver.Attribute.MINOR_VERSION,DRIVER_MINOR_VERSION.getName());
      writeElementIfHas(writer,driverProperty.getValue(),Driver.Tag.DRIVER_CLASS.getLocalName(),DRIVER_CLASS_NAME.getName());
      writeElementIfHas(writer,driverProperty.getValue(),Driver.Tag.XA_DATASOURCE_CLASS.getLocalName(),DRIVER_XA_DATASOURCE_CLASS_NAME.getName());
      writer.writeEndElement();
    }
    writer.writeEndElement();
  }
  writer.writeEndElement();
  writer.writeEndElement();
}
