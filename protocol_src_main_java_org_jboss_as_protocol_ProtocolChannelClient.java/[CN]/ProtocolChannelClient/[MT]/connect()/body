{
  if (closed) {
    throw new IllegalStateException("Closed this client");
  }
  if (connection != null) {
    throw new IllegalStateException("Already connected");
  }
  IoFuture<Connection> future=endpoint.connect(uri,OptionMap.EMPTY,"bob",endpoint.getName(),"pass".toCharArray());
  Status status=future.await(2000,TimeUnit.MILLISECONDS);
  if (status == Status.WAITING) {
    future.cancel();
    throw new ConnectException("Could not connect to remote server at " + uri + " within 2 seconds");
  }
  this.connection=future.get();
  return connection;
}
