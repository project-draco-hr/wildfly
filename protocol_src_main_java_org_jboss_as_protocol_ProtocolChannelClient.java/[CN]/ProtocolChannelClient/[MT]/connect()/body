{
synchronized (this) {
    if (connection != null) {
      throw new IllegalStateException("Already connected");
    }
    IoFuture<Connection> future=endpoint.connect(uri,OptionMap.EMPTY,"bob",endpoint.getName(),"pass".toCharArray());
    Status status=future.await(1000,TimeUnit.MILLISECONDS);
    if (status == Status.WAITING) {
      future.cancel();
      throw new ConnectException("Could not connect to remote server at " + uri);
    }
    this.connection=future.get();
    return connection;
  }
}
