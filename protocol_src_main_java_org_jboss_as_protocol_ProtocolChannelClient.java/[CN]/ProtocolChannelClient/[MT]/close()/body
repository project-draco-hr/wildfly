{
synchronized (channels) {
    for (    T channel : channels) {
      try {
        channel.writeShutdown();
      }
 catch (      IOException ignore) {
      }
      IoUtils.safeClose(channel);
      try {
        channel.awaitClosed();
      }
 catch (      InterruptedException e) {
        Thread.currentThread().interrupt();
      }
    }
    channels.clear();
  }
  IoUtils.safeClose(connection);
  if (startedEndpoint) {
    IoUtils.safeClose(providerRegistration);
    IoUtils.safeClose(endpoint);
  }
}
