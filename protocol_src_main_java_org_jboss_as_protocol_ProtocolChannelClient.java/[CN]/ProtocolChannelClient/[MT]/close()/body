{
  if (channel != null) {
    try {
      channel.writeShutdown();
    }
 catch (    IOException ignore) {
    }
    IoUtils.safeClose(channel);
    try {
      channel.awaitClosed();
    }
 catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
    }
  }
  IoUtils.safeClose(connection);
  IoUtils.safeClose(endpoint);
  readChannelThread.shutdown();
  writeChannelThread.shutdown();
  connectionChannelThread.shutdown();
}
