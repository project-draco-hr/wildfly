{
  if (closed) {
    throw new IllegalStateException("Closed this client");
  }
  if (connection != null) {
    throw new IllegalStateException("Already connected");
  }
  IoFuture<Connection> future;
  if (handler != null) {
    future=endpoint.connect(uri,OptionMap.EMPTY,handler);
  }
 else {
    future=endpoint.connect(uri,OptionMap.EMPTY,"TestUser",endpoint.getName(),"TestUserPassword".toCharArray());
  }
  Status status=future.await(connectTimeout,TimeUnit.MILLISECONDS);
  if (status == Status.WAITING) {
    future.cancel();
    throw new ConnectException("Could not connect to remote server at " + connectTimeout + " within "+ connectTimeout+ "ms");
  }
  this.connection=future.get();
  return connection;
}
