{
  if (configuration == null) {
    throw new IllegalArgumentException("Null configuration");
  }
  configuration.validate();
  final Endpoint endpoint;
  if (configuration.getEndpoint() != null) {
    endpoint=configuration.getEndpoint();
    return new ProtocolChannelClient<T>(false,endpoint,null,configuration.getUri(),configuration.getChannelFactory());
  }
 else {
    endpoint=Remoting.createEndpoint(configuration.getEndpointName(),configuration.getExecutor(),configuration.getOptionMap());
    Xnio xnio;
    try {
      xnio=XnioUtil.getXnio();
    }
 catch (    ModuleLoadException e) {
      throw new RuntimeException(e);
    }
    Registration providerRegistration=endpoint.addConnectionProvider(configuration.getUri().getScheme(),new RemoteConnectionProviderFactory(xnio),OptionMap.create(Options.SSL_ENABLED,false));
    return new ProtocolChannelClient<T>(true,endpoint,providerRegistration,configuration.getUri(),configuration.getChannelFactory());
  }
}
