{
  if (method.getName().equals("getConnection") && method.getParameterTypes().length == 0 && delegate instanceof XADataSource) {
    final XADataSource xa=(XADataSource)delegate;
    final XAConnection xacon=xa.getXAConnection();
    if (!synchronizationRegistered.get()) {
      if (transactionManager.getTransaction() != null && transactionActive(transactionManager.getTransaction().getStatus())) {
        transactionManager.getTransaction().enlistResource(xacon.getXAResource());
        synchronizationRegistry.registerInterposedSynchronization(this);
        synchronizationRegistered.set(true);
      }
    }
    return xacon.getConnection();
  }
 else {
    final Object ret=method.invoke(delegate,args);
    return ret;
  }
}
