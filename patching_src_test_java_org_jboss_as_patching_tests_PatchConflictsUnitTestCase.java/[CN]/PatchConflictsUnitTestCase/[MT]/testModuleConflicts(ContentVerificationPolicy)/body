{
  final PatchingTestBuilder builder=createDefaultBuilder();
  final byte[] moduleHash=new byte[20];
  final File base=builder.getFile("modules","system","layers","base");
  createModule0(base,"org.jboss.test",randomString());
  final PatchingTestStepBuilder oneOff1=builder.createBuilder();
  oneOff1.setPatchId("one-off-1").oneOffPatchIdentity(PRODUCT_VERSION,NOT_PATCHED).oneOffPatchElement("base:oo1",BASE,NOT_PATCHED,false).updateModuleWithRandomContent("org.jboss.test",NO_CONTENT,moduleHash);
  try {
    apply(oneOff1);
    Assert.fail("should have detected conflicts");
  }
 catch (  PatchingException expected) {
    final ModuleItem item=new ModuleItem("org.jboss.test","main",moduleHash);
    Assert.assertTrue(expected.getConflicts().contains(item));
  }
  apply(oneOff1,resolvePolicy);
  return oneOff1;
}
