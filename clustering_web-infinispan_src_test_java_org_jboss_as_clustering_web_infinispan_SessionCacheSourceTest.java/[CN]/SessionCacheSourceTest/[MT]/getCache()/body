{
  ReplicationConfig config=new ReplicationConfig();
  config.setCacheName("test");
  ServiceRegistry registry=mock(ServiceRegistry.class);
  ServiceController<Cache<Object,Object>> controller=mock(ServiceController.class);
  LocalDistributableSessionManager manager=mock(LocalDistributableSessionManager.class);
  Cache<Object,Object> cache=mock(Cache.class);
  ServiceNameProvider provider=mock(ServiceNameProvider.class);
  ServiceName name=ServiceName.JBOSS.append("infinispan","web",CacheContainer.DEFAULT_CACHE_NAME);
  CacheSource source=new SessionCacheSource(provider);
  when(manager.getReplicationConfig()).thenReturn(config);
  when(provider.getServiceName(same(config))).thenReturn(name);
  when((ServiceController<Cache<Object,Object>>)registry.getRequiredService(name)).thenReturn(controller);
  when(controller.getValue()).thenReturn(cache);
  assertSame(cache,source.getCache(registry,manager));
}
