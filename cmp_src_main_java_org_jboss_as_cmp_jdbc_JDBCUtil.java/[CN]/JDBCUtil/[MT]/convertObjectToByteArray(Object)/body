{
  if (value instanceof byte[]) {
    return (byte[])value;
  }
  ByteArrayOutputStream baos=null;
  ObjectOutputStream oos=null;
  try {
    if (value instanceof EJBObject) {
      value=((EJBObject)value).getHandle();
    }
    value=new MarshalledValue(value);
    baos=new ByteArrayOutputStream();
    oos=new ObjectOutputStream(baos);
    oos.writeObject(value);
    return baos.toByteArray();
  }
 catch (  RemoteException e) {
    throw MESSAGES.couldNotGetEjbHandle(e);
  }
catch (  IOException e) {
    throw MESSAGES.canNotSerializeBinaryObject(e);
  }
 finally {
    safeClose(oos);
    safeClose(baos);
  }
}
