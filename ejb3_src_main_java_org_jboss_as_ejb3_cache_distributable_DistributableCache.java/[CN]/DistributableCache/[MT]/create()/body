{
  boolean newGroup=this.group.get() == null;
  try (Batch batch=this.manager.getBatcher().createBatch()){
    try {
      V instance=this.factory.createInstance();
      K id=instance.getId();
      this.manager.createBean(id,this.group.get(),instance).close();
      return instance;
    }
 catch (    RuntimeException|Error e) {
      batch.discard();
      throw e;
    }
  }
  finally {
    if (newGroup) {
      this.group.remove();
    }
  }
}
