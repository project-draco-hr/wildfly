{
  UUID group=CURRENT_GROUP.get();
  boolean newGroup=(group == null);
  if (newGroup) {
    group=this.manager.getGroupIdentifierFactory().createIdentifier();
    CURRENT_GROUP.set(group);
  }
  try (Batch batch=this.manager.getBatcher().createBatch()){
    try {
      V instance=this.factory.createInstance();
      K id=instance.getId();
      this.manager.createBean(id,group,instance).close();
      return instance;
    }
 catch (    RuntimeException|Error e) {
      batch.discard();
      throw e;
    }
  }
  finally {
    if (newGroup) {
      CURRENT_GROUP.remove();
    }
  }
}
