{
  ModelNode endpointModel=context.readResource(PathAddress.pathAddress(RemotingEndpointResource.ENDPOINT_PATH)).getModel();
  String workerName=RemotingEndpointResource.WORKER.resolveModelAttribute(context,endpointModel).asString();
  final OptionMap map=EndpointConfigFactory.populate(context,endpointModel);
  final ServiceTarget serviceTarget=context.getServiceTarget();
  final String nodeName=WildFlySecurityManager.getPropertyPrivileged(RemotingExtension.NODE_NAME_PROPERTY,null);
  final EndpointService endpointService=new EndpointService(nodeName,EndpointService.EndpointType.SUBSYSTEM,map);
  if (context.getProcessType() == ProcessType.DOMAIN_SERVER) {
    final ServiceController<?> controller=context.getServiceRegistry(false).getService(RemotingServices.SUBSYSTEM_ENDPOINT);
    if (controller != null) {
      return;
    }
  }
  final ServiceBuilder<Endpoint> builder=serviceTarget.addService(RemotingServices.SUBSYSTEM_ENDPOINT,endpointService).addDependency(IOServices.WORKER.append(workerName),XnioWorker.class,endpointService.getWorker());
  if (verificationHandler != null) {
    builder.addListener(verificationHandler);
  }
  ServiceController<?> controller=builder.install();
  if (newControllers != null) {
    newControllers.add(controller);
  }
}
