{
  final SOAPMessageContext msgContext=(SOAPMessageContext)context.getPrivateData(MessageContext.class);
  final Invocation wsInvocation=(Invocation)context.getPrivateData(Invocation.class);
  final HandlerCallback callback=(HandlerCallback)context.getPrivateData(HandlerCallback.class);
  if (msgContext == null || callback == null || wsInvocation == null) {
    return context.proceed();
  }
  try {
    boolean handlersPass=callback.callRequestHandlerChain(wsInvocation,HandlerType.ENDPOINT);
    handlersPass=handlersPass && callback.callRequestHandlerChain(wsInvocation,HandlerType.POST);
    if (handlersPass) {
      final Object[] reqParams=wsInvocation.getArgs();
      context.setParameters(reqParams);
      final Object resObj=context.proceed();
      msgContext.setMessage(null);
      wsInvocation.setReturnValue(resObj);
    }
    handlersPass=callback.callResponseHandlerChain(wsInvocation,HandlerType.POST);
    handlersPass=handlersPass && callback.callResponseHandlerChain(wsInvocation,HandlerType.ENDPOINT);
    return wsInvocation.getReturnValue();
  }
 catch (  final Exception ex) {
    try {
      boolean handlersPass=callback.callFaultHandlerChain(wsInvocation,HandlerType.POST,ex);
      handlersPass=handlersPass && callback.callFaultHandlerChain(wsInvocation,HandlerType.ENDPOINT,ex);
    }
 catch (    Exception ignore) {
    }
    throw ex;
  }
}
