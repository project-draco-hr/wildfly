{
  try {
    String failure=validator.validate(operation);
    if (failure == null) {
      String name=operation.get(NAME).asString();
      String runtimeName=has(operation,RUNTIME_NAME) ? operation.get(RUNTIME_NAME).asString() : name;
      InputStream is=getContentInputStream(operation);
      try {
        byte[] hash=deploymentRepository.addDeploymentContent(name,runtimeName,is);
        resultHandler.handleResultFragment(EMPTY,new ModelNode().set(hash));
      }
  finally {
        safeClose(is);
      }
    }
 else {
      throw new OperationFailedException(new ModelNode().set(failure));
    }
  }
 catch (  IOException e) {
    throw new OperationFailedException(new ModelNode().set(e.toString()));
  }
  resultHandler.handleResultComplete();
  return new BasicOperationResult();
}
