{
  BundleContext context=injectedSystemContext.getOptionalValue();
  XEnvironment env=injectedEnvironment.getOptionalValue();
  Registration reg=new Registration(module,metadata);
  if (context != null && env != null) {
    registerInternal(context,env,reg);
  }
  registrations.put(module,reg);
}
