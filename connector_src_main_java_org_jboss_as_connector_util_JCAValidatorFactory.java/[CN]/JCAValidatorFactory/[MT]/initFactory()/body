{
  final ClassLoader oldTCCL=SecurityActions.getThreadContextClassLoader();
  try {
    SecurityActions.setThreadContextClassLoader(classLoader);
    if (configuration == null) {
      return Validation.byDefaultProvider().providerResolver(new WildFlyProviderResolver()).configure().buildValidatorFactory();
    }
 else {
      return configuration.buildValidatorFactory();
    }
  }
  finally {
    SecurityActions.setThreadContextClassLoader(oldTCCL);
  }
}
