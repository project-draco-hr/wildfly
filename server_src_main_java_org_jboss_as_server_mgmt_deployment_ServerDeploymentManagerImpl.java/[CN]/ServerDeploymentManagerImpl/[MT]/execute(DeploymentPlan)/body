{
  if (!(plan instanceof DeploymentPlanImpl)) {
    throw new IllegalArgumentException("unexpected " + DeploymentPlan.class.getSimpleName() + " type "+ plan.getClass().getName());
  }
  final SimpleFuture<ServerDeploymentPlanResult> resultFuture=new SimpleFuture<ServerDeploymentPlanResult>();
  final UpdateResultHandlerImpl resultHandler=new UpdateResultHandlerImpl(resultFuture,plan);
  final ServerUpdateController controller=new ServerUpdateController(getServerConfiguration(),getServiceContainer(),getDeploymentExecutor(),resultHandler,plan.isGlobalRollback(),plan.isShutdown());
  DeploymentPlanImpl planImpl=(DeploymentPlanImpl)plan;
  for (  DeploymentActionImpl action : planImpl.getDeploymentActionImpls()) {
    addServerGroupDeploymentUpdate(action,resultHandler,controller);
  }
  Runnable r=new Runnable(){
    @Override public void run(){
      logger.debugf("Executing deployment plan %s",plan.getId().toString());
      controller.executeUpdates();
    }
  }
;
  getDeploymentExecutor().execute(r);
  return resultFuture;
}
