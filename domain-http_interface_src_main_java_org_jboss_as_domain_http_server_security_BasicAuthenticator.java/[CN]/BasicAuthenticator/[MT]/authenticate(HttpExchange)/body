{
  Subject subject=(Subject)httpExchange.getAttribute(Subject.class.getName(),AttributeScope.CONNECTION);
  if (subject != null) {
    Set<HttpPrincipal> httpPrincipals=subject.getPrincipals(HttpPrincipal.class);
    if (httpPrincipals.size() > 0) {
      return new Success(httpPrincipals.iterator().next());
    }
  }
  callbackHandler.set(securityRealm.getAuthorizingCallbackHandler(AuthenticationMechanism.PLAIN));
  try {
    return _authenticate(httpExchange);
  }
  finally {
    callbackHandler.set(null);
  }
}
