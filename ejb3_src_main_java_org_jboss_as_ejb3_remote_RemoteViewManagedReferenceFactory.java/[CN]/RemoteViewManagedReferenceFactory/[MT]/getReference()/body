{
  final ClassLoader tccl=SecurityActions.getContextClassLoader();
  final Class<?> viewClass;
  try {
    viewClass=Class.forName(this.viewClass,false,tccl);
  }
 catch (  ClassNotFoundException e) {
    throw new RuntimeException("Could not load view class for ejb " + beanName,e);
  }
  Locator ejbLocator=null;
  if (stateful) {
    final SessionID sessionID;
    try {
      sessionID=EJBClient.createSession(appName,moduleName,beanName,distinctName);
    }
 catch (    Exception e) {
      throw new RuntimeException(e);
    }
    ejbLocator=new StatefulEJBLocator(viewClass,appName,moduleName,beanName,distinctName,sessionID);
  }
 else {
    if (EJBHome.class.isAssignableFrom(viewClass) || EJBLocalHome.class.isAssignableFrom(viewClass)) {
      ejbLocator=new EJBHomeLocator(viewClass,appName,moduleName,beanName,distinctName);
    }
 else {
      ejbLocator=new StatelessEJBLocator(viewClass,appName,moduleName,beanName,distinctName);
    }
  }
  final Object proxy=EJBClient.createProxy(ejbLocator);
  return new ValueManagedReference(new ImmediateValue<Object>(proxy));
}
