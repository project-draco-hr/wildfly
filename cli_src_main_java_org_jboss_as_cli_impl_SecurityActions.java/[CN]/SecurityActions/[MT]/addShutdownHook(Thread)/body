{
  if (getSecurityManager() == null) {
    getRuntime().addShutdownHook(hook);
  }
 else {
    doPrivileged(new AddShutdownHookAction(hook));
  }
}
