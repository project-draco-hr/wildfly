{
  if (!tmpFile.renameTo(permanentFile)) {
    FileOutputStream fos=null;
    BufferedOutputStream bos=null;
    FileInputStream fis=null;
    try {
      fos=new FileOutputStream(permanentFile);
      bos=new BufferedOutputStream(fos);
      fis=new FileInputStream(tmpFile);
      BufferedInputStream bis=new BufferedInputStream(fis);
      byte[] bytes=new byte[8192];
      int read;
      while ((read=bis.read(bytes)) > -1) {
        bos.write(bytes,0,read);
      }
    }
  finally {
      safeClose(bos);
      safeClose(fos);
      safeClose(fis);
      if (!tmpFile.delete()) {
        tmpFile.deleteOnExit();
      }
    }
  }
}
