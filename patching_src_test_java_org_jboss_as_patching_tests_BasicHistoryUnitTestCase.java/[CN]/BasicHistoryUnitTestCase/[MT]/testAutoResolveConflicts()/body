{
  final PatchingTestBuilder builder=createDefaultBuilder();
  final File existing=builder.getFile(FILE_EXISTING);
  touch(existing);
  dump(existing,randomString());
  final byte[] existingHash=hashFile(existing);
  final byte[] initialHash=Arrays.copyOf(existingHash,existingHash.length);
  final byte[] moduleHash=new byte[20];
  final PatchingTestStepBuilder oo1=builder.createStepBuilder();
  oo1.setPatchId("one-off-one").oneOffPatchIdentity(PRODUCT_VERSION).updateFileWithRandomContent(initialHash,existingHash,FILE_EXISTING).oneOffPatchElement("base-one-off","base",false).addModuleWithRandomContent("test.module",moduleHash);
  apply(oo1);
  final PatchingTestStepBuilder cp1=builder.createStepBuilder();
  cp1.setPatchId("CP1").upgradeIdentity(PRODUCT_VERSION,PRODUCT_VERSION).updateFileWithRandomContent(initialHash,existingHash,FILE_EXISTING).upgradeElement("base-cp1","base",false).addModuleWithRandomContent("test.module",moduleHash);
  apply(cp1);
  rollback(cp1);
  rollback(oo1);
}
