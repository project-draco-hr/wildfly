{
  List<ModelNode> ops=new LinkedList<ModelNode>();
  PathAddress subsystemAddress=PathAddress.EMPTY_ADDRESS.append(SUBSYSTEM,getMainSubsystemName());
  PathAddress udpAddress=subsystemAddress.append("stack","udp");
  PathAddress tcpAddress=subsystemAddress.append("stack","tcp");
  ModelNode op=Util.createAddOperation(subsystemAddress);
  op.get("default-stack").set("udp");
  ops.add(op);
  op=Util.createAddOperation(udpAddress);
  ModelNode transport=new ModelNode();
  transport.get("type").set("UDP");
  transport.get("socket-binding").set("jgroups-udp");
  ModelNode protocols=new ModelNode();
  protocols.add("PING");
  protocols.add("MERGE3");
  protocols.add("FD_SOCK");
  protocols.add("FD");
  protocols.add("VERIFY_SUSPECT");
  protocols.add("BARRIER");
  protocols.add("pbcast.NAKACK2");
  protocols.add("UNICAST2");
  protocols.add("pbcast.STABLE");
  protocols.add("pbcast.GMS");
  protocols.add("UFC");
  protocols.add("MFC");
  protocols.add("FRAG2");
  protocols.add("RSVP");
  op.get("transport").set(transport);
  op.get("protocols").set(protocols);
  ops.add(op);
  ops.add(Util.getWriteAttributeOperation(udpAddress.append("protocol","FD_SOCK"),"socket-binding",new ModelNode("jgroups-udp-fd")));
  KernelServices servicesA=createKernelServicesBuilder(createAdditionalInitialization()).setBootOperations(ops).build();
  Assert.assertTrue("Subsystem boot failed!",servicesA.isSuccessfulBoot());
  final ModelNode modelA=servicesA.readWholeModel();
  validateModel(modelA);
  ModelNode protos=modelA.get(SUBSYSTEM,getMainSubsystemName(),"stack","udp","protocols");
  Assert.assertEquals("we should get back same number of protocols that we send",14,protos.asList().size());
  servicesA.shutdown();
}
