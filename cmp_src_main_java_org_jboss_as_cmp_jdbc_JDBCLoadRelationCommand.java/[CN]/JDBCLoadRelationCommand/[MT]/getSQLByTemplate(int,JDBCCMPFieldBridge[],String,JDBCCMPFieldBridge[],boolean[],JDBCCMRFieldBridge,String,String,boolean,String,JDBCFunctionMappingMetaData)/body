{
  StringBuffer columnNamesClause=new StringBuffer(100);
  if (keyCount > 1) {
    SQLUtil.getColumnNamesClause(myKeyFields,relationTableAlias,columnNamesClause).append(SQLUtil.COMMA);
  }
  SQLUtil.getColumnNamesClause(relatedKeyFields,relationTableAlias,columnNamesClause);
  if (preloadMask != null) {
    SQLUtil.appendColumnNamesClause(cmrField.getRelatedJDBCEntity().getTableFields(),preloadMask,relatedTableAlias,columnNamesClause);
  }
  StringBuffer fromClause=new StringBuffer(100);
  fromClause.append(relationTable);
  if (join) {
    fromClause.append(' ').append(relationTableAlias).append(SQLUtil.COMMA).append(relatedTable).append(' ').append(relatedTableAlias);
  }
  StringBuffer whereClause=new StringBuffer(150);
  if (join) {
    whereClause.append('(');
    SQLUtil.getJoinClause(relatedKeyFields,relationTableAlias,cmrField.getRelatedJDBCEntity().getPrimaryKeyFields(),relatedTableAlias,whereClause).append(')').append(SQLUtil.AND).append('(');
  }
  String pkWhere=SQLUtil.getWhereClause(myKeyFields,relationTableAlias,new StringBuffer(50)).toString();
  for (int i=0; i < keyCount; i++) {
    if (i > 0) {
      whereClause.append(SQLUtil.OR);
    }
    whereClause.append('(').append(pkWhere).append(')');
  }
  if (join) {
    whereClause.append(')');
  }
  String[] args=new String[]{columnNamesClause.toString(),fromClause.toString(),whereClause.toString(),null};
  return selectTemplate.getFunctionSql(args,new StringBuffer(500)).toString();
}
