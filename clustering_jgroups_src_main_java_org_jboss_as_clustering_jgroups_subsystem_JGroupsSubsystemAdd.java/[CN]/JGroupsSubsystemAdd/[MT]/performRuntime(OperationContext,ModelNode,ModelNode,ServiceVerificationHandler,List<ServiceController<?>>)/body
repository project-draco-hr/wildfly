{
  log.info("Activating JGroups subsystem.");
  ServiceTarget target=context.getServiceTarget();
  newControllers.add(target.addService(ProtocolDefaultsService.SERVICE_NAME,new ProtocolDefaultsService()).setInitialMode(ServiceController.Mode.ON_DEMAND).install());
  String stack=operation.require(ModelKeys.DEFAULT_STACK).asString();
  InjectedValue<ChannelFactory> factory=new InjectedValue<ChannelFactory>();
  ValueService<ChannelFactory> service=new ValueService<ChannelFactory>(factory);
  newControllers.add(target.addService(ChannelFactoryService.getServiceName(null),service).addDependency(ChannelFactoryService.getServiceName(stack),ChannelFactory.class,factory).setInitialMode(ServiceController.Mode.ON_DEMAND).install());
}
