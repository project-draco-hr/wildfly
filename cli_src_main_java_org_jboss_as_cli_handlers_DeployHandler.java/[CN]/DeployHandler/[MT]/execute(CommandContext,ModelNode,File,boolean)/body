{
  addHeaders(ctx,request);
  ModelNode result;
  try {
    if (!unmanaged && f != null) {
      OperationBuilder op=new OperationBuilder(request);
      op.addFileAsAttachment(f);
      request.get(Util.CONTENT).get(0).get(Util.INPUT_STREAM_INDEX).set(0);
      Operation operation=op.build();
      result=ctx.getModelControllerClient().execute(operation);
      operation.close();
    }
 else {
      result=ctx.getModelControllerClient().execute(request);
    }
  }
 catch (  Exception e) {
    throw new CommandFormatException("Failed to add the deployment content to the repository: " + e.getLocalizedMessage());
  }
  if (!Util.isSuccess(result)) {
    throw new CommandFormatException(Util.getFailureDescription(result));
  }
}
