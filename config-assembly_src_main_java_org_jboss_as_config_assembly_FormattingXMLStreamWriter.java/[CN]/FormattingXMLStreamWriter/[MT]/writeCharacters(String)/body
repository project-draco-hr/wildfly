{
  if (state != CHARACTERS) {
    String trimmed=text.trim();
    if (trimmed.contains("\n")) {
      nl();
      indent();
    }
 else {
      delegate.writeCharacters(trimmed);
      indentEndElement=false;
      state=CHARACTERS;
      return;
    }
  }
  final Iterator<String> iterator=Spliterator.over(text,'\n');
  while (iterator.hasNext()) {
    final String t=iterator.next();
    delegate.writeCharacters(t);
    if (iterator.hasNext()) {
      nl();
      indent();
    }
  }
  state=CHARACTERS;
  indentEndElement=true;
}
