{
  level--;
  if (state != START_ELEMENT) {
    if (state != CHARACTERS || indentEndElement) {
      nl();
      indent();
      indentEndElement=false;
    }
    delegate.writeEndElement();
  }
 else {
    throw new IllegalStateException("Should not happen?");
  }
  unspecifiedNamespaces.pop();
  state=END_ELEMENT;
}
