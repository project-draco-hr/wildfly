{
  String value=null;
  if (args.hasArguments()) {
    if (index >= 0) {
      List<String> others=args.getOtherArguments();
      if (others.size() > index) {
        value=others.get(index);
      }
    }
    if (names != null) {
      if (names.length == 1) {
        if (value == null) {
          value=args.getArgument(names[0]);
        }
 else {
          String namedValue=args.getArgument(names[0]);
          if (namedValue != null && !namedValue.equals(value)) {
            throw new IllegalArgumentException("Argument " + defaultName + " is specified twice: '"+ value+ "' vs '"+ namedValue+ "'.");
          }
        }
      }
 else {
        for (        String name : names) {
          if (value == null) {
            value=args.getArgument(name);
          }
 else {
            String namedValue=args.getArgument(name);
            if (namedValue != null && !namedValue.equals(value)) {
              throw new IllegalArgumentException("Argument " + defaultName + " is specified twice: '"+ value+ "' vs '"+ namedValue+ "'.");
            }
          }
        }
      }
    }
  }
  if (required && value == null && !isPresent(args)) {
    StringBuilder buf=new StringBuilder();
    buf.append("Required argument ");
    if (names != null) {
      buf.append('\'').append(names[0]).append('\'');
    }
 else {
      buf.append("with index ").append(index);
    }
    buf.append(" is missing.");
    throw new IllegalArgumentException(buf.toString());
  }
  return value;
}
