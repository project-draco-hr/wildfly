{
  String subsystemXml=readResource("subsystem.xml");
  AdditionalInitialization additionalInit=new AdditionalInitialization(){
    @Override protected OperationContext.Type getType(){
      return OperationContext.Type.MANAGEMENT;
    }
  }
;
  KernelServices servicesA=super.installInController(additionalInit,subsystemXml);
  ModelNode modelA=servicesA.readWholeModel();
  String marshalled=servicesA.getPersistedSubsystemXml();
  servicesA.shutdown();
  System.out.println(marshalled);
  KernelServices servicesB=super.installInController(additionalInit,marshalled);
  ModelNode modelB=servicesB.readWholeModel();
  super.compare(modelA,modelB);
  final ModelNode operation=createDescribeOperation();
  final ModelNode result=servicesB.executeOperation(operation);
  final List<ModelNode> operations=result.get("result").asList();
  servicesB.shutdown();
  KernelServices servicesC=super.installInController(additionalInit,operations);
  ModelNode modelC=servicesC.readWholeModel();
  super.compare(modelA,modelC);
}
