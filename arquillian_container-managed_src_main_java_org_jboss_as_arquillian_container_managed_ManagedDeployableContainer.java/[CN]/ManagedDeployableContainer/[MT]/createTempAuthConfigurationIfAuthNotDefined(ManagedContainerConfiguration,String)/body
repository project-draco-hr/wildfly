{
  File usersFile=new File(jbossHomeDir + CONFIG_PATH + MGMT_USERS_FILE);
  if (config.getUsername() == null) {
    File tmpUsersFile=new File(jbossHomeDir + CONFIG_PATH + MGMT_USERS_TMP_FILE);
    if (usersFile.exists()) {
      if (!usersFile.renameTo(tmpUsersFile)) {
        throw new IllegalStateException("Could not rename " + usersFile + " to "+ tmpUsersFile+ ". "+ "Unable to start server with custom security. "+ "Please setup a management user manually and provide username/password in the Arquillian configuration.");
      }
    }
    FileOutputStream fos=new FileOutputStream(usersFile);
    PrintWriter pw=new PrintWriter(fos);
    pw.println(username + "=" + new UsernamePasswordHashUtil().generateHashedHexURP(username,"ManagementRealm",password.toCharArray()));
    pw.close();
    fos.close();
  }
}
