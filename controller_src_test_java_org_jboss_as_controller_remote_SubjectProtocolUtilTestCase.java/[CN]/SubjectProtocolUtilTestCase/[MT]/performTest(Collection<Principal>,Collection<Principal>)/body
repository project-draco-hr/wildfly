{
  Subject toSend=new Subject();
  toSend.getPrincipals().addAll(original);
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  DataOutputStream dos=new DataOutputStream(baos);
  SubjectProtocolUtil.write(dos,toSend);
  dos.close();
  baos.close();
  byte[] sent=baos.toByteArray();
  ByteArrayInputStream bais=new ByteArrayInputStream(sent);
  DataInputStream dis=new DataInputStream(bais);
  Subject received=SubjectProtocolUtil.read(dis);
  for (  Principal current : received.getPrincipals()) {
    assertTrue("Principal received was in expected list.",expected.remove(current));
  }
  assertTrue("All expected principals received",expected.isEmpty());
}
