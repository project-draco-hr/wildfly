{
  final ModelNode compensatingOperation=new ModelNode();
  compensatingOperation.get(OP).set(ModelDescriptionConstants.REMOVE);
  compensatingOperation.get(OP_ADDR).set(operation.require(OP_ADDR));
  final String interfaceName=operation.require(ModelDescriptionConstants.INTERFACE).asString();
  final int port=operation.require(ModelDescriptionConstants.PORT).asInt();
  final ModelNode subModel=context.getSubModel();
  subModel.get(ModelDescriptionConstants.INTERFACE).set(interfaceName);
  subModel.get(ModelDescriptionConstants.PORT).set(port);
  if (context.getRuntimeContext() != null) {
    context.getRuntimeContext().setRuntimeTask(new RuntimeTask(){
      public void execute(      RuntimeTaskContext context) throws OperationFailedException {
        final ServiceTarget serviceTarget=context.getServiceTarget();
        Logger.getLogger("org.jboss.as").infof("creating native management service using network interface (%s) port (%s)",interfaceName,port);
        final ThreadGroup threadGroup=new ThreadGroup("ManagementCommunication-threads");
        final ThreadFactory threadFactory=new JBossThreadFactory(threadGroup,Boolean.FALSE,null,"%G - %t",null,null,AccessController.getContext());
        final ManagementCommunicationService managementCommunicationService=new ManagementCommunicationService();
        serviceTarget.addService(ManagementCommunicationService.SERVICE_NAME,managementCommunicationService).addDependency(NetworkInterfaceService.JBOSS_NETWORK_INTERFACE.append(interfaceName),NetworkInterfaceBinding.class,managementCommunicationService.getInterfaceInjector()).addInjection(managementCommunicationService.getPortInjector(),port).addInjection(managementCommunicationService.getExecutorServiceInjector(),Executors.newCachedThreadPool(threadFactory)).addInjection(managementCommunicationService.getThreadFactoryInjector(),threadFactory).setInitialMode(ServiceController.Mode.ACTIVE).install();
        ServerControllerOperationHandlerService operationHandlerService=new ServerControllerOperationHandlerService();
        serviceTarget.addService(ServerControllerOperationHandlerService.SERVICE_NAME,operationHandlerService).addDependency(ManagementCommunicationService.SERVICE_NAME,ManagementCommunicationService.class,operationHandlerService.getManagementCommunicationServiceValue()).addDependency(Services.JBOSS_SERVER_CONTROLLER,ModelController.class,operationHandlerService.getModelControllerValue()).setInitialMode(ServiceController.Mode.ACTIVE).install();
      }
    }
);
  }
 else {
    resultHandler.handleResultComplete();
  }
  return new BasicOperationResult(compensatingOperation);
}
