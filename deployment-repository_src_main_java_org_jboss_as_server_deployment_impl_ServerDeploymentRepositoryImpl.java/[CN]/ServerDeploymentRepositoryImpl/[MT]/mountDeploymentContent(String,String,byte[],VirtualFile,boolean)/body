{
  if (deploymentHash == null) {
    File file=new File(systemDeployDir,name);
    return VFS.mountZip(file,mountPoint,tempFileProvider);
  }
  final File external=getExternalFileReference(deploymentHash,false);
  if (external.exists()) {
    final InputStream is=new FileInputStream(external);
    try {
      final BufferedReader reader=new BufferedReader(new InputStreamReader(is));
      final String fileName=reader.readLine();
      final File realRoot=new File(fileName);
      if (!realRoot.exists()) {
        throw new FileNotFoundException(fileName);
      }
      return VFS.mountReal(realRoot,mountPoint);
    }
  finally {
      safeClose(is);
    }
  }
  final File content=getDeploymentContentFile(deploymentHash);
  if (mountExpanded) {
    return VFS.mountZipExpanded(content,mountPoint,tempFileProvider);
  }
 else {
    return VFS.mountZip(content,mountPoint,tempFileProvider);
  }
}
