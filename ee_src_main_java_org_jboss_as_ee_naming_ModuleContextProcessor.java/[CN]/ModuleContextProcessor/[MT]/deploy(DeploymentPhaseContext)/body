{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (isEarDeployment(deploymentUnit)) {
    return;
  }
  final ServiceTarget serviceTarget=phaseContext.getServiceTarget();
  final ServiceName parentContextName=getParentContextServiceName(deploymentUnit);
  final ServiceName moduleContextServiceName=parentContextName.append(deploymentUnit.getName());
  final JndiName moduleContextJndiName=getContextJndiName(deploymentUnit);
  final ContextService contextService=new ContextService(moduleContextJndiName);
  serviceTarget.addService(moduleContextServiceName,contextService).addDependency(parentContextName,Context.class,contextService.getParentContextInjector()).install();
  final BinderService<String> moduleNameBinder=new BinderService<String>("ModuleName",Values.immediateValue(getModuleName(deploymentUnit)));
  serviceTarget.addService(moduleContextServiceName.append("module-name"),moduleNameBinder).addDependency(moduleContextServiceName,Context.class,moduleNameBinder.getContextInjector()).install();
  phaseContext.getDeploymentUnit().putAttachment(Attachments.MODULE_CONTEXT_CONFIG,new NamingContextConfig(moduleContextServiceName,moduleContextJndiName));
}
