{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (DeploymentTypeMarker.isType(DeploymentType.EAR,deploymentUnit)) {
    return;
  }
  EEModuleDescription moduleDescription=deploymentUnit.getAttachment(EE_MODULE_DESCRIPTION);
  final ServiceTarget serviceTarget=phaseContext.getServiceTarget();
  final ServiceName appContextServiceName=ContextNames.contextServiceNameOfApplication(moduleDescription.getApplicationName());
  final ServiceName moduleContextServiceName=ContextNames.contextServiceNameOfModule(moduleDescription.getApplicationName(),moduleDescription.getModuleName());
  final RootContextService contextService=new RootContextService();
  serviceTarget.addService(moduleContextServiceName,contextService).install();
  final BinderService moduleNameBinder=new BinderService("ModuleName");
  serviceTarget.addService(moduleContextServiceName.append("ModuleName"),moduleNameBinder).addInjection(moduleNameBinder.getManagedObjectInjector(),new ValueManagedReferenceFactory(Values.immediateValue(moduleDescription.getModuleName()))).addDependency(moduleContextServiceName,NamingStore.class,moduleNameBinder.getNamingStoreInjector()).install();
  deploymentUnit.putAttachment(MODULE_CONTEXT_CONFIG,moduleContextServiceName);
  final InjectedEENamespaceContextSelector selector=new InjectedEENamespaceContextSelector();
  phaseContext.addDependency(appContextServiceName,NamingStore.class,selector.getAppContextInjector());
  phaseContext.addDependency(moduleContextServiceName,NamingStore.class,selector.getModuleContextInjector());
  final JavaNamespaceSetup setupAction=new JavaNamespaceSetup(selector);
  deploymentUnit.addToAttachmentList(SETUP_ACTIONS,setupAction);
}
