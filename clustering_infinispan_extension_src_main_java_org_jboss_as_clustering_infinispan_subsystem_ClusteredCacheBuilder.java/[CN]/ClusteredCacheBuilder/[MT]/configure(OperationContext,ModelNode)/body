{
  Mode mode=ModelNodes.asEnum(ClusteredCacheResourceDefinition.Attribute.MODE.getDefinition().resolveModelAttribute(context,model),Mode.class);
  ClusteringConfigurationBuilder builder=new ConfigurationBuilder().clustering().cacheMode(mode.apply(this.mode));
  if (mode.isSynchronous()) {
    builder.sync().replTimeout(REMOTE_TIMEOUT.getDefinition().resolveModelAttribute(context,model).asLong());
  }
 else {
    int queueSize=QUEUE_SIZE.getDefinition().resolveModelAttribute(context,model).asInt();
    builder.async().useReplQueue(queueSize > 0).replQueueInterval(QUEUE_FLUSH_INTERVAL.getDefinition().resolveModelAttribute(context,model).asLong()).replQueueMaxElements(queueSize);
  }
  this.clustering=builder.create();
  return super.configure(context,model);
}
