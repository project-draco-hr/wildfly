{
  VirtualFile vf=contentRepository.getContent(initialHash);
  if (vf == null) {
    throw ManagedDMRContentLogger.ROOT_LOGGER.noContentFoundWithHash(HashUtil.bytesToHexString(initialHash));
  }
  InputStream is=null;
  try {
    is=vf.openStream();
    ModelNode node=ModelNode.fromStream(is);
    if (node.isDefined()) {
      for (      Property prop : node.asPropertyList()) {
        ModelNode value=prop.getValue();
        byte[] hash=hashContent(value);
synchronized (content) {
          content.put(prop.getName(),new ManagedContent(value,hash));
        }
      }
    }
    this.model.get(ModelDescriptionConstants.HASH).set(initialHash);
  }
 catch (  IOException e) {
    throw new ContentStorageException(e);
  }
 finally {
    safeClose(is);
  }
}
