{
  if (updates == null || updates.size() == 0) {
    throw new IllegalArgumentException("updates is " + (updates == null ? "null" : "empty"));
  }
  List<DomainUpdateResult<?>> result;
  List<DomainUpdateApplierResponse> domainResults=applyUpdatesToModel(updates);
  DomainUpdateApplierResponse last=domainResults.get(domainResults.size() - 1);
  if (last.isCancelled() || last.isRolledBack() || last.getDomainFailure() != null || last.getHostFailures().size() > 0) {
    result=new ArrayList<DomainUpdateResult<?>>();
    for (    DomainUpdateApplierResponse duar : domainResults) {
      if (duar.isCancelled()) {
        result.add(new DomainUpdateResult<Object>(true));
      }
 else       if (duar.isRolledBack()) {
        result.add(new DomainUpdateResult<Object>(false));
      }
 else       if (duar.getDomainFailure() != null) {
        result.add(new DomainUpdateResult<Object>(duar.getDomainFailure()));
      }
 else {
        result.add(new DomainUpdateResult<Object>(duar.getHostFailures()));
      }
    }
  }
 else {
    result=applyUpdatesToServers(updates,domainResults,false);
  }
  return result;
}
