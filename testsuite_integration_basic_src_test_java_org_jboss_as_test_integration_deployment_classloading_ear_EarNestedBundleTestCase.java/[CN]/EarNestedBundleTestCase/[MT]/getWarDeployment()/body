{
  JavaArchive jarA=ShrinkWrap.create(JavaArchive.class,"jarA.jar");
  jarA.addClass(EarNestedBundleTestCase.class);
  final JavaArchive bundle=ShrinkWrap.create(JavaArchive.class,"nested-bundle.jar");
  bundle.addClass(TestAA.class);
  bundle.setManifest(new Asset(){
    public InputStream openStream(){
      OSGiManifestBuilder builder=OSGiManifestBuilder.newInstance();
      builder.addBundleSymbolicName(bundle.getName());
      builder.addBundleManifestVersion(2);
      return builder.openStream();
    }
  }
);
  EnterpriseArchive ear=ShrinkWrap.create(EnterpriseArchive.class,NESTED_BUNDLE_EAR);
  ear.addAsLibrary(jarA);
  ear.addAsModule(bundle);
  return ear;
}
