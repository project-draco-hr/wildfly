{
  final String GET_PROCESSES_COMMAND="gwmi win32_process -filter \"name='java.exe' and commandLine like '%jboss-modules%' \" | foreach { " + getJStackPath() + " $_.ProcessId }";
  final String KILL_PROCESSES_COMMAND="gwmi win32_process -filter \"name='java.exe' and commandLine like '%jboss-modules%' \" | foreach { kill -id $_.ProcessId }";
  try {
    Path getProcessCommand=createCommandFile(GET_PROCESSES_COMMAND);
    Process process=rt.exec(new String[]{"powershell.exe","-NoProfile","-NonInteractive","-ExecutionPolicy","ByPass",getProcessCommand.toString()});
    InputStream in=process.getInputStream();
    String processTable=readString(in);
    String errors=readString(process.getErrorStream());
    if (errors != null && !errors.isEmpty()) {
      System.out.println("Could not get processes:\n" + errors);
    }
    if (!processTable.isEmpty()) {
      Path killProcessesCommand=createCommandFile(KILL_PROCESSES_COMMAND);
      readString(rt.exec(new String[]{"powershell.exe","-NoProfile","-NonInteractive","-ExecutionPolicy","ByPass",killProcessesCommand.toString()}).getInputStream());
      errorProcessTable=processTable;
      Files.delete(killProcessesCommand);
    }
    long end=System.currentTimeMillis() + 5000;
    while (System.currentTimeMillis() < end) {
      String running=readString(rt.exec(new String[]{"powershell.exe","-NoProfile","-NonInteractive","-ExecutionPolicy","ByPass",getProcessCommand.toString()}).getInputStream());
      if (running.isEmpty()) {
        break;
      }
 else {
        Thread.sleep(100);
      }
    }
    Files.delete(getProcessCommand);
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
}
