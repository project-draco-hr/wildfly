{
  HttpServerExchange exchange=new HttpServerExchange(null);
  @SuppressWarnings("unchecked") SessionManager<Void> manager=mock(SessionManager.class);
  Batcher batcher=mock(Batcher.class);
  when(this.manager.getSessionManager()).thenReturn(manager);
  when(manager.getBatcher()).thenReturn(batcher);
  this.facade.requestDone(exchange);
  verify(this.session).close();
  verify(batcher).endBatch(true);
}
