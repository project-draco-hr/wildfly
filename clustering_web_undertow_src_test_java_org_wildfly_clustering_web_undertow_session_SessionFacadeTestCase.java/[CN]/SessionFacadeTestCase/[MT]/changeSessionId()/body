{
  HttpServerExchange exchange=new HttpServerExchange(null);
  SessionConfig config=mock(SessionConfig.class);
  SessionManager<Void> manager=mock(SessionManager.class);
  Session<Void> session=mock(Session.class);
  SessionAttributes oldAttributes=mock(SessionAttributes.class);
  SessionAttributes newAttributes=mock(SessionAttributes.class);
  SessionMetaData oldMetaData=mock(SessionMetaData.class);
  SessionMetaData newMetaData=mock(SessionMetaData.class);
  String sessionId="session";
  String route="route";
  String routedSessionid="session:route";
  String name="name";
  Object value=new Object();
  Date date=new Date();
  long interval=10L;
  ArgumentCaptor<TimeUnit> capturedUnit=ArgumentCaptor.forClass(TimeUnit.class);
  when(this.manager.getSessionManager()).thenReturn(manager);
  when(manager.createSessionId()).thenReturn(sessionId);
  when(manager.createSession(sessionId)).thenReturn(session);
  when(this.session.getAttributes()).thenReturn(oldAttributes);
  when(this.session.getMetaData()).thenReturn(oldMetaData);
  when(session.getAttributes()).thenReturn(newAttributes);
  when(session.getMetaData()).thenReturn(newMetaData);
  when(oldAttributes.getAttributeNames()).thenReturn(Collections.singleton(name));
  when(oldAttributes.getAttribute(name)).thenReturn(value);
  when(newAttributes.setAttribute(name,value)).thenReturn(null);
  when(oldMetaData.getLastAccessedTime()).thenReturn(date);
  when(oldMetaData.getMaxInactiveInterval(capturedUnit.capture())).thenReturn(interval);
  when(session.getId()).thenReturn(sessionId);
  when(manager.locate(sessionId)).thenReturn(route);
  when(this.manager.format(sessionId,route)).thenReturn(routedSessionid);
  String result=this.facade.changeSessionId(exchange,config);
  assertSame(sessionId,result);
  verify(newMetaData).setLastAccessedTime(date);
  verify(newMetaData).setMaxInactiveInterval(interval,capturedUnit.getValue());
  verify(config).setSessionId(exchange,routedSessionid);
}
