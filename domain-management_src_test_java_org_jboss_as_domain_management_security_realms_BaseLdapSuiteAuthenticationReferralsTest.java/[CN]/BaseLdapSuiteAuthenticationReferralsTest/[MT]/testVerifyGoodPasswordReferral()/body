{
  AuthorizingCallbackHandler cbh=securityRealm.getAuthorizingCallbackHandler(AuthMechanism.PLAIN);
  NameCallback ncb=new NameCallback("Username",USER_THREE_REFERRAL);
  RealmCallback rcb=new RealmCallback("Realm",TEST_REALM);
  VerifyPasswordCallback vpc=new VerifyPasswordCallback(USER_THREE_PASSWORD);
  cbh.handle(new Callback[]{ncb,rcb,vpc});
  assertTrue("Password Verified",vpc.isVerified());
  Collection<Principal> principals=Collections.emptyList();
  SubjectUserInfo userInfo=cbh.createSubjectUserInfo(principals);
  principals=userInfo.getPrincipals();
  assertEquals("Principal Count",1,principals.size());
  RealmUser user=(RealmUser)principals.iterator().next();
  assertEquals("Expected Username","user_three",user.getName());
}
