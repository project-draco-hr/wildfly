{
  log.info("++++ Starting testUndeploy ++++");
  String warname=String.valueOf(++testId);
  this.startManagers(warname,1800,-1);
  SetAttributesRequestHandler setHandler=new SetAttributesRequestHandler(getAttributeMap(),false);
  SessionTestUtil.invokeRequest(managers[0],setHandler,null);
  assertEquals(1,Attribute.attributeCount());
  String sessionId=setHandler.getSessionId();
  WeakReference<Session> session0A=new WeakReference<Session>(managers[0].findSession(sessionId));
  SessionTestUtil.cleanupPipeline(managers[0]);
  assertNotNull(session0A.get());
  managers[0].stop();
  managers[1].stop();
  System.gc();
  System.runFinalization();
  assertEquals(0,Attribute.attributeCount());
  assertNull(session0A.get());
}
