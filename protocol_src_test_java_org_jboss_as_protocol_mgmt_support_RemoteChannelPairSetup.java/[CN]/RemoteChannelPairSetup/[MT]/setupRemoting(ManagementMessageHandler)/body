{
  ThreadFactory threadFactory=new JBossThreadFactory(new ThreadGroup("Remoting"),Boolean.FALSE,null,"Remoting %f thread %t",null,null,AccessController.getContext());
  executorService=new QueueExecutor(EXECUTOR_MAX_THREADS / 4 + 1,EXECUTOR_MAX_THREADS,EXECUTOR_KEEP_ALIVE_TIME,TimeUnit.MILLISECONDS,500,threadFactory,true,null);
  ChannelServer.Configuration configuration=new ChannelServer.Configuration();
  configuration.setEndpointName(ENDPOINT_NAME);
  configuration.setUriScheme(URI_SCHEME);
  configuration.setBindAddress(new InetSocketAddress("127.0.0.1",PORT));
  configuration.setExecutor(executorService);
  channelServer=ChannelServer.create(configuration);
  final Channel.Receiver receiver=ManagementChannelReceiver.createDelegating(handler);
  channelServer.addChannelOpenListener(TEST_CHANNEL,new OpenListener(){
    @Override public void registrationTerminated(){
    }
    @Override public void channelOpened(    Channel channel){
      serverChannel=channel;
      serverChannel.receiveMessage(receiver);
      clientConnectedLatch.countDown();
    }
  }
);
}
