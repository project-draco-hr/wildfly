{
  HttpClient client=HttpClients.createDefault();
  URI uri1=TraceServlet.createURI(baseURL1);
  URI uri2=TraceServlet.createURI(new URL(baseURL2.getProtocol(),baseURL2.getHost(),baseURL2.getPort(),baseURL1.getFile()));
  try {
    HttpResponse response=client.execute(new HttpTrace(uri1));
    try {
      Assert.assertEquals(HttpServletResponse.SC_OK,response.getStatusLine().getStatusCode());
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
    response=client.execute(new HttpTrace(uri2));
    try {
      Assert.assertEquals(HttpServletResponse.SC_METHOD_NOT_ALLOWED,response.getStatusLine().getStatusCode());
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
    this.undeploy(DEPLOYMENT_1);
    TimeUnit.SECONDS.sleep(5);
    response=client.execute(new HttpTrace(uri1));
    try {
      Assert.assertEquals(HttpServletResponse.SC_METHOD_NOT_ALLOWED,response.getStatusLine().getStatusCode());
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
    response=client.execute(new HttpTrace(uri2));
    try {
      Assert.assertEquals(HttpServletResponse.SC_OK,response.getStatusLine().getStatusCode());
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
    this.deploy(DEPLOYMENT_1);
    TimeUnit.SECONDS.sleep(5);
    response=client.execute(new HttpTrace(uri1));
    try {
      Assert.assertEquals(HttpServletResponse.SC_METHOD_NOT_ALLOWED,response.getStatusLine().getStatusCode());
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
    response=client.execute(new HttpTrace(uri2));
    try {
      Assert.assertEquals(HttpServletResponse.SC_OK,response.getStatusLine().getStatusCode());
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
    this.undeploy(DEPLOYMENT_2);
    TimeUnit.SECONDS.sleep(5);
    response=client.execute(new HttpTrace(uri1));
    try {
      Assert.assertEquals(HttpServletResponse.SC_OK,response.getStatusLine().getStatusCode());
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
    response=client.execute(new HttpTrace(uri2));
    try {
      Assert.assertEquals(HttpServletResponse.SC_METHOD_NOT_ALLOWED,response.getStatusLine().getStatusCode());
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
    this.deploy(DEPLOYMENT_2);
    TimeUnit.SECONDS.sleep(5);
    response=client.execute(new HttpTrace(uri1));
    try {
      Assert.assertEquals(HttpServletResponse.SC_OK,response.getStatusLine().getStatusCode());
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
    response=client.execute(new HttpTrace(uri2));
    try {
      Assert.assertEquals(HttpServletResponse.SC_METHOD_NOT_ALLOWED,response.getStatusLine().getStatusCode());
    }
  finally {
      HttpClientUtils.closeQuietly(response);
    }
  }
  finally {
    HttpClientUtils.closeQuietly(client);
  }
}
