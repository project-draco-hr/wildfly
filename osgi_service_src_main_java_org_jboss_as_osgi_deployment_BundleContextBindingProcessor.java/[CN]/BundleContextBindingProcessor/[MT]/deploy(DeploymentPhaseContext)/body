{
  DeploymentUnit depUnit=phaseContext.getDeploymentUnit();
  EEModuleDescription moduleDesc=depUnit.getAttachment(EE_MODULE_DESCRIPTION);
  if (moduleDesc == null || !depUnit.hasAttachment(BUNDLE_CONTEXT_RESOURCE_KEY)) {
    return;
  }
  ServiceTarget serviceTarget=phaseContext.getServiceTarget();
  if (DeploymentTypeMarker.isType(DeploymentType.WAR,depUnit)) {
    ServiceName serviceName=contextServiceNameOfModule(moduleDesc.getApplicationName(),moduleDesc.getModuleName());
    bindServices(depUnit,serviceTarget,moduleDesc,moduleDesc.getModuleName(),serviceName);
  }
  for (  ComponentDescription comp : moduleDesc.getComponentDescriptions()) {
    if (comp.getNamingMode() == ComponentNamingMode.CREATE) {
      ServiceName serviceName=contextServiceNameOfComponent(moduleDesc.getApplicationName(),moduleDesc.getModuleName(),comp.getComponentName());
      bindServices(depUnit,serviceTarget,moduleDesc,comp.getComponentName(),serviceName);
    }
  }
}
