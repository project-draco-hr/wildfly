{
  DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final EEModuleDescription moduleDescription=deploymentUnit.getAttachment(org.jboss.as.ee.component.Attachments.EE_MODULE_DESCRIPTION);
  FiltersMetaData filters=metaData.getMergedJBossWebMetaData().getFilters();
  if (filters == null) {
    metaData.getMergedJBossWebMetaData().setFilters(filters=new FiltersMetaData());
  }
  deploymentUnit.addToAttachmentList(ServletContextAttribute.ATTACHMENT_KEY,new ServletContextAttribute(ServerContainer.class.getName(),webSocketDeploymentInfo));
  final ServiceName serviceName=deploymentUnit.getServiceName().append(WebSocketContainerService.SERVICE_NAME);
  WebSocketContainerService service=new WebSocketContainerService(webSocketDeploymentInfo);
  phaseContext.getServiceTarget().addService(serviceName,service).addDependency(IOServices.WORKER.append("default"),XnioWorker.class,service.getXnioWorker()).addDependency(IOServices.BUFFER_POOL.append("default"),Pool.class,service.getInjectedBuffer()).install();
  deploymentUnit.addToAttachmentList(ServletContextAttribute.ATTACHMENT_KEY,new ServletContextAttribute(WebSocketDeploymentInfo.ATTRIBUTE_NAME,webSocketDeploymentInfo));
  final ServiceName moduleContextServiceName=ContextNames.contextServiceNameOfModule(moduleDescription.getApplicationName(),moduleDescription.getModuleName());
  bindJndiServices(deploymentUnit,phaseContext.getServiceTarget(),moduleContextServiceName,serviceName,webSocketDeploymentInfo);
  deploymentUnit.addToAttachmentList(Attachments.WEB_DEPENDENCIES,serviceName);
}
