{
  final ModelNode model=Resource.Tools.readModel(context.readResource(PathAddress.EMPTY_ADDRESS));
  performRemove(context,operation,model);
  if (requiresRuntime(context)) {
    context.addStep(new OperationStepHandler(){
      public void execute(      OperationContext context,      ModelNode operation) throws OperationFailedException {
        performRuntime(context,operation,model);
        if (context.completeStep() == OperationContext.ResultAction.ROLLBACK) {
          recoverServices(context,operation,model);
        }
      }
    }
,OperationContext.Stage.RUNTIME);
  }
  context.completeStep();
}
