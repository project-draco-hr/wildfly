{
  try {
    ejbContext.getUserTransaction().begin();
    try {
      return task.execute();
    }
 catch (    Exception e) {
      throw new EJBException(e);
    }
 finally {
      if (ejbContext.getUserTransaction().getStatus() == Status.STATUS_ACTIVE) {
        ejbContext.getUserTransaction().commit();
      }
    }
  }
 catch (  Throwable t) {
    try {
      ejbContext.getUserTransaction().rollback();
    }
 catch (    Throwable unused) {
    }
    if (t instanceof EJBException) {
      throw (EJBException)t;
    }
    throw new RuntimeException(t);
  }
}
