{
  final PathAddress address=PathAddress.pathAddress(operation.get(OP_ADDR));
  final String name=address.getLastElement().getValue();
  final ServiceTarget serviceTarget=context.getServiceTarget();
  final ConsoleHandlerService service=new ConsoleHandlerService();
  final ServiceBuilder<Handler> serviceBuilder=serviceTarget.addService(LogServices.handlerName(name),service);
  if (operation.hasDefined(LEVEL))   service.setLevel(Level.parse(operation.get(LEVEL).asString()));
  final Boolean autoFlush=operation.get(AUTOFLUSH).asBoolean();
  if (autoFlush != null)   service.setAutoflush(autoFlush.booleanValue());
  try {
    if (operation.hasDefined(ENCODING))     service.setEncoding(operation.get(ENCODING).asString());
  }
 catch (  Throwable t) {
    throw new OperationFailedException(new ModelNode().set(t.getLocalizedMessage()));
  }
  service.setFormatterSpec(AbstractFormatterSpec.Factory.create(operation));
  serviceBuilder.addListener(verificationHandler);
  serviceBuilder.setInitialMode(ServiceController.Mode.ACTIVE);
  newControllers.add(serviceBuilder.install());
}
