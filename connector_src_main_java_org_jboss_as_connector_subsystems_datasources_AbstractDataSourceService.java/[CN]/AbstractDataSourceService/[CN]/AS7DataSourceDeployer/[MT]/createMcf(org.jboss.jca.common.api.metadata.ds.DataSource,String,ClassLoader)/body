{
  final LocalManagedConnectionFactory managedConnectionFactory=new LocalManagedConnectionFactory();
  managedConnectionFactory.setUserTransactionJndiName("java:comp/UserTransaction");
  managedConnectionFactory.setDriverClass(dataSourceConfig.getDriverClass());
  if (dataSourceConfig.getConnectionProperties() != null) {
    managedConnectionFactory.setConnectionProperties(buildConfigPropsString(dataSourceConfig.getConnectionProperties()));
  }
  if (dataSourceConfig.getConnectionUrl() != null) {
    managedConnectionFactory.setConnectionURL(dataSourceConfig.getConnectionUrl());
  }
  if (dataSourceConfig.getUrlDelimiter() != null) {
    managedConnectionFactory.setURLDelimiter(dataSourceConfig.getUrlDelimiter());
  }
  setMcfProperties(managedConnectionFactory);
  return managedConnectionFactory;
}
