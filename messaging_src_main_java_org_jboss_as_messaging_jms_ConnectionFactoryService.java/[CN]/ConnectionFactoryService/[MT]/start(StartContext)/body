{
  final JMSServerManager jmsManager=jmsServer.getValue();
  try {
    MockContext.pushBindingTrap();
    try {
      jmsManager.createConnectionFactory(false,configuration,configuration.getBindings());
    }
  finally {
      final ServiceTarget target=context.getChildTarget();
      final Map<String,Object> bindings=MockContext.popTrappedBindings();
      for (      Map.Entry<String,Object> binding : bindings.entrySet()) {
        final ContextNames.BindInfo bindInfo=ContextNames.bindInfoFor(binding.getKey());
        final BinderService binderService=new BinderService(bindInfo.getBindName());
        target.addService(bindInfo.getBinderServiceName(),binderService).addDependency(bindInfo.getParentContextServiceName(),ServiceBasedNamingStore.class,binderService.getNamingStoreInjector()).addInjection(binderService.getManagedObjectInjector(),new ValueManagedReferenceFactory(Values.immediateValue(binding.getValue()))).setInitialMode(ServiceController.Mode.ACTIVE).install();
      }
    }
  }
 catch (  Exception e) {
    throw new StartException(MESSAGES.failedToCreate("connection-factory"),e);
  }
}
