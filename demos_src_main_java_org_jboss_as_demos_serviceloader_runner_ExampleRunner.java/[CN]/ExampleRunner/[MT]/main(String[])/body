{
  DeploymentUtils utils=new DeploymentUtils("serviceloader-example.jar",TestService.class.getPackage());
  try {
    utils.addDeployment("serviceloader-mbean.sar",Test.class.getPackage(),true);
    utils.deploy();
    ObjectName objectName=new ObjectName("jboss:name=test,type=serviceloader");
    utils.waitForDeploymentHack(objectName);
    MBeanServerConnection mbeanServer=utils.getConnection();
    Thread.sleep(1000);
    mbeanServer.invoke(objectName,"test",new Object[0],new String[0]);
  }
  finally {
    utils.undeploy();
  }
}
