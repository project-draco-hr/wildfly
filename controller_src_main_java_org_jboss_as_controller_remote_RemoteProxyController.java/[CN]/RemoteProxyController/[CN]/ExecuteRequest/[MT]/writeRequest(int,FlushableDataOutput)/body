{
  boolean success=false;
  activeRequests.put(getBatchId(),executeRequestContext);
  try {
    output.write(ModelControllerProtocol.PARAM_OPERATION);
    operation.writeExternal(output);
    output.write(ModelControllerProtocol.PARAM_INPUTSTREAMS_LENGTH);
    int inputStreamLength=0;
    if (executeRequestContext.getAttachments() != null) {
      List<InputStream> streams=executeRequestContext.getAttachments().getInputStreams();
      if (streams != null) {
        inputStreamLength=streams.size();
      }
    }
    output.writeInt(inputStreamLength);
    success=true;
  }
  finally {
    if (!success) {
      ManagementBatchIdManager.DEFAULT.freeBatchId(getBatchId());
    }
  }
}
