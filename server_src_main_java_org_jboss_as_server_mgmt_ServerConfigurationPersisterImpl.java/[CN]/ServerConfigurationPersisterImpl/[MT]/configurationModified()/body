{
  if (configFile != null) {
    try {
      backupConfigFile();
      configFile.createNewFile();
      final FileOutputStream fos=new FileOutputStream(configFile);
      try {
        final BufferedOutputStream bos=new BufferedOutputStream(fos);
        try {
          final XMLStreamWriter writer=XMLOutputFactory.newInstance().createXMLStreamWriter(bos);
          try {
            final XMLMapper mapper=XMLMapper.Factory.create();
            mapper.deparseDocument(new RootElementWriter(),writer);
          }
  finally {
            StreamUtils.safeClose(writer);
          }
        }
  finally {
          StreamUtils.safeClose(bos);
        }
      }
  finally {
        StreamUtils.safeClose(fos);
      }
    }
 catch (    Exception e) {
      logger.errorf(e,"Failed persisting configuration file %s",configFile.getAbsolutePath());
    }
  }
}
