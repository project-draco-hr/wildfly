{
  final ClassLoader oldTCCL=SecurityActions.getContextClassLoader();
  try {
    SecurityActions.setContextClassLoader(classLoader);
    if (configuration == null) {
      return Validation.byDefaultProvider().providerResolver(new WildFlyProviderResolver()).configure().buildValidatorFactory();
    }
 else {
      return configuration.buildValidatorFactory();
    }
  }
  finally {
    SecurityActions.setContextClassLoader(oldTCCL);
  }
}
