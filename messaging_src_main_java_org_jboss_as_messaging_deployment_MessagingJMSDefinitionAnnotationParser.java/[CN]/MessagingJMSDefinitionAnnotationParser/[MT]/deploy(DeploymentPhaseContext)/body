{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final EEModuleDescription eeModuleDescription=deploymentUnit.getAttachment(Attachments.EE_MODULE_DESCRIPTION);
  final CompositeIndex index=deploymentUnit.getAttachment(org.jboss.as.server.deployment.Attachments.COMPOSITE_ANNOTATION_INDEX);
  final EEApplicationClasses applicationClasses=deploymentUnit.getAttachment(Attachments.EE_APPLICATION_CLASSES_DESCRIPTION);
  for (  AnnotationInstance annotation : index.getAnnotations(JMS_DESTINATION_DEFINITIONS)) {
    final AnnotationTarget target=annotation.target();
    if (!(target instanceof ClassInfo)) {
      throw MESSAGES.classOnlyAnnotation(JMS_DESTINATION_DEFINITIONS.toString(),target);
    }
    List<AnnotationInstance> destinationDefinitions=getNestedDefinitionAnnotations(annotation);
    for (    AnnotationInstance definition : destinationDefinitions) {
      processJMSDestinationDefinition(deploymentUnit,eeModuleDescription,definition,(ClassInfo)target,applicationClasses);
    }
  }
  for (  AnnotationInstance definition : index.getAnnotations(JMS_DESTINATION_DEFINITION)) {
    final AnnotationTarget target=definition.target();
    if (!(target instanceof ClassInfo)) {
      throw MESSAGES.classOnlyAnnotation(JMS_DESTINATION_DEFINITION.toString(),target);
    }
    processJMSDestinationDefinition(deploymentUnit,eeModuleDescription,definition,(ClassInfo)target,applicationClasses);
  }
  for (  AnnotationInstance annotation : index.getAnnotations(JMS_CONNECTION_FACTORY_DEFINITIONS)) {
    final AnnotationTarget target=annotation.target();
    if (!(target instanceof ClassInfo)) {
      throw MESSAGES.classOnlyAnnotation(JMS_CONNECTION_FACTORY_DEFINITIONS.toString(),target);
    }
    List<AnnotationInstance> connectionFactoryDefinitions=getNestedDefinitionAnnotations(annotation);
    for (    AnnotationInstance definition : connectionFactoryDefinitions) {
      processJMSConnectionFactoryDefinition(deploymentUnit,eeModuleDescription,definition,(ClassInfo)target,applicationClasses);
    }
  }
  for (  AnnotationInstance definition : index.getAnnotations(JMS_CONNECTION_FACTORY_DEFINITION)) {
    final AnnotationTarget target=definition.target();
    if (!(target instanceof ClassInfo)) {
      throw MESSAGES.classOnlyAnnotation(JMS_CONNECTION_FACTORY_DEFINITION.toString(),target);
    }
    processJMSConnectionFactoryDefinition(deploymentUnit,eeModuleDescription,definition,(ClassInfo)target,applicationClasses);
  }
}
