{
  ModelNode addOp=createOpNode("subsystem=security/security-domain=test","add");
  ModelNode addLoginModuleOp=createOpNode("subsystem=security/security-domain=test/authentication=classic","add");
  ModelNode loginModule=new ModelNode();
  loginModule.get("code").set("Simple");
  loginModule.get("flag").set("required");
  addLoginModuleOp.get("login-modules").add(loginModule);
  executeOperation(ModelUtil.createCompositeNode(new ModelNode[]{addOp,addLoginModuleOp}));
  deployer.deploy("secured-servlet");
  boolean failed=false;
  try {
    String response=HttpRequest.get(url.toString() + "/SecurityDomainTestCase/SecuredServlet",10,TimeUnit.SECONDS);
  }
 catch (  Exception e) {
    assertTrue(e.toString().contains("Status 401"));
    failed=true;
  }
  assertTrue(failed);
  try {
    String response=HttpRequest.get(url.toString() + "/SecurityDomainTestCase/SecuredServlet","test","test",10,TimeUnit.SECONDS);
  }
 catch (  Exception e) {
    throw new Exception("Unable to access secured servlet.",e);
  }
  deployer.undeploy("secured-servlet");
  ModelNode op=createOpNode("subsystem=security/security-domain=test","remove");
  executeOperation(op);
  failed=false;
  try {
    deployer.deploy("secured-servlet");
  }
 catch (  Exception e) {
    failed=true;
  }
  assertTrue(failed);
}
