{
  Descriptor jbossDescriptorName=null;
  if (deploymentFile.endsWith(".war"))   jbossDescriptorName=Descriptor.WAR_JBOSS_FILE;
 else   if (deploymentFile.endsWith(".jar"))   jbossDescriptorName=Descriptor.JAR_JBOSS_FILE;
 else   if (deploymentFile.endsWith(".ear"))   jbossDescriptorName=Descriptor.EAR_JBOSS_FILE;
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  JarOutputStream plan=new JarOutputStream(baos);
  URL descriptorURL=getClass().getResource(jbossDescriptorName.name);
  File jbossDescriptorFile=new File(descriptorURL.getPath());
  JarUtils.addJarEntry(plan,"!/" + jbossDescriptorName.fullPath(),new FileInputStream(jbossDescriptorFile));
  DeploymentMetaData metaData=new DeploymentMetaData(deploymentFile);
  String[] strs=jbossDescriptorName.fullPath().split("/");
  metaData.addEntry(deploymentFile,strs[strs.length - 1]);
  String metaStr=metaData.toXMLString();
  JarUtils.addJarEntry(plan,DeploymentMetaData.ENTRY_NAME,new ByteArrayInputStream(metaStr.getBytes()));
  plan.flush();
  plan.close();
  return new ByteArrayInputStream(baos.toByteArray());
}
