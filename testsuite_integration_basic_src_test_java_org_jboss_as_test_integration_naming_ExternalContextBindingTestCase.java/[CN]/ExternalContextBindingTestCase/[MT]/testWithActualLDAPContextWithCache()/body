{
  InitialContext ctx=null;
  InitialDirContext ldapContext1=null;
  InitialDirContext ldapContext2=null;
  try {
    ctx=new InitialContext();
    LOGGER.info("looking up java:global/ldap-cache ....");
    ldapContext1=(InitialDirContext)ctx.lookup("java:global/ldap-cache");
    ldapContext2=(InitialDirContext)ctx.lookup("java:global/ldap-cache");
    Assert.assertNotNull(ldapContext1);
    Assert.assertNotNull(ldapContext2);
    Assert.assertSame(ldapContext1,ldapContext2);
    LOGGER.info("acquired external LDAP context: " + ldapContext1.toString());
    LdapCtx c=(LdapCtx)ldapContext1.lookup("dc=jboss,dc=org");
    c=(LdapCtx)c.lookup("ou=People");
    Attributes attributes=c.getAttributes("uid=jduke");
    Assert.assertTrue(attributes.get("description").contains("awesome"));
  }
  finally {
    if (ctx != null) {
      ctx.close();
    }
    if (ldapContext1 != null) {
      ldapContext1.close();
    }
    if (ldapContext2 != null) {
      ldapContext2.close();
    }
  }
}
