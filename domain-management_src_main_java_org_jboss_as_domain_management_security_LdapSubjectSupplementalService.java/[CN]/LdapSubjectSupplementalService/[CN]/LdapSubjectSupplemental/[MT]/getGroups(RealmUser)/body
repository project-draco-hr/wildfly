{
  Set<RealmGroup> response=new HashSet<RealmGroup>();
  try {
    HashSet<String> ldapGroups=(HashSet<String>)searchLdap(user.getName());
    ROOT_LOGGER.trace("Retrieved groups [" + user.getName() + "] :");
    for (    String group : ldapGroups) {
      if (pattern != null) {
        Pattern compilePattern=Pattern.compile(pattern);
        Matcher ldapGroupMatch=compilePattern.matcher(group);
        if (ldapGroupMatch.groupCount() > 0) {
          String parsedGroup=replaceGroups(ldapGroupMatch);
          if (parsedGroup.length() > 0) {
            response.add(new RealmGroup(parsedGroup));
          }
        }
      }
 else {
        ROOT_LOGGER.trace("   group:" + group);
        response.add(new RealmGroup(group));
      }
    }
  }
 catch (  Exception e) {
    ROOT_LOGGER.failedRetrieveLdapGroups(e);
  }
  return response;
}
