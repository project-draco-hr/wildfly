{
  Set<String> userNames=new HashSet<String>();
  DirContext searchContext=null;
  NamingEnumeration<SearchResult> searchEnumeration=null;
  try {
    searchContext=getSearchContext();
    SearchControls searchControls=createSearchControl();
    String[] filter=createSearchFilter(searchContext,searchControls,username);
    Object[] filterArguments=new Object[]{filter[1]};
    searchEnumeration=searchContext.search(baseDn,filter[0],filterArguments,searchControls);
    while (searchEnumeration.hasMore()) {
      SearchResult result=searchEnumeration.next();
      if (groupsDn.equalsIgnoreCase("dn")) {
        userNames.add(result.getNameInNamespace());
      }
 else {
        Attributes attributes=result.getAttributes();
        if (attributes != null) {
          Attribute dn=attributes.get(groupsDn);
          if (dn != null) {
            NamingEnumeration<?> group=dn.getAll();
            while (group.hasMore()) {
              userNames.add(group.next().toString());
            }
          }
 else {
            ROOT_LOGGER.failedRetrieveLdapAttribute(groupsDn);
          }
        }
 else {
          ROOT_LOGGER.failedRetrieveLdapAttribute(groupsDn);
        }
      }
    }
  }
 catch (  Exception e) {
    ROOT_LOGGER.failedRetrieveLdapGroups(e);
  }
 finally {
    safeClose(searchEnumeration);
    safeClose(searchContext);
  }
  return userNames;
}
