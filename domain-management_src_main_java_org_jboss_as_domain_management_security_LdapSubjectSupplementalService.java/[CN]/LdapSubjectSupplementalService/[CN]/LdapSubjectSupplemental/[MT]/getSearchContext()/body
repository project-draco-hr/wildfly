{
  DirContext searchContext;
  if (shareConnection && sharedState.containsKey(DirContext.class.getName())) {
    SECURITY_LOGGER.trace("Using existing DirContext from shared state.");
    searchContext=(DirContext)sharedState.remove(DirContext.class.getName());
  }
 else {
    SECURITY_LOGGER.trace("Obtaining new DirContext from the ConnectionManager.");
    ConnectionManager connectionManager=LdapSubjectSupplementalService.this.connectionManager.getValue();
    searchContext=(DirContext)connectionManager.getConnection();
  }
  return searchContext;
}
