{
  ModelControllerClient client=ModelControllerClient.Factory.create("localhost",9999);
  try {
    ModelNode allVersions=new ModelNode();
    ModelNode op=new ModelNode();
    op.get(OP).set(READ_RESOURCE_OPERATION);
    op.get(OP_ADDR).setEmptyList();
    ModelNode result=Tools.getAndCheckResult(client.execute(op));
    allVersions.get(CORE,STANDALONE).set(readModelVersionFields(result));
    op.get(OP_ADDR).add(EXTENSION,"*").add(SUBSYSTEM,"*");
    result=Tools.getAndCheckResult(client.execute(op));
    TreeMap<String,ModelNode> map=new TreeMap<String,ModelNode>();
    List<ModelNode> subsystemResults=result.asList();
    for (    ModelNode subsystemResult : subsystemResults) {
      String subsystemName=PathAddress.pathAddress(subsystemResult.get(OP_ADDR)).getLastElement().getValue();
      map.put(subsystemName,Tools.getAndCheckResult(subsystemResult));
    }
    for (    Map.Entry<String,ModelNode> entry : map.entrySet()) {
      allVersions.get(SUBSYSTEM,entry.getKey()).set(readModelVersionFields(entry.getValue()));
      allVersions.get(SUBSYSTEM,entry.getKey()).get(XML_NAMESPACES).set(entry.getValue().get(XML_NAMESPACES));
    }
    return allVersions;
  }
  finally {
    IoUtils.safeClose(client);
  }
}
