{
  final CompositeIndex compositeIndex=depUnit.getAttachment(Attachments.COMPOSITE_ANNOTATION_INDEX);
  if (compositeIndex == null) {
    log.warnf("Cannot find composite annotation index in: %s",depUnit);
    return null;
  }
  final DotName runWithName=DotName.createSimple(RunWith.class.getName());
  final List<AnnotationInstance> runWithList=compositeIndex.getAnnotations(runWithName);
  if (runWithList.isEmpty()) {
    return null;
  }
  ArquillianConfig arqConfig=new ArquillianConfig(arqService,depUnit,runWithList);
  if (arqService.getServiceContainer().getService(arqConfig.getServiceName()) != null) {
    log.warnf("Arquillian config already registered: %s",arqConfig);
    return null;
  }
  depUnit.putAttachment(ArquillianConfig.KEY,arqConfig);
  return arqConfig;
}
