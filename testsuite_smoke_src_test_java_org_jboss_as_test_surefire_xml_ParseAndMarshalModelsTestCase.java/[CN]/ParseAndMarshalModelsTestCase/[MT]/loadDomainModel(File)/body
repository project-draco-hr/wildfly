{
  final QName rootElement=new QName(Namespace.CURRENT.getUriString(),"domain");
  final DomainXml parser=new DomainXml(Module.getBootModuleLoader());
  final XmlConfigurationPersister persister=new XmlConfigurationPersister(file,rootElement,parser,parser);
  final List<ModelNode> ops=persister.load();
  final ModelNodeRegistration hostRegistry=HostModelUtil.createHostRegistry(persister,null,null);
  final ModelNodeRegistration rootRegistration=HostModelUtil.createBootstrapHostRegistry(hostRegistry,null);
  TestDomainController controller=new TestDomainController(persister,rootRegistration);
  executeOperations(controller,ops);
  ModelNode model=controller.getDomainModel().clone();
  persister.store(model);
  return model;
}
