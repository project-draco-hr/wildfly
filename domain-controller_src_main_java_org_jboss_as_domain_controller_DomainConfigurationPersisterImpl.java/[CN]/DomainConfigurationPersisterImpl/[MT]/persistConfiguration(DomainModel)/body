{
  FileOutputStream fos=null;
  BufferedOutputStream bos=null;
  XMLStreamWriter xmlWriter=null;
  try {
    backupConfigFile();
    configFile.createNewFile();
    fos=new FileOutputStream(configFile);
    bos=new BufferedOutputStream(fos);
    xmlWriter=XMLOutputFactory.newInstance().createXMLStreamWriter(bos);
    final XMLMapper mapper=XMLMapper.Factory.create();
    mapper.deparseDocument(new RootElementWriter(domainModel),xmlWriter);
  }
 catch (  Exception e) {
    logger.errorf(e,"Failed persisting configuration file %s",configFile.getAbsolutePath());
  }
 finally {
    if (xmlWriter != null) {
      try {
        xmlWriter.close();
      }
 catch (      XMLStreamException e) {
        logger.warnf(e,"Failed closing writer to configuration file %s",configFile.getAbsolutePath());
      }
    }
    StreamUtils.safeClose(bos);
    StreamUtils.safeClose(fos);
  }
}
