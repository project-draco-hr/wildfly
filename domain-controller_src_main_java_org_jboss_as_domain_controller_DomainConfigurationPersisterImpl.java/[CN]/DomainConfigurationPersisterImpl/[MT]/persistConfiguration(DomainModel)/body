{
  FileOutputStream fos=null;
  BufferedOutputStream bos=null;
  XMLStreamWriter xmlWriter=null;
  try {
    backupConfigFile();
    configFile.createNewFile();
    fos=new FileOutputStream(configFile);
    bos=new BufferedOutputStream(fos);
    xmlWriter=XMLOutputFactory.newInstance().createXMLStreamWriter(bos);
    final XMLMapper mapper=XMLMapper.Factory.create();
    mapper.deparseDocument(new RootElementWriter(domainModel),xmlWriter);
    xmlWriter.close();
  }
 catch (  Exception e) {
    logger.errorf(e,"Failed persisting configuration file %s",configFile.getAbsolutePath());
  }
 finally {
    StreamUtils.safeClose(bos);
    StreamUtils.safeClose(fos);
  }
}
