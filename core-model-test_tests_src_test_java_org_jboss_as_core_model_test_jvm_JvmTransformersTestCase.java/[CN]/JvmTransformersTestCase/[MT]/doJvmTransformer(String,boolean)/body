{
  KernelServicesBuilder builder=createKernelServicesBuilder(TestModelType.DOMAIN).setXmlResource(xmlResource).setModelInitializer(XML_MODEL_INITIALIZER,XML_MODEL_WRITE_SANITIZER);
  LegacyKernelServicesInitializer legacyInitializer=builder.createLegacyKernelServicesBuilder(modelVersion);
  legacyInitializer.setTestControllerVersion(testControllerVersion).initializerCreateModelResource(PathAddress.EMPTY_ADDRESS,PathElement.pathElement(PROFILE,"test"),null).initializerCreateModelResource(PathAddress.EMPTY_ADDRESS,PathElement.pathElement(SOCKET_BINDING_GROUP,"test-sockets"),new ModelNode().setEmptyObject());
  KernelServices mainServices=builder.build();
  assertTrue(mainServices.isSuccessfulBoot());
  KernelServices legacyServices=mainServices.getLegacyServices(modelVersion);
  if (legacyMustBoot) {
    assertTrue(legacyServices.isSuccessfulBoot());
    checkCoreModelTransformation(mainServices,modelVersion,MODEL_FIXER,MODEL_FIXER);
  }
 else {
    assertFalse(legacyServices.isSuccessfulBoot());
  }
}
