{
  KernelServicesBuilder builder=createKernelServicesBuilder(TestModelType.DOMAIN).setXmlResource(xmlResource).setModelInitializer(StandardServerGroupInitializers.XML_MODEL_INITIALIZER,StandardServerGroupInitializers.XML_MODEL_WRITE_SANITIZER);
  StandardServerGroupInitializers.addServerGroupInitializers(builder.createLegacyKernelServicesBuilder(modelVersion,testControllerVersion));
  KernelServices mainServices=builder.build();
  assertTrue(mainServices.isSuccessfulBoot());
  KernelServices legacyServices=mainServices.getLegacyServices(modelVersion);
  if (legacyMustBoot) {
    assertTrue(legacyServices.isSuccessfulBoot());
    checkCoreModelTransformation(mainServices,modelVersion,StandardServerGroupInitializers.MODEL_FIXER,StandardServerGroupInitializers.MODEL_FIXER);
  }
 else {
    assertFalse(legacyServices.isSuccessfulBoot());
  }
}
