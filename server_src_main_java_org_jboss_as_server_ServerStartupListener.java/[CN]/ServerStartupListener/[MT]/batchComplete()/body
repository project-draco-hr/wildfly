{
  boolean finished=this.finished.get();
  if (batchCallback != null) {
    batchCallback.run();
  }
  if (finished && callbackRan.compareAndSet(false,true)) {
    final long end=System.currentTimeMillis();
    finishCallback.run(serviceFailures,end - start,totalServices,expectedOnDemandServices.size() - startedOnDemandServicesUpdater.get(this),startedServices);
  }
}
