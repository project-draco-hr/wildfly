{
  File workDir=null;
  try {
    workDir=createTempDir();
    final File cachedContent=new File(workDir,"content");
    FileOutputStream os=null;
    try {
      os=new FileOutputStream(cachedContent);
      PatchUtils.copyStream(content,os);
      os.close();
    }
  finally {
      PatchUtils.safeClose(os);
    }
    unpack(cachedContent,workDir);
    return execute(workDir,ContentVerificationPolicy.STRICT);
  }
 catch (  IOException e) {
    throw new PatchingException(e);
  }
 finally {
    if (workDir != null && !recursiveDelete(workDir)) {
      PatchLogger.ROOT_LOGGER.debugf("failed to remove work directory (%s)",workDir);
    }
  }
}
