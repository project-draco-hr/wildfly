{
  final String localHostName=domainOperationContext.getLocalHostInfo().getLocalHostName();
  Map<String,ModelNode> hostResults=new HashMap<String,ModelNode>(domainOperationContext.getHostControllerResults());
  if (domainOperationContext.getCoordinatorResult().isDefined()) {
    hostResults.put(localHostName,domainOperationContext.getCoordinatorResult());
  }
  Map<String,Map<ServerIdentity,ModelNode>> opsByGroup=getOpsByGroup(hostResults);
  if (opsByGroup.size() > 0) {
    final ModelNode rolloutPlan=getRolloutPlan(this.providedRolloutPlan,opsByGroup);
    if (trace) {
      HOST_CONTROLLER_LOGGER.tracef("Rollout plan is %s",rolloutPlan);
    }
    final ServerTaskExecutor taskExecutor=new ServerTaskExecutor(context,submittedTasks,preparedResults){
      @Override protected boolean execute(      TransactionalProtocolClient.TransactionalOperationListener<ServerTaskExecutor.ServerOperation> listener,      ServerIdentity server,      ModelNode original) throws OperationFailedException {
        final String hostName=server.getHostName();
        ProxyController proxy=hostProxies.get(hostName);
        if (proxy == null) {
          if (localHostName.equals(hostName)) {
            proxy=serverProxies.get(server.getServerName());
          }
          if (proxy == null) {
            if (trace) {
              HOST_CONTROLLER_LOGGER.tracef("No proxy for %s",server);
            }
            return false;
          }
        }
        final TransformingProxyController remoteProxyController=(TransformingProxyController)proxy;
        final OperationTransformer.TransformedOperation transformed=domainOperationContext.transformServerOperation(hostName,remoteProxyController,context,original);
        final ModelNode transformedOperation=transformed.getTransformedOperation();
        final OperationResultTransformer resultTransformer=transformed.getResultTransformer();
        final TransactionalProtocolClient client=remoteProxyController.getProtocolClient();
        return executeOperation(listener,client,server,transformedOperation,resultTransformer);
      }
    }
;
    RolloutPlanController rolloutPlanController=new RolloutPlanController(opsByGroup,rolloutPlan,domainOperationContext,taskExecutor,executorService);
    RolloutPlanController.Result planResult=rolloutPlanController.execute();
    if (trace) {
      HOST_CONTROLLER_LOGGER.tracef("Rollout plan result is %s",planResult);
    }
    if (planResult == RolloutPlanController.Result.FAILED || (planResult == RolloutPlanController.Result.PARTIAL && domainOperationContext.isCompleteRollback())) {
      domainOperationContext.setCompleteRollback(true);
      context.getResult();
      context.getFailureDescription().set(DomainControllerLogger.ROOT_LOGGER.operationFailedOrRolledBack());
      domainOperationContext.setFailureReported(true);
    }
  }
}
