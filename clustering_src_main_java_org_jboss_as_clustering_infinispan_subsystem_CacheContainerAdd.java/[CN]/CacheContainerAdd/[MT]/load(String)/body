{
  URL url=InfinispanExtension.class.getClassLoader().getResource(resource);
  if (url == null) {
    throw new IllegalStateException(String.format("Failed to locate %s",resource));
  }
  try {
    InputStream input=url.openStream();
    SwitchContext context=this.switcher.getSwitchContext(InfinispanConfiguration.class.getClassLoader());
    try {
      return InfinispanConfiguration.newInfinispanConfiguration(input);
    }
  finally {
      context.reset();
      try {
        input.close();
      }
 catch (      IOException e) {
        log.warn(e.getMessage(),e);
      }
    }
  }
 catch (  IOException e) {
    throw new IllegalStateException(String.format("Failed to parse %s",url),e);
  }
}
