{
  PathAddress stackAddress=PathAddress.pathAddress(operation.get(OP_ADDR));
  if (operation.hasDefined(TransportResourceDefinition.PATH.getKey())) {
    PathAddress address=stackAddress.append(TransportResourceDefinition.PATH);
    ModelNode transportOperation=operation.get(ModelKeys.TRANSPORT).clone();
    transportOperation.get(OPERATION_NAME).set(ADD);
    transportOperation.get(OP_ADDR).set(address.toModelNode());
    context.addStep(transportOperation,TransportResourceDefinition.ADD_HANDLER,OperationContext.Stage.MODEL,true);
  }
  if (operation.hasDefined(StackResourceDefinition.PROTOCOLS.getName())) {
    List<ModelNode> protocols=operation.get(StackResourceDefinition.PROTOCOLS.getName()).asList();
    ListIterator<ModelNode> iterator=protocols.listIterator(protocols.size());
    while (iterator.hasPrevious()) {
      ModelNode protocolOperation=iterator.previous().clone();
      protocolOperation.get(OPERATION_NAME).set(ModelKeys.ADD_PROTOCOL);
      protocolOperation.get(OP_ADDR).set(stackAddress.toModelNode());
      context.addStep(protocolOperation,ProtocolResourceDefinition.ADD_HANDLER,OperationContext.Stage.MODEL,true);
    }
  }
}
