{
  String subsystemXml="<subsystem xmlns=\"" + Namespace.CURRENT.getUriString() + "\"/>";
  KernelServices services=createKernelServicesBuilder(null).setSubsystemXml(subsystemXml).build();
  ModelNode model=services.readWholeModel();
  Assert.assertFalse(model.get(SUBSYSTEM,JMXExtension.SUBSYSTEM_NAME,CommonAttributes.EXPOSE_MODEL,CommonAttributes.RESOLVED).isDefined());
  ModelNode read=createOperation(READ_ATTRIBUTE_OPERATION);
  read.get(NAME).set(CommonAttributes.SHOW_MODEL);
  Assert.assertFalse(services.executeForResult(read).asBoolean());
  ModelNode write=createOperation(WRITE_ATTRIBUTE_OPERATION);
  write.get(NAME).set(CommonAttributes.SHOW_MODEL);
  write.get(VALUE).set(true);
  services.executeForResult(write);
  model=services.readWholeModel();
  Assert.assertTrue(model.get(SUBSYSTEM,JMXExtension.SUBSYSTEM_NAME,CommonAttributes.EXPOSE_MODEL,CommonAttributes.RESOLVED).isDefined());
  Assert.assertTrue(services.executeForResult(read).asBoolean());
  write.get(VALUE).set(false);
  services.executeForResult(write);
  model=services.readWholeModel();
  Assert.assertFalse(model.get(SUBSYSTEM,JMXExtension.SUBSYSTEM_NAME,CommonAttributes.EXPOSE_MODEL,CommonAttributes.RESOLVED).isDefined());
  Assert.assertFalse(services.executeForResult(read).asBoolean());
}
