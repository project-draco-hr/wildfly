{
  String subsystemXml="<subsystem xmlns=\"" + Namespace.CURRENT.getUriString() + "\">"+ "    <jmx-connector registry-binding=\"registry\" server-binding=\"server\" />"+ "</subsystem>";
  KernelServices services=super.installInController(new AdditionalInitialization(){
    @Override protected void setupController(    ControllerInitializer controllerInitializer){
      controllerInitializer.addSocketBinding("registry",12345);
      controllerInitializer.addSocketBinding("server",12346);
    }
  }
,subsystemXml);
  ModelNode model=services.readWholeModel();
  Assert.assertTrue(model.get(SUBSYSTEM).hasDefined(JMXExtension.SUBSYSTEM_NAME));
  Assert.assertEquals("registry",model.get(SUBSYSTEM,JMXExtension.SUBSYSTEM_NAME,CommonAttributes.CONNECTOR,CommonAttributes.JMX).require(CommonAttributes.REGISTRY_BINDING).asString());
  Assert.assertEquals("server",model.get(SUBSYSTEM,JMXExtension.SUBSYSTEM_NAME,CommonAttributes.CONNECTOR,CommonAttributes.JMX).require(CommonAttributes.SERVER_BINDING).asString());
  String host="localhost";
  int port=12345;
  String urlString=System.getProperty("jmx.service.url","service:jmx:rmi:///jndi/rmi://" + host + ":"+ port+ "/jmxrmi");
  JMXServiceURL serviceURL=new JMXServiceURL(urlString);
  MBeanServerConnection connection=null;
  long end=System.currentTimeMillis() + 10000;
  do {
    try {
      connection=JMXConnectorFactory.connect(serviceURL,null).getMBeanServerConnection();
    }
 catch (    Exception e) {
      Thread.sleep(500);
    }
  }
 while (connection == null && System.currentTimeMillis() < end);
  Assert.assertNotNull(connection);
  connection.getMBeanCount();
}
