{
  String subsystemXml="<subsystem xmlns=\"" + Namespace.JMX_1_0.getUriString() + "\">"+ "    <jmx-connector registry-binding=\"registry1\" server-binding=\"server1\" />"+ "</subsystem>";
  AdditionalInitialization additionalInit=new AdditionalInitialization(){
    @Override protected void setupController(    ControllerInitializer controllerInitializer){
      controllerInitializer.addSocketBinding("registry1",12345);
      controllerInitializer.addSocketBinding("server1",12346);
    }
  }
;
  KernelServices servicesA=super.installInController(additionalInit,subsystemXml);
  ModelNode modelA=servicesA.readWholeModel();
  String marshalled=servicesA.getPersistedSubsystemXml();
  servicesA.shutdown();
  Assert.assertTrue(marshalled.contains(Namespace.JMX_1_1.getUriString()));
  marshalled=marshalled.replace(Namespace.JMX_1_1.getUriString(),Namespace.JMX_1_0.getUriString());
  System.out.println(marshalled);
  Assert.assertEquals(normalizeXML(subsystemXml),normalizeXML(marshalled));
  KernelServices servicesB=super.installInController(additionalInit,marshalled);
  ModelNode modelB=servicesB.readWholeModel();
  super.compare(modelA,modelB);
}
