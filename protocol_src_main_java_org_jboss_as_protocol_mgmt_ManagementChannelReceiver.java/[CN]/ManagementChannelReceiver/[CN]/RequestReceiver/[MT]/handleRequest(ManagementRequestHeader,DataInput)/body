{
  ManagementOperationHandler operationHandler=getOperationHandler(header);
  final FlushableDataOutputImpl output=FlushableDataOutputImpl.create(getChannel().writeMessage());
  try {
    expectHeader(input,ManagementProtocol.REQUEST_OPERATION);
    ManagementRequestHandler requestHandler=getRequestHandler(operationHandler,input);
    expectHeader(input,ManagementProtocol.REQUEST_START);
    expectHeader(input,ManagementProtocol.REQUEST_BODY);
    requestHandler.setChannel(getChannel());
    requestHandler.readRequest(input);
    expectHeader(input,ManagementProtocol.REQUEST_END);
    writeResponseHeader(header,output);
    output.writeByte(ManagementProtocol.RESPONSE_START);
    output.writeByte(ManagementProtocol.RESPONSE_BODY);
    requestHandler.writeResponse(output);
    output.writeByte(ManagementProtocol.RESPONSE_END);
  }
  finally {
    IoUtils.safeClose(output);
  }
}
