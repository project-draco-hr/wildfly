{
  PersistenceProviderAdaptor persistenceProviderAdaptor=null;
  final ServiceLoader<PersistenceProviderAdaptor> serviceLoader=ServiceLoader.load(PersistenceProviderAdaptor.class,persistenceProvider.getClass().getClassLoader());
  if (serviceLoader != null) {
    for (    PersistenceProviderAdaptor adaptor : serviceLoader) {
      if (persistenceProviderAdaptor != null) {
        throw MESSAGES.classloaderHasMultipleAdapters(persistenceProvider.getClass().getClassLoader().toString());
      }
      persistenceProviderAdaptor=adaptor;
      JPA_LOGGER.debugf("loaded persistence provider adapter %s from classloader %s",persistenceProviderAdaptor.getClass().getName(),persistenceProvider.getClass().getClassLoader().toString());
    }
    if (persistenceProviderAdaptor != null) {
      persistenceProviderAdaptor.injectJtaManager(JtaManagerImpl.getInstance());
      persistenceProviderAdaptor.injectPlatform(platform);
    }
  }
  return persistenceProviderAdaptor == null ? noopAdaptor : persistenceProviderAdaptor;
}
