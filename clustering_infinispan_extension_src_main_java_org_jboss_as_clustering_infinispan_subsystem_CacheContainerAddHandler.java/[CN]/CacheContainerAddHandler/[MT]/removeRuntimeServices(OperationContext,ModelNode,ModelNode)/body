{
  String name=Operations.getPathAddress(operation).getLastElement().getValue();
  context.removeService(InfinispanBindingFactory.createCacheContainerBinding(name).getBinderServiceName());
  for (  CacheContainerServiceNameFactory factory : CacheContainerServiceName.values()) {
    context.removeService(factory.getServiceName(name));
  }
  if (model.hasDefined(TransportResourceDefinition.PATH.getKey())) {
    removeServices(context,ClusteredGroupBuilderProvider.class,name);
    context.removeService(new TransportConfigurationBuilder(name).getServiceName());
    context.removeService(JGroupsBindingFactory.createChannelBinding(name).getBinderServiceName());
    for (    ChannelServiceNameFactory factory : ChannelServiceName.values()) {
      context.removeService(factory.getServiceName(name));
    }
  }
 else {
    removeServices(context,LocalGroupBuilderProvider.class,name);
  }
  String defaultCache=ModelNodes.asString(CacheContainerResourceDefinition.DEFAULT_CACHE.resolveModelAttribute(context,model));
  if ((defaultCache != null) && !defaultCache.equals(CacheServiceNameFactory.DEFAULT_CACHE)) {
    Class<? extends CacheGroupBuilderProvider> providerClass=model.hasDefined(TransportResourceDefinition.PATH.getKey()) ? ClusteredCacheGroupBuilderProvider.class : LocalCacheGroupBuilderProvider.class;
    for (    CacheGroupBuilderProvider provider : ServiceLoader.load(providerClass,providerClass.getClassLoader())) {
      for (      Builder<?> builder : provider.getBuilders(name,CacheServiceNameFactory.DEFAULT_CACHE)) {
        context.removeService(builder.getServiceName());
      }
    }
  }
}
