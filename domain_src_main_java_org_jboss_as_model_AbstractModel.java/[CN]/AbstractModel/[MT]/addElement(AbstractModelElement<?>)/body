{
  final String id=element.getId();
  if (id != null) {
    final Map<String,AbstractModelElement<?>> elementsById=this.elementsById;
    if (elementsById.containsKey(id)) {
      throw new IllegalArgumentException("Domain already contains an element with ID '" + id + "'");
    }
    elementsById.put(id,element);
  }
  if (!elements.add(element)) {
    if (id != null) {
      elementsById.remove(id);
    }
    throw new IllegalArgumentException("Domain already contains element " + element);
  }
}
