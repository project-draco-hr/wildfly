{
  Map<String,ProcessInfo> processInfoMap=determineRunningProcesses();
  for (  String serverProcessName : processInfoMap.keySet()) {
    if (ManagedServer.isServerProcess(serverProcessName)) {
      String serverName=ManagedServer.getServerName(serverProcessName);
      stopServer(serverName,gracefulTimeout);
    }
  }
  if (blockUntilStopped) {
synchronized (shutdownCondition) {
      for (; ; ) {
        int count=0;
        for (        ManagedServer server : servers.values()) {
switch (server.getState()) {
case FAILED:
case MAX_FAILED:
case STOPPED:
            break;
default :
          count++;
      }
    }
    if (count == 0) {
      break;
    }
    try {
      shutdownCondition.wait();
    }
 catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
      break;
    }
  }
}
}
}
