{
  ArgumentCaptor<CoarseSSOCacheEntry> capturedEntry=ArgumentCaptor.forClass(CoarseSSOCacheEntry.class);
  String newId="new";
  String existingId="existing";
  CoarseSSOCacheEntry<Object> entry=new CoarseSSOCacheEntry<Object>();
  when(this.cache.getAdvancedCache()).thenReturn(this.cache);
  when(this.cache.withFlags()).thenReturn(this.cache);
  when(this.cache.putIfAbsent(same(newId),capturedEntry.capture())).thenReturn(null);
  when(this.cache.putIfAbsent(same(existingId),any(CoarseSSOCacheEntry.class))).thenReturn(entry);
  CoarseSSOCacheEntry<Object> result=this.factory.createValue(newId);
  assertSame(capturedEntry.getValue(),result);
  result=this.factory.createValue(existingId);
  assertSame(entry,result);
}
