{
  final ModelNode fullModel=Resource.Tools.readModel(context.readResource(PathAddress.EMPTY_ADDRESS));
  final ModelNode modelConfig=fullModel.get(ModClusterExtension.CONFIGURATION_PATH.getKeyValuePair());
  final ModClusterConfig config=getModClusterConfig(context,modelConfig);
  final LoadBalanceFactorProvider loadProvider=getModClusterLoadProvider(context,modelConfig);
  final ModClusterService service=new ModClusterService(config,loadProvider);
  final ServiceBuilder<ModCluster> serviceBuilder=context.getServiceTarget().addService(ModClusterService.NAME,service).addDependency(WebSubsystemServices.JBOSS_WEB,WebServer.class,service.getWebServer()).addDependency(SocketBindingManager.SOCKET_BINDING_MANAGER,SocketBindingManager.class,service.getBindingManager()).addListener(verificationHandler).setInitialMode(Mode.ACTIVE);
  final ModelNode bindingRefNode=ADVERTISE_SOCKET.resolveModelAttribute(context,modelConfig);
  final String bindingRef=bindingRefNode.isDefined() ? bindingRefNode.asString() : null;
  if (bindingRef != null) {
    serviceBuilder.addDependency(SocketBinding.JBOSS_BINDING_NAME.append(bindingRef),SocketBinding.class,service.getBinding());
  }
  newControllers.add(serviceBuilder.install());
}
