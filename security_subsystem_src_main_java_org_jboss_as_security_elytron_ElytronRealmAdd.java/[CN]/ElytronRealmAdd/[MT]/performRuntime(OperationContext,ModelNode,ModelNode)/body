{
  final PathAddress address=PathAddress.pathAddress(operation.get(OP_ADDR));
  final String elytronRealmName=address.getLastElement().getValue();
  final ServiceTarget target=context.getServiceTarget();
  final ModelNode securityDomainName=ElytronRealmResourceDefinition.LEGACY_DOMAIN_NAME.resolveModelAttribute(context,model);
  if (securityDomainName.isDefined()) {
    final ServiceName realmServiceName=context.getCapabilityServiceName(ElytronRealmResourceDefinition.SECURITY_REALM_CAPABILITY,elytronRealmName,SecurityRealm.class);
    final SecurityDomainContextRealmService domainContextRealmService=new SecurityDomainContextRealmService();
    target.addService(realmServiceName,domainContextRealmService).addDependency(SecurityDomainService.SERVICE_NAME.append(securityDomainName.asString()),SecurityDomainContext.class,domainContextRealmService.getSecurityDomainContextInjector()).setInitialMode(ServiceController.Mode.ACTIVE).install();
  }
}
