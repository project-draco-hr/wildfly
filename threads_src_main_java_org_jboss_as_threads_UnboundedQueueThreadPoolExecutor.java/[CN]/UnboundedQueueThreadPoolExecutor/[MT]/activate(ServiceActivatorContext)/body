{
  final BatchBuilder batchBuilder=context.getBatchBuilder();
  final ScaledCount maxThreads=getMaxThreads();
  int maxThreadsValue=maxThreads != null ? maxThreads.getScaledCount() : Integer.MAX_VALUE;
  TimeSpec keepAlive=getKeepaliveTime();
  if (keepAlive == null)   keepAlive=TimeSpec.DEFAULT_KEEPALIVE;
  final UnboundedQueueThreadPoolService service=new UnboundedQueueThreadPoolService(maxThreadsValue,keepAlive);
  final ServiceName serviceName=JBOSS_THREAD_EXECUTOR.append(getName());
  final BatchServiceBuilder<ExecutorService> serviceBuilder=batchBuilder.addService(serviceName,service);
  final String threadFactory=getThreadFactory();
  final ServiceName threadFactoryName;
  if (threadFactory == null) {
    threadFactoryName=serviceName.append("thread-factory");
    batchBuilder.addService(threadFactoryName,new ThreadFactoryService());
  }
 else {
    threadFactoryName=JBOSS_THREAD_FACTORY.append(threadFactory);
  }
  serviceBuilder.addDependency(threadFactoryName,ThreadFactory.class,service.getThreadFactoryInjector());
}
