{
  String jbossHome=System.getenv("JBOSS_HOME");
  if (jbossHome == null) {
    return new ErrorState(MESSAGES.jbossHomeNotSet());
  }
  List<File> foundFiles=new ArrayList<File>(2);
  File standaloneProps=new File(jbossHome + "/standalone/configuration/mgmt-users.properties");
  if (standaloneProps.exists()) {
    foundFiles.add(standaloneProps);
  }
  File domainProps=new File(jbossHome + "/domain/configuration/mgmt-users.properties");
  if (domainProps.exists()) {
    foundFiles.add(domainProps);
  }
  if (foundFiles.size() == 0) {
    return new ErrorState(MESSAGES.mgmtUsersPropertiesNotFound());
  }
  propertiesFiles=foundFiles;
  Set<String> foundUsers=new HashSet<String>();
  for (  File current : propertiesFiles) {
    try {
      foundUsers.addAll(loadUserNames(current));
    }
 catch (    IOException e) {
      return new ErrorState(MESSAGES.unableToLoadUsers(current.getAbsolutePath(),e.getMessage()));
    }
  }
  knownUsers=foundUsers;
  if (values == null) {
    return new PromptNewUserState();
  }
 else {
    return new PromptNewUserState(values);
  }
}
