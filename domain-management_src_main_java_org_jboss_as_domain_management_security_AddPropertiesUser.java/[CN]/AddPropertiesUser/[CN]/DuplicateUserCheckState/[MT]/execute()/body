{
  final State continuingState;
  if (values.isExistingUser()) {
    continuingState=new UpdateUser(values);
  }
 else {
    State addState=new AddUser(values);
    if (values.isSilentOrNonInteractive()) {
      continuingState=addState;
    }
 else {
      String message=MESSAGES.aboutToAddUser(values.userName,values.realm);
      String prompt=MESSAGES.isCorrectPrompt();
      continuingState=new ConfirmationChoice(message,prompt,addState,new PromptNewUserState(values));
    }
  }
  return continuingState;
}
