{
  if (knownUsers.contains(values.userName)) {
    State continuing=values.isSilentOrNonInteractive() ? null : new PromptNewUserState(values);
    return new ErrorState(MESSAGES.duplicateUser(values.userName),continuing,values);
  }
  State addState=new AddUser(values);
  final State continuingState;
  if (values.isSilentOrNonInteractive()) {
    continuingState=addState;
  }
 else {
    String message=MESSAGES.aboutToAddUser(values.userName,values.realm);
    String prompt=MESSAGES.isCorrectPrompt();
    continuingState=new ConfirmationChoice(message,prompt,addState,new PromptNewUserState(values));
  }
  return continuingState;
}
