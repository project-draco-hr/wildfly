{
  final ServiceController<?> controller=serviceRegistry.getService(lookupName);
  final Object object;
  if (controller != null) {
    try {
      object=controller.getValue();
    }
 catch (    IllegalStateException e) {
      throw new NameNotFoundException("Error looking up " + name + ", service "+ lookupName+ " is not started");
    }
  }
 else {
    return null;
  }
  if (dereference && object instanceof ManagedReferenceFactory) {
    try {
      return ManagedReferenceFactory.class.cast(object).getReference().getInstance();
    }
 catch (    Exception e) {
      NamingException n=new NamingException(e.getMessage());
      n.initCause(e);
      throw n;
    }
  }
  return object;
}
