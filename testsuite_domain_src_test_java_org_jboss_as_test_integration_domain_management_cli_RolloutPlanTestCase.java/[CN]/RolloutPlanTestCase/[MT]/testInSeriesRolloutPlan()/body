{
  String[] serverGroups=CLITestSuite.serverGroups.keySet().toArray(new String[]{});
  RolloutPlanBuilder planBuilder=new RolloutPlanBuilder();
  planBuilder.addGroup(serverGroups[0],new RolloutPlanBuilder.RolloutPolicy(true,null,null));
  planBuilder.addGroup(serverGroups[1],new RolloutPlanBuilder.RolloutPolicy(true,null,null));
  planBuilder.addGroup(serverGroups[2],new RolloutPlanBuilder.RolloutPolicy(true,null,null));
  String rolloutPlan=planBuilder.buildAsString();
  cli.sendLine("rollout-plan add --name=testPlan --content=" + rolloutPlan);
  planBuilder=new RolloutPlanBuilder();
  planBuilder.addGroup(serverGroups[2],new RolloutPlanBuilder.RolloutPolicy(true,null,null));
  planBuilder.addGroup(serverGroups[1],new RolloutPlanBuilder.RolloutPolicy(true,null,null));
  planBuilder.addGroup(serverGroups[0],new RolloutPlanBuilder.RolloutPolicy(true,null,null));
  rolloutPlan=planBuilder.buildAsString();
  cli.sendLine("rollout-plan add --name=testPlan2 --content=" + rolloutPlan);
  cli.sendLine("cd /management-client-content=rollout-plans/rollout-plan");
  cli.sendLine("ls");
  String ls=cli.readAllUnformated(WAIT_TIMEOUT,WAIT_LINETIMEOUT);
  Assert.assertTrue(ls.contains("testPlan"));
  Assert.assertTrue(ls.contains("testPlan2"));
  cli.sendLine("deploy " + warFile.getAbsolutePath() + " --all-server-groups --headers={rollout id=testPlan}");
  cli.waitForPrompt(WAIT_TIMEOUT);
  long mainOneTime=Long.valueOf(checkURL("main-one",false));
  long mainTwoTime=Long.valueOf(checkURL("main-two",false));
  long mainThreeTime=Long.valueOf(checkURL("main-three",false));
  long otherTwoTime=Long.valueOf(checkURL("other-two",false));
  long testOneTime=Long.valueOf(checkURL("test-one",false));
  Assert.assertTrue(mainOneTime < otherTwoTime);
  Assert.assertTrue(mainTwoTime < otherTwoTime);
  Assert.assertTrue(mainThreeTime < otherTwoTime);
  Assert.assertTrue(otherTwoTime < testOneTime);
  cli.sendLine("undeploy RolloutPlanTestCase.war --all-relevant-server-groups");
  cli.waitForPrompt(WAIT_TIMEOUT);
  cli.sendLine("deploy " + warFile.getAbsolutePath() + " --all-server-groups --headers={rollout id=testPlan2}");
  cli.waitForPrompt(WAIT_TIMEOUT);
  mainOneTime=Long.valueOf(checkURL("main-one",false));
  mainTwoTime=Long.valueOf(checkURL("main-two",false));
  mainThreeTime=Long.valueOf(checkURL("main-three",false));
  otherTwoTime=Long.valueOf(checkURL("other-two",false));
  testOneTime=Long.valueOf(checkURL("test-one",false));
  Assert.assertTrue(mainOneTime > otherTwoTime);
  Assert.assertTrue(mainTwoTime > otherTwoTime);
  Assert.assertTrue(mainThreeTime > otherTwoTime);
  Assert.assertTrue(otherTwoTime > testOneTime);
  cli.sendLine("undeploy RolloutPlanTestCase.war --all-relevant-server-groups");
  cli.waitForPrompt(WAIT_TIMEOUT);
  cli.sendLine("rollout-plan remove --name=testPlan");
  cli.sendLine("rollout-plan remove --name=testPlan2");
  cli.sendLine("cd /management-client-content=rollout-plans");
  cli.sendLine("ls");
  ls=cli.readAllUnformated(WAIT_TIMEOUT,WAIT_LINETIMEOUT);
  Assert.assertFalse(ls.contains("testPlan"));
  Assert.assertFalse(ls.contains("testPlan2"));
}
