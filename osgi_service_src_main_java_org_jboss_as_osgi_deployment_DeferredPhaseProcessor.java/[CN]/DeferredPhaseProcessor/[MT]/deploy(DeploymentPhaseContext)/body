{
  DeploymentUnit depUnit=phaseContext.getDeploymentUnit();
  XBundle bundle=depUnit.getAttachment(OSGiConstants.BUNDLE_KEY);
  if (bundle == null || bundle.isFragment())   return;
  XBundleRevision brev=bundle.getBundleRevision();
  ServiceName moduleService=ServiceModuleLoader.moduleServiceName(brev.getModuleIdentifier());
  phaseContext.addDeploymentDependency(moduleService,Attachments.MODULE);
  if (bundle.isResolved() == false) {
    depUnit.putAttachment(Attachments.DEFERRED_ACTIVATION_COUNT,new AtomicInteger());
    DeploymentUtils.addDeferredModule(depUnit);
  }
}
