{
  BundleManagerService service=new BundleManagerService(subsystemState);
  ServiceBuilder<?> serviceBuilder=target.addService(BundleManagerService.SERVICE_NAME,service);
  serviceBuilder.addDependency(ServerEnvironmentService.SERVICE_NAME,ServerEnvironment.class,service.injectedEnvironment);
  serviceBuilder.addDependency(Services.JBOSS_SERVER_CONTROLLER,ServerController.class,service.injectedServerController);
  serviceBuilder.addDependency(ServerDeploymentManager.SERVICE_NAME_LOCAL,ServerDeploymentManager.class,service.injectedDeploymentManager);
  serviceBuilder.addDependency(Services.JBOSS_SERVICE_MODULE_LOADER,ServiceModuleLoader.class,service.injectedServiceModuleLoader);
  serviceBuilder.addDependency(SocketBinding.JBOSS_BINDING_NAME.append("osgi-http"),SocketBinding.class,service.osgiHttpServerPortBinding);
  serviceBuilder.addDependency(MBeanServerService.SERVICE_NAME,MBeanServer.class,service.injectedMBeanServer);
  serviceBuilder.setInitialMode(Mode.ON_DEMAND);
  serviceBuilder.install();
}
