{
  super.setupServices(target);
  deploymentChain.removeProcessor(deploymentModuleLoaderProcessor,Phase.MODULARIZE_DEPLOYMENT_MODULE_LOADER);
  deploymentModuleLoaderProcessor=new DeploymentModuleLoaderProcessor(new DeploymentModuleLoaderImpl(mainModuleLoader));
  deploymentChain.addProcessor(deploymentModuleLoaderProcessor,Phase.MODULARIZE_DEPLOYMENT_MODULE_LOADER);
  javaContext=new MockContext();
  target.addService(ContextNames.JAVA_CONTEXT_SERVICE_NAME,new PassthroughService<Context>(javaContext)).install();
  final Context globalContext=javaContext.createSubcontext("global");
  target.addService(ContextNames.GLOBAL_CONTEXT_SERVICE_NAME,new PassthroughService<Context>(globalContext)).install();
  globalContext.bind("someNumber",Integer.valueOf(99));
  target.addService(DeploymentChain.SERVICE_NAME,new DeploymentChainService(deploymentChain)).install();
}
