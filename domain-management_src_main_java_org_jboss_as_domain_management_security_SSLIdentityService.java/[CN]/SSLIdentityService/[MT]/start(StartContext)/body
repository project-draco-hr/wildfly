{
  try {
    KeyManager[] keyManagers=null;
    KeyStore theKeyStore=keystore.getOptionalValue();
    if (theKeyStore != null) {
      KeyManagerFactory keyManagerFactory=KeyManagerFactory.getInstance(KeyManagerFactory.getDefaultAlgorithm());
      keyManagerFactory.init(theKeyStore,keyPassword == null ? keystorePassword : keyPassword);
      keyManagers=keyManagerFactory.getKeyManagers();
    }
    TrustManager[] trustManagers=null;
    KeyStore theTrustStore=truststore.getOptionalValue();
    if (theTrustStore != null) {
      TrustManagerFactory trustManagerFactory=TrustManagerFactory.getInstance(KeyManagerFactory.getDefaultAlgorithm());
      trustManagerFactory.init(theTrustStore);
      trustManagers=trustManagerFactory.getTrustManagers();
    }
    SSLContext sslContext=SSLContext.getInstance(protocol);
    sslContext.init(keyManagers,trustManagers,null);
    this.fullContext=sslContext;
    if (keyManagers != null) {
      sslContext=SSLContext.getInstance(protocol);
      sslContext.init(null,trustManagers,null);
    }
    trustOnlyContext=sslContext;
  }
 catch (  NoSuchAlgorithmException nsae) {
    throw MESSAGES.unableToStart(nsae);
  }
catch (  KeyManagementException kme) {
    throw MESSAGES.unableToStart(kme);
  }
catch (  KeyStoreException kse) {
    throw MESSAGES.unableToStart(kse);
  }
catch (  UnrecoverableKeyException e) {
    throw MESSAGES.unableToStart(e);
  }
}
