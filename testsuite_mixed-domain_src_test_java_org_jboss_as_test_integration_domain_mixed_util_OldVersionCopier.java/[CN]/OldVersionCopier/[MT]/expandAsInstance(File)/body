{
  ZipFile zipFile=null;
  try {
    zipFile=new ZipFile(file);
    for (Enumeration<? extends ZipEntry> en=zipFile.entries(); en.hasMoreElements(); ) {
      final ZipEntry entry=en.nextElement();
      final File output=new File(targetOldVersions,entry.getName());
      if (entry.isDirectory()) {
        if (!output.exists()) {
          if (!output.mkdirs() && !output.exists()) {
            throw new RuntimeException("Could not make dir " + output.getAbsolutePath());
          }
        }
      }
 else {
        final InputStream in=new BufferedInputStream(zipFile.getInputStream(entry));
        try {
          final OutputStream out=new BufferedOutputStream(new FileOutputStream(output));
          try {
            int i=in.read();
            while (i != -1) {
              out.write((byte)i);
              i=in.read();
            }
          }
  finally {
            IoUtils.safeClose(out);
          }
        }
  finally {
          IoUtils.safeClose(in);
        }
      }
    }
  }
  finally {
    IoUtils.safeClose(zipFile);
  }
}
