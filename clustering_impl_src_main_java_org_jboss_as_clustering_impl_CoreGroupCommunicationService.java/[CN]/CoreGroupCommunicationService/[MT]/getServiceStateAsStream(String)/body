{
  RunnableFuture<StreamStateTransferResult> future=null;
  StateTransferTask<?,?> task=stateTransferTasks.get(serviceName);
  if (task == null || (task.result != null && !task.result.stateReceived())) {
    StreamStateTransferTask newTask=new StreamStateTransferTask(serviceName);
    stateTransferTasks.put(serviceName,newTask);
    future=new FutureTask<StreamStateTransferResult>(newTask);
  }
 else   if (task instanceof StreamStateTransferTask) {
    ClusteringImplLogger.ROOT_LOGGER.receivedConcurrentStateRequests(serviceName);
    future=new FutureTask<StreamStateTransferResult>((StreamStateTransferTask)task);
  }
 else {
    throw MESSAGES.stateTransferAlreadyPending(serviceName,"deserialized object");
  }
  Executor e=getThreadPool();
  if (e == null) {
    e=Executors.newSingleThreadExecutor();
  }
  e.execute(future);
  return future;
}
