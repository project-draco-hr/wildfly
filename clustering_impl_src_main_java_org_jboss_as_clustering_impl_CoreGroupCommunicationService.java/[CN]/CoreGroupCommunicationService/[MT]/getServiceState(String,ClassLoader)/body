{
  RunnableFuture<SerializableStateTransferResult> future=null;
  StateTransferTask<?,?> task=stateTransferTasks.get(serviceName);
  if (task == null || (task.result != null && !task.result.stateReceived())) {
    SerializableStateTransferTask newTask=new SerializableStateTransferTask(serviceName,classloader);
    stateTransferTasks.put(serviceName,newTask);
    future=new FutureTask<SerializableStateTransferResult>(newTask);
  }
 else   if (task instanceof SerializableStateTransferTask) {
    ClusteringImplLogger.ROOT_LOGGER.receivedConcurrentStateRequests(serviceName);
    future=new FutureTask<SerializableStateTransferResult>((SerializableStateTransferTask)task);
  }
 else {
    throw MESSAGES.stateTransferAlreadyPending(serviceName,"input stream");
  }
  Executor e=getThreadPool();
  if (e == null) {
    e=Executors.newSingleThreadExecutor();
  }
  e.execute(future);
  return future;
}
