{
  final LayersConfig layersConfig=LayersConfig.getLayersConfig(root);
  final File layersDir=new File(root,layersConfig.getLayersPath());
  if (!layersDir.exists()) {
    if (layersConfig.isConfigured()) {
      throw PatchMessages.MESSAGES.installationNoLayersConfigFound(layersDir.getAbsolutePath());
    }
  }
 else {
    for (    final String layer : layersConfig.getLayers()) {
      File layerDir=new File(layersDir,layer);
      if (!layerDir.exists()) {
        if (layersConfig.isConfigured()) {
          throw PatchMessages.MESSAGES.installationMissingLayer(layer,layersDir.getAbsolutePath());
        }
        return;
      }
      layers.addLayer(layer,layerDir,setter);
    }
  }
  final File addOnsDir=new File(root,layersConfig.getAddOnsPath());
  final File[] addOnsList=addOnsDir.listFiles();
  if (addOnsList != null) {
    for (    final File addOn : addOnsList) {
      layers.addAddOn(addOn.getName(),addOn,setter);
    }
  }
}
