{
  DomainXml domainXml=new DomainXml(Module.getBootModuleLoader(),executorService,extensionRegistry);
  File file=new File(configDir,CACHED_DOMAIN_XML);
  CachedRemoteDomainXmlPersister persister=new CachedRemoteDomainXmlPersister(file,new QName(Namespace.CURRENT.getUriString(),"domain"),domainXml,domainXml);
  for (  Namespace namespace : Namespace.domainValues()) {
    if (!namespace.equals(Namespace.CURRENT)) {
      persister.registerAdditionalRootElement(new QName(namespace.getUriString(),"domain"),domainXml);
    }
  }
  extensionRegistry.setWriterRegistry(persister);
  return persister;
}
