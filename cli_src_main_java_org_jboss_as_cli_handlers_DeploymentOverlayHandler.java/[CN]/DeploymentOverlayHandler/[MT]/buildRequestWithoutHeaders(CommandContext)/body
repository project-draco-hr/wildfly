{
  final ParsedCommandLine args=ctx.getParsedCommandLine();
  final String action=this.action.getValue(args,true);
  try {
    if (REMOVE.equals(action)) {
      return remove(ctx);
    }
 else     if (LINK.equals(action)) {
      return link(ctx);
    }
 else     if (REDEPLOY_AFFECTED.equals(action)) {
      return redeployAffected(ctx);
    }
 else     if (ADD.equals(action)) {
      return add(ctx,false);
    }
 else     if (UPLOAD.equals(action)) {
      return upload(ctx,false);
    }
 else {
      throw new CommandFormatException("Doesn't know how to build request for action '" + action + "'");
    }
  }
 catch (  CommandFormatException e) {
    throw e;
  }
catch (  CommandLineException e) {
    throw new CommandFormatException("Failed to build " + action + " request.",e);
  }
}
