{
  for (  String link : links) {
    final ModelNode op=new ModelNode();
    final ModelNode address=op.get(Util.ADDRESS);
    if (serverGroup != null) {
      address.add(Util.SERVER_GROUP,serverGroup);
    }
    address.add(Util.DEPLOYMENT_OVERLAY,overlay);
    address.add(Util.DEPLOYMENT,link);
    op.get(Util.OPERATION).set(Util.ADD);
    if (regexp) {
      op.get(Util.REGULAR_EXPRESSION).set(true);
      steps.add(op);
      if (redeployAffected.isPresent(ctx.getParsedCommandLine())) {
        final List<String> matchingDeployments=Util.getMatchingDeployments(ctx.getModelControllerClient(),link,serverGroup);
        if (!matchingDeployments.isEmpty()) {
          if (serverGroup == null) {
            for (            String deployment : matchingDeployments) {
              final ModelNode step=new ModelNode();
              final ModelNode addr=step.get(Util.ADDRESS);
              addr.add(Util.DEPLOYMENT,deployment);
              step.get(Util.OPERATION).set(Util.REDEPLOY);
              steps.add(step);
            }
          }
 else {
            for (            String deployment : matchingDeployments) {
              final ModelNode step=new ModelNode();
              final ModelNode addr=step.get(Util.ADDRESS);
              addr.add(Util.SERVER_GROUP,serverGroup);
              addr.add(Util.DEPLOYMENT,deployment);
              step.get(Util.OPERATION).set(Util.REDEPLOY);
              steps.add(step);
            }
          }
        }
      }
    }
 else     if (redeployAffected.isPresent(ctx.getParsedCommandLine())) {
      steps.add(op);
      if (serverGroup == null) {
        if (Util.isValidPath(ctx.getModelControllerClient(),Util.DEPLOYMENT,link)) {
          final ModelNode step=new ModelNode();
          final ModelNode addr=step.get(Util.ADDRESS);
          addr.add(Util.DEPLOYMENT,link);
          step.get(Util.OPERATION).set(Util.REDEPLOY);
          steps.add(step);
        }
      }
 else {
        if (Util.isValidPath(ctx.getModelControllerClient(),Util.SERVER_GROUP,serverGroup,Util.DEPLOYMENT,link)) {
          final ModelNode step=new ModelNode();
          final ModelNode addr=step.get(Util.ADDRESS);
          addr.add(Util.SERVER_GROUP,serverGroup);
          addr.add(Util.DEPLOYMENT,link);
          step.get(Util.OPERATION).set(Util.REDEPLOY);
          steps.add(step);
        }
      }
    }
 else {
      steps.add(op);
    }
  }
}
