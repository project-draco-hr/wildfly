{
  boolean clustered=cache.getCacheConfiguration().clustering().cacheMode().isClustered();
  return clustered ? new LifecycleKeyAffinityService<>(this.executor,cache,generator,this.bufferSize,Collections.singleton(cache.getCacheManager().getAddress())) : new SimpleKeyAffinityService<>(generator);
}
