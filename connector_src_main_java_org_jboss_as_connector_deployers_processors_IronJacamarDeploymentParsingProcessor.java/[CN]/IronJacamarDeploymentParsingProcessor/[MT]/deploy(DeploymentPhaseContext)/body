{
  final ResourceRoot resourceRoot=phaseContext.getDeploymentUnit().getAttachment(Attachments.DEPLOYMENT_ROOT);
  final VirtualFile deploymentRoot=resourceRoot.getRoot();
  if (deploymentRoot == null || !deploymentRoot.exists())   return;
  final String deploymentRootName=deploymentRoot.getLowerCaseName();
  VirtualFile serviceXmlFile=null;
  if (deploymentRootName.endsWith(".rar")) {
    serviceXmlFile=deploymentRoot.getChild("/META-INF/ironjacamar.xml");
  }
  if (serviceXmlFile == null || !serviceXmlFile.exists())   return;
  InputStream xmlStream=null;
  IronJacamar result=null;
  try {
    xmlStream=serviceXmlFile.openStream();
    result=(new IronJacamarParser()).parse(xmlStream);
    if (result != null) {
      IronJacamarXmlDescriptor xmlDescriptor=new IronJacamarXmlDescriptor(result);
      phaseContext.getDeploymentUnit().putAttachment(IronJacamarXmlDescriptor.ATTACHMENT_KEY,xmlDescriptor);
    }
 else     throw new DeploymentUnitProcessingException("Failed to parse service xml [" + serviceXmlFile + "]");
  }
 catch (  Exception e) {
    throw new DeploymentUnitProcessingException("Failed to parse service xml [" + serviceXmlFile + "]",e);
  }
 finally {
    VFSUtils.safeClose(xmlStream);
  }
}
