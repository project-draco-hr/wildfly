{
  if (node == null || !node.isDefined() || node.asString().isEmpty()) {
    return null;
  }
  if (!expressions || valueAccessor == UndefinedValueAccessor.INSTANCE) {
    if (!expressions && node.getType() == ModelType.EXPRESSION) {
      if (!VAULT_PATTERN.matcher(node.asString()).matches()) {
        return valueAccessor.fromModelNode(node.resolve());
      }
    }
    return valueAccessor.fromModelNode(node);
  }
 else {
    return node.asString();
  }
}
