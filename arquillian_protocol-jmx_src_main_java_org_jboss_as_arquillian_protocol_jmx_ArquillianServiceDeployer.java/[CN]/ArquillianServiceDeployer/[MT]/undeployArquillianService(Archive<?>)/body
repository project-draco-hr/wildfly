{
  try {
    final ModelNode operation=new ModelNode();
    operation.get(OP).set(COMPOSITE);
    operation.get(ADDRESS).setEmptyList();
    ModelNode steps=operation.get(STEPS);
    ModelNode undeployNode=new ModelNode();
    undeployNode.get(OP).set(UNDEPLOY);
    undeployNode.get(ADDRESS).set(DEPLOYMENT,archive.getName());
    steps.add(undeployNode);
    ModelNode removeNode=new ModelNode();
    removeNode.get(OP).set(REMOVE);
    removeNode.get(ADDRESS).set(DEPLOYMENT,archive.getName());
    steps.add(removeNode);
    log.infof("Undeploying arquillian service  with: %s",operation);
    ModelNode result=getModelControllerClient().execute(OperationBuilder.Factory.create(operation).build());
    if (FAILED.equals(result.get(OUTCOME).asString()))     throw new IllegalStateException("Management request failed: " + result);
  }
 catch (  RuntimeException rte) {
    throw rte;
  }
catch (  Exception ex) {
    throw new IllegalStateException("Cannot undeploy arquillian service",ex);
  }
}
