{
  if (serviceArchiveDeployed.contains(container.getName())) {
    archiveHolder.deploymentExistsAndRemove(event.getDeployment().getName());
    return;
  }
  if (archiveHolder.deploymentExistsAndRemove(event.getDeployment().getName())) {
    JavaArchive serviceArchive=(JavaArchive)archiveHolder.getArchive();
    try {
      log.infof("Deploy arquillian service: %s",serviceArchive);
      final Map<String,String> props=container.getContainerConfiguration().getContainerProperties();
      final ByteArrayOutputStream bytes=new ByteArrayOutputStream();
      ObjectOutputStream out=new ObjectOutputStream(bytes);
      out.writeObject(props.get("managementPort"));
      out.writeObject(NetworkUtils.formatPossibleIpv6Address(props.get("managementAddress")));
      out.writeObject(NetworkUtils.formatPossibleIpv6Address(props.get("managementProtocol")));
      out.close();
      serviceArchive.addAsManifestResource(new ByteArrayAsset(bytes.toByteArray()),"org.jboss.as.managementConnectionProps");
      DeployableContainer<?> deployableContainer=container.getDeployableContainer();
      deployableContainer.deploy(serviceArchive);
      serviceArchiveDeployed.add(container.getName());
    }
 catch (    Throwable th) {
      log.error("Cannot deploy arquillian service",th);
    }
  }
}
