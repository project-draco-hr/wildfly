{
  JavaArchive apiArchive=getAPIModuleArchive();
  assertNull("Bundle null",executeDeploy(apiArchive));
  ModuleIdentifier apiId=ModuleIdentifier.create("test." + support.getDeploymentName(apiArchive));
  assertNotNull("Module not null",loadModule(apiId));
  Bundle apiBundle=getBundleManager().installBundle(apiId);
  assertBundleState(Bundle.INSTALLED,apiBundle.getState());
  JavaArchive targetArchive=getTargetBundleArchive();
  Bundle targetBundle=executeDeploy(targetArchive);
  assertBundleState(Bundle.INSTALLED,targetBundle.getState());
  targetBundle.start();
  assertBundleState(Bundle.ACTIVE,targetBundle.getState());
  String result=invokeTargetService(targetBundle,"hello world");
  assertEquals("hello world",result);
  targetBundle.uninstall();
  assertBundleState(Bundle.UNINSTALLED,targetBundle.getState());
  apiBundle.uninstall();
  assertBundleState(Bundle.UNINSTALLED,apiBundle.getState());
}
