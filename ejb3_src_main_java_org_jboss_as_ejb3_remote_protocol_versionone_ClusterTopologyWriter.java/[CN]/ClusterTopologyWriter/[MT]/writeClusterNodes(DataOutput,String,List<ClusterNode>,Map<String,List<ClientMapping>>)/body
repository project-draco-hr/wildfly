{
  final int memberCount=clusterNodes.size();
  PackedInteger.writePackedInteger(output,memberCount);
  for (  final ClusterNode clusterMember : clusterNodes) {
    final String nodeName=clusterMember.getName();
    output.writeUTF(nodeName);
    final List<ClientMapping> clientMappingsForNode=clientMappings.get(nodeName);
    if (clientMappingsForNode == null || clientMappingsForNode.isEmpty()) {
      throw new IllegalStateException("No client-mapping entries found for node " + nodeName + " in cluster "+ clusterName);
    }
    PackedInteger.writePackedInteger(output,clientMappingsForNode.size());
    for (    final ClientMapping clientMapping : clientMappingsForNode) {
      final byte[] clientNetworkAddress=clientMapping.getSourceNetworkAddress().getAddress();
      output.write(clientNetworkAddress);
      output.writeByte(clientMapping.getSourceNetworkMaskBits());
      output.writeUTF(clientMapping.getDestinationAddress());
      output.writeShort(clientMapping.getDestinationPort());
    }
  }
}
