{
  ServiceRegistry registry=context.getServiceRegistry(true);
  ServiceController<?> hqService=registry.getService(MessagingServices.JBOSS_MESSAGING);
  if (hqService != null) {
    if (hqService.getState() != ServiceController.State.UP) {
      throw new IllegalStateException(String.format("Service %s is not in state %s, it is in state %s",MessagingServices.JBOSS_MESSAGING,ServiceController.State.UP,hqService.getState()));
    }
    final String name=PathAddress.pathAddress(operation.require(ModelDescriptionConstants.OP_ADDR)).getLastElement().getValue();
    DivertConfiguration divertConfiguration=createDivertConfiguration(name,model);
    HornetQServerControl serverControl=HornetQServer.class.cast(hqService.getValue()).getHornetQServerControl();
    try {
      serverControl.createDivert(name,divertConfiguration.getRoutingName(),divertConfiguration.getAddress(),divertConfiguration.getForwardingAddress(),divertConfiguration.isExclusive(),divertConfiguration.getFilterString(),divertConfiguration.getTransformerClassName());
    }
 catch (    RuntimeException e) {
      throw e;
    }
catch (    Exception e) {
      throw new RuntimeException(e);
    }
  }
}
