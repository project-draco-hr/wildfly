{
  File file=getFile(key);
  if (!file.exists())   return null;
  log.tracef("Loading state from %s",file);
  try {
    FileInputStream inputStream=null;
    try {
      inputStream=FISAction.open(file);
      SimpleDataInput input=new SimpleDataInput(Marshalling.createByteInput(inputStream));
      int version=input.readInt();
      MarshallingConfiguration config=this.passivationManager.getMarshallingConfiguration(version);
      Unmarshaller unmarshaller=this.marshallerFactory.createUnmarshaller(config);
      unmarshaller.start(input);
      try {
        V value=(V)unmarshaller.readObject();
        unmarshaller.finish();
        counter.decrementAndGet();
        return value;
      }
  finally {
        unmarshaller.close();
      }
    }
  finally {
      safeClose(inputStream);
      DeleteFileAction.delete(file);
    }
  }
 catch (  Exception e) {
    throw EjbMessages.MESSAGES.activationFailed(e,key);
  }
}
