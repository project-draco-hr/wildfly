{
  boolean success=true;
  final File[] files=dir.listFiles(filter);
  if (files != null) {
    for (int i=0; i < files.length; i++) {
      File f=files[i];
      if (f.isDirectory()) {
        if (!deleteDir(f,filter)) {
          success=false;
          if (log.isDebugEnabled()) {
            log.debug("Failed to delete dir: " + f.getAbsolutePath());
          }
        }
      }
 else       if (!f.delete()) {
        success=false;
        if (log.isDebugEnabled()) {
          log.debug("Failed to delete file: " + f.getAbsolutePath());
        }
      }
    }
  }
  if (!dir.delete()) {
    success=false;
    if (log.isDebugEnabled()) {
      log.debug("Failed to delete dir: " + dir.getAbsolutePath());
    }
  }
  return success;
}
