{
  boolean success=true;
  final File[] files=dir.listFiles(filter);
  if (files != null) {
    for (int i=0; i < files.length; i++) {
      File f=files[i];
      if (f.isDirectory()) {
        if (!deleteDir(f,filter)) {
          success=false;
          log.debugf("Failed to delete dir: %s",f.getAbsolutePath());
        }
      }
 else       if (!f.delete()) {
        success=false;
        log.debugf("Failed to delete file: %s",f.getAbsolutePath());
      }
    }
  }
  if (!dir.delete()) {
    success=false;
    log.debugf("Failed to delete dir: %s",dir.getAbsolutePath());
  }
  return success;
}
