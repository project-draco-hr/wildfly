{
  activeHistory.add(patch.getHistoryDir().getDirectory().getName());
  PatchElementArtifact.State patchElements=patch.getHistoryDir().getPatchXml().getPatchElements();
  patchElements.resetIndex();
  while (patchElements.hasNext()) {
    final File bundlesDir=patchElements.getState().getLayer().getBundlesDir();
    if (bundlesDir != null) {
      activeOverlays.add(bundlesDir);
    }
    final File modulesDir=patchElements.getState().getLayer().getModulesDir();
    if (modulesDir != null) {
      activeOverlays.add(modulesDir);
    }
    patchElements.next();
  }
}
