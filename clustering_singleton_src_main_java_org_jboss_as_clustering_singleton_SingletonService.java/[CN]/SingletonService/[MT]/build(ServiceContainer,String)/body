{
  ServiceName registryName=ServiceProviderRegistryService.getServiceName(container);
synchronized (target) {
    if (target.getService(registryName) == null) {
      new ServiceProviderRegistryService().build(target,container).setInitialMode(ServiceController.Mode.ON_DEMAND).install();
    }
  }
  target.addService(this.serviceName,this.service).setInitialMode(ServiceController.Mode.NEVER).install();
  target.addService(this.singletonServiceName.append("singleton"),new ValueService<Singleton>(new ImmediateValue<Singleton>(this))).addDependency(this.singletonServiceName).setInitialMode(ServiceController.Mode.PASSIVE).install();
  return AsynchronousService.addService(target,this.singletonServiceName,this).addDependency(ServiceProviderRegistryService.getServiceName(container),ServiceProviderRegistry.class,this.registryRef).addDependency(ServiceName.JBOSS.append(DEFAULT_CONTAINER,container),GroupRpcDispatcher.class,this.dispatcherRef);
}
