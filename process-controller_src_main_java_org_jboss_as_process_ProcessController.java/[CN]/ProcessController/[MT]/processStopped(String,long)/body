{
synchronized (lock) {
    for (    Connection connection : managedConnections) {
      try {
        final OutputStream os=connection.writeMessage();
        try {
          os.write(Protocol.PROCESS_STOPPED);
          StreamUtils.writeUTFZBytes(os,processName);
          StreamUtils.writeLong(os,uptime);
          os.close();
        }
  finally {
          StreamUtils.safeClose(os);
        }
      }
 catch (      IOException e) {
        ProcessLogger.ROOT_LOGGER.failedToWriteMessage("PROCESS_STOPPED",e);
        removeManagedConnection(connection);
      }
    }
  }
}
