{
synchronized (lock) {
    for (    String s : command) {
      if (s == null) {
        throw MESSAGES.nullCommandComponent();
      }
    }
    if (shutdown) {
      return;
    }
    final Map<String,ManagedProcess> processes=this.processes;
    if (processes.containsKey(processName)) {
      ROOT_LOGGER.duplicateProcessName(processName);
      return;
    }
    final byte[] authKey=new byte[16];
    rng.nextBytes(authKey);
    final ManagedProcess process=new ManagedProcess(processName,command,env,workingDirectory,lock,this,authKey,isInitial);
    processes.put(processName,process);
    processesByKey.put(new Key(authKey),process);
    for (    Connection connection : managedConnections) {
      try {
        final OutputStream os=connection.writeMessage();
        try {
          os.write(Protocol.PROCESS_ADDED);
          StreamUtils.writeUTFZBytes(os,processName);
          os.close();
        }
  finally {
          StreamUtils.safeClose(os);
        }
      }
 catch (      IOException e) {
        ROOT_LOGGER.failedToWriteMessage("PROCESS_ADDED",e);
      }
    }
  }
}
