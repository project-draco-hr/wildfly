{
  defaultFrameworkModule=moduleLoader.loadModule(ModuleIdentifier.create("org.jboss.osgi.framework"));
  String modulesProps=(String)props.get(Configuration.PROP_JBOSS_OSGI_SYSTEM_MODULES);
  if (modulesProps == null) {
    frameworkIdentifier=defaultFrameworkModule.getIdentifier();
    moduleSpec=null;
    return;
  }
  frameworkIdentifier=ModuleIdentifier.create("org.jboss.osgi.framework.extended");
  ModuleSpec.Builder builder=ModuleSpec.build(frameworkIdentifier);
  PathFilter all=PathFilters.acceptAll();
  ModuleIdentifier moduleId=defaultFrameworkModule.getIdentifier();
  DependencySpec moduleDep=DependencySpec.createModuleDependencySpec(all,all,moduleLoader,moduleId,false);
  builder.addDependency(moduleDep);
  for (  String moduleProp : modulesProps.split(",")) {
    moduleId=ModuleIdentifier.create(moduleProp.trim());
    moduleDep=DependencySpec.createModuleDependencySpec(all,all,moduleLoader,moduleId,false);
    builder.addDependency(moduleDep);
  }
  moduleSpec=builder.create();
}
