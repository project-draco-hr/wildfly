{
  List<ModuleIdentifier> moduleIds=new ArrayList<ModuleIdentifier>();
  moduleIds.add(ModuleIdentifier.create("org.jboss.logging"));
  moduleIds.add(ModuleIdentifier.create("org.jboss.osgi.deployment"));
  moduleIds.add(ModuleIdentifier.create("org.jboss.osgi.spi"));
  moduleIds.add(ModuleIdentifier.create("org.osgi.core"));
  moduleIds.add(ModuleIdentifier.create("org.osgi.util.tracker"));
  String modulesProps=(String)bundleManager.getProperty(Configuration.PROP_JBOSS_OSGI_SYSTEM_MODULES);
  if (modulesProps != null) {
    for (    String moduleProp : modulesProps.split(",")) {
      ModuleIdentifier moduleId=ModuleIdentifier.create(moduleProp.trim());
      moduleIds.add(moduleId);
    }
  }
  PathFilter all=PathFilters.acceptAll();
  ModuleLoader moduleLoader=bundleManager.getDefaultModuleLoader();
  List<DependencySpec> moduleDependencies=new ArrayList<DependencySpec>();
  for (  ModuleIdentifier moduleId : moduleIds) {
    PathFilter exp=all;
    if (moduleId.getName().equals("org.osgi.util.tracker"))     exp=PathFilters.in(Collections.singleton("org/osgi/util/tracker"));
    DependencySpec moduleDep=DependencySpec.createModuleDependencySpec(all,exp,moduleLoader,moduleId,false);
    moduleDependencies.add(moduleDep);
  }
  plugin.setFrameworkDependencies(moduleDependencies);
}
