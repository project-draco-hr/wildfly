{
  log.info("Activating Transactions Subsystem");
  final BatchBuilder builder=context.getBatchBuilder();
  final XATerminatorService xaTerminatorService=new XATerminatorService();
  builder.addService(TxnServices.JBOSS_TXN_XA_TERMINATOR,xaTerminatorService);
  final TransactionManagerService transactionManagerService=new TransactionManagerService(coreEnvironmentElement.getNodeIdentifier(),coreEnvironmentElement.getMaxPorts(),coordinatorEnvironmentElement.isEnableStatistics(),coordinatorEnvironmentElement.getDefaultTimeout(),objectStoreEnvironmentElement.getDirectory());
  final BatchServiceBuilder<TransactionManager> transactionManagerServiceBuilder=builder.addService(TxnServices.JBOSS_TXN_TRANSACTION_MANAGER,transactionManagerService);
  transactionManagerServiceBuilder.addOptionalDependency(ServiceName.JBOSS.append("iiop","orb"),ORB.class,transactionManagerService.getOrbInjector());
  transactionManagerServiceBuilder.addDependency(TxnServices.JBOSS_TXN_XA_TERMINATOR,JBossXATerminator.class,transactionManagerService.getXaTerminatorInjector());
  transactionManagerServiceBuilder.addDependency(SocketBinding.JBOSS_BINDING_NAME.append(recoveryEnvironmentElement.getBindingRef()),SocketBinding.class,transactionManagerService.getRecoveryBindingInjector());
  transactionManagerServiceBuilder.addDependency(SocketBinding.JBOSS_BINDING_NAME.append(recoveryEnvironmentElement.getStatusBindingRef()),SocketBinding.class,transactionManagerService.getStatusBindingInjector());
  transactionManagerServiceBuilder.addDependency(SocketBinding.JBOSS_BINDING_NAME.append(coreEnvironmentElement.getBindingRef()),SocketBinding.class,transactionManagerService.getSocketProcessBindingInjector());
  transactionManagerServiceBuilder.setInitialMode(ServiceController.Mode.IMMEDIATE);
}
