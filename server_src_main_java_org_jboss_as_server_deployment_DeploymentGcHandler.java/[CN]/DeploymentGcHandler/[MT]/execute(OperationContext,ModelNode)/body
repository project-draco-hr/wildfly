{
  final List<byte[]> hashes=new ArrayList<byte[]>();
  for (  Resource resource : context.getRootResource().getChildren(DEPLOYMENT)) {
    final ModelNode model=resource.getModel();
    if (model.hasDefined(CONTENT)) {
      for (      ModelNode contentElement : model.get(CONTENT).asList()) {
        if (contentElement.hasDefined(HASH)) {
          final byte[] hash=contentElement.get(HASH).asBytes();
          hashes.add(hash);
        }
      }
    }
  }
  context.addStep(new OperationStepHandler(){
    @Override public void execute(    OperationContext context,    ModelNode operation) throws OperationFailedException {
      contentRepository.purgeContent(hashes);
      context.completeStep();
    }
  }
,Stage.RUNTIME);
  context.completeStep();
}
