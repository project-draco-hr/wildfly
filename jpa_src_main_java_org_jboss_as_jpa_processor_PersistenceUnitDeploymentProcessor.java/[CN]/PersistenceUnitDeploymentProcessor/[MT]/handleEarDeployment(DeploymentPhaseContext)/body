{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (isEarDeployment(deploymentUnit) && JPADeploymentMarker.isJPADeployment(deploymentUnit)) {
    final ResourceRoot deploymentRoot=deploymentUnit.getAttachment(Attachments.DEPLOYMENT_ROOT);
    PersistenceUnitMetadataHolder holder;
    ArrayList<PersistenceUnitMetadataHolder> puList=new ArrayList<PersistenceUnitMetadataHolder>(1);
    if (deploymentRoot != null && (holder=deploymentRoot.getAttachment(PersistenceUnitMetadataHolder.PERSISTENCE_UNITS)) != null && holder.getPersistenceUnits().size() > 0) {
      puList.add(holder);
    }
    log.trace("install persistence unit definitions for ear " + deploymentRoot.getRootName());
    addPuService(phaseContext,deploymentRoot,puList);
  }
}
