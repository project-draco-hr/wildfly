{
  deployer.undeploy(DEPLOYMENT_2);
  controller.stop(CONTAINER_2);
  DefaultHttpClient client=HttpClientUtils.relaxedCookieHttpClient();
  String url1=baseURL1.toString() + "count";
  String url2=baseURL2.toString() + "count";
  System.out.println("URLs are: " + url1 + ", "+ url2);
  try {
    assertQueryCount(20010101,client,url1);
    assertQueryCount(20020202,client,url1);
    controller.start(CONTAINER_2);
    deployer.deploy(DEPLOYMENT_2);
    assertQueryCount(20030303,client,url1);
    assertQueryCount(20040404,client,url1);
    assertQueryCount(20050505,client,url2);
    assertQueryCount(20060606,client,url2);
    controller.stop(CONTAINER_2);
    assertQueryCount(20070707,client,url1);
    assertQueryCount(20080808,client,url1);
    controller.start(CONTAINER_2);
    assertQueryCount(20090909,client,url1);
    assertQueryCount(20101010,client,url1);
    assertQueryCount(20111111,client,url2);
    assertQueryCount(20121212,client,url2);
    controller.stop(CONTAINER_1);
    assertQueryCount(20131313,client,url2);
    assertQueryCount(20141414,client,url2);
    controller.start(CONTAINER_1);
    assertQueryCount(20151515,client,url1);
    assertQueryCount(20161616,client,url1);
    assertQueryCount(20171717,client,url1);
    assertQueryCount(20181818,client,url1);
  }
  finally {
    client.getConnectionManager().shutdown();
    this.cleanup(DEPLOYMENT_1,CONTAINER_1);
    this.cleanup(DEPLOYMENT_2,CONTAINER_2);
  }
}
