{
  if (name == null)   throw MESSAGES.expiredSession();
  if (value == null) {
    return removeAttribute(name);
  }
  if (!isValidInternal()) {
    throw MESSAGES.expiredSession();
  }
  if (canAttributeBeReplicated(value) == false) {
    throw MESSAGES.failToReplicateAttribute(name,value.getClass().getCanonicalName());
  }
  HttpSessionBindingEvent event=null;
  if (value instanceof HttpSessionActivationListener)   hasActivationListener=Boolean.TRUE;
  return setAttributeInternal(name,value);
}
