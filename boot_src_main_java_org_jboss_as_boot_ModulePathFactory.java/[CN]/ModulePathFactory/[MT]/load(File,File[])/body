{
  final DirectoryStructure structure=DirectoryStructure.createDefault(jbossHome);
  if (structure.getCumulativeLink().exists()) {
    final String ref=readRef(structure.getCumulativeLink());
    final List<String> patches=readRefs(structure.getCumulativeRefs(ref));
    final List<File> path=new ArrayList<File>(patches.size() + modulePath.length + 1);
    for (    final String patch : patches) {
      path.add(structure.getModulePatchDirectory(patch));
    }
    path.add(structure.getModulePatchDirectory(ref));
    for (    final File file : modulePath) {
      path.add(file);
    }
    return path.toArray(new File[path.size()]);
  }
 else {
    return modulePath;
  }
}
