{
  final DomainClient masterClient=domainMasterLifecycleUtil.getDomainClient();
  ModelNode composite=new ModelNode();
  composite.get(OP).set(CompositeOperationHandler.NAME);
  composite.get(OP_ADDR).setEmptyList();
  composite.get(OPERATION_HEADERS,ROLLBACK_ON_RUNTIME_FAILURE).set(false);
  ModelNode goodServerOp=new ModelNode();
  goodServerOp.get(OP).set(READ_RESOURCE_OPERATION);
  goodServerOp.get(OP_ADDR).set(stepAddress);
  composite.get(STEPS).add(goodServerOp);
  composite.get(STEPS).add(getAddThreadFactoryOperation(stepAddress.clone().add("worker","default")));
  ModelNode result=masterClient.execute(composite);
  validateFailedResponse(result);
  Set<String> keys=new HashSet<String>(result.get(RESULT).keys());
  keys.remove(SERVER_GROUPS);
  Assert.assertEquals(2,keys.size());
  String errorCode=getNotAuthorizedErrorCode();
  List<Property> steps=result.get(RESULT).asPropertyList();
  int i=0;
  for (  Property property : steps) {
    if (property.getName().equals(SERVER_GROUPS)) {
      continue;
    }
    ModelNode stepResult=property.getValue();
    Assert.assertEquals(FAILED,stepResult.get(OUTCOME).asString());
    if (i == 0) {
      Assert.assertFalse(stepResult.hasDefined(FAILURE_DESCRIPTION));
    }
    if (i++ == 1) {
      ModelNode desc=validateFailedResponse(stepResult);
      Assert.assertTrue(desc.toString() + " does not contain " + errorCode,desc.toString().contains(errorCode));
    }
    i++;
  }
}
