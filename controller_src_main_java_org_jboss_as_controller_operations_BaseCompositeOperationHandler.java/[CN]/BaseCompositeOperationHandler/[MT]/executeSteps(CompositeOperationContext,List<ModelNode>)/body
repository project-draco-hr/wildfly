{
  final StepHandlerContext stepHandlerContext=new StepHandlerContext(context,steps.size());
  for (int i=0; i < steps.size(); i++) {
    final ModelNode step=steps.get(i);
    if (stepHandlerContext.hasFailures()) {
      stepHandlerContext.recordCancellation(Integer.valueOf(i));
    }
 else {
      final PathAddress address=PathAddress.pathAddress(step.require(OP_ADDR));
      final String operationName=step.require(OP).asString();
      final Integer id=Integer.valueOf(i);
      final OperationHandler stepHandler=context.getRegistry().getOperationHandler(address,operationName);
      final OperationContext stepContext=context.getStepOperationContext(id,address,stepHandler);
      final ResultHandler stepResultHandler=new StepResultHandler(id,stepHandlerContext);
      try {
        final OperationResult result=stepHandler.execute(stepContext,step,stepResultHandler);
        stepHandlerContext.setRollbackOp(id,result.getCompensatingOperation());
        final ModelNode overallModel=context.getSubModel();
        final ModelNode stepModel=stepContext.getSubModel();
        if (stepModel != null) {
synchronized (overallModel) {
            if (stepHandler instanceof ModelRemoveOperationHandler) {
              address.remove(overallModel);
            }
 else {
              address.navigate(overallModel,true).set(stepModel);
            }
          }
        }
      }
 catch (      OperationFailedException e) {
        stepResultHandler.handleFailed(e.getFailureDescription());
      }
catch (      Throwable t) {
        final String message=t.getLocalizedMessage() != null ? t.getLocalizedMessage() : t.getMessage();
        stepResultHandler.handleFailed(new ModelNode().set(message));
      }
    }
  }
  stepHandlerContext.setModelComplete();
  if (!stepHandlerContext.hasFailures() && context.overallContext.getRuntimeContext() != null) {
    final RuntimeTask runtimeTask=getRuntimeTasks(context);
    if (runtimeTask != null) {
      context.overallContext.getRuntimeContext().setRuntimeTask(runtimeTask);
    }
  }
}
