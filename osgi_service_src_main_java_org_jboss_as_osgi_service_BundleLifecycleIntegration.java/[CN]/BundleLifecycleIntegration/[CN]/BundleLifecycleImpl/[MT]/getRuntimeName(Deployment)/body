{
  String runtimeName=dep.getAttachment(RUNTIME_NAME_KEY,String.class);
  if (runtimeName == null) {
    runtimeName=dep.getLocation();
    try {
      new URI(runtimeName);
      int queryIndex=runtimeName.indexOf('?');
      if (queryIndex > 0) {
        runtimeName=runtimeName.substring(0,queryIndex);
      }
    }
 catch (    URISyntaxException ex) {
    }
    if (dep.isBundleUpdate()) {
      String suffix="";
      Bundle bundle=dep.getAttachment(Bundle.class);
      BundleRevisions brevs=bundle.adapt(BundleRevisions.class);
      int revid=brevs.getRevisions().size();
      int dotindex=runtimeName.length() - 4;
      if (dotindex > 0 && runtimeName.charAt(dotindex) == '.') {
        suffix=runtimeName.substring(runtimeName.length() - 4);
        runtimeName=runtimeName.substring(0,dotindex);
      }
      runtimeName+="-rev" + revid + suffix;
    }
    dep.addAttachment(RUNTIME_NAME_KEY,runtimeName,String.class);
  }
  return runtimeName;
}
