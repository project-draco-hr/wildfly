{
  String runtimeName=deployment.getAttachment(RUNTIME_NAME_KEY);
  if (runtimeName == null) {
    runtimeName=deployment.getLocation();
    try {
      new URI(runtimeName);
      int queryIndex=runtimeName.indexOf('?');
      if (queryIndex > 0) {
        runtimeName=runtimeName.substring(0,queryIndex);
      }
    }
 catch (    URISyntaxException ex) {
    }
    if (deployment.isBundleUpdate()) {
      String suffix="";
      XBundle bundle=deployment.getAttachment(IntegrationConstants.BUNDLE_KEY);
      BundleRevisions brevs=bundle.adapt(BundleRevisions.class);
      int revid=brevs.getRevisions().size();
      int dotindex=runtimeName.length() - 4;
      if (dotindex > 0 && runtimeName.charAt(dotindex) == '.') {
        suffix=runtimeName.substring(runtimeName.length() - 4);
        runtimeName=runtimeName.substring(0,dotindex);
      }
      runtimeName+="-rev" + revid + suffix;
    }
    deployment.putAttachment(RUNTIME_NAME_KEY,runtimeName);
  }
  return runtimeName;
}
