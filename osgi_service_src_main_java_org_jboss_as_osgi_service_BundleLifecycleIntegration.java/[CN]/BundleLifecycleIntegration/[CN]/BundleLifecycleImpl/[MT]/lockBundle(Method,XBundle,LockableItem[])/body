{
  if (method == Method.START || method == Method.STOP) {
    LockContext context=bundle.getAttachment(IntegrationConstants.LOCK_CONTEXT_KEY);
    Method cachedMethod=context != null ? context.getMethod() : null;
    if (cachedMethod == Method.UPDATE || cachedMethod == Method.UNINSTALL) {
      return null;
    }
  }
  LockContext context=lockManager.lockItems(method,items);
  if (method == Method.UPDATE || method == Method.UNINSTALL) {
    bundle.addAttachment(IntegrationConstants.LOCK_CONTEXT_KEY,context);
  }
  return context;
}
