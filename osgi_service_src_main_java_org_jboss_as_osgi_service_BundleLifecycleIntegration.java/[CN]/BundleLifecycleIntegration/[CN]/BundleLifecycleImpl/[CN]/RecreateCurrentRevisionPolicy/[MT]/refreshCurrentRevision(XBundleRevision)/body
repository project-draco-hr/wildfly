{
  DeploymentProvider deploymentManager=injectedDeploymentManager.getValue();
  Deployment deployment=deploymentManager.createDeployment(bundle.getLocation(),rootFile);
  deployment.putAttachment(IntegrationConstants.BUNDLE_KEY,bundle);
  deployment.setAutoStart(false);
  String runtimeName=getRuntimeName(deployment);
  putDeployment(runtimeName,deployment);
  try {
    InputStream input=deployment.getRoot().openStream();
    try {
      ServerDeploymentHelper server=new ServerDeploymentHelper(serverDeploymentManager);
      server.deploy(runtimeName,input);
    }
  finally {
      VFSUtils.safeClose(input);
    }
  }
 catch (  RuntimeException rte) {
    throw rte;
  }
catch (  Exception ex) {
    throw MESSAGES.cannotDeployBundleRevision(ex,deployment);
  }
}
