{
  if (modelOnly && !standalone) {
    throw new IllegalStateException("model-only updates are not valid on a domain-based server");
  }
  List<UpdateResultHandlerResponse<?>> results=new ArrayList<UpdateResultHandlerResponse<?>>(updates.size());
  final CountDownLatch latch=new CountDownLatch(1);
  ServerUpdateCommitHandlerImpl handler=new ServerUpdateCommitHandlerImpl(results,latch);
  final ServerUpdateController controller=new ServerUpdateController(getServerModel(),container,executor,handler,rollbackOnFailure,modelOnly);
  for (int i=0; i < updates.size(); i++) {
    controller.addServerModelUpdate(updates.get(i),handler,Integer.valueOf(i));
  }
  controller.executeUpdates();
  try {
    latch.await();
  }
 catch (  Exception e) {
    throw new ManagementException("failed to execute updates",e);
  }
  return results;
}
