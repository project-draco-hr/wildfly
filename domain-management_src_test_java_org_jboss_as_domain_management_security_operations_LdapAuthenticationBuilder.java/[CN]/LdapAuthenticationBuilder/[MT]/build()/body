{
  assertNotBuilt();
  built=true;
  ModelNode add=new ModelNode();
  add.get(OP).set(ADD);
  add.get(ADDRESS).set(parent.getRealmAddress().add(AUTHENTICATION,LDAP));
  if (connection != null) {
    add.get(CONNECTION).set(connection);
  }
  if (baseDn != null) {
    add.get(BASE_DN).set(baseDn);
  }
  if (userDn != null) {
    add.get(USER_DN).set(userDn);
  }
  if (recursive) {
    add.get(RECURSIVE).set(true);
  }
  if (allowEmptyPasswords) {
    add.get(ALLOW_EMPTY_PASSWORDS).set(true);
  }
  if (usernameFilter != null) {
    add.get(USERNAME_ATTRIBUTE).set(usernameFilter);
  }
  if (advancedFilter != null) {
    add.get(ADVANCED_FILTER).set(advancedFilter);
  }
  parent.addStep(add);
  return parent;
}
