{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (!isEarDeployment(deploymentUnit)) {
    return;
  }
  final ResourceRoot deploymentRoot=deploymentUnit.getAttachment(Attachments.DEPLOYMENT_ROOT);
  final VirtualFile deploymentFile=deploymentRoot.getRoot();
  final VirtualFile applicationXmlFile=deploymentFile.getChild(APPLICATION_XML);
  if (!applicationXmlFile.exists()) {
    return;
  }
  InputStream inputStream=null;
  try {
    inputStream=applicationXmlFile.openStream();
    final XMLInputFactory inputFactory=XMLInputFactory.newInstance();
    inputFactory.setXMLResolver(NoopXmlResolver.create());
    XMLStreamReader xmlReader=inputFactory.createXMLStreamReader(inputStream);
    final EarMetaData earMetaData=EarConfigParser.parse(xmlReader);
    if (earMetaData != null) {
      final EarConfig earConfig=new EarConfig(earMetaData);
      deploymentUnit.putAttachment(EarConfig.ATTACHMENT_KEY,earConfig);
    }
  }
 catch (  Exception e) {
    throw new DeploymentUnitProcessingException("Failed to parse " + applicationXmlFile,e);
  }
 finally {
    VFSUtils.safeClose(inputStream);
  }
}
