{
synchronized (lock) {
    if (writeDone)     return;
    while (sender != null) {
      try {
        lock.wait();
      }
 catch (      InterruptedException e) {
        Thread.currentThread().interrupt();
        throw new InterruptedIOException();
      }
    }
    writeDone=true;
    if (readDone) {
      socket.close();
    }
 else {
      socket.shutdownOutput();
    }
    lock.notifyAll();
  }
}
