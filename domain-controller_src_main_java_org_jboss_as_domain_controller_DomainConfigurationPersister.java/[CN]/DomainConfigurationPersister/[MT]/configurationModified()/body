{
  FileOutputStream fos=null;
  BufferedOutputStream bos=null;
  OutputStreamWriter writer=null;
  try {
    backupConfigFile();
    configFile.createNewFile();
    fos=new FileOutputStream(configFile);
    bos=new BufferedOutputStream(fos);
    writer=new OutputStreamWriter(bos);
    final XMLMapper mapper=XMLMapper.Factory.create();
    mapper.deparseDocument(new RootElementWriter(),XMLOutputFactory.newInstance().createXMLStreamWriter(writer));
  }
 catch (  Exception e) {
    logger.errorf(e,"Failed persisting configuration file %s",configFile.getAbsolutePath());
  }
 finally {
    if (writer != null) {
      try {
        writer.close();
      }
 catch (      IOException e) {
        logger.warnf(e,"Failed closing writer to configuration file %s",configFile.getAbsolutePath());
      }
    }
    if (fos != null) {
      try {
        fos.close();
      }
 catch (      IOException e) {
        logger.warnf(e,"Failed closing output stream to configuration file %s",configFile.getAbsolutePath());
      }
    }
  }
}
