{
  final ServiceContainer serviceContainer=this.serviceContainer;
  final BatchBuilder batchBuilder=serviceContainer.batchBuilder();
  final DeploymentServiceListener deploymentServiceListener=new DeploymentServiceListener();
  batchBuilder.addListener(deploymentServiceListener);
  try {
    for (    VirtualFile deploymentRoot : deploymentRoots) {
      if (!deploymentRoot.exists())       throw new DeploymentException("Deployment root does not exist." + deploymentRoot);
      deploy(deploymentRoot,batchBuilder);
    }
    batchBuilder.install();
    deploymentServiceListener.waitForCompletion();
  }
 catch (  DeploymentException e) {
    throw e;
  }
catch (  Throwable t) {
    throw new DeploymentException(t);
  }
}
