{
  for (  Deployment deployment : deployments) {
    final VirtualFile deploymentRoot=deployment.deploymentRoot;
    final DeploymentChain deploymentChain=deployment.deploymentService.getDeploymentChain();
    final DeploymentModuleLoader deploymentModuleLoader=deployment.deploymentService.getModuleLoader();
    DeploymentModuleLoaderSelector.CURRENT_MODULE_LOADER.set(deploymentModuleLoader);
    final DeploymentUnitContext deploymentUnitContext=deployment.deploymentUnitContext;
    logger.debugf("Deployment processor starting with chain: %s",deploymentChain);
    try {
      deploymentChain.processDeployment(deploymentUnitContext);
    }
 catch (    DeploymentUnitProcessingException e) {
      throw new DeploymentException("Failed to process deployment chain.",e);
    }
 finally {
      DeploymentModuleLoaderSelector.CURRENT_MODULE_LOADER.set(null);
    }
  }
}
