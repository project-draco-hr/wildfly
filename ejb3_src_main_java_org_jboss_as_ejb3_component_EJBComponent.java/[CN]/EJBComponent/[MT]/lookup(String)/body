{
  if (name == null) {
    throw MESSAGES.jndiNameCannotBeNull();
  }
  final NamespaceContextSelector namespaceContextSelector=NamespaceContextSelector.getCurrentSelector();
  if (namespaceContextSelector == null) {
    throw MESSAGES.noNamespaceContextSelectorAvailable(name);
  }
  Context jndiContext=null;
  String namespaceStrippedJndiName=name;
  if (name.startsWith("java:app/")) {
    jndiContext=namespaceContextSelector.getContext("app");
    namespaceStrippedJndiName=name.substring("java:app/".length());
  }
 else   if (name.startsWith("java:module/")) {
    jndiContext=namespaceContextSelector.getContext("module");
    namespaceStrippedJndiName=name.substring("java:module/".length());
  }
 else   if (name.startsWith("java:comp/")) {
    jndiContext=namespaceContextSelector.getContext("comp");
    namespaceStrippedJndiName=name.substring("java:comp/".length());
  }
 else   if (!name.startsWith("java:")) {
    jndiContext=namespaceContextSelector.getContext("comp");
    namespaceStrippedJndiName="env/" + name;
  }
 else   if (name.startsWith("java:global/")) {
    try {
      jndiContext=new InitialContext();
    }
 catch (    NamingException ne) {
      throw MESSAGES.failToLookupJNDI(name,ne);
    }
  }
 else {
    throw MESSAGES.failToLookupJNDINameSpace(name);
  }
  ROOT_LOGGER.debug("Looking up " + namespaceStrippedJndiName + " in jndi context: "+ jndiContext);
  try {
    return jndiContext.lookup(namespaceStrippedJndiName);
  }
 catch (  NamingException ne) {
    throw MESSAGES.failToLookupStrippedJNDI(namespaceContextSelector,jndiContext,ne);
  }
}
