{
  if (isBeanManagedTransaction()) {
    throw new IllegalStateException("EJB 3.1 FR 13.6.1 Only beans with container-managed transaction demarcation " + "can use setRollbackOnly.");
  }
  try {
    TransactionManager tm=getTransactionManager();
    if (tm.getTransaction() == null) {
      throw new IllegalStateException("setRollbackOnly() not allowed without a transaction.");
    }
    tm.setRollbackOnly();
  }
 catch (  SystemException se) {
    log.warn("failed to set rollback only; ignoring",se);
  }
}
