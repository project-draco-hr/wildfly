{
  SystemExiter.initialize(new NoopExiter());
  String[] args=command.toArray(new String[command.size()]);
  ServerManagerEnvironment config=Main.determineEnvironment(args,System.getProperties(),stdin,stdout,stderr);
  if (config == null) {
    throw new RuntimeException("Could not determine SM environment");
  }
 else {
    TestServerManagerProcess manager=new TestServerManagerProcess(managed,config);
    manager.start();
    manager.waitForLatch(manager.domainModelLatch);
    return manager;
  }
}
