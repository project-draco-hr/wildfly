{
  try {
    TextMessage reply;
    if (message instanceof TextMessage) {
      String text=((TextMessage)message).getText();
      if (text.equals("await")) {
        HelperSingletonImpl.barrier.await(10,SECONDS);
        HelperSingletonImpl.barrier.reset();
        HelperSingletonImpl.barrier.await(10,SECONDS);
        HelperSingletonImpl.barrier.reset();
      }
      reply=session.createTextMessage("Reply: " + text);
    }
 else {
      reply=session.createTextMessage("Unknown message");
    }
    Destination destination=message.getJMSReplyTo();
    sender.send(destination,reply,NON_PERSISTENT,1,SECONDS.toMillis(10));
    log.info("onMessage method [OK], msg: " + message.toString());
  }
 catch (  JMSException e) {
    throw new RuntimeException(e);
  }
catch (  InterruptedException e) {
    throw new RuntimeException(e);
  }
catch (  BrokenBarrierException e) {
    throw new RuntimeException(e);
  }
catch (  TimeoutException e) {
    throw new RuntimeException(e);
  }
}
