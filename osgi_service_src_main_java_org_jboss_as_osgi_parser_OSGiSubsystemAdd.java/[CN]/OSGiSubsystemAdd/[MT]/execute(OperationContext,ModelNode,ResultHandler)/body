{
  populateSubModel(context.getSubModel(),operation);
  if (context instanceof BootOperationContext) {
    final BootOperationContext updateContext=(BootOperationContext)context;
    context.getRuntimeContext().setRuntimeTask(new RuntimeTask(){
      public void execute(      RuntimeTaskContext context) throws OperationFailedException {
        log.infof("Activating OSGi Subsystem");
        long begin=System.currentTimeMillis();
        SubsystemState subsystemState=createSubsystemState(operation);
        ServiceTarget serviceTarget=context.getServiceTarget();
        BundleStartTracker.addService(serviceTarget);
        InstallHandlerIntegration.addService(serviceTarget);
        FrameworkBootstrapService.addService(serviceTarget,subsystemState);
        ConfigAdminServiceImpl.addService(serviceTarget,subsystemState);
        new OSGiDeploymentActivator().activate(updateContext);
        resultHandler.handleResultComplete();
        long end=System.currentTimeMillis();
        log.debugf("Activated OSGi Subsystem in %dms",end - begin);
      }
    }
);
  }
 else {
    resultHandler.handleResultComplete();
  }
  final ModelNode compensatingOperation=new ModelNode();
  compensatingOperation.get(OP).set(REMOVE);
  compensatingOperation.get(OP_ADDR).set(operation.require(OP_ADDR));
  return new BasicOperationResult(compensatingOperation);
}
