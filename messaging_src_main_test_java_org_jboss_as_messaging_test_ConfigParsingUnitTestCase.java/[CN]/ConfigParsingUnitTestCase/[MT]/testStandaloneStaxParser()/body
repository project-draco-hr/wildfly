{
  try {
    final XMLMapper mapper=createXMLMapper();
    URL configURL=getClass().getResource("/standalone-with-messaging.xml");
    Assert.assertNotNull("standalone-with-messaging.xml url is not null",configURL);
    System.out.println("configURL = " + configURL);
    BufferedReader reader=new BufferedReader(new InputStreamReader(configURL.openStream()));
    List<AbstractServerModelUpdate<?>> updates=new ArrayList<AbstractServerModelUpdate<?>>();
    mapper.parseDocument(updates,XMLInputFactory.newInstance().createXMLStreamReader(reader));
    final ServerModel model=new ServerModel();
    for (    final AbstractServerModelUpdate<?> update : updates) {
      model.update(update);
    }
    MessagingSubsystemElement subsystem=(MessagingSubsystemElement)model.getProfile().getSubsystem(Namespace.MESSAGING_1_0.getUriString());
    Assert.assertNotNull(subsystem);
    Assert.assertEquals("bindings-directory","hornetq/bindings",subsystem.getBindingsDirectory().getPath());
    Assert.assertEquals("journal-type",JournalType.NIO,subsystem.getJournalType());
    Assert.assertEquals("journal-min-files",2,subsystem.getJournalMinFiles());
    Assert.assertEquals("journal-file-size",102400,subsystem.getJournalFileSize());
    Assert.assertEquals("paging-directory","hornetq/paging",subsystem.getPagingDirectory().getPath());
    Map<String,Set<Role>> securityRoleMap=new HashMap<String,Set<Role>>();
    for (    SecuritySettingsElement sec : subsystem.getSecuritySettings()) {
      securityRoleMap.put(sec.getMatch(),sec.getRoles());
    }
    Assert.assertEquals("1 security roles",1,securityRoleMap.size());
    Set<Role> securityRoles=securityRoleMap.values().iterator().next();
    Role expectedRole=new Role("guest",true,true,false,false,true,true,false);
    Set<Role> expectedRoles=new HashSet<Role>();
    expectedRoles.add(expectedRole);
    Assert.assertEquals("guest role",expectedRoles,securityRoles);
    final Map<String,AbstractTransportElement<?>> connectors=new HashMap<String,AbstractTransportElement<?>>();
    for (    AbstractTransportElement<?> connector : subsystem.getConnectors()) {
      Assert.assertNotNull(connector.getName());
      connectors.put(connector.getName(),connector);
    }
    Assert.assertEquals("3 connectors",3,connectors.size());
    Assert.assertEquals("netty",connectors.get("netty").getSocketBindingRef());
    Assert.assertEquals("netty-throughput",connectors.get("netty-throughput").getSocketBindingRef());
    Assert.assertNull(connectors.get("in-vm").getSocketBindingRef());
    final Map<String,AbstractTransportElement<?>> acceptors=new HashMap<String,AbstractTransportElement<?>>();
    for (    final AbstractTransportElement<?> acceptor : subsystem.getAcceptors()) {
      Assert.assertNotNull(acceptor.getName());
      acceptors.put(acceptor.getName(),acceptor);
    }
    Assert.assertEquals("3 acceptors",3,acceptors.size());
    Assert.assertEquals("netty",acceptors.get("netty").getSocketBindingRef());
    Assert.assertEquals("netty-throughput",acceptors.get("netty-throughput").getSocketBindingRef());
    Assert.assertNull(acceptors.get("in-vm").getSocketBindingRef());
  }
 catch (  Exception e) {
    throw new RuntimeException("standalone-with-messaging.xml",e);
  }
 finally {
  }
}
