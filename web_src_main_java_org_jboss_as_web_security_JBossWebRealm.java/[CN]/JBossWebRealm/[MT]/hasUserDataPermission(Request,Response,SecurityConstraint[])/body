{
  boolean ok=super.hasUserDataPermission(request,response,constraints);
  if (ok && useJBossAuthorization) {
    Map<String,Object> map=new HashMap<String,Object>();
    map.put("securityConstraints",constraints);
    map.put(ResourceKeys.USERDATA_PERM_CHECK,Boolean.TRUE);
    SecurityContext sc=SecurityActions.getSecurityContext();
    AbstractWebAuthorizationHelper helper=null;
    try {
      helper=SecurityHelperFactory.getWebAuthorizationHelper(sc);
    }
 catch (    Exception e) {
      log.error("Error obtaining helper",e);
    }
    Subject callerSubject=sc.getUtil().getSubject();
    if (callerSubject == null)     callerSubject=new Subject();
    ok=helper.hasUserDataPermission(map,request,response,PolicyContext.getContextID(),callerSubject,getPrincipalRoles(request));
  }
  return ok;
}
