{
  if (context.getAttachment(ModuleConfig.ATTACHMENT_KEY) != null) {
    return;
  }
  final VirtualFile deploymentRoot=getVirtualFileAttachment(context);
  final ModuleIdentifier moduleIdentifier=ModuleIdentifier.create("deployment." + deploymentRoot.getName());
  final ModuleConfig.ResourceRoot[] resourceRoots=createResourceRoots(context.getAttachment(DeploymentStructure.ATTACHMENT_KEY));
  final ModuleDependencies dependenciesAttachment=getAttachedDependencies(context);
  final ModuleConfig.Dependency[] dependencies=dependenciesAttachment != null ? dependenciesAttachment.getDependencies() : NO_DEPS;
  final ModuleConfig moduleConfig=new ModuleConfig(moduleIdentifier,dependencies,resourceRoots);
  context.putAttachment(ModuleConfig.ATTACHMENT_KEY,moduleConfig);
}
