{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (!isWarDeployment(deploymentUnit)) {
    return;
  }
  if (phaseContext.getAttachment(ModuleConfig.ATTACHMENT_KEY) != null) {
    return;
  }
  final VirtualFile deploymentRoot=phaseContext.getAttachment(Attachments.DEPLOYMENT_ROOT).getRoot();
  final ModuleIdentifier moduleIdentifier=ModuleIdentifier.create("deployment." + deploymentRoot.getName());
  final ResourceRoot[] resourceRoots=createResourceRoots(phaseContext.getAttachment(DeploymentStructure.ATTACHMENT_KEY));
  final ModuleDependencies dependenciesAttachment=getAttachedDependencies(deploymentUnit);
  final ModuleDependency[] dependencies=dependenciesAttachment != null ? dependenciesAttachment.getDependencies() : NO_DEPS;
  final ModuleConfig moduleConfig=new ModuleConfig(moduleIdentifier,dependencies,resourceRoots);
  phaseContext.putAttachment(ModuleConfig.ATTACHMENT_KEY,moduleConfig);
}
