{
  final EntityBeanComponent component=getComponent(context,EntityBeanComponent.class);
  final Object primaryKey=context.getPrivateData(EntityBeanComponent.PRIMARY_KEY_CONTEXT_KEY);
  if (primaryKey == null) {
    throw EjbLogger.ROOT_LOGGER.primaryKeyIsNull();
  }
  final EntityBeanComponentInstance instance;
  try {
    instance=component.getCache().get(primaryKey);
    if (instance.isRemoved()) {
      component.getCache().release(instance,true);
      throw EjbLogger.ROOT_LOGGER.instanceWasRemoved(component.getComponentName(),primaryKey);
    }
  }
 catch (  javax.ejb.NoSuchEntityException e) {
    if (context.getPrivateData(InvocationType.class) == InvocationType.TIMER) {
      throw new BeanRemovedException(e);
    }
    throw e;
  }
  try {
    context.putPrivateData(ComponentInstance.class,instance);
    return context.proceed();
  }
 catch (  Exception ex) {
    if (component.getApplicationException(ex.getClass(),context.getMethod()) != null) {
      throw ex;
    }
    if (ex instanceof ConcurrentAccessTimeoutException || ex instanceof ConcurrentAccessException) {
      throw ex;
    }
    if (ex instanceof RuntimeException || ex instanceof RemoteException) {
      if (ROOT_LOGGER.isTraceEnabled())       ROOT_LOGGER.trace("Discarding bean " + primaryKey + " because of exception",ex);
      instance.discard();
    }
    throw ex;
  }
catch (  final Error e) {
    if (ROOT_LOGGER.isTraceEnabled())     ROOT_LOGGER.trace("Discarding bean " + primaryKey + " because of error",e);
    instance.discard();
    throw e;
  }
catch (  final Throwable t) {
    if (ROOT_LOGGER.isTraceEnabled())     ROOT_LOGGER.trace("Discarding bean " + primaryKey + " because of Throwable",t);
    instance.discard();
    throw new RuntimeException(t);
  }
 finally {
    context.putPrivateData(ComponentInstance.class,null);
  }
}
