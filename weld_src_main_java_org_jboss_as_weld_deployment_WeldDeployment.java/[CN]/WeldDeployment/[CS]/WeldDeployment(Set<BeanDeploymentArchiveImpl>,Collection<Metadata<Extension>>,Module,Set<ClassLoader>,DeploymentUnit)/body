{
  this.subDeploymentClassLoaders=new HashSet<ClassLoader>(subDeploymentClassLoaders);
  this.beanDeploymentArchives=new HashSet<BeanDeploymentArchiveImpl>(beanDeploymentArchives);
  this.extensions=new HashSet<Metadata<Extension>>(extensions);
  this.serviceRegistry=new SimpleServiceRegistry();
  this.additionalBeanDeploymentArchivesByClassloader=new HashMap<ClassLoader,BeanDeploymentArchiveImpl>();
  this.module=module;
  this.serviceRegistry.add(ProxyServices.class,new ProxyServicesImpl(module));
  this.serviceRegistry.add(ResourceLoader.class,new WeldModuleResourceLoader(module));
  CompositeIndex index=deploymentUnit.getAttachment(Attachments.COMPOSITE_ANNOTATION_INDEX);
  if (index != null) {
    this.serviceRegistry.add(AnnotationDiscovery.class,new WeldAnnotationDiscovery(index));
  }
  calculateAccessibilityGraph(this.beanDeploymentArchives);
}
