{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final BundleInstallService service=new BundleInstallService(deployment);
  final String contextName=deploymentUnit.getName();
  final ServiceName serviceName=getServiceName(contextName);
  final ServiceTarget serviceTarget=phaseContext.getServiceTarget();
  ServiceBuilder<BundleInstallService> builder=serviceTarget.addService(serviceName,service);
  builder.addDependency(ServiceNames.SYSTEM_CONTEXT,BundleContext.class,service.injectedBundleContext);
  builder.addDependency(ServiceNames.BUNDLE_MANAGER,BundleManagement.class,service.injectedBundleManager);
  builder.addDependency(BundleStartupProcessor.SERVICE_NAME,BundleStartupProcessor.class,service.injectedStartTracker);
  builder.addDependency(org.jboss.as.server.deployment.Services.deploymentUnitName(contextName));
  builder.install();
}
