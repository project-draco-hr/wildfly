{
  ServiceController<?> controller=context.getController();
  ROOT_LOGGER.debugf("Stopping: %s in mode %s",controller.getName(),controller.getMode());
  try {
    BundleManagerService bundleManager=injectedBundleManager.getValue();
    bundleManager.uninstallBundle(deployment);
  }
 catch (  Throwable t) {
    ROOT_LOGGER.failedToUninstallDeployment(t,deployment);
  }
  ServiceName serviceName=deploymentUnitName(context.getController().getName().getSimpleName());
  ServiceController<?> deploymentController=context.getController().getServiceContainer().getService(serviceName);
  if (deploymentController != null) {
    deploymentController.setMode(Mode.REMOVE);
  }
}
