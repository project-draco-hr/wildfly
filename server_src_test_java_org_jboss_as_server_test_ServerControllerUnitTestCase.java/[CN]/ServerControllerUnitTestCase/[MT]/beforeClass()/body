{
  final ServiceTarget target=container.subTarget();
  final ExtensionRegistry extensionRegistry=new ExtensionRegistry(ProcessType.STANDALONE_SERVER,new RunningModeControl(RunningMode.NORMAL),null,null);
  final StringConfigurationPersister persister=new StringConfigurationPersister(Collections.<ModelNode>emptyList(),new StandaloneXml(null,null,extensionRegistry));
  extensionRegistry.setWriterRegistry(persister);
  final ControlledProcessState processState=new ControlledProcessState(true);
  final ModelControllerService svc=new ModelControllerService(processState,persister,new DelegatingResourceDefinition());
  final ServiceBuilder<ModelController> builder=target.addService(Services.JBOSS_SERVER_CONTROLLER,svc);
  builder.install();
  svc.latch.await();
  this.controller=svc.getValue();
}
