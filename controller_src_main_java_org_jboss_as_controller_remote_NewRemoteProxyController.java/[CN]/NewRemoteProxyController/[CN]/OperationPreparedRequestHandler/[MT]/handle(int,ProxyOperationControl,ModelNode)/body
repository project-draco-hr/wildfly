{
  control.operationPrepared(new OperationTransaction(){
    @Override public void rollback(){
      done(false);
    }
    @Override public void commit(){
      done(true);
    }
    private void done(    boolean commit){
      status=commit ? ModelControllerProtocol.PARAM_COMMIT : ModelControllerProtocol.PARAM_ROLLBACK;
      requestContext.setTxCommittedOrRolledBack();
      try {
        requestContext.awaitControlCompleted();
      }
 catch (      InterruptedException e) {
        Thread.currentThread().interrupt();
        throw new RuntimeException("A timeout occurred waiting for the transaction to " + (commit ? "commit" : "rollback"));
      }
    }
  }
,response);
}
