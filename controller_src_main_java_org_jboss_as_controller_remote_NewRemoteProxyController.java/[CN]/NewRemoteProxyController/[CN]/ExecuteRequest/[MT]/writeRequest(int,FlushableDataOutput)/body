{
  boolean success=false;
  activeRequests.put(getCurrentRequestId(),executeRequestContext);
  executeRequestContext.getExecutionCallback().registerOutgoingExecution(getCurrentRequestId());
  try {
    output.write(NewModelControllerProtocol.PARAM_OPERATION);
    operation.writeExternal(output);
    output.write(NewModelControllerProtocol.PARAM_INPUTSTREAMS_LENGTH);
    int inputStreamLength=0;
    if (executeRequestContext.getAttachments() != null) {
      List<InputStream> streams=executeRequestContext.getAttachments().getInputStreams();
      if (streams != null) {
        inputStreamLength=streams.size();
      }
    }
    output.writeInt(inputStreamLength);
    success=true;
  }
  finally {
    if (!success) {
      executeRequestContext.getExecutionCallback().completeOutgoingExecution(getCurrentRequestId());
    }
  }
}
