{
  final BatchBuilder builder=updateContext.getBatchBuilder();
  final XATerminatorService xaTerminatorService=new XATerminatorService();
  builder.addService(TxnServices.JBOSS_TXN_XA_TERMINATOR,xaTerminatorService).setInitialMode(ServiceController.Mode.ACTIVE);
  final TransactionManagerService transactionManagerService=new TransactionManagerService(nodeIdentifier,maxPorts,coordinatorEnableStatistics,coordinatorDefaultTimeout);
  final BatchServiceBuilder<com.arjuna.ats.jbossatx.jta.TransactionManagerService> transactionManagerServiceBuilder=builder.addService(TxnServices.JBOSS_TXN_TRANSACTION_MANAGER,transactionManagerService);
  transactionManagerServiceBuilder.addOptionalDependency(ServiceName.JBOSS.append("iiop","orb"),ORB.class,transactionManagerService.getOrbInjector());
  transactionManagerServiceBuilder.addDependency(TxnServices.JBOSS_TXN_XA_TERMINATOR,JBossXATerminator.class,transactionManagerService.getXaTerminatorInjector());
  transactionManagerServiceBuilder.addDependency(SocketBinding.JBOSS_BINDING_NAME.append(recoveryBindingName),SocketBinding.class,transactionManagerService.getRecoveryBindingInjector());
  transactionManagerServiceBuilder.addDependency(SocketBinding.JBOSS_BINDING_NAME.append(recoveryStatusBindingName),SocketBinding.class,transactionManagerService.getStatusBindingInjector());
  transactionManagerServiceBuilder.addDependency(SocketBinding.JBOSS_BINDING_NAME.append(bindingName),SocketBinding.class,transactionManagerService.getSocketProcessBindingInjector());
  transactionManagerServiceBuilder.addDependency(AbstractPathService.pathNameOf(INTERNAL_OBJECTSTORE_PATH),String.class,transactionManagerService.getPathInjector());
  transactionManagerServiceBuilder.addDependencies(MBeanServerService.SERVICE_NAME);
  transactionManagerServiceBuilder.setInitialMode(ServiceController.Mode.ACTIVE);
  RelativePathService.addService(INTERNAL_OBJECTSTORE_PATH,objectStorePath,objectStorePathRef,builder);
}
