{
  controller.addListener(new AbstractServiceListener<Object>(){
    public void listenerAdded(    final ServiceController<?> controller){
      final Map<ServiceName,ServiceController<?>> map=realRemovingControllers;
synchronized (map) {
        map.put(controller.getName(),controller);
        controller.setMode(ServiceController.Mode.REMOVE);
      }
    }
    public void serviceRemoveRequestCleared(    final ServiceController<?> controller){
      clear(controller);
    }
    public void serviceRemoved(    final ServiceController<? extends Object> controller){
      clear(controller);
    }
    private void clear(    final ServiceController<?> controller){
      final Map<ServiceName,ServiceController<?>> map=realRemovingControllers;
synchronized (map) {
        if (map.get(controller.getName()) == controller) {
          map.remove(controller.getName());
          map.notifyAll();
        }
      }
    }
  }
);
}
