{
  Realm realm=this.getContainer().getRealm();
  if (realm.findSecurityConstraints(request,(Context)this.getContainer()) == null) {
    log.tracef("Invoking optional JASPI authenticator for request context %s",request.getServletPath());
    GenericMessageInfo messageInfo=new GenericMessageInfo();
    messageInfo.setRequestMessage(request);
    messageInfo.setResponseMessage(request.getResponse());
    messageInfo.getMap().put("javax.security.auth.message.MessagePolicy.isMandatory","false");
    WebJASPICallbackHandler cbh=new WebJASPICallbackHandler();
    ServerAuthenticationManager sam=new JASPIServerAuthenticationManager();
    String appContext=request.getLocalName() + " " + request.getContextPath();
    String messageLayer="HttpServlet";
    boolean isValid=sam.isValid(messageInfo,new Subject(),messageLayer,appContext,cbh);
    if (isValid) {
      WebLogger.WEB_SECURITY_LOGGER.debugf("JASPI validation for unprotected request context %s succeeded",request.getServletPath());
      sam.secureResponse(messageInfo,new Subject(),messageLayer,appContext,cbh);
    }
 else {
      WebLogger.WEB_SECURITY_LOGGER.failJASPIValidation(request.getServletPath());
    }
  }
  super.getNext().invoke(request,response);
}
