{
  EmbeddedCacheManager container=this.container.getValue();
  this.registerGroupers(container.getCacheManagerConfiguration().classLoader());
  if (this.module != null) {
    try {
      Module module=this.loader.getValue().loadModule(this.module);
      this.registerGroupers(module.getClassLoader());
    }
 catch (    ModuleLoadException e) {
      throw new IllegalArgumentException(e);
    }
  }
  TransactionManager tm=this.tm.getOptionalValue();
  if (tm != null) {
    this.configurationBuilder.transaction().transactionManagerLookup(new TransactionManagerProvider(tm));
  }
  TransactionSynchronizationRegistry tsr=this.tsr.getOptionalValue();
  if (tsr != null) {
    this.configurationBuilder.transaction().transactionSynchronizationRegistryLookup(new TransactionSynchronizationRegistryProvider(tsr));
  }
  boolean topologyAware=container.getCacheManagerConfiguration().transport().hasTopologyInfo();
  this.consistentHashStrategy.buildHashConfiguration(this.configurationBuilder.clustering().hash(),this.mode,topologyAware);
  return this.configurationBuilder.build();
}
