{
  if (digestMd5Supported()) {
    return OptionMap.create(SASL_MECHANISMS,Sequence.of(DIGEST_MD5));
  }
  if (plainSupported()) {
    return OptionMap.create(Options.SASL_MECHANISMS,Sequence.of(PLAIN),SASL_POLICY_NOPLAINTEXT,false);
  }
  if (realm == null) {
    return OptionMap.create(SASL_MECHANISMS,Sequence.of(ANONYMOUS),SASL_POLICY_NOANONYMOUS,Boolean.FALSE);
  }
  throw new IllegalStateException("A security realm has been specified but no supported mechanism identified.");
}
