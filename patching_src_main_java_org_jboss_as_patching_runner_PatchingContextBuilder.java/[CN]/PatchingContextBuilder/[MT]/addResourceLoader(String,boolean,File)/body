{
  final File miscRoot;
  final File modulesRoot;
  final File bundlesRoot;
  if (rollback) {
    final File historyDir=structure.getHistoryDir(patchId);
    miscRoot=new File(historyDir,PatchContentLoader.MISC);
    modulesRoot=structure.getModulePatchDirectory(patchId);
    bundlesRoot=structure.getBundlesPatchDirectory(patchId);
  }
 else {
    miscRoot=new File(workDir,PatchContentLoader.MISC);
    bundlesRoot=new File(workDir,PatchContentLoader.BUNDLES);
    modulesRoot=new File(workDir,PatchContentLoader.MODULES);
  }
  loaders.put(patchId,new PatchContentLoader(miscRoot,bundlesRoot,modulesRoot));
}
