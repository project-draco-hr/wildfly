{
  ServletRequestContext servletRequestContext=exchange.getAttachment(ServletRequestContext.ATTACHMENT_KEY);
  LoginConfig loginConfig=servletRequestContext.getDeployment().getDeploymentInfo().getLoginConfig();
  String desiredAuthMethod=loginConfig.getAuthMethod().toUpperCase();
  if (BASIC_AUTH.equals(desiredAuthMethod)) {
    return new BasicAuthenticationMechanism(loginConfig.getRealmName());
  }
 else   if (DIGEST_AUTH.equals(desiredAuthMethod)) {
    return new DigestAuthenticationMechanism(loginConfig.getRealmName(),servletRequestContext.getCurrentServetContext().getContextPath(),DIGEST_AUTH);
  }
 else   if (FORM_AUTH.equals(desiredAuthMethod)) {
    return new ServletFormAuthenticationMechanism(FORM_AUTH,loginConfig.getLoginPage(),loginConfig.getErrorPage());
  }
 else   if (CLIENT_CERT_AUTH.equals(desiredAuthMethod)) {
    return new ClientCertAuthenticationMechanism();
  }
 else {
    throw new RuntimeException("Invalid authentication mechanism [" + loginConfig.getAuthMethod() + "].");
  }
}
