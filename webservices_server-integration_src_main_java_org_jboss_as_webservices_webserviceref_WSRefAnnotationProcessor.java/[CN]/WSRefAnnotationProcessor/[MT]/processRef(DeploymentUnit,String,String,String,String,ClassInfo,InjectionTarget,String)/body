{
  final EEApplicationClasses applicationClasses=deploymentUnit.getAttachment(Attachments.EE_APPLICATION_CLASSES_DESCRIPTION);
  final EEModuleClassDescription classDescription=applicationClasses.getOrAddClassByName(classInfo.name().toString());
  final ResourceInjectionConfiguration injectionConfiguration=targetDescription != null ? new ResourceInjectionConfiguration(targetDescription,new LookupInjectionSource(localContextName)) : null;
  final Module module=deploymentUnit.getAttachment(org.jboss.as.server.deployment.Attachments.MODULE);
  final ClassLoader classLoader=module.getClassLoader();
  final WSReferences wsRefRegistry=getWSRefRegistry(deploymentUnit);
  UnifiedServiceRefMetaData serviceRefUMDM=wsRefRegistry.get(name);
  if (serviceRefUMDM == null) {
    serviceRefUMDM=new UnifiedServiceRefMetaData(getUnifiedVirtualFile(deploymentUnit));
    serviceRefUMDM.setServiceRefName(name);
    wsRefRegistry.add(name,serviceRefUMDM);
  }
  final Class<?> typeClass=getClass(classLoader,type);
  processServiceRef(deploymentUnit,serviceRefUMDM,typeClass,name,value,wsdlLocation);
  if (targetDescription != null) {
    processInjectionTargets(deploymentUnit,targetDescription,serviceRefUMDM);
  }
 else {
    final Class<?> target=getClass(classLoader,classInfo.name().toString());
    processAnnotatedElement(target,serviceRefUMDM);
  }
  final InjectionSource valueSource=new WSRefValueSource(serviceRefUMDM);
  final BindingConfiguration bindingConfiguration=new BindingConfiguration(localContextName,valueSource);
  classDescription.getConfigurators().add(new BindingConfigurator(bindingConfiguration));
  if (injectionConfiguration != null) {
    classDescription.getConfigurators().add(new InjectionConfigurator(injectionConfiguration));
  }
}
