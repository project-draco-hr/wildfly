{
  System.setProperty("jboss.as.test.transformation.hack","true");
  try {
    ModelVersion modelVersion=ModelVersion.create(1,1,0);
    KernelServicesBuilder builder=createKernelServicesBuilder(AdditionalInitialization.MANAGEMENT).setSubsystemXmlResource(subsystemXml);
    builder.createLegacyKernelServicesBuilder(null,modelVersion).addMavenResourceURL("org.jboss.as:jboss-as-connector:" + mavenVersion).setExtensionClassName("org.jboss.as.connector.subsystems.datasources.DataSourcesExtension").skipReverseControllerCheck();
    KernelServices mainServices=builder.build();
    Assert.assertTrue(mainServices.isSuccessfulBoot());
    KernelServices legacyServices=mainServices.getLegacyServices(modelVersion);
    Assert.assertTrue(legacyServices.isSuccessfulBoot());
    Assert.assertNotNull(legacyServices);
    checkSubsystemModelTransformation(mainServices,modelVersion);
  }
  finally {
    System.clearProperty("jboss.as.test.transformation.hack");
  }
}
