{
  long toWait=unit.toMillis(timeout);
  long expire=System.currentTimeMillis() + toWait;
synchronized (this) {
    while (!isDone()) {
      wait(toWait);
      if (!isDone()) {
        long now=System.currentTimeMillis();
        if (now >= expire) {
          throw new TimeoutException();
        }
        toWait=expire - now;
      }
    }
    return getResult();
  }
}
