{
  if (deploymentFinished.get()) {
    throw new DeploymentException("Deployment has already been marked as finished.");
  }
  if (batchInProgress.compareAndSet(false,true) && countUpdater.compareAndSet(this,0,1)) {
    this.batchCompletionTask=batchCompletionTask;
  }
 else {
    throw new DeploymentException("Batch is already in progress");
  }
}
