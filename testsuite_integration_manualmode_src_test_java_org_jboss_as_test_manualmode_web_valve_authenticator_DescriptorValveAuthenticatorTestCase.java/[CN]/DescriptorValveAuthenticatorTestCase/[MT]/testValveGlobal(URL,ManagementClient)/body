{
  Map<String,String> params=new HashMap<String,String>();
  params.put(PARAM_NAME,GLOBAL_PARAM_VALUE);
  ValveUtil.addValve(client,CUSTOM_AUTHENTICATOR_1,MODULENAME,AUTHENTICATOR.getName(),params);
  ValveUtil.reload(client);
  String appUrl=url.toExternalForm() + WEB_APP_URL;
  log.debug("Testing url " + appUrl + " against two authenticators - one defined in web descriptor other is defined globally in server configuration and checking which one was used");
  Header[] valveHeaders=ValveUtil.hitValve(new URL(appUrl));
  assertEquals("There were two valves defined (but detected these valve headers: " + Arrays.toString(valveHeaders) + ")",1,valveHeaders.length);
  assertEquals(WEB_PARAM_VALUE,valveHeaders[0].getValue());
}
