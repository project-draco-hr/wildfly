{
  if (environment == null)   environment=new Hashtable<String,Object>();
  final String factoryClassName=(String)environment.get(Context.INITIAL_CONTEXT_FACTORY);
  if (factoryClassName == null || InitialContextFactory.class.getName().equals(factoryClassName)) {
    return DEFAULT_FACTORY;
  }
  final ClassLoader classLoader=getContextClassLoader();
  try {
    final Class<?> factoryClass=Class.forName(factoryClassName,true,classLoader);
    return (javax.naming.spi.InitialContextFactory)factoryClass.newInstance();
  }
 catch (  Exception e) {
    throw MESSAGES.failedToInstantiate("InitialContextFactory",factoryClassName,classLoader);
  }
}
