{
  System.out.println("testHCReloadAbortPreservesServers()");
  List<RunningProcess> original=waitForAllProcessesFullyStarted();
  try {
    File toBreak=new File(domainConfigDir,hostXml.getName());
    PrintWriter pw=null;
    try {
      pw=new PrintWriter(toBreak);
      pw.println("<host/>");
    }
  finally {
      if (pw != null) {
        pw.close();
      }
    }
    executeReloadOperation(false,false);
    long deadline=System.currentTimeMillis() + 30000;
    boolean origHCGone;
    do {
      origHCGone=true;
      Set<RunningProcess> updated=new HashSet<RunningProcess>(waitForProcesses(SERVER_ONE,SERVER_TWO));
      for (      RunningProcess process : original) {
        if (!process.getProcess().equals(HOST_CONTROLLER)) {
          Assert.assertTrue(process.getProcess() + " is missing",updated.contains(process));
        }
 else {
          origHCGone=!updated.contains(process);
        }
      }
      if (!origHCGone) {
        Thread.sleep(100);
      }
    }
 while (!origHCGone && System.currentTimeMillis() < deadline);
    if (!origHCGone) {
      Assert.fail("Original HC process did not terminate within 30 seconds");
    }
  }
  finally {
    copyFile(hostXml,domainConfigDir);
    waitForAllProcesses();
  }
}
