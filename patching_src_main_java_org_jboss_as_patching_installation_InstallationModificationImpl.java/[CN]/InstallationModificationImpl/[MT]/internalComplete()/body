{
  if (!setDone()) {
    throw new IllegalStateException();
  }
  try {
    installationState.persist();
  }
 catch (  Exception e) {
    installationState.restore();
    throw e;
  }
  try {
    persist();
  }
 catch (  Exception e) {
    installationState.restore();
  }
  return installationState;
}
