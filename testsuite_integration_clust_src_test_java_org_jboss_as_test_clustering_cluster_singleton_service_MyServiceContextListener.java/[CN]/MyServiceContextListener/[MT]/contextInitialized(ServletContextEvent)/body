{
  MyService service=new MyService();
  SingletonService<Environment> singleton=new SingletonService<Environment>(service,MyService.SERVICE_NAME);
  singleton.setElectionPolicy(new PreferredSingletonElectionPolicy(new NamePreference(PREFERRED_NODE + "/" + SingletonService.DEFAULT_CONTAINER),new SimpleSingletonElectionPolicy()));
  singleton.setClassResolver(new SimpleClassResolver(this.getClass().getClassLoader()));
  ServiceController<Environment> controller=singleton.build(CurrentServiceContainer.getServiceContainer()).addDependency(ServerEnvironmentService.SERVICE_NAME,ServerEnvironment.class,service.getEnvInjector()).install();
  controller.setMode(ServiceController.Mode.ACTIVE);
  wait(controller,EnumSet.of(ServiceController.State.DOWN,ServiceController.State.STARTING),ServiceController.State.UP);
}
