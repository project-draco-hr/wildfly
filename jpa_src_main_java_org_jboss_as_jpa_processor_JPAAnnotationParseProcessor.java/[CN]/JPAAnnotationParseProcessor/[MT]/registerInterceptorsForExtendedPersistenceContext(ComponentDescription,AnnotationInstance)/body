{
  if (componentDescription instanceof StatefulComponentDescription && isExtendedPersistenceContext(annotation)) {
    componentDescription.getConfigurators().addFirst(new ComponentConfigurator(){
      @Override public void configure(      DeploymentPhaseContext context,      ComponentDescription description,      ComponentConfiguration configuration) throws DeploymentUnitProcessingException {
        configuration.getPostConstructInterceptors().addFirst(new SFSBCreateInterceptorFactory());
        configuration.getPreDestroyInterceptors().addFirst(new SFSBDestroyInterceptorFactory());
      }
    }
);
    List<ViewDescription> views=componentDescription.getViews();
    for (    ViewDescription view : views) {
      view.getConfigurators().addFirst(new ViewConfigurator(){
        @Override public void configure(        DeploymentPhaseContext context,        ComponentConfiguration componentConfiguration,        ViewDescription description,        ViewConfiguration configuration) throws DeploymentUnitProcessingException {
          Method[] viewMethods=configuration.getProxyFactory().getCachedMethods();
          for (          Method viewMethod : viewMethods) {
            configuration.getViewInterceptorDeque(viewMethod).addFirst(new ImmediateInterceptorFactory(SFSBInvocationInterceptor.INSTANCE));
          }
        }
      }
);
    }
  }
  if (!isExtendedPersistenceContext(annotation) && (componentDescription instanceof StatefulComponentDescription || componentDescription instanceof StatelessComponentDescription)) {
    componentDescription.getConfigurators().add(new ComponentConfigurator(){
      @Override public void configure(      DeploymentPhaseContext context,      ComponentDescription description,      ComponentConfiguration configuration) throws DeploymentUnitProcessingException {
        for (        Method method : configuration.getDefinedComponentMethods()) {
          configuration.getComponentInterceptorDeque(method).addFirst(new ImmediateInterceptorFactory(SBInvocationInterceptor.INSTANCE));
        }
      }
    }
);
  }
}
