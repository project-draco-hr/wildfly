{
  Valve valve=null;
  try {
    if (module == null) {
      String filename=pathManagerInjector.getValue().resolveRelativePathEntry(filePath,fileRelativeTo);
      valve=WebValve.createValve(filename,classname,this.getClass().getClassLoader());
    }
 else {
      final ModuleLoader moduleLoader=Module.getBootModuleLoader();
      final ModuleIdentifier id=ModuleIdentifier.create(module);
      Module valveModule=moduleLoader.loadModule(id);
      valve=WebValve.createValve(classname,valveModule.getClassLoader());
    }
  }
 catch (  Exception e) {
    throw new StartException(e);
  }
  if (params != null) {
    for (    final Property param : params.asPropertyList()) {
      IntrospectionUtils.setProperty(valve,param.getName(),param.getValue().asString());
    }
  }
  webServer.getValue().addValve(valve);
  this.valve=valve;
}
