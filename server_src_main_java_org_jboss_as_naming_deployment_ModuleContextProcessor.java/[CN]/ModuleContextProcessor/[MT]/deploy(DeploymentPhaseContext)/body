{
  final ServiceTarget serviceTarget=phaseContext.getServiceTarget();
  final DeploymentUnit deploymentUnitContext=phaseContext.getDeploymentUnit();
  final ServiceName moduleContextServiceName=ContextNames.GLOBAL_CONTEXT_SERVICE_NAME.append(deploymentUnitContext.getName());
  final JndiName moduleContextJndiName=ContextNames.GLOBAL_CONTEXT_NAME.append(deploymentUnitContext.getName());
  final ContextService contextService=new ContextService(moduleContextJndiName);
  serviceTarget.addService(moduleContextServiceName,contextService).addDependency(ContextNames.GLOBAL_CONTEXT_SERVICE_NAME,Context.class,contextService.getParentContextInjector()).install();
  phaseContext.getDeploymentUnit().putAttachment(ModuleContextConfig.ATTACHMENT_KEY,new ModuleContextConfig(moduleContextServiceName,moduleContextJndiName));
}
