def add_file(self, src, dest=None):
    if os.path.isdir(src):
        regex = re.compile(('^' + src))
        for (path, dirnames, filenames) in os.walk(src):
            for filename in filenames:
                filename = '/'.join((path, filename))
                if dest:
                    self.zipfile.write(filename, self.prepend(re.sub(regex, dest, filename)))
                else:
                    self.zipfile.write(filename, self.prepend(filename))
    elif dest:
        self.zipfile.write(src, self.prepend(dest))
    else:
        self.zipfile.write(src, self.prepend(src))
