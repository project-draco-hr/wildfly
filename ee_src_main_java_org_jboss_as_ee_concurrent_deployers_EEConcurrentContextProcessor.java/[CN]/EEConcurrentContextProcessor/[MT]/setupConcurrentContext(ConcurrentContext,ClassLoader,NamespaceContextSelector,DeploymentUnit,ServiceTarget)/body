{
  concurrentContext.addFactory(new NamingContextHandleFactory(namespaceContextSelector,deploymentUnit.getServiceName()));
  concurrentContext.addFactory(new ClassLoaderContextHandleFactory(moduleClassLoader));
  concurrentContext.addFactory(SecurityContextHandleFactory.INSTANCE);
  concurrentContext.addFactory(new OtherEESetupActionsContextHandleFactory(deploymentUnit.getAttachmentList(Attachments.OTHER_EE_SETUP_ACTIONS)));
  final TransactionLeakContextHandleFactory transactionLeakContextHandleFactory=new TransactionLeakContextHandleFactory();
  concurrentContext.addFactory(transactionLeakContextHandleFactory);
  final ConcurrentContextService service=new ConcurrentContextService(concurrentContext);
  final ServiceName serviceName=ConcurrentServiceNames.getConcurrentContextServiceName(concurrentContext.getApplicationName(),concurrentContext.getModuleName(),concurrentContext.getComponentName());
  serviceTarget.addService(serviceName,service).addDependency(ServiceName.JBOSS.append("txn","TransactionManager"),TransactionManager.class,transactionLeakContextHandleFactory).install();
}
