{
  try {
    if (tx != tm.getTransaction()) {
      throw EjbMessages.MESSAGES.wrongTxOnThread(tx,tm.getTransaction());
    }
    if (tx.getStatus() == Status.STATUS_MARKED_ROLLBACK) {
      tm.rollback();
    }
 else {
      tm.commit();
    }
  }
 catch (  RollbackException e) {
    handleEndTransactionException(e);
  }
catch (  HeuristicMixedException e) {
    handleEndTransactionException(e);
  }
catch (  HeuristicRollbackException e) {
    handleEndTransactionException(e);
  }
catch (  SystemException e) {
    handleEndTransactionException(e);
  }
}
