{
  ApplicationExceptionDetails ae=invocation.getApplicationException(t.getClass());
  if (ae != null) {
    if (ae.isRollback())     setRollbackOnly(tx);
    throw (Exception)t;
  }
  if (!(t instanceof EJBTransactionRolledbackException)) {
    if (t instanceof Error) {
      Throwable cause=t;
      t=new EJBTransactionRolledbackException("Unexpected Error");
      t.initCause(cause);
    }
 else     if (t instanceof EJBException || t instanceof RemoteException) {
    }
 else     if (t instanceof RuntimeException) {
      t=new EJBTransactionRolledbackException(t.getMessage(),(Exception)t);
    }
 else {
      throw (Exception)t;
    }
  }
  setRollbackOnly(tx);
  log.error(t);
  throw (Exception)t;
}
