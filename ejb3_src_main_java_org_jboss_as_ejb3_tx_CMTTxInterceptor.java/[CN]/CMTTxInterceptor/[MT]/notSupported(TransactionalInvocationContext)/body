{
  Transaction tx=tm.getTransaction();
  if (tx != null) {
    tm.suspend();
    try {
      return invokeInNoTx(invocation);
    }
 catch (    Exception e) {
      if (invocation.getApplicationException(e.getClass()) != null) {
        throw e;
      }
 else {
        throw new EJBException(e);
      }
    }
 finally {
      tm.resume(tx);
    }
  }
 else {
    return invokeInNoTx(invocation);
  }
}
