{
  ApplicationExceptionDetails ae=invocation.getApplicationException(t.getClass());
  if (ae != null) {
    if (ae.isRollback())     setRollbackOnly(tx);
    throw (Exception)t;
  }
  if (!(t instanceof EJBException || t instanceof RemoteException)) {
    if (t instanceof Error) {
      Throwable cause=t;
      t=new EJBException("Unexpected Error");
      t.initCause(cause);
    }
 else     if (t instanceof RuntimeException) {
      t=new EJBException((Exception)t);
    }
 else {
      throw (Exception)t;
    }
  }
  setRollbackOnly(tx);
  throw (Exception)t;
}
