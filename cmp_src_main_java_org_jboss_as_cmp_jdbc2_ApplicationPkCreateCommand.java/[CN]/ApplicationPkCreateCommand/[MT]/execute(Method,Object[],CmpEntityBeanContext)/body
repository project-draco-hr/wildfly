{
  Object pk;
  PersistentContext pctx=(PersistentContext)ctx.getPersistenceContext();
  if (ctx.getPrimaryKey() == null) {
    pk=entityBridge.extractPrimaryKeyFromInstance(ctx);
    if (pk == null) {
      throw MESSAGES.pkIsNullForCreatedInstance();
    }
    pctx.setPk(pk);
  }
 else {
    try {
      pctx.flush();
    }
 catch (    SQLException e) {
      if ("23000".equals(e.getSQLState())) {
        throw MESSAGES.uniqueKeyViolation(ctx.getPrimaryKey());
      }
 else {
        throw MESSAGES.failedToCreateInstance(ctx.getPrimaryKey(),e);
      }
    }
    pk=ctx.getPrimaryKey();
  }
  return pk;
}
