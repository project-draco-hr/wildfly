{
  final PathAddress rootAddress=PathAddress.pathAddress(PathAddress.pathAddress(operation.require(OP_ADDR)).getLastElement());
  final ModelNode wsSubsystemAddress=rootAddress.toModelNode();
  final ModelNode wsSubsystem=Resource.Tools.readModel(context.readResource(PathAddress.EMPTY_ADDRESS));
  final ModelNode result=context.getResult();
  final ModelNode subsystemAdd=getSubsystemAddOperation(wsSubsystemAddress,wsSubsystem);
  result.add(subsystemAdd);
  if (wsSubsystem.hasDefined(ENDPOINT_CONFIG)) {
    processConfig(wsSubsystem,ENDPOINT_CONFIG,wsSubsystemAddress,result);
  }
  if (wsSubsystem.hasDefined(CLIENT_CONFIG)) {
    processConfig(wsSubsystem,CLIENT_CONFIG,wsSubsystemAddress,result);
  }
  context.stepCompleted();
}
