{
  ArquillianConfig arqConfig=phaseContext.getAttachment(ArquillianConfig.KEY);
  if (arqConfig == null)   return;
  ServiceTarget serviceTarget=phaseContext.getServiceTarget();
  DeploymentTrackerService tracker=new DeploymentTrackerService(arqConfig);
  ServiceBuilder<Object> serviceBuilder=serviceTarget.addService(SERVICE_NAME_BASE.append(phaseContext.getDeploymentUnitContext().getName()),tracker);
  serviceBuilder.addDependency(ArquillianService.SERVICE_NAME,ArquillianService.class,tracker.injectedArquillianService);
  Deployment osgiDeployment=OSGiDeploymentAttachment.getAttachment(phaseContext.getDeploymentUnitContext());
  if (osgiDeployment != null) {
    ServiceName serviceName=OSGiDeploymentService.getServiceName(phaseContext.getDeploymentUnitContext().getName());
    serviceBuilder.addDependency(serviceName);
    osgiDeployment.setAutoStart(false);
  }
  serviceBuilder.install();
}
