{
  setStatisticsEnabled(true);
  final ModelNode address=new ModelNode();
  address.add(ModelDescriptionConstants.DEPLOYMENT,"ws-example.war");
  address.add(ModelDescriptionConstants.SUBSYSTEM,WSExtension.SUBSYSTEM_NAME);
  address.add("endpoint","*");
  final ModelNode operation=new ModelNode();
  operation.get(ModelDescriptionConstants.OP).set(ModelDescriptionConstants.READ_RESOURCE_OPERATION);
  operation.get(ModelDescriptionConstants.OP_ADDR).set(address);
  operation.get(ModelDescriptionConstants.INCLUDE_RUNTIME).set(true);
  operation.get(ModelDescriptionConstants.RECURSIVE).set(true);
  ModelNode result=managementClient.getControllerClient().execute(operation);
  Assert.assertEquals(ModelDescriptionConstants.SUCCESS,result.get(ModelDescriptionConstants.OUTCOME).asString());
  for (  final ModelNode endpointResult : result.get("result").asList()) {
    final ModelNode endpoint=endpointResult.get("result");
    final URL url=new URL(endpoint.get("wsdl-url").asString());
    HttpRequest.get(url.toExternalForm(),30,TimeUnit.SECONDS);
    checkCountMetric(endpointResult,managementClient.getControllerClient(),"request-count");
    checkCountMetric(endpointResult,managementClient.getControllerClient(),"response-count");
  }
  setStatisticsEnabled(false);
  result=managementClient.getControllerClient().execute(operation);
  Assert.assertEquals(ModelDescriptionConstants.SUCCESS,result.get(ModelDescriptionConstants.OUTCOME).asString());
  for (  final ModelNode endpointResult : result.get("result").asList()) {
    final ModelNode endpoint=endpointResult.get("result");
    Assert.assertTrue(endpoint.hasDefined("request-count"));
    Assert.assertTrue(endpoint.get("request-count").asString().contains("No metrics available"));
  }
}
