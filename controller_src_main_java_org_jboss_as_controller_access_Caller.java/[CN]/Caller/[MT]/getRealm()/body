{
  if (UNDEFINED.equals(realm)) {
    if (subject != null) {
      Set<RealmPrincipal> realmPrincipals=subject.getPrincipals(RealmPrincipal.class);
      String foundRealm=null;
      for (      RealmPrincipal current : realmPrincipals) {
        if (foundRealm == null) {
          foundRealm=current.getRealm();
        }
 else         if (foundRealm.equals(current.getRealm()) == false) {
          throw MESSAGES.differentRealmsInSubject(foundRealm,current.getRealm());
        }
      }
      realm=foundRealm;
    }
 else {
      this.realm=null;
    }
  }
  return realm;
}
