{
  Map<String,String> renames=new HashMap<String,String>();
  Map<String,ModelNode> adds=new HashMap<String,ModelNode>();
  for (  final Map.Entry<String,AttributeTransformationDescription> entry : descriptions.entrySet()) {
    final String attributeName=entry.getKey();
    final ModelNode attributeValue=modelOrOp.get(attributeName);
    AttributeTransformationDescription description=entry.getValue();
    if (description.shouldDiscard(attributeValue,context)) {
      modelOrOp.remove(attributeName);
    }
    if (!description.checkAttributeValueIsValid(attributeValue,context)) {
      reject.add(attributeName);
    }
    description.convertValue(attributeValue,context);
    String newName=description.getNewName();
    if (newName != null) {
      renames.put(attributeName,newName);
    }
    ModelNode added=description.addAttribute(context);
    if (added != null) {
      adds.put(attributeName,added);
    }
  }
  if (renames.size() > 0) {
    for (    Map.Entry<String,String> entry : renames.entrySet()) {
      if (modelOrOp.has(entry.getKey())) {
        ModelNode model=modelOrOp.remove(entry.getKey());
        if (model.isDefined()) {
          modelOrOp.get(entry.getValue()).set(model);
        }
      }
    }
  }
  if (adds.size() > 0) {
    for (    Map.Entry<String,ModelNode> entry : adds.entrySet()) {
      modelOrOp.get(entry.getKey()).set(entry.getValue());
    }
  }
}
