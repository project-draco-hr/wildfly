{
  Map<String,String> renames=new HashMap<String,String>();
  Map<String,ModelNode> adds=new HashMap<String,ModelNode>();
  for (  final Map.Entry<String,AttributeTransformationDescription> entry : descriptions.entrySet()) {
    final String attributeName=entry.getKey();
    final ModelNode attributeValue=modelOrOp.get(attributeName);
    AttributeTransformationDescription description=entry.getValue();
    boolean discarded=false;
    if (description.shouldDiscard(address,attributeValue,operation,context)) {
      modelOrOp.remove(attributeName);
      discarded=true;
    }
    description.rejectAttributes(rejectedAttributes,attributeValue);
    boolean isNewAttribute;
    if (operation != null) {
      isNewAttribute=!operation.has(attributeName);
    }
 else {
      isNewAttribute=!modelOrOp.has(attributeName);
    }
    description.convertValue(address,attributeValue,operation,context);
    if (!attributeValue.isDefined()) {
      modelOrOp.remove(attributeName);
    }
 else     if (isNewAttribute && !discarded) {
      adds.put(attributeName,attributeValue);
    }
    String newName=description.getNewName();
    if (newName != null) {
      renames.put(attributeName,newName);
    }
  }
  if (renames.size() > 0) {
    for (    Map.Entry<String,String> entry : renames.entrySet()) {
      if (modelOrOp.has(entry.getKey())) {
        ModelNode model=modelOrOp.remove(entry.getKey());
        if (model.isDefined()) {
          modelOrOp.get(entry.getValue()).set(model);
        }
      }
    }
  }
  if (adds.size() > 0) {
    for (    Map.Entry<String,ModelNode> entry : adds.entrySet()) {
      modelOrOp.get(entry.getKey()).set(entry.getValue());
    }
  }
}
