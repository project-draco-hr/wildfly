{
  if (removedReferences != null && removedReferences.contains(referenceAddress)) {
    throw ControllerMessages.MESSAGES.attemptToBothRemoveAndAddHandlerReferenceFromCompositeOperation();
  }
  if (addedReferences == null) {
    addedReferences=new HashSet<PathAddress>();
  }
  addedReferences.add(referenceAddress);
  config.addHandlerReference(org.jboss.as.controller.operations.common.Util.getNameFromAddress(referenceAddress));
  final String name=org.jboss.as.controller.operations.common.Util.getNameFromAddress(referenceAddress);
  final AuditLogHandler handler=config.getConfiguredHandler(name);
  if (handler == null) {
    throw ControllerMessages.MESSAGES.noHandlerCalled(name);
  }
  handler.addReference(referenceAddress);
}
