{
  if (removedHandlers != null && removedHandlers.size() > 0) {
    for (    String name : removedHandlers) {
      AuditLogHandler handler=config.removeConfiguredHandler(name);
      if (handler != null) {
        handler.stop();
      }
    }
  }
  if (replacedHandlers != null && replacedHandlers.size() > 0) {
    for (    AuditLogHandler handler : replacedHandlers.values()) {
      AuditLogHandler existing=config.removeConfiguredHandler(handler.getName());
      if (existing != null) {
        existing.stop();
      }
      for (      PathAddress referenceAddress : existing.getReferences()) {
        if (removedReferences != null && !removedReferences.contains(referenceAddress)) {
          handler.addReference(referenceAddress);
        }
      }
      config.putConfiguredHandler(handler);
      handler.setFormatter(config.getFormatter(handler.getFormatterName()));
    }
  }
  if (removedReferences != null && removedReferences.size() > 0) {
    for (    PathAddress referenceAddress : removedReferences) {
      final String name=org.jboss.as.controller.operations.common.Util.getNameFromAddress(referenceAddress);
      final AuditLogHandler handler=config.getConfiguredHandler(name);
      if (handler != null) {
        handler.removeReference(referenceAddress);
      }
      config.removeHandlerReference(name);
    }
  }
}
