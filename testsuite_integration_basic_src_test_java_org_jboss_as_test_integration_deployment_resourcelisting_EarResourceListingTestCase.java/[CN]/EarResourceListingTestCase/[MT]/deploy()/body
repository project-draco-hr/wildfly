{
  EnterpriseArchive ear=ShrinkWrap.create(EnterpriseArchive.class);
  JavaArchive earLib=ShrinkWrap.create(JavaArchive.class);
  earLib.addClasses(EarResourceListingTestCase.class,ResourceListingUtils.class);
  earLib.addAsManifestResource(EmptyAsset.INSTANCE,"emptyJarLibResource.properties");
  earLib.addAsManifestResource(EmptyAsset.INSTANCE,"properties/nestedJarLib.properties");
  ear.addAsLibraries(earLib);
  WebArchive war=ShrinkWrap.create(WebArchive.class,innerWarArchiveName);
  war.addClass(TestA.class);
  war.add(EmptyAsset.INSTANCE,"META-INF/example.txt");
  war.add(EmptyAsset.INSTANCE,"META-INF/properties/nested.properties");
  war.add(EmptyAsset.INSTANCE,"example2.txt");
  war.addAsResource(EarResourceListingTestCase.class.getPackage(),"TextFile1.txt","TextFile1.txt");
  war.addAsWebInfResource(EarResourceListingTestCase.class.getPackage(),"web.xml","web.xml");
  JavaArchive libJar=ShrinkWrap.create(JavaArchive.class);
  libJar.addClass(WebInfLibClass.class);
  war.addAsLibraries(libJar);
  ear.addAsModules(libJar,war);
  ear.addAsManifestResource(EmptyAsset.INSTANCE,"MANIFEST.MF");
  ear.addAsResource(EmptyAsset.INSTANCE,"emptyEarResource");
  ear.addAsManifestResource(new StringAsset("<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n" + "\n" + "<application xmlns=\"http://java.sun.com/xml/ns/javaee\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n"+ "   xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/application_6.xsd\" version=\"6\">\n"+ "\n"+ "  <module>\n"+ "     <web>\n"+ "       <web-uri>" + war.getName() + "</web-uri>\n"+ "       <context-root>"+ war.getName().replace(".war","")+ "</context-root>\n"+ "     </web>\n"+ "   </module>\n"+ "\n"+ "  <module>\n"+ "     <java>"+ libJar.getName()+ "</java>\n"+ "  </module>\n"+ "\n"+ "</application>"),"application.xml");
  ear.addAsManifestResource(new StringAsset("<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n" + "<jboss-deployment-structure> \n" + "  <ear-subdeployments-isolated>false</ear-subdeployments-isolated>\n"+ "  <sub-deployment name=\"" + war.getName() + "\"/>\n"+ "</jboss-deployment-structure>"),"jboss-deployment-structure.xml");
  return ear;
}
