{
  writer.writeStartElement(Element.PROFILE.getLocalName());
  writer.writeAttribute(Attribute.NAME.getLocalName(),profileName);
  if (profileNode.hasDefined(INCLUDES)) {
    for (    final ModelNode include : profileNode.get(INCLUDES).asList()) {
      writer.writeEmptyElement(INCLUDE);
      writer.writeAttribute(PROFILE,include.asString());
    }
  }
  final Set<String> subsystemNames=profileNode.get(SUBSYSTEM).keys();
  if (subsystemNames.size() > 0) {
    String defaultNamespace=writer.getNamespaceContext().getNamespaceURI(XMLConstants.DEFAULT_NS_PREFIX);
    for (    String subsystemName : subsystemNames) {
      try {
        ModelNode subsystem=profileNode.get(SUBSYSTEM,subsystemName);
        XMLElementWriter<SubsystemMarshallingContext> subsystemWriter=context.getSubsystemWriter(subsystemName);
        if (subsystemWriter != null) {
          subsystemWriter.writeContent(writer,new SubsystemMarshallingContext(subsystem,writer));
        }
      }
  finally {
        writer.setDefaultNamespace(defaultNamespace);
      }
    }
  }
  writer.writeEndElement();
}
