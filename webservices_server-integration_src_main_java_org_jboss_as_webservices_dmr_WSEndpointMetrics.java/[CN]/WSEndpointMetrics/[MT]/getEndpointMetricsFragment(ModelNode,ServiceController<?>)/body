{
  final PathAddress address=PathAddress.pathAddress(operation.require(OP_ADDR));
  String endpointId=null;
  try {
    endpointId=URLDecoder.decode(address.getLastElement().getValue(),"UTF-8");
  }
 catch (  final UnsupportedEncodingException e) {
    throw new RuntimeException(e);
  }
  final String metricName=operation.require(NAME).asString();
  final String webContext=endpointId.substring(0,endpointId.indexOf(":"));
  final String endpointName=endpointId.substring(endpointId.indexOf(":") + 1);
  ObjectName endpointObjectName=null;
  try {
    endpointObjectName=new ObjectName("jboss.ws:context=" + webContext + ",endpoint="+ endpointName);
  }
 catch (  final MalformedObjectNameException e) {
    throw new OperationFailedException(new ModelNode().set(e.getMessage()));
  }
  final EndpointRegistry registry=(EndpointRegistry)controller.getValue();
  final Endpoint endpoint=registry.getEndpoint(endpointObjectName);
  final ModelNode result=new ModelNode();
  if (endpoint != null && endpoint.getEndpointMetrics() != null) {
    final EndpointMetrics endpointMetrics=endpoint.getEndpointMetrics();
    if (MIN_PROCESSING_TIME.equals(metricName)) {
      result.set(String.valueOf(endpointMetrics.getMinProcessingTime()));
    }
 else     if (MAX_PROCESSING_TIME.equals(metricName)) {
      result.set(String.valueOf(endpointMetrics.getMaxProcessingTime()));
    }
 else     if (AVERAGE_PROCESSING_TIME.equals(metricName)) {
      result.set(String.valueOf(endpointMetrics.getTotalProcessingTime()));
    }
 else     if (TOTAL_PROCESSING_TIME.equals(metricName)) {
      result.set(String.valueOf(endpointMetrics.getTotalProcessingTime()));
    }
 else     if (REQUEST_COUNT.equals(metricName)) {
      result.set(String.valueOf(endpointMetrics.getRequestCount()));
    }
 else     if (RESPONSE_COUNT.equals(metricName)) {
      result.set(String.valueOf(endpointMetrics.getResponseCount()));
    }
 else     if (FAULT_COUNT.equals(metricName)) {
      result.set(String.valueOf(endpointMetrics.getFaultCount()));
    }
  }
 else {
    result.set(getFallbackMessage());
  }
  return result;
}
