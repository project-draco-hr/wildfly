{
  final InstalledConfiguration conf=new InstalledConfiguration(image);
  final File layersDir=conf.getLayersMetadataDir();
  final File[] layers=layersDir.listFiles();
  if (layers != null) {
    for (    final File layer : layers) {
      final File identity=new File(layer,INSTALLATION_METADATA);
      if (identity.isFile()) {
        conf.getInstalledLayers().add(layer.getName());
      }
    }
  }
  final File addOnsDir=conf.getAddOnsMetadataDir();
  final File[] addOns=addOnsDir.listFiles();
  if (layers != null) {
    for (    final File addOn : addOns) {
      final File identity=new File(addOn,INSTALLATION_METADATA);
      if (identity.isFile()) {
        conf.getInstalledAddOns().add(addOn.getName());
      }
    }
  }
  return conf;
}
