{
  final File installation=new File(metadata,INSTALLATION_METADATA);
  final Properties properties=loadProperties(installation);
  final String layerName=(String)properties.get(NAME);
  final String layerVersion=(String)properties.get(VERSION);
  if (layerName == null || layerVersion == null) {
    throw processingError("missing attributes in the layer '%s' installation metadata: %s",name,properties);
  }
  return new AbstractPatchableTarget(){
    @Override protected File getModulesBase(){
      if (layer.modulePath == null) {
        throw new IllegalStateException("no module base available");
      }
      return layer.modulePath;
    }
    @Override protected File getBundlesBase(){
      if (layer.bundlePath == null) {
        throw new IllegalStateException("no bundle base available");
      }
      return layer.bundlePath;
    }
    @Override protected File getPatchesMetadataDir(){
      return metadata;
    }
    @Override public String getInstallationName(){
      return layerName;
    }
    @Override public String getVersion(){
      return layerVersion;
    }
    @Override public String getName(){
      return name;
    }
  }
;
}
