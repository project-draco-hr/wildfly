{
  TestParser testParser;
  String root;
  if (type == TestModelType.STANDALONE) {
    StandaloneXml standaloneXml=new StandaloneXml(null,Executors.newCachedThreadPool(),registry);
    testParser=new TestParser(type,standaloneXml,standaloneXml);
    root="server";
  }
 else   if (type == TestModelType.DOMAIN) {
    DomainXml domainXml=new DomainXml(null,Executors.newCachedThreadPool(),registry);
    testParser=new TestParser(type,domainXml,domainXml);
    root="domain";
  }
 else   if (type == TestModelType.HOST) {
    HostXml hostXml=new HostXml("master");
    testParser=new TestParser(type,hostXml,hostXml);
    root="host";
  }
 else {
    throw new IllegalArgumentException("Unknown type " + type);
  }
  try {
    for (    Namespace ns : Namespace.ALL_NAMESPACES) {
      xmlMapper.registerRootElement(new QName(ns.getUriString(),root),testParser);
    }
  }
 catch (  NoSuchFieldError e) {
    xmlMapper.registerRootElement(new QName(Namespace.DOMAIN_1_0.getUriString(),root),testParser);
    xmlMapper.registerRootElement(new QName(Namespace.DOMAIN_1_1.getUriString(),root),testParser);
    xmlMapper.registerRootElement(new QName(Namespace.DOMAIN_1_2.getUriString(),root),testParser);
  }
  return testParser;
}
