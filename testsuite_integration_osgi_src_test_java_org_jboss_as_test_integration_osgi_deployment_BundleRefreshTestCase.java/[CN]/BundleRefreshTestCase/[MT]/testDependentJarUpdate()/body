{
  Bundle jar=context.installBundle(V200_JAR,deployer.getDeployment(V200_JAR));
  Bundle webapp=context.installBundle(BUNDLE_V200_WAB,deployer.getDeployment(BUNDLE_V200_WAB));
  try {
    webapp.start();
    String result=performCall("bundle-v200","simple",null);
    Assert.assertEquals("Revision deployment.v200.jar:main",result);
    result=performCall("bundle-v200","message.txt",null);
    Assert.assertEquals("Resource V2.0.0",result);
    jar.update(deployer.getDeployment(V201_JAR));
    result=performCall("bundle-v200","simple",null);
    Assert.assertEquals("Revision deployment.v200.jar:main",result);
    result=performCall("bundle-v200","message.txt",null);
    Assert.assertEquals("Resource V2.0.0",result);
    FrameworkUtils.refreshBundles(context,Collections.singleton(jar));
    result=performCall("bundle-v200","simple",null);
    Assert.assertEquals("Revision deployment.v200.jar:main",result);
    result=performCall("bundle-v200","message.txt",null);
    Assert.assertEquals("Resource V2.0.0",result);
  }
  finally {
    webapp.uninstall();
    jar.uninstall();
  }
}
