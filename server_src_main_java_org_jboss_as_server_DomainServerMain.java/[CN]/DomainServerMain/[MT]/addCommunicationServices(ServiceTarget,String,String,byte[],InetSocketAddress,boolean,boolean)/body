{
  final ServiceName endpointName;
  if (!managementSubsystemEndpoint) {
    endpointName=ManagementRemotingServices.MANAGEMENT_ENDPOINT;
    if (!isReconnect) {
      ManagementRemotingServices.installRemotingEndpoint(serviceTarget,ManagementRemotingServices.MANAGEMENT_ENDPOINT,SecurityActions.getSystemProperty(ServerEnvironment.NODE_NAME),EndpointService.EndpointType.MANAGEMENT,null,null);
    }
  }
 else {
    endpointName=RemotingServices.SUBSYSTEM_ENDPOINT;
  }
  try {
    final int port=managementSocket.getPort();
    final String host=InetAddress.getByName(managementSocket.getHostName()).getHostName();
    final HostControllerServerClient client=new HostControllerServerClient(serverName,serverProcessName,host,port,authKey);
    serviceTarget.addService(HostControllerServerClient.SERVICE_NAME,client).addDependency(endpointName,Endpoint.class,client.getEndpointInjector()).addDependency(Services.JBOSS_SERVER_CONTROLLER,ModelController.class,client.getServerControllerInjector()).addDependency(RemoteFileRepository.SERVICE_NAME,RemoteFileRepository.class,client.getRemoteFileRepositoryInjector()).setInitialMode(ServiceController.Mode.ACTIVE).install();
  }
 catch (  UnknownHostException e) {
    throw new RuntimeException(e);
  }
}
