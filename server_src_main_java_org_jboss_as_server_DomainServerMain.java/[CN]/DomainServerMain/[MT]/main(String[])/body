{
  System.setProperty("log4j.defaultInitOverride","true");
  new BridgeRepositorySelector().start();
  final InputStream initialInput=System.in;
  final PrintStream initialError=System.err;
  StdioContext.install();
  final StdioContext context=StdioContext.create(new NullInputStream(),new LoggingOutputStream(org.jboss.logmanager.Logger.getLogger("stdout"),Level.INFO),new LoggingOutputStream(org.jboss.logmanager.Logger.getLogger("stderr"),Level.ERROR));
  StdioContext.setStdioContextSelector(new SimpleStdioContextSelector(context));
  final byte[] authKey=new byte[16];
  try {
    StreamUtils.readFully(initialInput,authKey);
  }
 catch (  IOException e) {
    e.printStackTrace();
    System.exit(1);
    throw new IllegalStateException();
  }
  final MarshallerFactory factory=Marshalling.getMarshallerFactory("river",DomainServerMain.class.getClassLoader());
  final Unmarshaller unmarshaller;
  final ByteInput byteInput;
  try {
    final MarshallingConfiguration configuration=new MarshallingConfiguration();
    configuration.setVersion(2);
    configuration.setClassResolver(new SimpleClassResolver(DomainServerMain.class.getClassLoader()));
    unmarshaller=factory.createUnmarshaller(configuration);
    byteInput=Marshalling.createByteInput(initialInput);
    unmarshaller.start(byteInput);
    final ServerTask task=unmarshaller.readObject(ServerTask.class);
    unmarshaller.finish();
    task.run(Arrays.<ServiceActivator>asList(new ServiceActivator(){
      @Override public void activate(      final ServiceActivatorContext serviceActivatorContext){
      }
    }
));
  }
 catch (  Exception e) {
    e.printStackTrace(initialError);
    System.exit(1);
    throw new IllegalStateException();
  }
  for (; ; )   try {
    unmarshaller.start(byteInput);
    final InetSocketAddress socketAddress=unmarshaller.readObject(InetSocketAddress.class);
    unmarshaller.finish();
    break;
  }
 catch (  InterruptedIOException e) {
    Thread.interrupted();
  }
catch (  EOFException e) {
    break;
  }
catch (  Exception e) {
    break;
  }
  System.exit(0);
  throw new IllegalStateException();
}
