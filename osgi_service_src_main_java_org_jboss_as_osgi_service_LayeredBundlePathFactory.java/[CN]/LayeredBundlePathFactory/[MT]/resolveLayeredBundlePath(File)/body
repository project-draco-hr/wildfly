{
  List<File> layeredPath=new ArrayList<File>();
  for (  File file : bundlePath) {
    layeredPath.add(file);
    LayersConfig layersConfig=getLayersConfig(file);
    File layersDir=new File(file,layersConfig.getLayersPath());
    if (!layersDir.exists()) {
      if (layersConfig.isConfigured()) {
        throw MESSAGES.illegalStateNoLayersDirectoryFound(layersDir);
      }
      continue;
    }
    boolean validLayers=true;
    List<File> layerFiles=new ArrayList<File>();
    for (    String layerName : layersConfig.getLayers()) {
      File layer=new File(layersDir,layerName);
      if (!layer.exists()) {
        if (layersConfig.isConfigured()) {
          throw MESSAGES.illegalStateCannotFindLayer(layerName,layersDir);
        }
        validLayers=false;
        break;
      }
      layerFiles.add(layer);
    }
    if (validLayers) {
      layeredPath.addAll(layerFiles);
      File[] addOns=new File(file,layersConfig.getAddOnsPath()).listFiles();
      if (addOns != null) {
        for (        File addOn : addOns) {
          if (addOn.isDirectory()) {
            layeredPath.add(addOn);
          }
        }
      }
    }
  }
  return layeredPath;
}
