{
  DeploymentUnit depUnit=phaseContext.getDeploymentUnit();
  WarMetaData warMetaData=depUnit.getAttachment(WarMetaData.ATTACHMENT_KEY);
  OSGiMetaData metadata=depUnit.getAttachment(OSGiConstants.OSGI_METADATA_KEY);
  if (warMetaData == null || metadata == null)   return;
  FilterMappingMetaData filterMetaData=new FilterMappingMetaData();
  filterMetaData.setFilterName(WebBundleContextFilter.class.getName());
  filterMetaData.setServletNames(Collections.singletonList("io.undertow.DefaultServlet"));
  filterMetaData.setUrlPatterns(Arrays.asList("/OSGI-INF/*","/OSGI-OPT/*"));
  JBossWebMetaData jbossWebMetaData=warMetaData.getMergedJBossWebMetaData();
  List<FilterMappingMetaData> filterMappings=jbossWebMetaData.getFilterMappings();
  if (filterMappings == null) {
    filterMappings=new ArrayList<FilterMappingMetaData>();
    jbossWebMetaData.setFilterMappings(filterMappings);
  }
  filterMappings.add(filterMetaData);
}
