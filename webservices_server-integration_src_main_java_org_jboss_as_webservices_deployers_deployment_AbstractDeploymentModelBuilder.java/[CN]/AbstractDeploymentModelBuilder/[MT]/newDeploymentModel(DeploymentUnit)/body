{
  final ArchiveDeployment dep;
  if (unit.getAttachment(WSAttachmentKeys.DEPLOYMENT_KEY) != null) {
    dep=(ArchiveDeployment)unit.getAttachment(WSAttachmentKeys.DEPLOYMENT_KEY);
  }
 else {
    try {
      dep=this.newDeployment(unit);
    }
 catch (    DeploymentUnitProcessingException e) {
      throw new RuntimeException(e);
    }
    dep.addAttachment(DeploymentUnit.class,unit);
    unit.putAttachment(WSAttachmentKeys.DEPLOYMENT_KEY,dep);
  }
  this.build(dep,unit);
}
