{
  final ArchiveDeployment dep;
  if (unit.hasAttachment(DEPLOYMENT_KEY)) {
    dep=(ArchiveDeployment)unit.getAttachment(DEPLOYMENT_KEY);
  }
 else {
    try {
      dep=this.newDeployment(unit);
    }
 catch (    DeploymentUnitProcessingException e) {
      throw new RuntimeException(e);
    }
    dep.addAttachment(DeploymentUnit.class,unit);
    unit.putAttachment(DEPLOYMENT_KEY,dep);
    final JBossWebMetaData webMD=getJBossWebMetaData(unit);
    dep.addAttachment(JBossWebMetaData.class,webMD);
    final WebservicesMetaData webservicesMD=getOptionalAttachment(unit,WEBSERVICES_METADATA_KEY);
    dep.addAttachment(WebservicesMetaData.class,webservicesMD);
    final JBossWebservicesMetaData jbossWebservicesMD=getOptionalAttachment(unit,JBOSS_WEBSERVICES_METADATA_KEY);
    dep.addAttachment(JBossWebservicesMetaData.class,jbossWebservicesMD);
    final JAXWSDeployment jaxwsDeployment=getOptionalAttachment(unit,JAXWS_ENDPOINTS_KEY);
    dep.addAttachment(JAXWSDeployment.class,jaxwsDeployment);
  }
  this.build(dep,unit);
}
