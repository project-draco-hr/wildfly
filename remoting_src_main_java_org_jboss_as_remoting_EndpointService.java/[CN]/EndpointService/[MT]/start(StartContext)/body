{
  final Endpoint endpoint;
  try {
    boolean ok=false;
    endpoint=Remoting.createEndpoint(endpointName,optionMap);
    try {
      endpoint.addConnectionProvider(Protocol.REMOTE.toString(),new RemoteConnectionProviderFactory(),optionMap);
      endpoint.addConnectionProvider(Protocol.HTTP_REMOTING.toString(),new HttpUpgradeConnectionProviderFactory(),optionMap);
      endpoint.addConnectionProvider(Protocol.HTTPS_REMOTING.toString(),new HttpUpgradeConnectionProviderFactory(),OptionMap.builder().set(Options.SSL_ENABLED,true).addAll(optionMap).getMap());
      ok=true;
    }
  finally {
      if (!ok) {
        endpoint.closeAsync();
      }
    }
  }
 catch (  IOException e) {
    throw MESSAGES.couldNotStart(e);
  }
  this.endpoint=endpoint;
}
