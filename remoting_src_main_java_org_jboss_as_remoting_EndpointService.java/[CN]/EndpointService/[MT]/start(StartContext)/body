{
  final Endpoint endpoint;
  try {
    boolean ok=false;
    endpoint=Remoting.createEndpoint(endpointName,optionMap);
    try {
      endpoint.addConnectionProvider(Protocols.REMOTE,new RemoteConnectionProviderFactory(),optionMap);
      endpoint.addConnectionProvider(Protocols.HTTP_REMOTING,new HttpUpgradeConnectionProviderFactory(),optionMap);
      endpoint.addConnectionProvider(Protocols.HTTPS_REMOTING,new HttpUpgradeConnectionProviderFactory(),OptionMap.builder().addAll(optionMap).set(Options.SSL_ENABLED,true).getMap());
      ok=true;
    }
  finally {
      if (!ok) {
        endpoint.closeAsync();
      }
    }
  }
 catch (  IOException e) {
    throw MESSAGES.couldNotStart(e);
  }
  this.endpoint=endpoint;
}
