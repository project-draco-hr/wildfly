{
  String protocol=getRequestingProtocol();
  Credentials c=null;
  if ("smtp".equals(protocol)) {
    c=config.getSmtpServer().getCredentials();
  }
 else   if ("pop3".equals(protocol)) {
    c=config.getPop3Server().getCredentials();
  }
 else   if ("imap".equals(protocol)) {
    c=config.getImapServer().getCredentials();
  }
  if (c != null) {
    return new javax.mail.PasswordAuthentication(c.getUsername(),c.getPassword());
  }
  return null;
}
