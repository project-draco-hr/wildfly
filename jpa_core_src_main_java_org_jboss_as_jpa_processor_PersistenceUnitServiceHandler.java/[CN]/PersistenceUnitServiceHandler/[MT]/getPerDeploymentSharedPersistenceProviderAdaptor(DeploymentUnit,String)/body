{
  if (deploymentUnit.getParent() != null) {
    deploymentUnit=deploymentUnit.getParent();
  }
synchronized (deploymentUnit) {
    Map<String,PersistenceProviderAdaptor> map=deploymentUnit.getAttachment(providerAdaptorMapKey);
    if (map == null) {
      map=new HashMap<String,PersistenceProviderAdaptor>();
      deploymentUnit.putAttachment(providerAdaptorMapKey,map);
    }
    return map.get(adaptorModule);
  }
}
