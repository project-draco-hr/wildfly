{
  final String jbossDist=System.getProperty("jboss.dist");
  if (jbossDist == null) {
    fail("jboss.dist system property is not set");
  }
  final String modulePath=System.getProperty("module.path");
  if (modulePath == null) {
    fail("module.path system property is not set");
  }
  final ProcessBuilder builder=new ProcessBuilder();
  builder.command("java","-jar",jbossDist + File.separatorChar + "jboss-modules.jar","-mp",modulePath,"org.jboss.as.cli","-c",cmd);
  final Process cliProc=builder.start();
  int exitCode=cliProc.waitFor();
  if (logFailure && exitCode != 0) {
    System.out.println("Failed to execute '" + cmd + "'");
    int bytesTotal=cliProc.getInputStream().available();
    if (bytesTotal > 0) {
      final byte[] bytes=new byte[bytesTotal];
      cliProc.getInputStream().read(bytes);
      System.out.println("Command's output: '" + new String(bytes) + "'");
    }
    bytesTotal=cliProc.getErrorStream().available();
    if (bytesTotal > 0) {
      final byte[] bytes=new byte[bytesTotal];
      cliProc.getErrorStream().read(bytes);
      System.out.println("Command's error log: '" + new String(bytes) + "'");
    }
 else {
      System.out.println("No output data for the command.");
    }
  }
  return exitCode;
}
