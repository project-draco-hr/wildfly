{
  Configuration config=this.config.getCache().getCacheConfiguration();
  boolean lockOnRead=config.transaction().transactionMode().isTransactional() && (config.transaction().lockingMode() == LockingMode.PESSIMISTIC) && config.locking().isolationLevel() == IsolationLevel.REPEATABLE_READ;
  boolean requireMarshallable=config.clustering().cacheMode().needsStateTransfer() || config.persistence().usingStores();
  SessionMetaDataFactory<InfinispanSessionMetaData<L>,L> metaDataFactory=new InfinispanSessionMetaDataFactory<>(this.config.getCache(),lockOnRead);
  return new InfinispanSessionFactory<>(metaDataFactory,this.createSessionAttributesFactory(lockOnRead,requireMarshallable),localContextFactory);
}
