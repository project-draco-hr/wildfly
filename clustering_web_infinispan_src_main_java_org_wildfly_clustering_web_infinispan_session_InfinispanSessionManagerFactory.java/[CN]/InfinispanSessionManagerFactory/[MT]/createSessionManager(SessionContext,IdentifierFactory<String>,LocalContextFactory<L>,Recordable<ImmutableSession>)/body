{
  final Batcher<TransactionBatch> batcher=new InfinispanBatcher(this.config.getCache());
  final Cache<String,?> cache=this.config.getCache();
  final IdentifierFactory<String> factory=new AffinityIdentifierFactory<>(identifierFactory,cache,this.config.getKeyAffinityServiceFactory());
  final CommandDispatcherFactory dispatcherFactory=this.config.getCommandDispatcherFactory();
  final NodeFactory<Address> nodeFactory=this.config.getNodeFactory();
  final int maxActiveSessions=this.config.getSessionManagerConfiguration().getMaxActiveSessions();
  InfinispanSessionManagerConfiguration config=new InfinispanSessionManagerConfiguration(){
    @Override public SessionContext getSessionContext(){
      return context;
    }
    @Override public Cache<String,?> getCache(){
      return cache;
    }
    @Override public IdentifierFactory<String> getIdentifierFactory(){
      return factory;
    }
    @Override public Batcher<TransactionBatch> getBatcher(){
      return batcher;
    }
    @Override public CommandDispatcherFactory getCommandDispatcherFactory(){
      return dispatcherFactory;
    }
    @Override public NodeFactory<Address> getNodeFactory(){
      return nodeFactory;
    }
    @Override public int getMaxActiveSessions(){
      return maxActiveSessions;
    }
    @Override public Recordable<ImmutableSession> getInactiveSessionRecorder(){
      return inactiveSessionRecorder;
    }
  }
;
  return new InfinispanSessionManager<>(this.getSessionFactory(context,localContextFactory),config);
}
