{
  cli.sendLine("batch");
  cli.sendLine("deploy " + warFiles[0].getAbsolutePath(),true);
  cli.sendLine("deploy " + warFiles[1].getAbsolutePath(),true);
  assertTrue(checkUndeployed(getBaseURL(url) + "deployment0/SimpleServlet"));
  assertTrue(checkUndeployed(getBaseURL(url) + "deployment1/SimpleServlet"));
  cli.sendLine("run-batch");
  String line=cli.readLine(WAIT_TIMEOUT * 5);
  assertTrue(line.contains("The batch executed successfully"));
  String response=HttpRequest.get(getBaseURL(url) + "deployment0/SimpleServlet",10,TimeUnit.SECONDS);
  assertTrue("Invalid response: " + response,response.indexOf("SimpleServlet") >= 0);
  response=HttpRequest.get(getBaseURL(url) + "deployment1/SimpleServlet",10,TimeUnit.SECONDS);
  assertTrue("Invalid response: " + response,response.indexOf("SimpleServlet") >= 0);
  cli.sendLine("batch");
  cli.sendLine("undeploy deployment0.war");
  cli.sendLine("undeploy deployment1.war");
  cli.sendLine("holdback-batch dbatch");
  cli.sendLine("batch dbatch");
  response=HttpRequest.get(getBaseURL(url) + "deployment0/SimpleServlet",10,TimeUnit.SECONDS);
  assertTrue("Invalid response: " + response,response.indexOf("SimpleServlet") >= 0);
  response=HttpRequest.get(getBaseURL(url) + "deployment1/SimpleServlet",10,TimeUnit.SECONDS);
  assertTrue("Invalid response: " + response,response.indexOf("SimpleServlet") >= 0);
  cli.sendLine("run-batch");
  assertTrue(checkUndeployed(getBaseURL(url) + "deployment0/SimpleServlet"));
  assertTrue(checkUndeployed(getBaseURL(url) + "deployment1/SimpleServlet"));
}
