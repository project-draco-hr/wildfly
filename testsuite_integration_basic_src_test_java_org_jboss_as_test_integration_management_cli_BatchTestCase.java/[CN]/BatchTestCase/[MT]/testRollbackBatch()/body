{
  cli.sendLine("batch");
  cli.sendLine("deploy " + warFiles[0].getAbsolutePath(),true);
  cli.sendLine("deploy " + warFiles[2].getAbsolutePath(),true);
  assertUndeployed(getBaseURL(url) + "deployment0/SimpleServlet");
  assertUndeployed(getBaseURL(url) + "deployment2/SimpleServlet");
  cli.sendLine("run-batch");
  String line=cli.readLine(WAIT_TIMEOUT);
  assertTrue("Batch did not fail.",line.contains("Failed to execute batch"));
  assertUndeployed(getBaseURL(url) + "deployment0/SimpleServlet");
  assertUndeployed(getBaseURL(url) + "deployment2/SimpleServlet");
  cli.sendLine("discard-batch");
  cli.sendLine("deploy " + warFiles[0].getAbsolutePath(),true);
  String response=HttpRequest.get(getBaseURL(url) + "deployment0/SimpleServlet",1000,10,TimeUnit.SECONDS);
  assertTrue("Invalid response: " + response,response.indexOf("SimpleServlet") >= 0);
  cli.sendLine("undeploy deployment0.war");
  assertUndeployed(getBaseURL(url) + "deployment0/SimpleServlet");
}
