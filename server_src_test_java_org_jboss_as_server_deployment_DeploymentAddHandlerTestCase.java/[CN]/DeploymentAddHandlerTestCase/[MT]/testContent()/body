{
  final DeploymentAddHandler handler=DeploymentAddHandler.create(contentRepository,null);
  final OperationContext context=Mockito.mock(OperationContext.class);
  Mockito.when(context.getResult()).thenReturn(new ModelNode());
  Mockito.when(context.readModelForUpdate(PathAddress.EMPTY_ADDRESS)).thenReturn(new ModelNode());
  Mockito.when(context.getProcessType()).thenReturn(ProcessType.STANDALONE_SERVER);
  Mockito.when(context.getRunningMode()).thenReturn(RunningMode.NORMAL);
  Mockito.when(context.isNormalServer()).thenReturn(true);
  final ModelNode operation=new ModelNode();
  operation.get("address").get(0).setExpression("deployment","test.war");
  operation.get("content").get(0).get("archive").set(true);
  operation.get("content").get(0).get("path").set("test.war");
  handler.execute(context,operation);
  Mockito.verify(context).addStep(Mockito.any(OperationStepHandler.class),OperationContext.Stage.RUNTIME);
  Mockito.verify(context).stepCompleted();
}
