{
  String subsystemXml=readResource("subsystem-transformers-discard.xml");
  ModelVersion modelVersion=ModelVersion.create(1,0,0);
  KernelServicesBuilder builder=createKernelServicesBuilder(AdditionalInitialization.MANAGEMENT).setSubsystemXml(subsystemXml);
  builder.createLegacyKernelServicesBuilder(null,ModelTestControllerVersion.V7_1_3_FINAL,modelVersion).addMavenResourceURL("org.jboss.as:jboss-as-ee:7.1.3.Final");
  KernelServices mainServices=builder.build();
  KernelServices legacyServices=mainServices.getLegacyServices(modelVersion);
  Assert.assertTrue(mainServices.isSuccessfulBoot());
  Assert.assertTrue(legacyServices.isSuccessfulBoot());
  ModelNode globalModules=mainServices.readTransformedModel(modelVersion).get(ModelDescriptionConstants.SUBSYSTEM,"ee").get(GlobalModulesDefinition.GLOBAL_MODULES);
  for (  ModelNode node : globalModules.asList()) {
    if (node.hasDefined(ANNOTATIONS) || node.hasDefined(SERVICES) || node.hasDefined(META_INF)) {
      throw new RuntimeException("attributes not discarded");
    }
  }
}
