{
  for (  ControllerTransactionSynchronization sync : synchronizations) {
    try {
      sync.beforeCompletion();
    }
 catch (    Exception e) {
      log.errorf(e,"Caught exception applying beforeCompletion notification for transaction %s on synchronization %s",id,sync);
    }
  }
  for (  ControllerResource resource : resources) {
    try {
      if (rollbackOnly)       resource.rollback();
 else       resource.commit();
    }
 catch (    Exception e) {
      if (rollbackOnly) {
        log.errorf(e,"Caught exception rolling back transaction %s on resource %s",id,resource);
      }
 else {
        log.errorf(e,"Caught exception committing transaction %s on resource %s",id,resource);
      }
    }
  }
  for (  ControllerTransactionSynchronization sync : synchronizations) {
    try {
      sync.afterCompletion(!rollbackOnly);
    }
 catch (    Exception e) {
      log.errorf(e,"Caught exception applying beforeCompletion notification for transaction %s on synchronization %s",id,sync);
    }
  }
}
