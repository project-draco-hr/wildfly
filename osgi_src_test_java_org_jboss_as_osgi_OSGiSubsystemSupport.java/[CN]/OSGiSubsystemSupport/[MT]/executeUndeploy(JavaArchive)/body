{
  final CountDownLatch latch=new CountDownLatch(1);
  AbstractServiceListener<Object> serviceStopListener=new AbstractServiceListener<Object>(){
    @Override public void serviceStopped(    ServiceController<?> controller){
      latch.countDown();
    }
  }
;
  ServiceName serviceName=DeploymentService.SERVICE_NAME.append(getDeploymentName(archive));
  ServiceController<?> controller=serviceContainer.getService(serviceName);
  controller.addListener(serviceStopListener);
  controller.setMode(ServiceController.Mode.REMOVE);
  latch.await(5L,TimeUnit.SECONDS);
  if (latch.getCount() != 0)   fail("Did not uninstall deployment within 5 seconds.");
}
