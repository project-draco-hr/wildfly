{
  if (deploymentElement != null) {
    final ServiceController<?> controller=updateContext.getServiceRegistry().getService(Services.deploymentUnitName(newDeployment));
    if (controller != null) {
      controller.addListener(new AbstractServiceListener<Object>(){
        public void serviceRemoved(        ServiceController<? extends Object> serviceController){
          deploy(updateContext);
        }
      }
);
      controller.setMode(ServiceController.Mode.REMOVE);
    }
 else {
      deploy(updateContext);
      if (resultHandler != null)       resultHandler.handleSuccess(null,param);
    }
  }
 else   if (resultHandler != null) {
    resultHandler.handleFailure(new IllegalStateException("Unknown deployment " + newDeployment),param);
  }
}
