{
  final String hostName=host.get(NAME).asString();
  final String mgmtNetwork=host.get(MANAGEMENT_INTERFACE,NATIVE_INTERFACE,INTERFACE).asString();
  final int mgmtPort=host.get(MANAGEMENT_INTERFACE,NATIVE_INTERFACE,PORT).asInt();
  final boolean backupDomainFiles=environment.isBackupDomainFiles();
  final boolean useCachedDc=environment.isUseCachedDc();
  serviceTarget.addService(HostRegistryService.SERVICE_NAME,new HostRegistryService()).install();
  final File configDir=environment.getDomainConfigurationDir();
  final ConfigurationFile configurationFile=environment.getDomainConfigurationFile();
  final ExtensibleConfigurationPersister domainConfigurationPersister=createDomainConfigurationPersister(configDir,configurationFile,isSlave);
  ContentRepository contentRepository=new DomainContentRepository(environment.getDomainDeploymentDir());
  final DomainControllerService dcService=new DomainControllerService(domainConfigurationPersister,hostName,mgmtPort,contentRepository,fileRepository,backupDomainFiles,useCachedDc,domainModel);
  ServiceBuilder<DomainController> builder=serviceTarget.addService(DomainController.SERVICE_NAME,dcService);
  if (isSlave) {
    builder.addDependency(MasterDomainControllerClient.SERVICE_NAME,MasterDomainControllerClient.class,dcService.getMasterDomainControllerClientInjector());
  }
  builder.addDependency(HOST_CONTROLLER_SERVICE_NAME_BASE.append("executor"),ScheduledExecutorService.class,dcService.getScheduledExecutorServiceInjector()).addDependency(HostController.SERVICE_NAME,LocalHostModel.class,dcService.getHostControllerServiceInjector()).addDependency(NetworkInterfaceService.JBOSS_NETWORK_INTERFACE.append(mgmtNetwork),NetworkInterfaceBinding.class,dcService.getInterfaceInjector()).addDependency(HostRegistryService.SERVICE_NAME,HostRegistryService.class,dcService.getHostRegistryInjector()).install();
  DomainControllerOperationHandlerService operationHandlerService=new DomainControllerOperationHandlerService(isSlave);
  serviceTarget.addService(DomainControllerOperationHandlerService.SERVICE_NAME,operationHandlerService).addDependency(ManagementCommunicationService.SERVICE_NAME,ManagementCommunicationService.class,operationHandlerService.getManagementCommunicationServiceValue()).addDependency(DomainController.SERVICE_NAME,ModelController.class,operationHandlerService.getModelControllerValue()).setInitialMode(ServiceController.Mode.ACTIVE).install();
}
