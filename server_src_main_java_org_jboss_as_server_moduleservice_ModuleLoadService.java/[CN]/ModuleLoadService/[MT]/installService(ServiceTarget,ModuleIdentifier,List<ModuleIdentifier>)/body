{
  final ModuleLoadService service=new ModuleLoadService();
  final ServiceName serviceName=ServiceModuleLoader.moduleServiceName(identifier);
  final ServiceBuilder<Module> builder=target.addService(serviceName,service);
  builder.addDependency(Services.JBOSS_SERVICE_MODULE_LOADER,ServiceModuleLoader.class,service.getServiceModuleLoader());
  builder.addDependency(ServiceModuleLoader.moduleSpecServiceName(identifier),ModuleSpec.class,service.getModuleSpec());
  for (  final ModuleIdentifier dep : dependencies) {
    if (dep.getName().startsWith(ServiceModuleLoader.MODULE_PREFIX)) {
      builder.addDependencies(ServiceModuleLoader.moduleSpecServiceName(dep));
    }
  }
  builder.setInitialMode(Mode.ON_DEMAND);
  builder.install();
  return serviceName;
}
