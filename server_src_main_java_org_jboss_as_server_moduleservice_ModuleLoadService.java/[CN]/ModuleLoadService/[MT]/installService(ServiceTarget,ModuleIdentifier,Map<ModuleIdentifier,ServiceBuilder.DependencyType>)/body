{
  final ModuleLoadService service=new ModuleLoadService(new ArrayList<ModuleIdentifier>(dependencies.keySet()));
  final ServiceName serviceName=ServiceModuleLoader.moduleServiceName(identifier);
  final ServiceBuilder<Module> builder=target.addService(serviceName,service);
  builder.addDependency(Services.JBOSS_SERVICE_MODULE_LOADER,ServiceModuleLoader.class,service.getServiceModuleLoader());
  builder.addDependency(ServiceModuleLoader.moduleSpecServiceName(identifier),ModuleSpec.class,service.getModuleSpec());
  for (  final Map.Entry<ModuleIdentifier,ServiceBuilder.DependencyType> entry : dependencies.entrySet()) {
    if (entry.getKey().getName().startsWith(ServiceModuleLoader.MODULE_PREFIX)) {
      builder.addDependency(entry.getValue(),ServiceModuleLoader.moduleSpecServiceName(entry.getKey()));
    }
  }
  builder.setInitialMode(Mode.ON_DEMAND);
  builder.install();
  return serviceName;
}
