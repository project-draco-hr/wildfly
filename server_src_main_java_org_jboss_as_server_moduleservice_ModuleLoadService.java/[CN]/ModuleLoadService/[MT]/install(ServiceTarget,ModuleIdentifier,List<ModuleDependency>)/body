{
  final ModuleLoadService service=new ModuleLoadService(dependencies);
  final ServiceName serviceName=ServiceModuleLoader.moduleServiceName(identifier);
  final ServiceBuilder<Module> builder=target.addService(serviceName,service);
  builder.addDependency(Services.JBOSS_SERVICE_MODULE_LOADER,ServiceModuleLoader.class,service.getServiceModuleLoader());
  builder.addDependency(ServiceModuleLoader.moduleSpecServiceName(identifier),ModuleDefinition.class,service.getModuleDefinitionInjectedValue());
  builder.addDependency(ServiceModuleLoader.moduleResolvedServiceName(identifier));
  for (  ModuleDependency dependency : dependencies) {
    final ModuleIdentifier moduleIdentifier=dependency.getIdentifier();
    if (moduleIdentifier.getName().startsWith(ServiceModuleLoader.MODULE_PREFIX)) {
      builder.addDependency(dependency.isOptional() ? OPTIONAL : REQUIRED,ServiceModuleLoader.moduleSpecServiceName(moduleIdentifier));
    }
  }
  builder.setInitialMode(Mode.ON_DEMAND);
  builder.install();
  return serviceName;
}
