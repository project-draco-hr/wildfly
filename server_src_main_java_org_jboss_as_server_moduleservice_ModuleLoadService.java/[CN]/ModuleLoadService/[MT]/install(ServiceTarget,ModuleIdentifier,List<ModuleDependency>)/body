{
  ModuleLoadService service=new ModuleLoadService();
  ServiceName serviceName=ServiceModuleLoader.moduleServiceName(identifier);
  ServiceBuilder<Module> builder=target.addService(serviceName,service);
  builder.addDependency(Services.JBOSS_SERVICE_MODULE_LOADER,ServiceModuleLoader.class,service.getServiceModuleLoader());
  builder.addDependency(ServiceModuleLoader.moduleSpecServiceName(identifier),ModuleSpec.class,service.getModuleSpec());
  for (  ModuleDependency dep : dependencies) {
    if (dep.getIdentifier().getName().startsWith(ServiceModuleLoader.MODULE_PREFIX)) {
      builder.addDependencies(ServiceModuleLoader.moduleSpecServiceName(dep.getIdentifier()));
    }
  }
  builder.setInitialMode(Mode.ON_DEMAND);
  builder.install();
  return serviceName;
}
