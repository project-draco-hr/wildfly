{
  DeploymentSetPlanImpl currentSet=getCurrentDeploymentSetPlan();
  if (currentSet.hasServerGroupPlans()) {
    throw new IllegalStateException("Cannot add deployment actions after starting creation of a rollout plan");
  }
  byte[] hash=deploymentDistributor.distributeReplacementDeploymentContent(name,commonName,stream);
  DeploymentActionImpl mod=DeploymentActionImpl.getFullReplaceAction(name,commonName,hash);
  DeploymentSetPlanImpl newSet=currentSet.addAction(mod);
  return new RemoveDeploymentPlanBuilderImpl(this,newSet);
}
