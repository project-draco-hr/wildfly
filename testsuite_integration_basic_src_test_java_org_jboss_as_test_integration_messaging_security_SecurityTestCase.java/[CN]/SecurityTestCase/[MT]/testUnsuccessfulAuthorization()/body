{
  final String queueName="queue.testUnsuccessfulAuthorization";
  final ClientSessionFactory sf=createClientSessionFactory(managementClient.getMgmtAddress(),5445);
  ClientSession session=null;
  try {
    session=sf.createSession("guest","guest",false,true,true,false,1);
    session.createQueue(queueName,queueName,true);
    fail("Must not create a durable queue without the CREATE_DURABLE_QUEUE permission");
  }
 catch (  HornetQException e) {
    assertEquals(HornetQExceptionType.SECURITY_EXCEPTION,e.getType());
    assertTrue(e.getMessage().startsWith("HQ119032"));
    assertTrue(e.getMessage().contains(CheckType.CREATE_DURABLE_QUEUE.toString()));
  }
 finally {
    if (session != null) {
      session.close();
    }
  }
}
