{
  String roleName=added.getName();
  String officialForm=getOfficialForm(roleName);
  if (permissionsByRole.containsKey(officialForm)) {
    throw ControllerLogger.ROOT_LOGGER.roleIsAlreadyRegistered(roleName);
  }
  String baseName=added.getBaseRoleName();
  String officialBase=getOfficialForm(baseName);
  if (rolePermissionsConfigured && !permissionsByRole.containsKey(officialBase)) {
    throw ControllerLogger.ROOT_LOGGER.unknownBaseRole(baseName);
  }
  ScopingConstraint constraint=added.getScopingConstraint();
  addConstraintFactory(constraint.getFactory());
  scopedBaseMap.put(officialForm,new ScopedBase(StandardRole.valueOf(officialBase),constraint));
  rolePermissionsConfigured=false;
}
