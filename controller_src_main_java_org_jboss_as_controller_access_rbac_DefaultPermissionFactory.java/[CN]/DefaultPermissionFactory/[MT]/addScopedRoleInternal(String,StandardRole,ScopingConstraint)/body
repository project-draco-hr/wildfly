{
  ManagementPermissionCollection baseCollection=permissionsByRole.get(getOfficialForm(base));
  int constraintIndex=getConstraintIndex(scopingConstraint.getFactory());
  Map<Action.ActionEffect,SimpleManagementPermission> monitorPermissions=new HashMap<Action.ActionEffect,SimpleManagementPermission>();
  ManagementPermissionCollection monitorCollection=permissionsByRole.get(getOfficialForm(StandardRole.MONITOR));
  Enumeration<Permission> monitorEnumeration=monitorCollection.elements();
  while (monitorEnumeration.hasMoreElements()) {
    SimpleManagementPermission monitorPerm=(SimpleManagementPermission)monitorEnumeration.nextElement();
    monitorPermissions.put(monitorPerm.getActionEffect(),monitorPerm);
  }
  ManagementPermissionCollection scopedPermissions=null;
  Enumeration<Permission> permissionEnumeration=baseCollection.elements();
  String scopedBaseName=officialForm + " (" + getOfficialForm(base)+ " permissions)";
  while (permissionEnumeration.hasMoreElements()) {
    SimpleManagementPermission basePerm=(SimpleManagementPermission)permissionEnumeration.nextElement();
    Action.ActionEffect actionEffect=basePerm.getActionEffect();
    CombinationManagementPermission combinedPermission=new CombinationManagementPermission(CombinationPolicy.PERMISSIVE,actionEffect);
    if (scopedPermissions == null) {
      scopedPermissions=new ManagementPermissionCollection(officialForm,CombinationManagementPermission.class);
    }
    ManagementPermission scopedPerm=basePerm.createScopedPermission(scopingConstraint.getStandardConstraint(),constraintIndex);
    combinedPermission.addUnderlyingPermission(scopedBaseName,scopedPerm);
    SimpleManagementPermission monitorPerm=monitorPermissions.get(actionEffect);
    String scopedReadOnlyName=officialForm + " (READ-ONLY permissions)";
    if (monitorPerm != null) {
      combinedPermission.addUnderlyingPermission(scopedReadOnlyName,monitorPerm.createScopedPermission(scopingConstraint.getOutofScopeReadConstraint(),constraintIndex));
    }
    scopedPermissions.add(combinedPermission);
  }
  permissionsByRole.put(officialForm,scopedPermissions);
}
