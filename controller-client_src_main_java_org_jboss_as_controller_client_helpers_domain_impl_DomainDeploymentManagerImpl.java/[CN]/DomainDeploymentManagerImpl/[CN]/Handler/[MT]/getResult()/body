{
  Exception e=exception.get();
  if (e instanceof ExecutionException) {
    throw (ExecutionException)e;
  }
 else   if (e instanceof CancellationException) {
    throw (CancellationException)e;
  }
 else   if (e != null) {
    throw new ExecutionException(e);
  }
 else   if (state.get() == State.CANCELLED) {
    throw new CancellationException();
  }
 else {
    return result;
  }
}
