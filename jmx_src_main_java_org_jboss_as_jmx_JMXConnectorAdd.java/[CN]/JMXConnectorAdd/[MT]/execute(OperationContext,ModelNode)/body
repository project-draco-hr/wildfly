{
  final Resource subsystem=context.readResourceForUpdate(PathAddress.EMPTY_ADDRESS);
  final ModelNode model=subsystem.getModel();
  final String serverBinding=operation.require(CommonAttributes.SERVER_BINDING).asString();
  final String registryBinding=operation.require(CommonAttributes.REGISTRY_BINDING).asString();
  model.get(CommonAttributes.SERVER_BINDING).set(serverBinding);
  model.get(CommonAttributes.REGISTRY_BINDING).set(registryBinding);
  if (context.getType() == OperationContext.Type.SERVER) {
    context.addStep(new OperationStepHandler(){
      @Override public void execute(      final OperationContext context,      final ModelNode operation) throws OperationFailedException {
        final ServiceTarget target=context.getServiceTarget();
        final ServiceVerificationHandler verificationHandler=new ServiceVerificationHandler();
        JMXConnectorService.addService(target,serverBinding,registryBinding,verificationHandler);
        context.addStep(verificationHandler,OperationContext.Stage.VERIFY);
        if (context.completeStep() == OperationContext.ResultAction.ROLLBACK) {
          context.removeService(JMXConnectorService.SERVICE_NAME);
        }
      }
    }
,OperationContext.Stage.RUNTIME);
  }
  context.completeStep();
}
