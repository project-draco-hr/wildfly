{
  ApplicationArchiveProcessor archiveProcessor;
  if (isBundleArchive(testClass,appArchive)) {
    archiveProcessor=new OSGiApplicationArchiveProcessor();
  }
 else {
    archiveProcessor=new ModuleApplicationArchiveProcessor();
  }
  log.debugf("Process archive '%s' with: %s",appArchive.getName(),archiveProcessor);
  archiveProcessor.process(appArchive,testClass);
  ArchivePath manifestPath=ArchivePaths.create(JarFile.MANIFEST_NAME);
  Node node=appArchive.get(manifestPath);
  if (node == null) {
    log.errorf("Cannot find manifest in: %s",appArchive.getName());
  }
 else {
    ByteArrayOutputStream baos=new ByteArrayOutputStream();
    try {
      IOUtil.copy(node.getAsset().openStream(),baos);
    }
 catch (    IOException ex) {
    }
    log.debugf("Manifest for %s: \n%s",appArchive.getName(),new String(baos.toByteArray()));
  }
}
