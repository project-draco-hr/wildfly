{
  String secretKey=exchange.getRequestHeaders().getFirst(keyHeader);
  if (secretKey == null) {
    throw RemotingMessages.MESSAGES.upgradeRequestMissingKey();
  }
  String response=createExpectedResponse(magicNumber,secretKey);
  exchange.getResponseHeaders().put(HttpString.tryFromString(acceptHeader),response);
  return true;
}
