{
  if (count.decrementAndGet() == 0 || (!failedDependencies.isEmpty() && (count.get() - uninstalledCount.get()) == 0)) {
    target.removeListener(this);
    if (startExceptions.isEmpty() && failedDependencies.isEmpty()) {
      log.infof("Completed deployment of \"%s\" in %d ms",deploymentName,Long.valueOf((System.nanoTime() - startTime) / 1000000L));
      callback.handleComplete();
    }
 else {
      final StringBuilder builder=new StringBuilder("Deployment  \"%s\" failed in %d ms.  ");
      if (!startExceptions.isEmpty()) {
        builder.append("Service failures: ").append(startExceptions.values());
      }
      if (!failedDependencies.isEmpty()) {
        builder.append("Failed Dependencies: ").append(failedDependencies);
      }
      log.infof(builder.toString(),deploymentName,Long.valueOf((System.nanoTime() - startTime) / 1000000L));
      callback.handleFailure(startExceptions,failedDependencies);
    }
  }
}
