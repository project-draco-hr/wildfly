{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (!EjbDeploymentMarker.isEjbDeployment(deploymentUnit)) {
    return;
  }
  final EjbJarMetaData jarMetaData=deploymentUnit.getAttachment(EjbDeploymentAttachmentKeys.EJB_JAR_METADATA);
  if (jarMetaData == null || jarMetaData.getEnterpriseBeans() == null) {
    return;
  }
  final ModuleSpecification moduleSpecification=deploymentUnit.getAttachment(org.jboss.as.server.deployment.Attachments.MODULE_SPECIFICATION);
  final ModuleLoader moduleLoader=Module.getBootModuleLoader();
  for (  EnterpriseBeanMetaData beanMetaData : jarMetaData.getEnterpriseBeans()) {
    if (beanMetaData.isEntity() && EntityBeanMetaData.class.cast(beanMetaData).isCMP()) {
      moduleSpecification.addSystemDependency(new ModuleDependency(moduleLoader,CMP,false,false,true));
      return;
    }
  }
}
