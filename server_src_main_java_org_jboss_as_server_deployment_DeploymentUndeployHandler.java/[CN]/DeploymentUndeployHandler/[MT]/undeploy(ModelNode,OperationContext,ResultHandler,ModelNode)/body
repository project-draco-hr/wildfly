{
  if (context instanceof RuntimeOperationContext) {
    RuntimeOperationContext updateContext=(RuntimeOperationContext)context;
    String deploymentUnitName=model.require(NAME).asString();
    final ServiceName deploymentUnitServiceName=Services.deploymentUnitName(deploymentUnitName);
    final ServiceRegistry serviceRegistry=updateContext.getServiceRegistry();
    final ServiceController<?> controller=serviceRegistry.getService(deploymentUnitServiceName);
    controller.addListener(new AbstractServiceListener<Object>(){
      public void serviceRemoved(      ServiceController<?> controller){
        resultHandler.handleResultComplete(compensatingOp);
        controller.removeListener(this);
      }
    }
);
    controller.setMode(ServiceController.Mode.NEVER);
  }
 else {
    resultHandler.handleResultComplete(compensatingOp);
  }
}
