{
  if (!resolved) {
synchronized (this) {
      if (!resolved) {
        final Set<ViewDescription> views=getViews();
        final Set<EJBViewDescription> ejbsForViewName=new HashSet<EJBViewDescription>();
        for (        final ViewDescription view : views) {
          if (view instanceof EJBViewDescription) {
            final MethodIntf viewType=((EJBViewDescription)view).getMethodIntf();
            if (viewType == MethodIntf.SERVICE_ENDPOINT || viewType == MethodIntf.MESSAGE_ENDPOINT) {
              continue;
            }
            ejbsForViewName.add((EJBViewDescription)view);
          }
        }
        if (ejbsForViewName.isEmpty()) {
          if (beanName == null) {
            error=EjbMessages.MESSAGES.ejbNotFound(typeName,bindingName);
          }
 else {
            error=EjbMessages.MESSAGES.ejbNotFound(typeName,beanName,bindingName);
          }
        }
 else         if (ejbsForViewName.size() > 1) {
          if (beanName == null) {
            error=EjbMessages.MESSAGES.moreThanOneEjbFound(typeName,bindingName,ejbsForViewName);
          }
 else {
            error=EjbMessages.MESSAGES.moreThanOneEjbFound(typeName,beanName,bindingName,ejbsForViewName);
          }
          error="More than 1 component found for type '" + typeName + "' and bean name "+ beanName+ " for binding "+ bindingName;
        }
 else {
          final EJBViewDescription description=ejbsForViewName.iterator().next();
          final EJBViewDescription ejbViewDescription=(EJBViewDescription)description;
          if (ejbViewDescription.getMethodIntf() == MethodIntf.REMOTE || ejbViewDescription.getMethodIntf() == MethodIntf.HOME) {
            final EJBComponentDescription componentDescription=(EJBComponentDescription)description.getComponentDescription();
            final EEModuleDescription moduleDescription=componentDescription.getModuleDescription();
            final String earApplicationName=moduleDescription.getEarApplicationName();
            remoteFactory=new RemoteViewManagedReferenceFactory(earApplicationName,moduleDescription.getModuleName(),moduleDescription.getDistinctName(),componentDescription.getComponentName(),description.getViewClassName(),componentDescription.isStateful());
          }
          final ServiceName serviceName=description.getServiceName();
          resolvedViewName=serviceName;
        }
        resolved=true;
      }
    }
  }
}
