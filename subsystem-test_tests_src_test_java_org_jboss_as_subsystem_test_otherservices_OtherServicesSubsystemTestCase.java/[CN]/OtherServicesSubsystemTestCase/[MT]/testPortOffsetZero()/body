{
  ((OtherServicesSubsystemExtension)getMainExtension()).setAddHandler(SubsystemAddWithSocketBindingUserService.INSTANCE);
  String subsystemXml="<subsystem xmlns=\"" + SimpleSubsystemExtension.NAMESPACE + "\">"+ "</subsystem>";
  KernelServices services=createKernelServicesBuilder(new PortOffsetZeroInit()).setSubsystemXml(subsystemXml).build();
  ModelNode model=services.readWholeModel();
  Assert.assertTrue(model.get(SUBSYSTEM).hasDefined(OtherServicesSubsystemExtension.SUBSYSTEM_NAME));
  ModelNode group=model.require(SOCKET_BINDING_GROUP).require(ControllerInitializer.SOCKET_BINDING_GROUP_NAME);
  Assert.assertEquals(8000,group.require(PORT_OFFSET).asInt());
  ModelNode bindings=group.require(SOCKET_BINDING);
  Assert.assertEquals(1,bindings.asList().size());
  Assert.assertEquals(0,group.require(SOCKET_BINDING).require("test2").require(PORT).asInt());
  ServiceController<?> controller=services.getContainer().getService(SocketBindingUserService.NAME);
  Assert.assertNotNull(controller);
  SocketBindingUserService service=(SocketBindingUserService)controller.getValue();
  SocketBinding socketBinding=service.socketBindingValue.getValue();
  Assert.assertEquals(8000,socketBinding.getSocketBindings().getPortOffset());
  Assert.assertFalse("fixed port",socketBinding.isFixedPort());
  Assert.assertEquals(0,socketBinding.getPort());
  Assert.assertEquals(8000,socketBinding.getSocketAddress().getPort());
}
