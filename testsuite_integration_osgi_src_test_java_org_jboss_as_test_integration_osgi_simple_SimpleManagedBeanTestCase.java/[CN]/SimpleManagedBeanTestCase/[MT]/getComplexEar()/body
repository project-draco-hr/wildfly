{
  WebArchive war=ShrinkWrap.create(WebArchive.class,COMPLEX_WAR);
  war.addClasses(ComplexBeanServlet.class);
  JavaArchive jar=ShrinkWrap.create(JavaArchive.class,COMPLEX_CDI_JAR);
  jar.addClasses(ComplexManagedBean.class);
  jar.addAsManifestResource(EmptyAsset.INSTANCE,"beans.xml");
  jar.setManifest(new Asset(){
    @Override public InputStream openStream(){
      OSGiManifestBuilder builder=OSGiManifestBuilder.newInstance();
      builder.addBundleSymbolicName(COMPLEX_CDI_JAR);
      builder.addBundleManifestVersion(2);
      builder.addImportPackages(PaymentProvider.class);
      builder.addImportPackages(BundleContext.class,ServiceTracker.class,ManagedBean.class);
      return builder.openStream();
    }
  }
);
  JavaArchive visa=ShrinkWrap.create(JavaArchive.class,VISA_PROVIDER_BUNDLE);
  visa.addClasses(PaymentProviderActivatorVisa.class,PaymentProvider.class);
  visa.setManifest(new Asset(){
    @Override public InputStream openStream(){
      OSGiManifestBuilder builder=OSGiManifestBuilder.newInstance();
      builder.addBundleSymbolicName(VISA_PROVIDER_BUNDLE);
      builder.addBundleManifestVersion(2);
      builder.addBundleActivator(PaymentProviderActivatorVisa.class);
      builder.addExportPackages(PaymentProvider.class);
      builder.addImportPackages(PaymentProvider.class,BundleActivator.class);
      return builder.openStream();
    }
  }
);
  JavaArchive paypal=ShrinkWrap.create(JavaArchive.class,PAYPAL_PROVIDER_BUNDLE);
  paypal.addClasses(PaymentProviderActivatorPaypal.class,PaymentProvider.class);
  paypal.setManifest(new Asset(){
    @Override public InputStream openStream(){
      OSGiManifestBuilder builder=OSGiManifestBuilder.newInstance();
      builder.addBundleSymbolicName(PAYPAL_PROVIDER_BUNDLE);
      builder.addBundleManifestVersion(2);
      builder.addBundleActivator(PaymentProviderActivatorPaypal.class);
      builder.addExportPackages(PaymentProvider.class);
      builder.addImportPackages(PaymentProvider.class,BundleActivator.class);
      return builder.openStream();
    }
  }
);
  EnterpriseArchive ear=ShrinkWrap.create(EnterpriseArchive.class,COMPLEX_EAR);
  ear.addAsModule(war);
  ear.addAsModule(jar);
  ear.addAsModule(visa);
  ear.addAsModule(paypal);
  return ear;
}
