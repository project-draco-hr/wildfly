{
  final int port=12345;
  KernelServices services=createKernelServicesBuilder(new AdditionalInitialization(){
    @Override protected void setupController(    ControllerInitializer controllerInitializer){
      controllerInitializer.addSocketBinding("test",port);
    }
    @Override protected void addExtraServices(    ServiceTarget target){
      AbsolutePathService.addService(ServerEnvironment.CONTROLLER_TEMP_DIR,new File("target/temp" + System.currentTimeMillis()).getAbsolutePath(),target);
    }
  }
).setSubsystemXmlResource("remoting-with-threads.xml").build();
  CurrentConnectorAndController current=CurrentConnectorAndController.create(services,RemotingServices.SUBSYSTEM_ENDPOINT,RemotingServices.serverServiceName("test-connector"));
  updateAndCheckThreadAttribute(services,current,CommonAttributes.WORKER_READ_THREADS,5,6);
  updateAndCheckThreadAttribute(services,current,CommonAttributes.WORKER_TASK_CORE_THREADS,6,2);
  updateAndCheckThreadAttribute(services,current,CommonAttributes.WORKER_TASK_KEEPALIVE,7,3);
  updateAndCheckThreadAttribute(services,current,CommonAttributes.WORKER_TASK_LIMIT,8,4);
  updateAndCheckThreadAttribute(services,current,CommonAttributes.WORKER_TASK_MAX_THREADS,9,5);
  updateAndCheckThreadAttribute(services,current,CommonAttributes.WORKER_WRITE_THREADS,10,6);
}
