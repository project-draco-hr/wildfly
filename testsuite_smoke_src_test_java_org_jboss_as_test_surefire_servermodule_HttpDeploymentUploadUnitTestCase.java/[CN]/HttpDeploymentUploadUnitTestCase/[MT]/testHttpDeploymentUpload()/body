{
  BufferedOutputStream os=null;
  BufferedInputStream is=null;
  try {
    final HttpURLConnection connection=(HttpURLConnection)new URL(UPLOAD_URL).openConnection();
    connection.setDoInput(true);
    connection.setDoOutput(true);
    connection.setRequestMethod(POST_REQUEST_METHOD);
    final WebArchive archive=ShrinkWrapUtils.createWebArchive(TEST_WAR);
    os=new BufferedOutputStream(connection.getOutputStream());
    is=new BufferedInputStream(archive.as(ZipExporter.class).exportZip());
    writeRequest(is,os);
    final ModelNode node=readResult(connection.getInputStream());
    assertNotNull(node);
    assertEquals(SUCCESS,node.require(OUTCOME).asString());
  }
 catch (  final Exception e) {
    fail("Exception not expected: " + e.getMessage());
  }
 finally {
    closeQuietly(is);
    closeQuietly(os);
  }
}
