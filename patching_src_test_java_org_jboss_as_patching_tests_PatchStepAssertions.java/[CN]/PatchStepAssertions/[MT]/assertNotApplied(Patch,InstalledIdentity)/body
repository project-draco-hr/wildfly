{
  final PatchableTarget.TargetInfo identity=installedIdentity.getIdentity().loadTargetInfo();
  assertNotApplied(patch.getIdentity().getPatchType(),patch.getPatchId(),identity);
  assertDoesNotExists(identity.getDirectoryStructure().getInstalledImage().getPatchHistoryDir(patch.getPatchId()));
  for (  final PatchElement element : patch.getElements()) {
    final PatchElementProvider provider=element.getProvider();
    final PatchableTarget target=provider.isAddOn() ? installedIdentity.getAddOn(provider.getName()) : installedIdentity.getLayer(provider.getName());
    Assert.assertNotNull(target);
    assertNotApplied(provider.getPatchType(),element.getId(),target.loadTargetInfo());
  }
}
