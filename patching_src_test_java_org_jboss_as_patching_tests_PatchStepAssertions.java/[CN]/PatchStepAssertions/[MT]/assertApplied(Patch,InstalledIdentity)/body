{
  final PatchableTarget.TargetInfo identity=installedIdentity.getIdentity().loadTargetInfo();
  assertIsApplied(patch.getIdentity().getPatchType(),patch.getPatchId(),installedIdentity.getIdentity().loadTargetInfo());
  assertExists(identity.getDirectoryStructure().getInstalledImage().getPatchHistoryDir(patch.getPatchId()));
  for (  final PatchElement element : patch.getElements()) {
    final PatchElementProvider provider=element.getProvider();
    final PatchableTarget target=provider.isAddOn() ? installedIdentity.getAddOn(provider.getName()) : installedIdentity.getLayer(provider.getName());
    assertIsApplied(provider.getPatchType(),element.getId(),target.loadTargetInfo());
  }
}
