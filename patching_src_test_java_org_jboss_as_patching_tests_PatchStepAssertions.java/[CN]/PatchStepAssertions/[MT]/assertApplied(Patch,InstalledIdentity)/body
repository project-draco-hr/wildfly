{
  final String patchID=patch.getPatchId();
  final PatchableTarget target=installedIdentity.getIdentity();
  final PatchableTarget.TargetInfo identity=target.loadTargetInfo();
  assertIsApplied(patch.getIdentity().getPatchType(),patchID,identity);
  assertExists(identity.getDirectoryStructure().getInstalledImage().getPatchHistoryDir(patchID));
  assertContentItems(patchID,target,patch.getModifications());
  for (  final PatchElement element : patch.getElements()) {
    final PatchElementProvider provider=element.getProvider();
    final PatchableTarget targetElement=provider.isAddOn() ? installedIdentity.getAddOn(provider.getName()) : installedIdentity.getLayer(provider.getName());
    assertIsApplied(provider.getPatchType(),element.getId(),targetElement.loadTargetInfo());
    assertContentItems(element.getId(),targetElement,element.getModifications());
  }
}
