{
  String xml=readResource(resourceFileName);
  KernelServices services=super.installInController(AdditionalInitialization.MANAGEMENT,xml);
  ModelNode model=services.readWholeModel();
  if (archiveName != null)   ConnectorServices.unregisterResourceIdentifiers(archiveName);
  String marshalled=services.getPersistedSubsystemXml();
  if (checkMarshalledXML)   Assert.assertEquals(normalizeXML(xml),normalizeXML(marshalled));
  services=super.installInController(AdditionalInitialization.MANAGEMENT,marshalled);
  ModelNode modelReloaded=services.readWholeModel();
  compare(model,modelReloaded);
  assertRemoveSubsystemResources(services);
  return model;
}
