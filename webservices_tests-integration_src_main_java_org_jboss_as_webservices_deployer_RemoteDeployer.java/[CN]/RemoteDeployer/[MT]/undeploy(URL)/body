{
synchronized (archiveCounters) {
    String k=archiveURL.toString();
    int count=archiveCounters.get(k);
    if (count > 1) {
      archiveCounters.put(k,(count - 1));
      return;
    }
 else {
      archiveCounters.remove(k);
    }
    final DeploymentPlanBuilder builder=deploymentManager.newDeploymentPlan();
    final String uniqueName=url2Id.get(archiveURL);
    if (uniqueName != null) {
      final DeploymentPlan plan=builder.undeploy(uniqueName).remove(uniqueName).build();
      final DeploymentAction deployAction=builder.getLastAction();
      try {
        executeDeploymentPlan(plan,deployAction);
      }
  finally {
        url2Id.remove(archiveURL);
      }
    }
  }
}
