{
  try {
    final ServerDeploymentPlanResult planResult=deploymentManager.execute(plan).get();
    if (deployAction != null) {
      final ServerDeploymentActionResult actionResult=planResult.getDeploymentActionResult(deployAction.getId());
      if (actionResult != null) {
        final Exception deploymentException=(Exception)actionResult.getDeploymentException();
        if (deploymentException != null)         throw deploymentException;
      }
    }
  }
 catch (  final Exception e) {
    LOGGER.fatal(e.getMessage(),e);
    throw e;
  }
 finally {
    client.close();
    deploymentManager.close();
  }
}
