{
  Properties properties=pu.getProperties();
  if (properties.getProperty(Environment.CACHE_REGION_PREFIX) == null) {
    properties.put(Environment.CACHE_REGION_PREFIX,pu.getScopedPersistenceUnitName());
  }
  String regionFactory=properties.getProperty(Environment.CACHE_REGION_FACTORY);
  if (regionFactory == null) {
    regionFactory=DEFAULT_REGION_FACTORY;
    properties.setProperty(Environment.CACHE_REGION_FACTORY,regionFactory);
  }
  if (regionFactory.equals(DEFAULT_REGION_FACTORY)) {
    String container=properties.getProperty(InfinispanRegionFactory.CACHE_CONTAINER);
    if (container == null) {
      container=InfinispanRegionFactory.DEFAULT_CACHE_CONTAINER;
      properties.setProperty(InfinispanRegionFactory.CACHE_CONTAINER,container);
    }
    String entity=properties.getProperty(InfinispanRegionFactory.ENTITY_CACHE_RESOURCE_PROP,InfinispanRegionFactory.DEF_ENTITY_RESOURCE);
    String collection=properties.getProperty(InfinispanRegionFactory.COLLECTION_CACHE_RESOURCE_PROP,InfinispanRegionFactory.DEF_ENTITY_RESOURCE);
    String query=properties.getProperty(InfinispanRegionFactory.QUERY_CACHE_RESOURCE_PROP,InfinispanRegionFactory.DEF_QUERY_RESOURCE);
    String timestamps=properties.getProperty(InfinispanRegionFactory.TIMESTAMPS_CACHE_RESOURCE_PROP,InfinispanRegionFactory.DEF_QUERY_RESOURCE);
    builder.addDependency(CacheConfigurationService.getServiceName(container,entity));
    builder.addDependency(CacheConfigurationService.getServiceName(container,collection));
    builder.addDependency(CacheConfigurationService.getServiceName(container,timestamps));
    builder.addDependency(CacheConfigurationService.getServiceName(container,query));
  }
}
