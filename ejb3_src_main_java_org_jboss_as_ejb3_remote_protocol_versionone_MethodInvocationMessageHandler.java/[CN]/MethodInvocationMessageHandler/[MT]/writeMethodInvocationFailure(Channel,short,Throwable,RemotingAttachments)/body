{
  final DataOutputStream outputStream=new DataOutputStream(channel.writeMessage());
  try {
    outputStream.write(HEADER_METHOD_INVOCATION_APPLICATION_EXCEPTION);
    outputStream.writeShort(invocationId);
    this.writeAttachments(outputStream,attachments);
    final Marshaller marshaller=MarshallerFactory.createMarshaller(this.marshallingStrategy);
    marshaller.start(outputStream);
    marshaller.writeObject(error);
    marshaller.finish();
  }
  finally {
    outputStream.close();
  }
}
