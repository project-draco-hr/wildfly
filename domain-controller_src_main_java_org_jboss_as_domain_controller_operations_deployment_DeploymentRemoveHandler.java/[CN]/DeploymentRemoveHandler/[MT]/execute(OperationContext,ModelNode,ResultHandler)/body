{
  final ModelNode model=context.getSubModel();
  final ModelNode compensatingOp=DeploymentAddHandler.getOperation(operation.get(OP_ADDR),model);
  if (model.hasDefined(START) && model.get(START).asBoolean()) {
    String msg=String.format("Deployment %s must be undeployed before being removed",model.get(NAME).asString());
    throw new OperationFailedException(new ModelNode().set(msg));
  }
 else {
    resultHandler.handleResultComplete();
  }
  return new BasicOperationResult(compensatingOp);
}
