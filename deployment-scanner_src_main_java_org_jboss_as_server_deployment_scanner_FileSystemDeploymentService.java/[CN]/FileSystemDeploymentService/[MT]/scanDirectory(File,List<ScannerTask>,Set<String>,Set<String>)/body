{
  final File[] children=directory.listFiles(filter);
  if (children == null) {
    return;
  }
  for (  File child : children) {
    final String fileName=child.getName();
    if (fileName.endsWith(DEPLOYED)) {
      final String deploymentName=fileName.substring(0,fileName.length() - DEPLOYED.length());
      toRemove.remove(deploymentName);
      if (!deployed.containsKey(deploymentName)) {
        if (!child.delete()) {
          log.warnf("Cannot removed extraneous deployment marker file %s",fileName);
        }
      }
      if (deployed.get(deploymentName).lastModified != child.lastModified()) {
        events.add(new RedeployTask(deploymentName,child.lastModified(),directory));
      }
    }
 else     if (fileName.endsWith(DO_DEPLOY)) {
      final String deploymentName=fileName.substring(0,fileName.length() - DO_DEPLOY.length());
      final File deploymentFile=new File(directory,deploymentName);
      if (!deploymentFile.exists()) {
        if (!ignoredMissingDeployments.contains(deploymentName)) {
          log.warnf("Deployment of '%s' requested, but the deployment is not present",deploymentFile);
          ignoredMissingDeployments.add(deploymentName);
        }
        continue;
      }
 else {
        ignoredMissingDeployments.remove(deploymentName);
      }
      if (registeredDeployments.contains(deploymentName)) {
        events.add(new ReplaceTask(deploymentName,deploymentFile,child.lastModified()));
      }
 else {
        events.add(new DeployTask(deploymentName,deploymentFile,child.lastModified()));
      }
      toRemove.remove(deploymentName);
    }
 else     if (fileName.endsWith(FAILED_DEPLOY)) {
      final String deploymentName=fileName.substring(0,fileName.length() - FAILED_DEPLOY.length());
      toRemove.remove(deploymentName);
    }
 else     if (isEEArchive(fileName) && !noticeLogged.contains(fileName) && !deployed.containsKey(fileName)&& !new File(fileName + DO_DEPLOY).exists()&& !new File(fileName + FAILED_DEPLOY).exists()) {
      noticeLogged.add(fileName);
      log.infof("Found %s in deployment directory. To trigger deployment create a file called %s%s",fileName,fileName,DO_DEPLOY);
    }
 else     if (child.isDirectory()) {
      if (!isEEArchive(fileName)) {
        scanDirectory(child,events,registeredDeployments,toRemove);
      }
    }
  }
}
