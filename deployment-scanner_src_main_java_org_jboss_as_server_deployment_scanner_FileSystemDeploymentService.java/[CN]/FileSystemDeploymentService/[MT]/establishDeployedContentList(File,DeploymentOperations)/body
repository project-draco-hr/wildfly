{
  final Set<String> deploymentNames=deploymentOperations.getDeploymentsStatus().keySet();
  final File[] children=dir.listFiles();
  if (children == null || children.length == 0) {
    return;
  }
  for (  File child : children) {
    final String fileName=child.getName();
    if (child.isDirectory()) {
      if (!isEEArchive(fileName)) {
        establishDeployedContentList(child,deploymentOperations);
      }
    }
 else     if (fileName.endsWith(DEPLOYED)) {
      final String deploymentName=fileName.substring(0,fileName.length() - DEPLOYED.length());
      if (deploymentNames.contains(deploymentName)) {
        File deployment=new File(dir,deploymentName);
        deployed.put(deploymentName,new DeploymentMarker(child.lastModified(),!deployment.isDirectory()));
      }
 else {
        if (!child.delete()) {
          ROOT_LOGGER.cannotRemoveDeploymentMarker(fileName);
        }
        File skipDeploy=new File(dir,deploymentName + SKIP_DEPLOY);
        if (!skipDeploy.exists()) {
          final File deployedMarker=new File(dir,deploymentName + DO_DEPLOY);
          createMarkerFile(deployedMarker,deploymentName);
        }
      }
    }
  }
}
