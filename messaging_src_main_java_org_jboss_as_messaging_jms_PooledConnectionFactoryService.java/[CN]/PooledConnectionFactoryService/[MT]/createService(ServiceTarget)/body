{
  InputStream is=null;
  InputStream isIj=null;
  List<ConfigProperty16> properties=new ArrayList<ConfigProperty16>();
  try {
    StringBuilder connectorClassname=new StringBuilder();
    StringBuilder connectorParams=new StringBuilder();
    for (    String connector : connectors) {
      TransportConfiguration tc=hornetQService.getValue().getConfiguration().getConnectorConfigurations().get(connector);
      if (tc == null) {
        throw new IllegalStateException("connector " + connector + " not defined");
      }
      if (connectorClassname.length() > 0) {
        connectorClassname.append(",");
        connectorParams.append(",");
      }
      connectorClassname.append(tc.getFactoryClassName());
      Map<String,Object> params=tc.getParams();
      boolean multiple=false;
      for (      Map.Entry<String,Object> entry : params.entrySet()) {
        if (multiple) {
          connectorParams.append(";");
        }
        connectorParams.append(entry.getKey()).append("=").append(entry.getValue());
        multiple=true;
      }
    }
    if (connectorClassname.length() > 0) {
      properties.add(simpleProperty(CONNECTOR_CLASSNAME,STRING_TYPE,connectorClassname.toString()));
    }
    if (connectorParams.length() > 0) {
      properties.add(simpleProperty(CONNECTION_PARAMETERS,STRING_TYPE,connectorParams.toString()));
    }
    for (    PooledConnectionFactoryConfigProperties adapterParam : adapterParams) {
      properties.add(simpleProperty(adapterParam.getName(),adapterParam.getType(),adapterParam.getValue()));
    }
    OutboundResourceAdapter outbound=createOutbound();
    InboundResourceAdapter inbound=createInbound();
    ResourceAdapter1516 ra=createResourceAdapter(properties,outbound,inbound);
    Connector16 cmd=createConnector(ra);
    CommonConnDef common=createConnDef(jndiName);
    IronJacamar ijmd=createIron(common,txSupport);
    ResourceAdapterActivatorService activator=new ResourceAdapterActivatorService(cmd,ijmd,HornetQResourceAdapter.class.getClassLoader(),name);
    serviceTarget.addService(ConnectorServices.RESOURCE_ADAPTER_ACTIVATOR_SERVICE,activator).addDependency(ConnectorServices.IRONJACAMAR_MDR,MetadataRepository.class,activator.getMdrInjector()).addDependency(ConnectorServices.RA_REPOSISTORY_SERVICE,ResourceAdapterRepository.class,activator.getRaRepositoryInjector()).addDependency(ConnectorServices.MANAGEMENT_REPOSISTORY_SERVICE,ManagementRepository.class,activator.getManagementRepositoryInjector()).addDependency(ConnectorServices.RESOURCE_ADAPTER_REGISTRY_SERVICE,ResourceAdapterDeploymentRegistry.class,activator.getRegistryInjector()).addDependency(ConnectorServices.TRANSACTION_INTEGRATION_SERVICE,TransactionIntegration.class,activator.getTxIntegrationInjector()).addDependency(ConnectorServices.CONNECTOR_CONFIG_SERVICE,JcaSubsystemConfiguration.class,activator.getConfigInjector()).addDependency(SubjectFactoryService.SERVICE_NAME,SubjectFactory.class,activator.getSubjectFactoryInjector()).addDependency(ConnectorServices.CCM_SERVICE,CachedConnectionManager.class,activator.getCcmInjector()).addDependency(NamingService.SERVICE_NAME).addDependency(TxnServices.JBOSS_TXN_TRANSACTION_MANAGER).setInitialMode(ServiceController.Mode.ACTIVE).install();
  }
  finally {
    if (is != null)     is.close();
    if (isIj != null)     isIj.close();
  }
}
