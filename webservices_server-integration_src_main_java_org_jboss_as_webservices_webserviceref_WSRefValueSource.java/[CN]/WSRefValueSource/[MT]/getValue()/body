{
  final ClassLoader oldCL=WildFlySecurityManager.getCurrentContextClassLoaderPrivileged();
  try {
    final ClassLoader integrationCL=new DelegateClassLoader(ClassLoaderProvider.getDefaultProvider().getServerIntegrationClassLoader(),classLoader);
    WildFlySecurityManager.setCurrentContextClassLoaderPrivileged(integrationCL);
    final ServiceRefFactory serviceRefFactory=getServiceRefFactory();
    return serviceRefFactory.newServiceRef(serviceRef);
  }
  finally {
    WildFlySecurityManager.setCurrentContextClassLoaderPrivileged(oldCL);
  }
}
