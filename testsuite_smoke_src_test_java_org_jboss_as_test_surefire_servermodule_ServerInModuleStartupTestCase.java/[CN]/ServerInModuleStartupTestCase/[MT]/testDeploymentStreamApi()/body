{
  final JavaArchive archive=ShrinkWrapUtils.createJavaArchive("servermodule/test-deployment.sar",Simple.class.getPackage());
  final ServerDeploymentManager manager=ServerDeploymentManager.Factory.create(InetAddress.getByName("localhost"),9999);
  testDeployments(new DeploymentExecutor(){
    @Override public void initialDeploy(){
      Future<?> future=manager.execute(manager.newDeploymentPlan().withRollback().add("test-deployment.sar",archive.as(ZipExporter.class).exportZip()).deploy("test-deployment.sar").build());
      awaitDeploymentExecution(future);
    }
    @Override public void fullReplace(){
      Future<?> future=manager.execute(manager.newDeploymentPlan().withRollback().replace("test-deployment.sar",archive.as(ZipExporter.class).exportZip()).build());
      awaitDeploymentExecution(future);
    }
    @Override public void undeploy(){
      Future<?> future=manager.execute(manager.newDeploymentPlan().withRollback().undeploy("test-deployment.sar").remove("test-deployment.sar").build());
      awaitDeploymentExecution(future);
    }
  }
);
}
