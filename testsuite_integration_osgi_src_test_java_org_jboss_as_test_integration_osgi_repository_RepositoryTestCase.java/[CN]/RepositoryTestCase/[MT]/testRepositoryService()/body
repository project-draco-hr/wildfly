{
  XRepository repo=FrameworkUtils.waitForService(context,XRepository.class);
  MavenCoordinates coordinates=MavenCoordinates.parse("org.apache.felix:org.apache.felix.eventadmin:1.2.6");
  XRequirement req=XRequirementBuilder.create(coordinates).getRequirement();
  assertNotNull("Requirement not null",req);
  Collection<Capability> caps=repo.findProviders(req);
  assertEquals("Capability not null",1,caps.size());
  Capability cap=caps.iterator().next();
  XResource resource=(XResource)cap.getResource();
  XIdentityCapability xcap=resource.getIdentityCapability();
  assertEquals("org.apache.felix.eventadmin",xcap.getSymbolicName());
  InputStream content=((RepositoryContent)xcap.getResource()).getContent();
  try {
    Bundle bundle=context.installBundle(xcap.getSymbolicName(),content);
    try {
      bundle.start();
      Assert.assertEquals(Bundle.ACTIVE,bundle.getState());
      ServiceReference<?> sref=context.getServiceReference("org.osgi.service.event.EventAdmin");
      assertNotNull("EventAdmin service not null",sref);
    }
  finally {
      bundle.uninstall();
    }
  }
  finally {
    content.close();
  }
}
