{
  isInTx=TransactionUtil.isInTx();
  if (isInTx) {
    EntityManager existing=TransactionUtil.getTransactionScopedEntityManager(puScopedName);
    if (existing != null && existing != this) {
      throw MESSAGES.cannotUseExtendedPersistenceTransaction(puScopedName,existing,this);
    }
 else     if (existing == null) {
      TransactionUtil.registerExtendedUnderlyingWithTransaction(puScopedName,this,underlyingEntityManager);
    }
  }
}
