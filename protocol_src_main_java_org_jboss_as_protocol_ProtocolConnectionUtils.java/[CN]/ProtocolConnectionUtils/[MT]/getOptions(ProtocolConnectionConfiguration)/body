{
  final Map<String,String> saslOptions=configuration.getSaslOptions();
  final OptionMap.Builder builder=OptionMap.builder();
  builder.addAll(configuration.getOptionMap());
  builder.set(SASL_POLICY_NOANONYMOUS,Boolean.FALSE);
  builder.set(SASL_POLICY_NOPLAINTEXT,Boolean.FALSE);
  if (isLocal(configuration.getUri()) == false) {
    builder.set(Options.SASL_DISALLOWED_MECHANISMS,Sequence.of(JBOSS_LOCAL_USER));
  }
  List<Property> tempProperties=new ArrayList<Property>(saslOptions != null ? saslOptions.size() : 1);
  tempProperties.add(Property.of("jboss.sasl.local-user.quiet-auth","true"));
  if (saslOptions != null) {
    for (    String currentKey : saslOptions.keySet()) {
      tempProperties.add(Property.of(currentKey,saslOptions.get(currentKey)));
    }
  }
  builder.set(Options.SASL_PROPERTIES,Sequence.of(tempProperties));
  builder.set(Options.SSL_ENABLED,true);
  builder.set(Options.SSL_STARTTLS,true);
  return builder.getMap();
}
