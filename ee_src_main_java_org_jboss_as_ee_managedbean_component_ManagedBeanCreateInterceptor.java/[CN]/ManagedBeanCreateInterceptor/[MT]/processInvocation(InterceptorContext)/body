{
  final AtomicReference<ComponentInstance> componentInstanceReference=this.componentInstanceReference;
  final Component component=context.getPrivateData(Component.class);
  final ComponentInstance componentInstance=component.createInstance();
  boolean ok=false;
  try {
    context.putPrivateData(ComponentInstance.class,componentInstance);
    componentInstanceReference.set(componentInstance);
    final Object result=context.proceed();
    ok=true;
    return result;
  }
  finally {
    context.putPrivateData(ComponentInstance.class,null);
    if (!ok) {
      componentInstance.destroy();
      componentInstanceReference.set(null);
    }
  }
}
