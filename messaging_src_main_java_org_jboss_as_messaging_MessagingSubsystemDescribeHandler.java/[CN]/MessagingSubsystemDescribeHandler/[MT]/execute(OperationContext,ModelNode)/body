{
  final Resource resource=context.readResource(PathAddress.EMPTY_ADDRESS);
  final ModelNode subModel=Resource.Tools.readModel(resource);
  final ModelNode subsystemAdd=new ModelNode();
  PathAddress rootAddress=PathAddress.pathAddress(PathAddress.pathAddress(operation.require(OP_ADDR)).getLastElement());
  subsystemAdd.get(OP).set(ADD);
  subsystemAdd.get(OP_ADDR).set(rootAddress.toModelNode());
  final ModelNode result=context.getResult();
  result.add(subsystemAdd);
  if (subModel.hasDefined(CommonAttributes.HORNETQ_SERVER)) {
    for (    Property prop : subModel.get(CommonAttributes.HORNETQ_SERVER).asPropertyList()) {
      ModelNode serverAdd=new ModelNode();
      serverAdd.get(OP).set(ADD);
      PathAddress serverAddress=rootAddress.append(PathElement.pathElement(CommonAttributes.HORNETQ_SERVER,prop.getName()));
      serverAdd.get(OP_ADDR).set(serverAddress.toModelNode());
      addHornetQServer(prop.getValue(),serverAdd,serverAddress,result);
    }
  }
  if (subModel.hasDefined(CommonAttributes.JMS_BRIDGE)) {
    for (    Property prop : subModel.get(CommonAttributes.JMS_BRIDGE).asPropertyList()) {
      PathAddress jmsBridgeAddress=rootAddress.append(PathElement.pathElement(CommonAttributes.JMS_BRIDGE,prop.getName()));
      result.add(JMSBridgeAdd.getAddOperation(jmsBridgeAddress.toModelNode(),prop.getValue()));
    }
  }
  context.completeStep();
}
