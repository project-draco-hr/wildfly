{
  final ModelNode subsystemAdd=new ModelNode();
  final ModelNode subModel=context.readModel(PathAddress.EMPTY_ADDRESS);
  PathAddress rootAddress=PathAddress.pathAddress(PathAddress.pathAddress(operation.require(OP_ADDR)).getLastElement());
  subsystemAdd.get(OP).set(ADD);
  subsystemAdd.get(OP_ADDR).set(rootAddress.toModelNode());
  for (  final AttributeDefinition attribute : CommonAttributes.SIMPLE_ROOT_RESOURCE_ATTRIBUTES) {
    String attrName=attribute.getName();
    if (subModel.hasDefined(attrName)) {
      subsystemAdd.get(attrName).set(subModel.get(attrName));
    }
  }
  for (  final String attribute : MessagingSubsystemProviders.MESSAGING_ROOT_ATTRIBUTES) {
    if (subModel.hasDefined(attribute)) {
      subsystemAdd.get(attribute).set(subModel.get(attribute));
    }
  }
  final ModelNode result=context.getResult();
  result.add(subsystemAdd);
  if (subModel.hasDefined(CommonAttributes.CONNECTION_FACTORY)) {
    for (    final Property property : subModel.get(CommonAttributes.CONNECTION_FACTORY).asPropertyList()) {
      final ModelNode address=rootAddress.toModelNode();
      address.add(CommonAttributes.CONNECTION_FACTORY,property.getName());
      result.add(ConnectionFactoryAdd.getAddOperation(address,property.getValue()));
    }
  }
  if (subModel.hasDefined(CommonAttributes.QUEUE)) {
    for (    final Property property : subModel.get(CommonAttributes.QUEUE).asPropertyList()) {
      final ModelNode address=rootAddress.toModelNode();
      address.add(CommonAttributes.QUEUE,property.getName());
      result.add(JMSQueueAdd.getOperation(address,property.getValue()));
    }
  }
  if (subModel.hasDefined(CommonAttributes.JMS_TOPIC)) {
    for (    final Property property : subModel.get(CommonAttributes.JMS_TOPIC).asPropertyList()) {
      final ModelNode address=rootAddress.toModelNode();
      address.add(CommonAttributes.JMS_TOPIC,property.getName());
      result.add(JMSTopicAdd.getOperation(address,property.getValue()));
    }
  }
  if (subModel.hasDefined(CommonAttributes.POOLED_CONNECTION_FACTORY)) {
    for (    final Property property : subModel.get(CommonAttributes.POOLED_CONNECTION_FACTORY).asPropertyList()) {
      final ModelNode address=rootAddress.toModelNode();
      address.add(CommonAttributes.POOLED_CONNECTION_FACTORY,property.getName());
      result.add(PooledConnectionFactoryAdd.getAddOperation(address,property.getValue()));
    }
  }
  context.completeStep();
}
