{
  PathAddress address=PathAddress.pathAddress(operation.get(ModelDescriptionConstants.OP_ADDR));
  String name=address.getLastElement().getValue();
  context.removeService(KeyAffinityServiceFactoryService.getServiceName(name));
  String jndiName=ModelNodes.asString(CacheContainerResourceDefinition.JNDI_NAME.resolveModelAttribute(context,model));
  context.removeService(CacheContainerAddHandler.createCacheContainerBinding(jndiName,name).getBinderServiceName());
  context.removeService(EmbeddedCacheManagerService.getServiceName(name));
  context.removeService(EmbeddedCacheManagerConfigurationService.getServiceName(name));
  if (model.hasDefined(TransportResourceDefinition.PATH.getKey())) {
    removeServices(context,ClusteredGroupServiceInstaller.class,name);
    context.removeService(ChannelService.createChannelBinding(name).getBinderServiceName());
    context.removeService(ChannelService.getServiceName(name));
    context.removeService(ChannelService.getFactoryServiceName(name));
  }
 else {
    removeServices(context,LocalGroupServiceInstaller.class,name);
  }
  String defaultCache=ModelNodes.asString(CacheContainerResourceDefinition.DEFAULT_CACHE.resolveModelAttribute(context,model));
  if ((defaultCache != null) && !defaultCache.equals(CacheContainer.DEFAULT_CACHE_ALIAS)) {
    Class<? extends CacheServiceInstaller> installerClass=model.hasDefined(TransportResourceDefinition.PATH.getKey()) ? ClusteredCacheServiceInstaller.class : LocalCacheServiceInstaller.class;
    for (    CacheServiceInstaller installer : ServiceLoader.load(installerClass,installerClass.getClassLoader())) {
      for (      ServiceName serviceName : installer.getServiceNames(name,CacheContainer.DEFAULT_CACHE_ALIAS)) {
        context.removeService(serviceName);
      }
    }
  }
}
