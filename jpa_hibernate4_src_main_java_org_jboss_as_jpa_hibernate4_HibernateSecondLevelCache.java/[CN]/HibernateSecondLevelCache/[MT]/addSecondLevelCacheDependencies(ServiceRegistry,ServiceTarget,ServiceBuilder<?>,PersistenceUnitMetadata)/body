{
  Properties properties=pu.getProperties();
  if (properties.getProperty(AvailableSettings.CACHE_REGION_PREFIX) == null) {
    String name=pu.getScopedPersistenceUnitName();
    if (name != null) {
      properties.setProperty(AvailableSettings.CACHE_REGION_PREFIX,name);
    }
  }
  String regionFactory=properties.getProperty(AvailableSettings.CACHE_REGION_FACTORY);
  if (regionFactory == null) {
    regionFactory=DEFAULT_REGION_FACTORY;
    properties.setProperty(AvailableSettings.CACHE_REGION_FACTORY,regionFactory);
  }
  if (regionFactory.equals(DEFAULT_REGION_FACTORY)) {
    String container=properties.getProperty(InfinispanRegionFactory.CACHE_CONTAINER);
    if (container == null) {
      container=InfinispanRegionFactory.DEFAULT_CACHE_CONTAINER;
      properties.setProperty(InfinispanRegionFactory.CACHE_CONTAINER,container);
    }
    builder.addDependency(DependencyType.OPTIONAL,ChannelService.getServiceName(container));
    String entity=properties.getProperty(InfinispanRegionFactory.ENTITY_CACHE_RESOURCE_PROP,InfinispanRegionFactory.DEF_ENTITY_RESOURCE);
    String collection=properties.getProperty(InfinispanRegionFactory.COLLECTION_CACHE_RESOURCE_PROP,InfinispanRegionFactory.DEF_ENTITY_RESOURCE);
    builder.addDependency(CacheConfigurationService.getServiceName(container,entity));
    builder.addDependency(CacheConfigurationService.getServiceName(container,collection));
    if (Boolean.parseBoolean(properties.getProperty(AvailableSettings.USE_QUERY_CACHE))) {
      String query=properties.getProperty(InfinispanRegionFactory.QUERY_CACHE_RESOURCE_PROP,InfinispanRegionFactory.DEF_QUERY_RESOURCE);
      String timestamps=properties.getProperty(InfinispanRegionFactory.TIMESTAMPS_CACHE_RESOURCE_PROP,InfinispanRegionFactory.DEF_QUERY_RESOURCE);
      builder.addDependency(CacheConfigurationService.getServiceName(container,timestamps));
      builder.addDependency(CacheConfigurationService.getServiceName(container,query));
    }
  }
}
