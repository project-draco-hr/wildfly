{
  ArquillianConfig config=context.getAttachment(ArquillianConfig.ATTACHMENT_KEY);
  if (config == null) {
    return;
  }
  final Index index=context.getAttachment(AnnotationIndexProcessor.ATTACHMENT_KEY);
  if (index == null) {
    return;
  }
  final Module module=context.getAttachment(ModuleDeploymentProcessor.MODULE_ATTACHMENT_KEY);
  if (module == null) {
    throw new DeploymentUnitProcessingException("Arquillian annotation processing requires a module.");
  }
  List<Class<?>> testClasses=new ArrayList<Class<?>>();
  addJunitTestClasses(testClasses,module,index,JUNIT_ANNOTATION_NAME);
  if (testClasses.size() > 0) {
    config.setTestClasses(testClasses);
    context.putAttachment(ArquillianConfig.ATTACHMENT_KEY,config);
  }
}
