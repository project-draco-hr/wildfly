{
  FrameworkFactory factory=new EmbeddedFrameworkFactory();
  Framework framework=factory.newFramework(null);
  try {
    Assert.assertEquals(Bundle.INSTALLED,framework.getState());
    framework.init();
    BundleContext syscontext=framework.getBundleContext();
    Bundle bundle=installBundle(syscontext,getBundleA());
    Assert.assertEquals(Bundle.INSTALLED,bundle.getState());
    Assert.assertNotNull("BundleContext not null",framework.getBundleContext());
    framework.stop();
    Assert.assertNull("BundleContext null",framework.getBundleContext());
    FrameworkEvent stopEvent=framework.waitForStop(TimeoutUtil.adjust(20));
    Assert.assertEquals(FrameworkEvent.STOPPED,stopEvent.getType());
  }
  finally {
    framework.stop();
    framework.waitForStop(5000);
  }
}
