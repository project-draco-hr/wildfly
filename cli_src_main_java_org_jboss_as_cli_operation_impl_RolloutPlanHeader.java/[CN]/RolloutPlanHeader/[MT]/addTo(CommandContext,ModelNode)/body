{
  if (planRef != null) {
    final OperationRequestHeader rolloutPlan=ctx.getConfig().getRolloutPlan(planRef);
    if (rolloutPlan == null) {
      throw new CommandFormatException("Rollout plan with id '" + planRef + "' could not be found.");
    }
    rolloutPlan.addTo(ctx,headers);
    return;
  }
  ModelNode header=headers.get(HEADER_NAME);
  final ModelNode series=header.get(Util.IN_SERIES);
  for (  RolloutPlanGroup group : groups) {
    group.addTo(series);
  }
  if (props != null) {
    for (    String propName : props.keySet()) {
      header.get(propName).set(props.get(propName));
    }
  }
}
