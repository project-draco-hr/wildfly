{
  if (Thread.currentThread().isInterrupted()) {
    cancelled=true;
  }
  if (cancelled) {
    if (activeStep != null) {
      activeStep.response.get(OUTCOME).set(CANCELLED);
      activeStep.response.get(FAILURE_DESCRIPTION).set(ControllerLogger.ROOT_LOGGER.operationCancelled());
      activeStep.response.get(ROLLED_BACK).set(true);
    }
    resultAction=ResultAction.ROLLBACK;
  }
 else   if (activeStep != null && activeStep.response.hasDefined(FAILURE_DESCRIPTION) && (isRollbackOnRuntimeFailure() || currentStage == Stage.MODEL)) {
    activeStep.response.get(OUTCOME).set(FAILED);
    activeStep.response.get(ROLLED_BACK).set(true);
    resultAction=ResultAction.ROLLBACK;
  }
  return resultAction != ResultAction.ROLLBACK;
}
