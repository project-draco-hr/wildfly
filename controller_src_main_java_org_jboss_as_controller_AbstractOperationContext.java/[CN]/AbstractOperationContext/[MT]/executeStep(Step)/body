{
  step.predecessor=this.activeStep;
  this.activeStep=step;
  try {
    try {
      ClassLoader oldTccl=SecurityActions.setThreadContextClassLoader(step.handler.getClass());
      try {
        step.handler.execute(this,step.operation);
      }
  finally {
        SecurityActions.setThreadContextClassLoader(oldTccl);
      }
    }
 catch (    OperationFailedException ofe) {
      if (currentStage != Stage.DONE) {
        step.response.get(FAILURE_DESCRIPTION).set(ofe.getFailureDescription());
        ROOT_LOGGER.operationFailed(step.operation.get(OP),step.operation.get(OP_ADDR),step.response.get(FAILURE_DESCRIPTION));
        completeStep();
      }
 else {
        throw ofe;
      }
    }
  }
 catch (  Throwable t) {
    if (t instanceof StackOverflowError) {
      ROOT_LOGGER.operationFailed(t,step.operation.get(OP),step.operation.get(OP_ADDR),AbstractControllerService.BOOT_STACK_SIZE_PROPERTY,AbstractControllerService.DEFAULT_BOOT_STACK_SIZE);
    }
 else {
      ROOT_LOGGER.operationFailed(t,step.operation.get(OP),step.operation.get(OP_ADDR));
    }
    if (currentStage != Stage.DONE) {
      if (!step.response.hasDefined(FAILURE_DESCRIPTION)) {
        step.response.get(FAILURE_DESCRIPTION).set(MESSAGES.operationHandlerFailed(t.getLocalizedMessage()));
      }
      step.response.get(OUTCOME).set(FAILED);
      resultAction=getFailedResultAction(t);
      if (resultAction == ResultAction.ROLLBACK) {
        step.response.get(ROLLED_BACK).set(true);
      }
    }
 else {
      report(MessageSeverity.WARN,MESSAGES.stepHandlerFailed(step.handler));
    }
  }
 finally {
    boolean finalize=true;
    if (step.rollbackHandler != null) {
      if (!hasMoreSteps()) {
        completeStep();
      }
 else {
        finalize=false;
      }
    }
    if (finalize) {
      step.finalizeStep();
    }
  }
}
