{
  AbstractOperationContext.this.activeStep=this;
  try {
    handleResult();
    if (currentStage != null && currentStage != Stage.DONE) {
      currentStage=Stage.DONE;
      if (!response.hasDefined(FAILURE_DESCRIPTION)) {
        response.get(FAILURE_DESCRIPTION).set(ControllerLogger.ROOT_LOGGER.operationHandlerFailedToComplete());
      }
      response.get(OUTCOME).set(cancelled ? CANCELLED : FAILED);
      response.get(ROLLED_BACK).set(true);
      resultAction=getFailedResultAction(null);
    }
 else     if (resultAction == ResultAction.ROLLBACK) {
      response.get(OUTCOME).set(cancelled ? CANCELLED : FAILED);
      response.get(ROLLED_BACK).set(true);
    }
 else {
      response.get(OUTCOME).set(response.hasDefined(FAILURE_DESCRIPTION) ? FAILED : SUCCESS);
    }
  }
  finally {
    releaseStepLocks(this);
    if (predecessor == null) {
      currentStage=null;
    }
  }
}
