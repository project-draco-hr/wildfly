{
  State retryState=stateValues.isSilentOrNonInteractive() ? null : new PromptNewUserState(theConsole,stateValues);
  if (Arrays.equals(stateValues.getUserName().toCharArray(),stateValues.getPassword())) {
    return new ErrorState(theConsole,MESSAGES.usernamePasswordMatch(),retryState);
  }
  for (  char currentChar : stateValues.getUserName().toCharArray()) {
    if ((!isValidPunctuation(currentChar)) && (Character.isLetter(currentChar) || Character.isDigit(currentChar)) == false) {
      return new ErrorState(theConsole,MESSAGES.usernameNotAlphaNumeric(),retryState);
    }
  }
  boolean weakUserName=false;
  for (  String current : BAD_USER_NAMES) {
    if (current.equals(stateValues.getUserName().toLowerCase(Locale.ENGLISH))) {
      weakUserName=true;
      break;
    }
  }
  State continuingState=new DuplicateUserCheckState(theConsole,stateValues);
  if (weakUserName && stateValues.isSilentOrNonInteractive() == false) {
    String message=MESSAGES.usernameEasyToGuess(stateValues.getUserName());
    String prompt=MESSAGES.sureToAddUser(stateValues.getUserName());
    State noState=new PromptNewUserState(theConsole,stateValues);
    return new ConfirmationChoice(theConsole,message,prompt,continuingState,noState);
  }
  PasswordCheckResult result=PasswordCheckUtil.INSTANCE.check(false,stateValues.getUserName(),new String(stateValues.getPassword()));
  if (result.getResult() == PasswordCheckResult.Result.WARN && stateValues.isSilentOrNonInteractive() == false) {
    String message=result.getMessage();
    String prompt=MESSAGES.sureToSetPassword(new String(stateValues.getPassword()));
    State noState=new PromptNewUserState(theConsole,stateValues);
    return new ConfirmationChoice(theConsole,message,prompt,continuingState,noState);
  }
  if (result.getResult() == PasswordCheckResult.Result.REJECT) {
    return new ErrorState(theConsole,result.getMessage(),retryState);
  }
  return continuingState;
}
