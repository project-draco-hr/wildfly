{
  PathAddress stackAddress=PathAddress.pathAddress(operation.get(OP_ADDR));
  String stackName=stackAddress.getLastElement().getValue();
  ServiceName factoryServiceName=ChannelFactoryService.getServiceName(stackName);
  ServiceController<?> channelFactoryServiceController=context.getServiceRegistry(false).getService(factoryServiceName);
  if (channelFactoryServiceController.getState() != ServiceController.State.UP) {
    return null;
  }
  ChannelFactory factory=ChannelFactory.class.cast(channelFactoryServiceController.getValue());
  return factory;
}
