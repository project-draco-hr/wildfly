{
  logger.info("Received message " + message + " in MDB "+ this.getClass().getName());
  try {
    if (message.getStringProperty("MessageFormat") != null)     logger.info("MessageFormat property = " + message.getStringProperty("MessageFormat"));
    Queue destination=(Queue)message.getJMSReplyTo();
    if (destination == null) {
      try {
        destination=(Queue)this.ctx.lookup("jms/replyQueue");
      }
 catch (      Throwable optional) {
      }
    }
    if (destination != null) {
      logger.info("replying to " + destination);
      final TextMessage tm=(TextMessage)message;
      final String text=tm.getText() + "processed by: " + hashCode();
      final QueueSender sender=session.createSender(destination);
      final TextMessage reply=session.createTextMessage(text);
      reply.setJMSCorrelationID(message.getJMSMessageID());
      sender.send(reply);
      sender.close();
    }
  }
 catch (  Exception e) {
    logger.error(e);
    throw new EJBException(e);
  }
}
