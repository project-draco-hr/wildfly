{
  phaseContext.addToAttachmentList(Attachments.NEXT_PHASE_DEPS,NamingService.SERVICE_NAME);
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final ServiceName serviceName=serviceName(deploymentUnit.getServiceName());
  final RuntimeBindReleaseService service=new RuntimeBindReleaseService(deploymentUnit.getAttachmentList(org.jboss.as.naming.deployment.Attachments.SHARED_BINDER_SERVICES));
  final ServiceBuilder<?> serviceBuilder=phaseContext.getServiceTarget().addService(serviceName,service);
  serviceBuilder.addDependencies(deploymentUnit.getAttachmentList(Attachments.JNDI_DEPENDENCIES));
  if (deploymentUnit.getParent() != null) {
    serviceBuilder.addDependencies(deploymentUnit.getParent().getAttachment(Attachments.JNDI_DEPENDENCIES));
  }
  serviceBuilder.addDependency(NamingService.SERVICE_NAME);
  serviceBuilder.install();
}
