{
  final State continuingState;
  if (stateValues.isExistingUser()) {
    continuingState=new UpdateUser(theConsole,stateValues);
  }
 else {
    State addState=new AddUserState(theConsole,stateValues);
    if (stateValues.isSilentOrNonInteractive()) {
      continuingState=addState;
    }
 else {
      String message=DomainManagementLogger.ROOT_LOGGER.aboutToAddUser(stateValues.getUserName(),stateValues.getRealm());
      String prompt=DomainManagementLogger.ROOT_LOGGER.isCorrectPrompt() + " " + DomainManagementLogger.ROOT_LOGGER.yes()+ "/"+ DomainManagementLogger.ROOT_LOGGER.no()+ "?";
      continuingState=new ConfirmationChoice(theConsole,message,prompt,addState,new PromptNewUserState(theConsole,stateValues));
    }
  }
  return continuingState;
}
