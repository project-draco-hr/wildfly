{
  long lastRespawn=0;
  Object lastId=getProcessId("KillMe",CrashingProcess.class);
  for (int i=0; i < 3; i++) {
    ProcessExitCodeAndShutDownLatch stopLatch=getStopTestProcessListenerLatch("KillMe");
    detachTestProcessListener("KillMe");
    long killStart=System.currentTimeMillis();
    killProcess("KillMe",CrashingProcess.class);
    assertTrue("Failed for " + i,stopLatch.await(2000,TimeUnit.MILLISECONDS));
    assertTrue(0 != stopLatch.getExitCode());
    listener.shutdown();
    listener=getTestProcessListener("KillMe",2000);
    if (i == 2) {
      assertNull(listener);
    }
 else {
      assertNotNull("Iteration " + i,listener);
      long respawn=System.currentTimeMillis() - killStart;
      assertTrue(respawn + "<" + lastRespawn+ " for iteration "+ i,respawn >= lastRespawn);
      lastRespawn=respawn;
      Object id=getProcessId("KillMe",CrashingProcess.class);
      assertFalse(lastId.equals(id));
      lastId=id;
    }
  }
}
