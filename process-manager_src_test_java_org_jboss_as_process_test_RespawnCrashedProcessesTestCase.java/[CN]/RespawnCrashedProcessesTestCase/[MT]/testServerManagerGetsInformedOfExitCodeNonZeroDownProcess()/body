{
  if (true)   return;
  addProcess("ServerManager",CaptureDownFromPmProcess.class);
  TestProcessListenerStream smListener=startTestProcessListenerAndWait("ServerManager");
  addProcess("Down",CrashingProcess.class);
  TestProcessListenerStream procListener=startTestProcessListenerAndWait("Down");
  ProcessExitCodeAndShutDownLatch stopLatch=getStopTestProcessListenerLatch("Down");
  detachTestProcessListener("Down");
  procListener.exitProcess(1);
  assertEquals("Down-Exit1",procListener.readMessage());
  assertTrue(stopLatch.await(1000,TimeUnit.MILLISECONDS));
  assertEquals(1,stopLatch.getExitCode());
  assertEquals("Down is down",smListener.readMessage());
}
