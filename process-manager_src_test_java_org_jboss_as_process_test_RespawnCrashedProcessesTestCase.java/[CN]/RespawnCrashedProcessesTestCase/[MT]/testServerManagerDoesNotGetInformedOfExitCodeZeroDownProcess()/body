{
  addProcess("ServerManager",CaptureDownFromPmProcess.class);
  TestProcessListenerStream smListener=startTestProcessListenerAndWait("ServerManager");
  addProcess("Down",CrashingProcess.class);
  TestProcessListenerStream procListener=startTestProcessListenerAndWait("Down");
  ProcessExitCodeAndShutDownLatch stopLatch=getStopTestProcessListenerLatch("Down");
  detachTestProcessListener("Down");
  procListener.exitProcess(0);
  assertEquals("Down-Exit0",procListener.readMessage());
  assertTrue(stopLatch.await(1000,TimeUnit.MILLISECONDS));
  assertEquals(0,stopLatch.getExitCode());
  assertNull(smListener.readMessage(2000));
  stopTestProcessListenerAndWait(smListener);
  removeProcess("ServerManager");
}
