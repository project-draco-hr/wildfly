{
  addProcess("Main",CrashingProcess.class,new TestRespawnPolicy());
  TestProcessListenerStream listener=startTestProcessListenerAndWait("Main");
  ProcessExitCodeAndShutDownLatch stopLatch=getStopTestProcessListenerLatch("Main");
  Object id=getProcessId("Main",CrashingProcess.class);
  detachTestProcessListener("Main");
  sendMessage("Test","Main",lazyList("Exit1"));
  assertEquals("Main-Exit1",listener.readMessage());
  assertTrue(stopLatch.await(1000,TimeUnit.MILLISECONDS));
  assertEquals(1,stopLatch.getExitCode());
  listener=getTestProcessListener("Main",1000);
  assertNotNull(listener);
  assertFalse(id.equals(getProcessId("Main",CrashingProcess.class)));
  assertTrue(id != getProcessId("Main",CrashingProcess.class));
  stopTestProcessListenerAndWait(listener);
  removeProcess("Main");
}
