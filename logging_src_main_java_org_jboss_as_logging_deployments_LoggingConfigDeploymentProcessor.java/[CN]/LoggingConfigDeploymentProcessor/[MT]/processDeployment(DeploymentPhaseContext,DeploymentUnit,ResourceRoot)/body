{
  if (Boolean.valueOf(WildFlySecurityManager.getPropertyPrivileged(PER_DEPLOYMENT_LOGGING,Boolean.toString(true)))) {
    LoggingLogger.ROOT_LOGGER.trace("Scanning for logging configuration files.");
    final List<DeploymentUnit> subDeployments=getSubDeployments(deploymentUnit);
    final VirtualFile configFile=findConfigFile(root);
    if (configFile != null) {
      final Module module=deploymentUnit.getAttachment(Attachments.MODULE);
      final LogContext logContext;
      if (isLog4jConfiguration(configFile.getName())) {
        logContext=LogContext.create(true);
      }
 else {
        logContext=LogContext.create();
      }
      if (configure(configFile,module.getClassLoader(),logContext)) {
        registerLogContext(deploymentUnit,module,logContext);
      }
 else {
        return;
      }
      for (      DeploymentUnit subDeployment : subDeployments) {
        if (subDeployment.hasAttachment(Attachments.DEPLOYMENT_ROOT)) {
          processDeployment(phaseContext,subDeployment,subDeployment.getAttachment(Attachments.DEPLOYMENT_ROOT));
        }
        if (subDeployment.hasAttachment(Attachments.MODULE) && !hasRegisteredLogContext(subDeployment)) {
          final Module subDeploymentModule=subDeployment.getAttachment(Attachments.MODULE);
          if (subDeploymentModule != null) {
            registerLogContext(subDeployment,subDeploymentModule,logContext);
          }
        }
      }
    }
 else {
      for (      DeploymentUnit subDeployment : subDeployments) {
        if (subDeployment.hasAttachment(Attachments.DEPLOYMENT_ROOT)) {
          processDeployment(phaseContext,subDeployment,subDeployment.getAttachment(Attachments.DEPLOYMENT_ROOT));
        }
      }
    }
  }
}
