{
  String accountName=null;
  String realm=null;
  Set<String> groups=null;
  for (  Principal current : theSet) {
    String expectedRealm=current.getRealm();
switch (current.getType()) {
case USER:
      if (expectedRealm != null) {
        if (current.getName().equals((accountName=getAccountName(caller,accountName))) && expectedRealm.equals((realm=getRealmName(caller,realm)))) {
          return current;
        }
      }
 else {
        if (current.getName().equals((accountName=getAccountName(caller,accountName)))) {
          return current;
        }
      }
    break;
case GROUP:
  if (expectedRealm != null) {
    if ((groups=getGroups(caller,groups)).contains(current.getName()) && expectedRealm.equals((realm=getRealmName(caller,realm)))) {
      return current;
    }
  }
 else {
    if ((groups=getGroups(caller,groups)).contains(current.getName())) {
      return current;
    }
  }
break;
}
}
return null;
}
