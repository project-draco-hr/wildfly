{
  if (isConnected == false)   throw new IllegalStateException(MESSAGES.deploymentManagerNotConnected());
  ROOT_LOGGER.debugf("getRunningModules [type=%s,targets=%s]",moduleType,Arrays.asList(targets));
  Set<TargetModuleExt> moduleSet=new HashSet<TargetModuleExt>();
  TargetModuleID[] availableModules=getAvailableModules(moduleType,targets);
  if (availableModules == null) {
    ROOT_LOGGER.debugf("No modules available");
    return null;
  }
  for (int i=0; i < availableModules.length; i++) {
    TargetModuleExt moduleID=(TargetModuleExt)availableModules[i];
    if (moduleID.isRunning()) {
      moduleSet.add(moduleID);
    }
  }
  ROOT_LOGGER.debugf("Found [%d] running modules",moduleSet.size());
  TargetModuleID[] idarr=new TargetModuleID[moduleSet.size()];
  moduleSet.toArray(idarr);
  return idarr;
}
