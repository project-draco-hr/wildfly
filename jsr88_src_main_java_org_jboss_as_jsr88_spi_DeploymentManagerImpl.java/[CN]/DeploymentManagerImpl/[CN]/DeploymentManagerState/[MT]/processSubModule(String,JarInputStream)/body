{
  File tmpModule=getTempFile(entryName);
  FileOutputStream fos=new FileOutputStream(tmpModule);
  JarUtils.copyStream(fos,jis);
  fos.close();
  JarInputStream jisModule=new JarInputStream(new FileInputStream(tmpModule));
  File tmpJBossModule=getTempFile("jboss_" + entryName);
  JarOutputStream jos=null;
  fos=new FileOutputStream(tmpJBossModule);
  Manifest manifest=jisModule.getManifest();
  if (manifest != null)   jos=new JarOutputStream(fos,manifest);
 else   jos=new JarOutputStream(fos);
  JarEntry entry=jisModule.getNextJarEntry();
  while (entry != null) {
    String subEntryName=entry.getName();
    if (getDescriptorFile(entryName + "!/" + subEntryName) == null)     JarUtils.addJarEntry(jos,subEntryName,jisModule);
 else     ROOT_LOGGER.debugf("Skip entry found in deployment plan: %s",subEntryName);
    entry=jisModule.getNextJarEntry();
  }
  jisModule.close();
  addDeploymentPlanEntry(jos,entryName);
  jos.close();
  return tmpJBossModule;
}
