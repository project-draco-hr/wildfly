{
  boolean firstError=true;
  BufferedReader reader=new BufferedReader(new InputStreamReader(stream));
  Connection connection=null;
  try {
    connection=datasource.getConnection();
    if (connection == null) {
      log.errorf("Cannot obtain connection");
      return;
    }
    Statement statement=connection.createStatement();
    try {
      String nextStatement="";
      String nextLine;
      while ((nextLine=reader.readLine()) != null) {
        log.debug("Statement Obtained=" + nextLine);
        nextLine=nextLine.trim();
        if (nextLine.indexOf("--") != -1)         continue;
        int semicolon=nextLine.indexOf(";");
        if (semicolon != -1) {
          nextStatement+=nextLine.substring(0,semicolon);
          try {
            log.debug("Statement to execute:" + nextStatement);
            statement.execute(nextStatement);
          }
 catch (          SQLException e) {
            String err="Could not execute a statement of juddi script::";
            if (firstError) {
              log.debug(err + e.getLocalizedMessage() + " "+ nextStatement);
              log.debug("Your settings are:dropOnStart =" + config.isDropOnStart() + ";createOnStart ="+ config.isCreateOnStart());
              log.debug("dropOnStop = " + config.isDropOnStop());
              firstError=false;
            }
          }
          nextStatement=nextLine.substring(semicolon + 1);
        }
 else {
          nextStatement+=nextLine;
        }
      }
      if (!nextStatement.equals("")) {
        try {
          log.debug("Statement to execute:" + nextStatement);
          statement.execute(nextStatement);
        }
 catch (        SQLException e) {
          log.debug("Could not execute last statement of a juddi init script: " + e.getLocalizedMessage());
          log.debug("Your settings are:dropOnStart =" + config.isDropOnStart() + ";createOnStart ="+ config.isCreateOnStart());
          log.debug("dropOnStop = " + config.isDropOnStop());
        }
      }
    }
  finally {
      if (statement != null)       statement.close();
    }
  }
  finally {
    if (connection != null)     connection.close();
  }
}
