{
  InitialContext ictx=new InitialContext();
  try {
    ictx.lookup("testscheme:testing/123");
  }
 catch (  NameNotFoundException nnfe) {
  }
  ObjectFactory of=new TestObjectFactory();
  BundleContext context=bundle.getBundleContext();
  Dictionary<String,Object> props=new Hashtable<String,Object>();
  props.put("osgi.jndi.url.scheme",new String[]{"testscheme"});
  ServiceRegistration reg=context.registerService(ObjectFactory.class.getName(),of,props);
  boolean found=false;
  int i=0;
  while (i < 20) {
    try {
      assertEquals("Gotcha!",ictx.lookup("testscheme:testing/123"));
      found=true;
      break;
    }
 catch (    NameNotFoundException nnfe) {
    }
    i++;
    Thread.sleep(100);
  }
  assertTrue(found);
  reg.unregister();
  boolean gone=false;
  int j=0;
  while (j < 20) {
    try {
      ictx.lookup("testscheme:testing/123");
    }
 catch (    NameNotFoundException nnfe) {
      gone=true;
      break;
    }
    j++;
    Thread.sleep(100);
  }
  assertTrue(gone);
}
