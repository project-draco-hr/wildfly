{
  final ExecutorService executor=executorInjector.getValue();
  final Runnable task=new Runnable(){
    @Override public void run(){
      try {
        JPA_LOGGER.startingService("Persistence Unit",pu.getScopedPersistenceUnitName());
        pu.setTempClassLoaderFactory(new TempClassLoaderFactoryImpl(classLoader));
        pu.setJtaDataSource(jtaDataSource.getOptionalValue());
        pu.setNonJtaDataSource(nonJtaDataSource.getOptionalValue());
        WritableServiceBasedNamingStore.pushOwner(context.getController().getServiceContainer().subTarget());
        entityManagerFactory=createContainerEntityManagerFactory();
        persistenceUnitRegistry.add(getScopedPersistenceUnitName(),getValue());
        context.complete();
      }
 catch (      Throwable t) {
        context.failed(new StartException(t));
      }
 finally {
        pu.setTempClassLoaderFactory(null);
        WritableServiceBasedNamingStore.popOwner();
      }
    }
  }
;
  context.asynchronous();
  executor.execute(task);
}
