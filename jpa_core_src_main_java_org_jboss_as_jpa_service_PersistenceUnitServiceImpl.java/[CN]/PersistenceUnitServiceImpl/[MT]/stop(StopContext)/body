{
  JPA_LOGGER.stoppingService("Persistence Unit",pu.getScopedPersistenceUnitName());
  if (entityManagerFactory != null) {
    WritableServiceBasedNamingStore.pushOwner(context.getController().getServiceContainer().subTarget());
    try {
      entityManagerFactory.close();
    }
  finally {
      entityManagerFactory=null;
      pu.setTempClassLoaderFactory(null);
      WritableServiceBasedNamingStore.popOwner();
    }
  }
}
