{
  final ExecutorService executor=executorInjector.getValue();
  final Runnable task=new Runnable(){
    @Override public void run(){
      JPA_LOGGER.stoppingService("Persistence Unit",pu.getScopedPersistenceUnitName());
      if (entityManagerFactory != null) {
        WritableServiceBasedNamingStore.pushOwner(deploymentUnitServiceName);
        try {
          entityManagerFactory.close();
        }
 catch (        Throwable t) {
          JPA_LOGGER.failedToStopPUService(t,pu.getScopedPersistenceUnitName());
        }
 finally {
          entityManagerFactory=null;
          pu.setTempClassLoaderFactory(null);
          WritableServiceBasedNamingStore.popOwner();
          persistenceUnitRegistry.remove(getScopedPersistenceUnitName());
        }
      }
      context.complete();
    }
  }
;
  context.asynchronous();
  executor.execute(task);
}
