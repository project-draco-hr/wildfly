{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final Boolean ear=deploymentUnit.getAttachment(Attachments.EAR_DEPLOYMENT_MARKER);
  if (ear == null || !ear) {
    return;
  }
  final ResourceRoot deploymentRoot=deploymentUnit.getAttachment(Attachments.DEPLOYMENT_ROOT);
  final AttachmentList<ResourceRoot> resourceRoots=deploymentUnit.getAttachment(Attachments.RESOURCE_ROOTS);
  for (  ResourceRoot resourceRoot : resourceRoots) {
    Boolean earLib=resourceRoot.getAttachment(Attachments.EAR_LIB_RESOURCE_MARKER);
    if (earLib != null && earLib) {
      continue;
    }
    if (SubDeploymentMarker.isSubDeployment(resourceRoot)) {
      continue;
    }
    String pathName=resourceRoot.getRoot().getPathNameRelativeTo(deploymentRoot.getRoot());
    ModuleIdentifier identifier=ModuleIdentifier.create(ServiceModuleLoader.MODULE_PREFIX + deploymentUnit.getName() + "."+ pathName);
    AdditionalModuleImpl module=new AdditionalModuleImpl(identifier,resourceRoot);
    deploymentUnit.addToAttachmentList(Attachments.ADDITIONAL_MODULES,module);
  }
}
