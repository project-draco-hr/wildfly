{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (deploymentUnit.getParent() != null) {
    return;
  }
  final ResourceRoot deploymentRoot=deploymentUnit.getAttachment(Attachments.DEPLOYMENT_ROOT);
  final AttachmentList<ResourceRoot> resourceRoots=deploymentUnit.getAttachment(Attachments.RESOURCE_ROOTS);
  if (resourceRoots != null) {
    for (    ResourceRoot resourceRoot : resourceRoots) {
      if (ResourceRootTypeMarker.isType(ResourceRootType.EAR_LIB_JAR,resourceRoot)) {
        continue;
      }
      if (ResourceRootTypeMarker.isSubDeployment(resourceRoot)) {
        continue;
      }
      String pathName=resourceRoot.getRoot().getPathNameRelativeTo(deploymentRoot.getRoot());
      ModuleIdentifier identifier=ModuleIdentifier.create(ServiceModuleLoader.MODULE_PREFIX + deploymentUnit.getName() + "."+ pathName);
      AdditionalModuleSpecification module=new AdditionalModuleSpecification(identifier,resourceRoot);
      deploymentUnit.addToAttachmentList(Attachments.ADDITIONAL_MODULES,module);
    }
  }
}
