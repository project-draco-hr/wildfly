{
  MultipartHeader currentHeader=null;
  if (!boundaryStream.isOuterStreamClosed()) {
    int separatorCounter=0;
    byte[] separatorBuffer=new byte[POST_HEADER_BOUNDARY.length];
    final ByteArrayOutputStream bos=new ByteArrayOutputStream();
    try {
      while (separatorCounter < POST_HEADER_BOUNDARY.length) {
        int current=boundaryStream.read();
        if (current == POST_HEADER_BOUNDARY[separatorCounter]) {
          separatorBuffer[separatorCounter]=(byte)current;
          separatorCounter++;
        }
 else {
          if (separatorCounter > 0) {
            bos.write(separatorBuffer,0,separatorCounter);
          }
          bos.write(current);
          separatorCounter=0;
        }
      }
    }
  finally {
      bos.flush();
      bos.close();
    }
    currentHeader=new MultipartHeader(bos.toByteArray());
  }
  return currentHeader;
}
