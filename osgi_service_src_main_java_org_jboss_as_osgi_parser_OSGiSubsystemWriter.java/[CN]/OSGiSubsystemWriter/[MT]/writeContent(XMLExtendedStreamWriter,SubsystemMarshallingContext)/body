{
  context.startSubsystemElement(Namespace.CURRENT.getUriString(),false);
  ModelNode node=context.getModelNode();
  if (node.hasDefined(ModelConstants.ACTIVATION)) {
    OSGiRootResource.ACTIVATION.marshallAsAttribute(node,writer);
  }
  if (node.hasDefined(ModelConstants.PROPERTY)) {
    writer.writeStartElement(Element.PROPERTIES.getLocalName());
    ModelNode properties=node.get(ModelConstants.PROPERTY);
    for (    String key : new TreeSet<String>(properties.keys())) {
      String val=properties.get(key).get(ModelConstants.VALUE).asString();
      writer.writeStartElement(Element.PROPERTY.getLocalName());
      writer.writeAttribute(Attribute.NAME.getLocalName(),key);
      writer.writeCharacters(val);
      writer.writeEndElement();
    }
    writer.writeEndElement();
  }
  if (node.hasDefined(ModelConstants.CAPABILITY)) {
    writer.writeStartElement(Element.CAPABILITIES.getLocalName());
    ModelNode modules=node.get(ModelConstants.CAPABILITY);
    for (    String key : modules.keys()) {
      ModelNode moduleNode=modules.get(key);
      writer.writeEmptyElement(Element.CAPABILITY.getLocalName());
      writer.writeAttribute(Attribute.NAME.getLocalName(),key);
      if (moduleNode.hasDefined(ModelConstants.STARTLEVEL)) {
        FrameworkCapabilityResource.STARTLEVEL.marshallAsAttribute(moduleNode,writer);
      }
    }
    writer.writeEndElement();
  }
  writer.writeEndElement();
}
