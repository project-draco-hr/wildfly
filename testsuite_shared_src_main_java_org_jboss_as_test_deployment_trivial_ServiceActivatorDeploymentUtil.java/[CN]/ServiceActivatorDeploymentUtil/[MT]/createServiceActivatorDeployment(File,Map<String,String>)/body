{
  final JavaArchive archive=ShrinkWrap.create(JavaArchive.class);
  archive.addClass(ServiceActivatorDeployment.class);
  archive.addAsServiceProvider(ServiceActivator.class,ServiceActivatorDeployment.class);
  if (properties != null && properties.size() > 0) {
    StringBuilder sb=new StringBuilder();
    for (    Map.Entry<String,String> prop : properties.entrySet()) {
      sb.append(prop.getKey());
      sb.append('=');
      sb.append(prop.getValue());
      sb.append("\n");
    }
    archive.addAsManifestResource(new StringAsset("Dependencies: org.jboss.msc\n"),"MANIFEST.MF");
    archive.addAsResource(new StringAsset(sb.toString()),ServiceActivatorDeployment.PROPERTIES_RESOURCE);
  }
  archive.as(ZipExporter.class).exportTo(destination);
}
