{
  final XMLMapper mapper=XMLMapper.Factory.create();
  final ByteArrayOutputStream baos=new ByteArrayOutputStream();
  final BufferedOutputStream bos=new BufferedOutputStream(baos);
  final XMLStreamWriter xmlWriter=XMLOutputFactory.newInstance().createXMLStreamWriter(bos);
  try {
    mapper.deparseDocument(new RootElementWriter(element,content),xmlWriter);
    xmlWriter.close();
  }
 catch (  XMLStreamException e) {
    xmlWriter.close();
    bos.close();
    baos.close();
    System.out.println("XML Content that was written prior to exception:");
    System.out.println(new String(baos.toByteArray()));
    throw e;
  }
 finally {
    bos.close();
    baos.close();
  }
  return new String(baos.toByteArray());
}
