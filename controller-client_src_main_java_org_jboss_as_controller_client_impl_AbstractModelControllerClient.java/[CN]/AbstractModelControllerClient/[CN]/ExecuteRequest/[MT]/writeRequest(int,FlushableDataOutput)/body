{
  try {
    log.tracef("Client writing request %d",getBatchId());
    activeRequests.put(getBatchId(),executeRequestContext);
    output.write(ModelControllerProtocol.PARAM_OPERATION);
    operation.writeExternal(output);
    output.write(ModelControllerProtocol.PARAM_INPUTSTREAMS_LENGTH);
    int inputStreamLength=0;
    if (executeRequestContext.getAttachments() != null) {
      List<InputStream> streams=executeRequestContext.getAttachments().getInputStreams();
      if (streams != null) {
        inputStreamLength=streams.size();
      }
    }
    output.writeInt(inputStreamLength);
    log.tracef("Client wrote request %d successfully",getBatchId());
  }
 catch (  Exception e) {
    log.tracef(e,"Client wrote request %d with error",getBatchId());
    super.setError(e);
    if (e instanceof IOException) {
      throw (IOException)e;
    }
    if (e instanceof RuntimeException) {
      throw (RuntimeException)e;
    }
    throw new IOException(e);
  }
}
