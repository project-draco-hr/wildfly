{
  KernelServices kernelServices=createKernelServices();
  File file=writeToFile("Test-file1",1,2,3,4,5);
  ModelNode content=new ModelNode();
  content.get(PATH).set(file.getAbsolutePath());
  ModelNode op=createAddOperation(kernelServices,"Test1",content);
  kernelServices.executeForFailure(op);
  content.get(ARCHIVE).set(true);
  op=createAddOperation(kernelServices,"Test1",content);
  ModelTestUtils.checkOutcome(kernelServices.executeOperation(op));
  ModelNode deployedContent=checkSingleUnmanagedDeployment(kernelServices,"Test1",false);
  checkUnmanagedContents(file,deployedContent,true,true);
  op=Util.createOperation(DeploymentDeployHandler.OPERATION_NAME,getPathAddress("Test1"));
  kernelServices.validateOperation(op);
  ModelTestUtils.checkOutcome(kernelServices.executeOperation(op));
  deployedContent=checkSingleUnmanagedDeployment(kernelServices,"Test1",true);
  checkUnmanagedContents(file,deployedContent,true,true);
  op=Util.createOperation(DeploymentUndeployHandler.OPERATION_NAME,getPathAddress("Test1"));
  kernelServices.validateOperation(op);
  ModelTestUtils.checkOutcome(kernelServices.executeOperation(op));
  deployedContent=checkSingleUnmanagedDeployment(kernelServices,"Test1",false);
  checkUnmanagedContents(file,deployedContent,true,true);
  op=Util.createOperation(DeploymentDeployHandler.OPERATION_NAME,getPathAddress("Test1"));
  kernelServices.validateOperation(op);
  ModelTestUtils.checkOutcome(kernelServices.executeOperation(op));
  deployedContent=checkSingleUnmanagedDeployment(kernelServices,"Test1",true);
  checkUnmanagedContents(file,deployedContent,true,true);
  op=Util.createOperation(DeploymentRemoveHandler.OPERATION_NAME,getPathAddress("Test1"));
  kernelServices.validateOperation(op);
  ModelTestUtils.checkOutcome(kernelServices.executeOperation(op));
  checkNoDeployments(kernelServices);
}
