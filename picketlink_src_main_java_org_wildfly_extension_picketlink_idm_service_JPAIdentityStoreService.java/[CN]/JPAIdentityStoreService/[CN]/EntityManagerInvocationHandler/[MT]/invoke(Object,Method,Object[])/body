{
  Transaction tx=null;
  if (isTxRequired(method)) {
    if (this.transactionManager.getStatus() == Status.STATUS_NO_TRANSACTION) {
      this.transactionManager.begin();
    }
    this.em.joinTransaction();
    tx=this.transactionManager.getTransaction();
  }
  ClassLoader originalClassLoader=Thread.currentThread().getContextClassLoader();
  try {
    if (this.entityModule != null) {
      Thread.currentThread().setContextClassLoader(this.entityModule.getClassLoader());
    }
    return method.invoke(this.em,args);
  }
  finally {
    Thread.currentThread().setContextClassLoader(originalClassLoader);
    if (tx != null) {
      tx.commit();
      this.transactionManager.suspend();
    }
  }
}
