{
synchronized (service) {
    if (restartRequiredFlag) {
      state.set(State.RESTART_REQUIRED,stamp.incrementAndGet());
      service.stateChanged(State.RESTART_REQUIRED);
    }
 else {
      state.set(State.RUNNING,stamp.incrementAndGet());
      service.stateChanged(State.RUNNING);
    }
  }
}
