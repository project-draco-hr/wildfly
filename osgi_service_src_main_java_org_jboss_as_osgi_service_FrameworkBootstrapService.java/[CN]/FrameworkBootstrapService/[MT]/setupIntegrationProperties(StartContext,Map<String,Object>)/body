{
  String storage=(String)props.get(Constants.FRAMEWORK_STORAGE);
  if (storage == null) {
    ServerEnvironment environment=injectedServerEnvironment.getValue();
    File dataDir=environment.getServerDataDir();
    storage=dataDir.getAbsolutePath() + File.separator + "osgi-store";
    props.put(Constants.FRAMEWORK_STORAGE,storage);
  }
  ModuleLogger moduleLogger=Module.getModuleLogger();
  if (moduleLogger != null)   props.put(ModuleLogger.class.getName(),moduleLogger.getClass().getName());
  String sysmodules=(String)props.get(PROP_JBOSS_OSGI_SYSTEM_MODULES);
  if (sysmodules == null) {
    Set<String> sysModules=new LinkedHashSet<String>();
    sysModules.add("javax.api");
    sysModules.add("javax.inject.api");
    sysModules.add("org.apache.xerces");
    sysModules.add("org.jboss.as.configadmin");
    sysModules.add("org.jboss.as.controller-client");
    sysModules.add("org.jboss.as.osgi");
    sysModules.add("org.jboss.logging");
    sysModules.add("org.jboss.modules");
    sysModules.add("org.jboss.msc");
    sysModules.add("org.jboss.osgi.framework");
    sysModules.add("org.jboss.osgi.repository");
    sysModules.add("org.jboss.osgi.resolver");
    sysmodules=sysModules.toString();
    sysmodules=sysmodules.substring(1,sysmodules.length() - 1);
    props.put(PROP_JBOSS_OSGI_SYSTEM_MODULES,sysmodules);
  }
  String syspackages=(String)props.get(Constants.FRAMEWORK_SYSTEMPACKAGES);
  if (syspackages == null) {
    Set<String> sysPackages=new LinkedHashSet<String>();
    sysPackages.addAll(Arrays.asList(SystemPackagesIntegration.JAVAX_API_PACKAGES));
    sysPackages.addAll(Arrays.asList(SystemPathsPlugin.DEFAULT_FRAMEWORK_PACKAGES));
    sysPackages.add("javax.inject");
    sysPackages.add("org.apache.xerces.jaxp");
    sysPackages.add("org.jboss.as.configadmin.service");
    sysPackages.add("org.jboss.as.controller.client");
    sysPackages.add("org.jboss.as.controller.client.helpers");
    sysPackages.add("org.jboss.as.controller.client.helpers.domain");
    sysPackages.add("org.jboss.as.controller.client.helpers.standalone");
    sysPackages.add("org.jboss.logging;version=3.1.0");
    sysPackages.add("org.jboss.osgi.repository;version=1.0");
    sysPackages.add("org.osgi.service.repository;version=1.0");
    syspackages=sysPackages.toString();
    syspackages=syspackages.substring(1,syspackages.length() - 1);
    props.put(Constants.FRAMEWORK_SYSTEMPACKAGES,syspackages);
  }
  String extrapackages=(String)props.get(Constants.FRAMEWORK_SYSTEMPACKAGES_EXTRA);
  if (extrapackages != null) {
    props.put(Constants.FRAMEWORK_SYSTEMPACKAGES_EXTRA,extrapackages);
  }
}
