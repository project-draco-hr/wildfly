{
  final ModelNode result=context.getResult();
  final PathAddress rootAddress=PathAddress.pathAddress(PathAddress.pathAddress(operation.require(OP_ADDR)).getLastElement());
  final ModelNode subModel=context.readModel(PathAddress.EMPTY_ADDRESS);
  final ModelNode subsystemAdd=new ModelNode();
  subsystemAdd.get(OP).set(ADD);
  subsystemAdd.get(OP_ADDR).set(rootAddress.toModelNode());
  result.add(subsystemAdd);
  if (subModel.hasDefined(ModelKeys.MAIL_SESSION)) {
    for (    final Property session : subModel.get(ModelKeys.MAIL_SESSION).asPropertyList()) {
      final ModelNode address=rootAddress.toModelNode();
      address.add(ModelKeys.MAIL_SESSION,session.getName());
      final ModelNode addOperation=org.jboss.as.controller.operations.common.Util.getEmptyOperation(ADD,address);
      addOperation.get(ModelKeys.JNDI_NAME).set(session.getValue().get(ModelKeys.JNDI_NAME).asString());
      addOperation.get(ModelKeys.DEBUG).set(session.getValue().get(ModelKeys.DEBUG).asString());
      addOperation.get(ModelKeys.USERNAME).set(session.getValue().get(ModelKeys.USERNAME).asString());
      addOperation.get(ModelKeys.PASSWORD).set(session.getValue().get(ModelKeys.PASSWORD).asString());
      addOperation.get(ModelKeys.SMTP_SERVER).set(session.getValue().get(ModelKeys.SMTP_SERVER));
      addOperation.get(ModelKeys.IMAP_SERVER).set(session.getValue().get(ModelKeys.IMAP_SERVER));
      addOperation.get(ModelKeys.POP3_SERVER).set(session.getValue().get(ModelKeys.POP3_SERVER));
      result.add(addOperation);
    }
  }
  context.completeStep();
}
