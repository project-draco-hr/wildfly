{
  if (context == null) {
    throw new IllegalStateException("BundleContext not injected");
  }
  if (BUNDLE_SYMBOLICNAME.equals(message)) {
    Bundle bundle=getTargetBundle();
    return bundle.getSymbolicName();
  }
 else {
    try {
      Bundle bundle=getTargetBundle();
      bundle.start();
      BundleContext context=bundle.getBundleContext();
      ServiceReference sref=context.getServiceReference(Echo.class.getName());
      Echo service=(Echo)context.getService(sref);
      return service.echo(message);
    }
 catch (    BundleException ex) {
      throw new IllegalStateException("Cannot invoke target service",ex);
    }
  }
}
