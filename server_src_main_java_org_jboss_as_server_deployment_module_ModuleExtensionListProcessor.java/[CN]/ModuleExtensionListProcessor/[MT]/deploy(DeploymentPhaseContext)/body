{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final AttachmentList<ExtensionListEntry> entries=deploymentUnit.getAttachment(Attachments.EXTENSION_LIST_ENTRIES);
  if (entries == null || entries.isEmpty()) {
    return;
  }
  final ServiceController<?> controller=phaseContext.getServiceRegistry().getRequiredService(Services.JBOSS_DEPLOYMENT_EXTENSION_INDEX);
  final ExtensionIndex index=(ExtensionIndex)controller.getValue();
  for (  ExtensionListEntry entry : entries) {
    final ResourceRoot extension=index.findExtension(entry.getName(),entry.getSpecificationVersion(),entry.getImplementationVersion(),entry.getImplementationVendorId());
    if (extension != null) {
      deploymentUnit.addToAttachmentList(Attachments.RESOURCE_ROOTS,extension);
    }
  }
}
