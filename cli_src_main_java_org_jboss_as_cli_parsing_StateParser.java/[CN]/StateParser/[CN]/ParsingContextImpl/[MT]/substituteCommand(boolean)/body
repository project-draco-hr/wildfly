{
  if (location + 1 == input.length()) {
    throw new CommandSubstitutionException("","Command is missing after `");
  }
  final int endQuote=firstNotEscaped('`',location + 1);
  if (endQuote - location <= 1) {
    throw new CommandSubstitutionException(input.substring(location + 1),"Closing ` is missing for " + input.substring(location,Math.min(location + 5,input.length())) + "...");
  }
  final String cmd=input.substring(location + 1,endQuote);
  final String resolved=Util.getResult(cmdCtx,cmd);
  final StringBuilder buf=new StringBuilder(input.length() - cmd.length() - 2 + resolved.length());
  buf.append(input.substring(0,location)).append(resolved);
  if (endQuote < input.length() - 1) {
    buf.append(input.substring(endQuote + 1));
  }
  variableCorrection+=resolved.length() - cmd.length() - 2;
  input=buf.toString();
  ch=input.charAt(location);
}
