{
  processState.setStarting();
  final ProductConfig config=environment.getProductConfig();
  final String prettyVersion=config.getPrettyVersionString();
  AS_ROOT_LOGGER.serverStarting(prettyVersion);
  if (CONFIG_LOGGER.isDebugEnabled()) {
    final Properties properties=System.getProperties();
    final StringBuilder b=new StringBuilder(8192);
    b.append("Configured system properties:");
    for (    String property : new TreeSet<String>(properties.stringPropertyNames())) {
      b.append("\n\t").append(property).append(" = ").append(properties.getProperty(property,"<undefined>"));
    }
    CONFIG_LOGGER.debug(b);
    CONFIG_LOGGER.debugf("VM Arguments: %s",getVMArguments());
    if (CONFIG_LOGGER.isTraceEnabled()) {
      b.setLength(0);
      final Map<String,String> env=System.getenv();
      b.append("Configured system environment:");
      for (      String key : new TreeSet<String>(env.keySet())) {
        b.append("\n\t").append(key).append(" = ").append(env.get(key));
      }
      CONFIG_LOGGER.trace(b);
    }
  }
  final ServiceTarget serviceTarget=context.getChildTarget();
  final ServiceController<?> myController=context.getController();
  final ServiceContainer serviceContainer=myController.getServiceContainer();
  futureContainer=new FutureServiceContainer();
  long startTime=this.startTime;
  if (startTime == -1) {
    startTime=System.currentTimeMillis();
  }
 else {
    this.startTime=-1;
  }
  final BootstrapListener bootstrapListener=new BootstrapListener(serviceContainer,startTime,serviceTarget,futureContainer,prettyVersion + " (Host Controller)");
  bootstrapListener.getStabilityMonitor().addController(myController);
  final ProcessControllerConnectionService processControllerClient=new ProcessControllerConnectionService(environment,authCode);
  serviceTarget.addService(ProcessControllerConnectionService.SERVICE_NAME,processControllerClient).install();
  final HostControllerExecutorService executorService=new HostControllerExecutorService();
  serviceTarget.addService(HC_EXECUTOR_SERVICE_NAME,executorService).addAliases(ManagementRemotingServices.SHUTDOWN_EXECUTOR_NAME).install();
  HostPathManagerService hostPathManagerService=new HostPathManagerService();
  HostPathManagerService.addService(serviceTarget,hostPathManagerService,environment);
  HttpListenerRegistryService.install(serviceTarget);
  final Value<DirectoryStructure> directoryStructure=new ImmediateValue<DirectoryStructure>(DirectoryStructure.createDefault(environment.getHomeDir()));
  serviceTarget.addService(Services.JBOSS_DIRECTORY_STRUCTURE_SERVICE,new ValueService<DirectoryStructure>(directoryStructure)).setInitialMode(ServiceController.Mode.ACTIVE).install();
  final Value<ProductConfig> productConfigValue=new ImmediateValue<ProductConfig>(config);
  serviceTarget.addService(Services.JBOSS_PRODUCT_CONFIG_SERVICE,new ValueService<ProductConfig>(productConfigValue)).setInitialMode(ServiceController.Mode.ACTIVE).install();
  DomainModelControllerService.addService(serviceTarget,environment,runningModeControl,processState,bootstrapListener,hostPathManagerService);
}
