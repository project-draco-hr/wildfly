{
  if (request instanceof HttpServletRequest && response instanceof HttpServletResponse) {
    HttpServletRequest httpRequest=(HttpServletRequest)request;
    HttpServletResponse httpResponse=(HttpServletResponse)response;
    if (!httpContext.handleSecurity(httpRequest,httpResponse)) {
      return;
    }
    Object u=httpRequest.getAttribute(HttpContext.REMOTE_USER);
    String remoteUser=u instanceof String ? (String)u : null;
    Object a=httpRequest.getAttribute(HttpContext.AUTHENTICATION_TYPE);
    String authType=a instanceof String ? (String)a : null;
    if (remoteUser != null || authType != null) {
      request=new SecurityRequestWrapper(remoteUser,authType,httpRequest);
    }
  }
  delegate.service(request,response);
}
