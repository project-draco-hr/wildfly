{
  long start=System.currentTimeMillis();
  long now;
  do {
    ModelNode operation=new ModelNode();
    operation.get(OP_ADDR).add("subsystem","messaging");
    operation.get(OP_ADDR).add("hornetq-server","default");
    operation.get(OP).set(READ_RESOURCE_OPERATION);
    operation.get(INCLUDE_RUNTIME).set(true);
    ModelNode result=execute(client,operation);
    boolean started=result.get(RESULT,"started").asBoolean();
    boolean active=result.get(RESULT,"active").asBoolean();
    if (started && expectedActive == active) {
      return;
    }
    try {
      Thread.sleep(100);
    }
 catch (    InterruptedException e) {
    }
    now=System.currentTimeMillis();
  }
 while (now - start < timeout);
  fail("Server did not become active in the imparted time.");
}
