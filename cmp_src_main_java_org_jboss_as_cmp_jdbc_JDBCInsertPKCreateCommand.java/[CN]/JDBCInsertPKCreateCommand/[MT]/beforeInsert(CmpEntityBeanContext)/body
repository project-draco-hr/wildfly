{
  if (existsSQL != null) {
    Connection c=null;
    PreparedStatement ps=null;
    ResultSet rs=null;
    try {
      if (debug)       log.debug("Executing SQL: " + existsSQL);
      c=entity.getDataSource().getConnection();
      ps=c.prepareStatement(existsSQL);
      Object pk=entity.extractPrimaryKeyFromInstance(ctx);
      entity.setPrimaryKeyParameters(ps,1,pk);
      rs=ps.executeQuery();
      if (!rs.next()) {
        throw new CreateException("Error checking if entity with primary pk " + pk + "exists: SQL returned no rows");
      }
      if (rs.getInt(1) > 0) {
        throw new DuplicateKeyException("Entity with primary key " + pk + " already exists");
      }
    }
 catch (    SQLException e) {
      log.error("Error checking if entity exists",e);
      throw new CreateException("Error checking if entity exists:" + e);
    }
 finally {
      JDBCUtil.safeClose(rs);
      JDBCUtil.safeClose(ps);
      JDBCUtil.safeClose(c);
    }
  }
}
