{
  final ClassLoader cl=SecurityActions.getContextClassLoader();
  try {
    SecurityActions.setContextClassLoader(classLoader);
    beanManager=weldContainer.getValue().getBeanManager(beanDeploymentArchiveId);
    for (    final Class<?> interceptor : interceptorClasses) {
      interceptorInjections.put(interceptor,new NonContextualComponentInjectionTarget(interceptor,null,beanManager));
    }
    if (ejbName != null) {
      EjbDescriptor<Object> descriptor=beanManager.getEjbDescriptor(ejbName);
      if (descriptor != null) {
        bean=beanManager.getBean(descriptor);
      }
    }
    if (bean instanceof SessionBean<?>) {
      SessionBean<?> sessionBean=(SessionBean<?>)bean;
      this.injectionTarget=sessionBean.getInjectionTarget();
      return;
    }
    if (componentDescription instanceof WSComponentDescription) {
      ManagedBean<?> bean=findManagedBeanForWSComponent(componentClass);
      if (bean != null) {
        injectionTarget=bean.getInjectionTarget();
        return;
      }
    }
    NonContextualComponentInjectionTarget injectionTarget=new NonContextualComponentInjectionTarget(componentClass,bean,beanManager);
    if (componentDescription instanceof MessageDrivenComponentDescription || componentDescription instanceof WebComponentDescription) {
      this.injectionTarget=beanManager.fireProcessInjectionTarget(injectionTarget.getAnnotated(),injectionTarget);
    }
 else {
      this.injectionTarget=injectionTarget;
    }
    beanManager.getServices().get(InjectionTargetService.class).validateProducer(injectionTarget);
  }
  finally {
    SecurityActions.setContextClassLoader(cl);
  }
}
