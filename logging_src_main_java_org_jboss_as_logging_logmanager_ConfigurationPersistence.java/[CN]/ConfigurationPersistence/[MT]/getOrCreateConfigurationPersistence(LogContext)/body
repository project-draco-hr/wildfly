{
  ConfigurationPersistence result=(ConfigurationPersistence)logContext.getAttachment(CommonAttributes.ROOT_LOGGER_NAME,Configurator.ATTACHMENT_KEY);
  if (result == null) {
    final Logger root=logContext.getLogger(CommonAttributes.ROOT_LOGGER_NAME);
    result=(ConfigurationPersistence)root.getAttachment(Configurator.ATTACHMENT_KEY);
    if (result == null) {
synchronized (PROP_CONFIG_LOCK) {
        result=(ConfigurationPersistence)logContext.getAttachment(CommonAttributes.ROOT_LOGGER_NAME,Configurator.ATTACHMENT_KEY);
        if (result == null) {
          result=(ConfigurationPersistence)root.getAttachment(Configurator.ATTACHMENT_KEY);
        }
        if (result == null) {
          result=new ConfigurationPersistence(logContext);
          ConfigurationPersistence current=(ConfigurationPersistence)root.attachIfAbsent(Configurator.ATTACHMENT_KEY,result);
          if (current != null) {
            result=current;
          }
        }
      }
    }
  }
  return result;
}
