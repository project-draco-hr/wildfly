{
  Set<Server> servers=domain.getServersInGroup(serverGroup);
  long timeout=operationTimeout * 1000;
  long sleep=100;
  while (timeout > 0 && servers.size() > 0) {
    Iterator<Server> serverIterator=servers.iterator();
    while (serverIterator.hasNext()) {
      Server server=serverIterator.next();
      if (shouldBeStarted == client.isServerStarted(server)) {
        serverIterator.remove();
      }
    }
    try {
      Thread.sleep(sleep);
      timeout-=sleep;
    }
 catch (    InterruptedException e) {
      throw new RuntimeException("Failed waiting for servers to " + (shouldBeStarted ? "start" : "stop"),e);
    }
  }
  if (timeout <= 0) {
    throw new RuntimeException("Servers in group did not " + (shouldBeStarted ? "start" : "stop") + " within set timeout [serverGroupOperationTimeoutInSeconds="+ operationTimeout+ "]. "+ servers);
  }
}
