{
  processState.setStarting();
  final Bootstrap.Configuration configuration=this.configuration;
  final ServerEnvironment serverEnvironment=configuration.getServerEnvironment();
  final ProductConfig config=serverEnvironment.getProductConfig();
  final String prettyVersion=config.getPrettyVersionString();
  AS_ROOT_LOGGER.serverStarting(prettyVersion);
  if (CONFIG_LOGGER.isDebugEnabled()) {
    final Properties properties=System.getProperties();
    final StringBuilder b=new StringBuilder(8192);
    b.append(ServerMessages.MESSAGES.configuredSystemPropertiesLabel());
    for (    String property : new TreeSet<String>(properties.stringPropertyNames())) {
      b.append("\n\t").append(property).append(" = ").append(properties.getProperty(property,"<undefined>"));
    }
    CONFIG_LOGGER.debug(b);
    CONFIG_LOGGER.debugf(ServerMessages.MESSAGES.vmArgumentsLabel(getVMArguments()));
    if (CONFIG_LOGGER.isTraceEnabled()) {
      b.setLength(0);
      final Map<String,String> env=System.getenv();
      b.append(ServerMessages.MESSAGES.configuredSystemEnvironmentLabel());
      for (      String key : new TreeSet<String>(env.keySet())) {
        b.append("\n\t").append(key).append(" = ").append(env.get(key));
      }
      CONFIG_LOGGER.trace(b);
    }
  }
  final ServiceTarget serviceTarget=context.getChildTarget();
  final ServiceController<?> myController=context.getController();
  final ServiceContainer container=myController.getServiceContainer();
  futureContainer=new FutureServiceContainer();
  long startTime=this.startTime;
  if (startTime == -1) {
    startTime=System.currentTimeMillis();
  }
 else {
    this.startTime=-1;
  }
  CurrentServiceContainer.setServiceContainer(context.getController().getServiceContainer());
  final BootstrapListener bootstrapListener=new BootstrapListener(container,startTime,serviceTarget,futureContainer,prettyVersion);
  bootstrapListener.getStabilityMonitor().addController(myController);
  if (standalone) {
    ContentRepository.Factory.addService(serviceTarget,serverEnvironment.getServerContentDir());
  }
 else {
    RemoteFileRepositoryService.addService(serviceTarget,serverEnvironment.getServerContentDir());
  }
  DeploymentMountProvider.Factory.addService(serviceTarget);
  ServiceModuleLoader.addService(serviceTarget,configuration);
  ExternalModuleService.addService(serviceTarget);
  ModuleIndexService.addService(serviceTarget);
  final AbstractVaultReader vaultReader=service(AbstractVaultReader.class);
  AS_ROOT_LOGGER.debugf("Using VaultReader %s",vaultReader);
  ServerService.addService(serviceTarget,configuration,processState,bootstrapListener,runningModeControl,vaultReader,configuration.getAuditLogger());
  final ServiceActivatorContext serviceActivatorContext=new ServiceActivatorContext(){
    @Override public ServiceTarget getServiceTarget(){
      return serviceTarget;
    }
    @Override public ServiceRegistry getServiceRegistry(){
      return container;
    }
  }
;
  for (  ServiceActivator activator : extraServices) {
    activator.activate(serviceActivatorContext);
  }
  ServerEnvironmentService.addService(serverEnvironment,serviceTarget);
  ServerPathManagerService serverPathManagerService=new ServerPathManagerService();
  ServerPathManagerService.addService(serviceTarget,serverPathManagerService,serverEnvironment);
  final Value<ProductConfig> productConfigValue=new ImmediateValue<ProductConfig>(config);
  serviceTarget.addService(Services.JBOSS_PRODUCT_CONFIG_SERVICE,new ValueService<ProductConfig>(productConfigValue)).setInitialMode(ServiceController.Mode.ACTIVE).install();
  if (AS_ROOT_LOGGER.isDebugEnabled()) {
    final long nanos=context.getElapsedTime();
    AS_ROOT_LOGGER.debugf(prettyVersion + " root service started in %d.%06d ms",Long.valueOf(nanos / 1000000L),Long.valueOf(nanos % 1000000L));
  }
}
