{
  parse("/profile=default/subsystem=threads/thread-factory=mytf:do{ rollout in-series " + "groupA(rolling-to-servers=true,max-failure-percentage=20) ^ groupB, groupC," + "groupD(rolling-to-servers=true,max-failed-servers=1) ^ groupE; rollback-across-groups = true}");
  assertTrue(handler.hasAddress());
  assertTrue(handler.hasOperationName());
  assertFalse(handler.hasProperties());
  assertFalse(handler.endsOnAddressOperationNameSeparator());
  assertFalse(handler.endsOnPropertyListStart());
  assertFalse(handler.endsOnPropertySeparator());
  assertFalse(handler.endsOnPropertyValueSeparator());
  assertFalse(handler.endsOnNodeSeparator());
  assertFalse(handler.endsOnNodeTypeNameSeparator());
  assertFalse(handler.endsOnSeparator());
  assertFalse(handler.endsOnHeaderListStart());
  assertFalse(handler.isRequestComplete());
  assertTrue(handler.hasHeaders());
  final List<OperationRequestHeader> headers=handler.getHeaders();
  assertEquals(2,headers.size());
  final ModelNode op=handler.toOperationRequest();
  assertTrue(op.hasDefined(Util.OPERATION_HEADERS));
  final ModelNode headersNode=op.get(Util.OPERATION_HEADERS);
  final ModelNode rolloutPlan=new ModelNode();
  final ModelNode inSeries=rolloutPlan.get(Util.ROLLOUT_PLAN).get(Util.IN_SERIES);
  ModelNode concurrent=new ModelNode();
  ModelNode cg=concurrent.get(Util.CONCURRENT_GROUPS);
  ModelNode sg=new ModelNode();
  ModelNode group=new ModelNode();
  ModelNode groupProps=group.get("groupA");
  groupProps.get("rolling-to-servers").set("true");
  groupProps.get("max-failure-percentage").set("20");
  sg.get(Util.SERVER_GROUP).set(group);
  cg.add().set(sg);
  sg=new ModelNode();
  group=new ModelNode();
  group.get("groupB");
  sg.get(Util.SERVER_GROUP).set(group);
  cg.add().set(sg);
  inSeries.add().set(concurrent);
  sg=new ModelNode();
  group=new ModelNode();
  group.get("groupC");
  sg.get(Util.SERVER_GROUP).set(group);
  inSeries.add().set(sg);
  concurrent=new ModelNode();
  cg=concurrent.get(Util.CONCURRENT_GROUPS);
  sg=new ModelNode();
  group=new ModelNode();
  groupProps=group.get("groupD");
  groupProps.get("rolling-to-servers").set("true");
  groupProps.get("max-failed-servers").set("1");
  sg.get(Util.SERVER_GROUP).set(group);
  cg.add().set(sg);
  sg=new ModelNode();
  group=new ModelNode();
  group.get("groupE");
  sg.get(Util.SERVER_GROUP).set(group);
  cg.add().set(sg);
  inSeries.add().set(concurrent);
  final ModelNode rollbackAcross=new ModelNode();
  rollbackAcross.get("rollback-across-groups").set("true");
  final ModelNode expectedList=new ModelNode();
  expectedList.add().set(rolloutPlan);
  expectedList.add().set(rollbackAcross);
  assertEquals(expectedList,headersNode);
}
