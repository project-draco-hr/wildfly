{
  UpdateResultHandlerResponse<?> response=processUpdate();
  try {
    final Marshaller marshaller=getMarshaller();
    marshaller.start(output);
    marshaller.writeByte(ManagementProtocol.PARAM_APPLY_UPDATE_RESULT);
    if (response.getFailureResult() != null) {
      marshaller.writeByte(ManagementProtocol.PARAM_APPLY_UPDATE_RESULT_EXCEPTION);
      marshaller.writeObject(response.getFailureResult());
    }
 else     if (response.isCancelled()) {
      marshaller.writeByte(ManagementProtocol.PARAM_APPLY_SERVER_MODEL_UPDATE_CANCELLED);
    }
 else     if (response.isTimedOut()) {
      marshaller.writeByte(ManagementProtocol.PARAM_APPLY_SERVER_MODEL_UPDATE_TIMED_OUT);
    }
 else {
      output.writeByte(ManagementProtocol.PARAM_APPLY_SERVER_MODEL_UPDATE_RESULT_RETURN);
      marshaller.writeObject(response.getSuccessResult());
    }
    marshaller.finish();
  }
 catch (  Exception e) {
    throw new ManagementException("Unable to send domain model update response.",e);
  }
}
