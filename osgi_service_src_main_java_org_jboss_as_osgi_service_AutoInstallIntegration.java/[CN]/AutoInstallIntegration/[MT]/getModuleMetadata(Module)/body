{
  URL manifestURL=module.getClassLoader().getResource(JarFile.MANIFEST_NAME);
  if (manifestURL != null) {
    InputStream input=manifestURL.openStream();
    try {
      Manifest manifest=new Manifest(input);
      if (BundleInfo.isValidBundleManifest(manifest)) {
        return OSGiMetaDataBuilder.load(manifest);
      }
    }
  finally {
      input.close();
    }
  }
  final File modulesDir=injectedEnvironment.getValue().getModulesDir();
  final ModuleIdentifier identifier=module.getIdentifier();
  String identifierPath=identifier.getName().replace('.',File.separatorChar) + File.separator + identifier.getSlot();
  File entryFile=new File(modulesDir + File.separator + identifierPath+ File.separator+ "jbosgi-xservice.properties");
  if (entryFile.exists() == false) {
    ROOT_LOGGER.debugf("Cannot obtain OSGi metadata file: %s",entryFile);
    return null;
  }
  FileInputStream input=new FileInputStream(entryFile);
  try {
    return OSGiMetaDataBuilder.load(input);
  }
  finally {
    input.close();
  }
}
