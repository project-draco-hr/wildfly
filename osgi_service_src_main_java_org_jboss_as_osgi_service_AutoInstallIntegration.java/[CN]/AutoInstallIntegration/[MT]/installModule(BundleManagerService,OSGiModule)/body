{
  ModuleIdentifier identifier=moduleMetaData.getIdentifier();
  File bundleFile=getRepositoryEntry(bundlesDir,identifier);
  if (bundleFile != null) {
    URL url=bundleFile.toURI().toURL();
    BundleInfo info=BundleInfo.createBundleInfo(url);
    Deployment dep=DeploymentFactory.createDeployment(info);
    Integer startLevel=moduleMetaData.getStartLevel();
    if (startLevel != null)     dep.setStartLevel(startLevel.intValue());
    return bundleManager.installBundle(serviceTarget,dep);
  }
 else {
    ModuleLoader moduleLoader=Module.getBootModuleLoader();
    Module module=moduleLoader.loadModule(identifier);
    OSGiMetaData metadata=getModuleMetadata(module);
    return bundleManager.registerModule(serviceTarget,module,metadata);
  }
}
