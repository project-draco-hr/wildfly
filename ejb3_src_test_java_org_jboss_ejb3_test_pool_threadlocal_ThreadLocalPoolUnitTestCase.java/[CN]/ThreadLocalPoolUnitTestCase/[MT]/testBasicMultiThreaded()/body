{
  StatelessObjectFactory<MockBean> factory=new MockFactory();
  final ThreadLocalPool<MockBean> pool=new ThreadLocalPool<MockBean>(factory);
  pool.start();
  Callable<?> task=new Callable<Void>(){
    public Void call() throws Exception {
      for (int i=0; i < 10; i++) {
        MockBean bean=pool.get();
        pool.release(bean);
        bean=null;
      }
      return null;
    }
  }
;
  ExecutorService service=Executors.newFixedThreadPool(10);
  Future<?> results[]=new Future<?>[10];
  for (int i=0; i < results.length; i++) {
    results[i]=service.submit(task);
  }
  for (  Future<?> result : results) {
    result.get(5,TimeUnit.SECONDS);
  }
  service.shutdown();
  boolean terminated=service.awaitTermination(5,TimeUnit.SECONDS);
  assertTrue(terminated);
  assertEquals(10,MockBean.getPostConstructs());
}
