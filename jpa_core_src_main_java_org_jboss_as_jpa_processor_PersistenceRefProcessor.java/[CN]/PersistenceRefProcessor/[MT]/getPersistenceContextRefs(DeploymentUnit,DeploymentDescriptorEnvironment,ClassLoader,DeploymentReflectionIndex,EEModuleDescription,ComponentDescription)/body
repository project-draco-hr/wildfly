{
  final EEApplicationClasses applicationClasses=deploymentUnit.getAttachment(Attachments.EE_APPLICATION_CLASSES_DESCRIPTION);
  List<BindingConfiguration> bindingConfigurations=new ArrayList<BindingConfiguration>();
  final RemoteEnvironment remoteEnvironment=environment.getEnvironment();
  if (remoteEnvironment == null) {
    return bindingConfigurations;
  }
  if (remoteEnvironment instanceof Environment) {
    PersistenceContextReferencesMetaData persistenceUnitRefs=((Environment)remoteEnvironment).getPersistenceContextRefs();
    if (persistenceUnitRefs != null) {
      for (      PersistenceContextReferenceMetaData puRef : persistenceUnitRefs) {
        String name=puRef.getName();
        String persistenceUnitName=puRef.getPersistenceUnitName();
        String lookup=puRef.getLookupName();
        if (!isEmpty(lookup) && !isEmpty(persistenceUnitName)) {
          throw MESSAGES.cannotSpecifyBoth("<lookup-name>",lookup,"persistence-unit-name",persistenceUnitName,"<persistence-context-ref/>",componentDescription);
        }
        if (!name.startsWith("java:")) {
          name=environment.getDefaultContext() + name;
        }
        LookupInjectionSource injectionSource=new LookupInjectionSource(name);
        processInjectionTargets(moduleDescription,applicationClasses,injectionSource,classLoader,deploymentReflectionIndex,puRef,EntityManager.class);
        BindingConfiguration bindingConfiguration=null;
        if (!isEmpty(lookup)) {
          bindingConfiguration=new BindingConfiguration(name,new LookupInjectionSource(lookup));
        }
 else         if (!isEmpty(persistenceUnitName)) {
          PropertiesMetaData properties=puRef.getProperties();
          Map map=new HashMap();
          if (properties != null) {
            for (            PropertyMetaData prop : properties) {
              map.put(prop.getKey(),prop.getValue());
            }
          }
          PersistenceContextType type=puRef.getPersistenceContextType() == null ? PersistenceContextType.TRANSACTION : puRef.getPersistenceContextType();
          InjectionSource pcBindingSource=this.getPersistenceContextBindingSource(deploymentUnit,persistenceUnitName,type,map);
          bindingConfiguration=new BindingConfiguration(name,pcBindingSource);
        }
 else {
          throw MESSAGES.lookupOrPersistenceUnitNameRequired();
        }
        bindingConfigurations.add(bindingConfiguration);
      }
    }
  }
  return bindingConfigurations;
}
