{
  ModelNode codeNode=VaultResourceDefinition.CODE.resolveModelAttribute(context,model);
  String vaultClass=codeNode.isDefined() ? codeNode.asString() : null;
  if (vaultReader != null) {
    final Map<String,Object> vaultOptions=new HashMap<String,Object>();
    ModelNode optionsNode=VaultResourceDefinition.VAULT_OPTIONS.resolveModelAttribute(context,model);
    if (optionsNode.isDefined()) {
      for (      Property prop : optionsNode.asPropertyList()) {
        vaultOptions.put(prop.getName(),prop.getValue().asString());
      }
    }
    try {
      vaultReader.createVault(vaultClass,vaultOptions);
    }
 catch (    VaultReaderException e) {
      throw ServerMessages.MESSAGES.cannotCreateVault(e,e);
    }
  }
}
