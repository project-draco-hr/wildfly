{
  if (defaultUser.equals(username) && defaultPassword.equals(password))   return true;
  if (securityDomainContext == null)   throw MESSAGES.securityDomainContextNotSet();
  Subject subject=new Subject();
  boolean authenticated=securityDomainContext.getAuthenticationManager().isValid(new SimplePrincipal(username),password,subject);
  if (authenticated) {
    SecurityContext securityContext=pushSecurityContext(subject,new SimplePrincipal(username),password);
    Set<Principal> principals=new HashSet<Principal>();
    for (    Role role : roles) {
      if (checkType.hasRole(role)) {
        principals.add(new SimplePrincipal(role.getName()));
      }
    }
    authenticated=securityDomainContext.getAuthorizationManager().doesUserHaveRole(new SimplePrincipal(username),principals);
    setSecurityContextOnAssociation(securityContext);
  }
  return authenticated;
}
