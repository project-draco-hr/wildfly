{
  return AccessController.doPrivileged(new PrivilegedAction<SecurityContext>(){
    public SecurityContext run(){
      final SecurityContext currentSecurityContext=SecurityContextAssociation.getSecurityContext();
      final SecurityContext securityContext;
      if (currentSecurityContext == null) {
        securityContext=createSecurityContext(subject,principal,credential,securityDomainContext.getAuthenticationManager().getSecurityDomain());
      }
 else {
        securityContext=currentSecurityContext;
        securityContext.getUtil().createSubjectInfo(principal,credential,subject);
      }
      setSecurityContextOnAssociation(securityContext);
      return currentSecurityContext;
    }
  }
);
}
