{
switch ((granularity != null) ? granularity : ReplicationGranularity.SESSION) {
case SESSION:
{
      return (SessionAttributeStorage<T>)new CoarseSessionAttributeStorage(marshaller);
    }
case ATTRIBUTE:
{
    return (SessionAttributeStorage<T>)new FineSessionAttributeStorage(marshaller);
  }
case FIELD:
{
  log.warn("FIELD replication granularity is deprecated.  Falling back to SESSION granularity instead.");
  return this.createStorage(ReplicationGranularity.SESSION,marshaller);
}
default :
{
throw new IllegalArgumentException("Unknown replication granularity: " + granularity);
}
}
}
