{
switch ((granularity != null) ? granularity : ReplicationGranularity.SESSION) {
case SESSION:
{
      return (SessionAttributeStorage<T>)new CoarseSessionAttributeStorage(marshaller);
    }
case ATTRIBUTE:
{
    return (SessionAttributeStorage<T>)new FineSessionAttributeStorage(marshaller);
  }
case FIELD:
{
  ROOT_LOGGER.deprecatedGranularity(ReplicationGranularity.FIELD.name(),ReplicationGranularity.SESSION.name());
  return this.createStorage(ReplicationGranularity.SESSION,marshaller);
}
default :
{
throw MESSAGES.unknownReplicationGranularity(granularity);
}
}
}
