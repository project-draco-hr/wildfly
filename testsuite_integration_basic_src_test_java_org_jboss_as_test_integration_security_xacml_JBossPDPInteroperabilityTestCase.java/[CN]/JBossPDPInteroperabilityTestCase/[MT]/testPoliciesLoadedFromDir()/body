{
  final File policyDir=new File((File)null,"test-JBossPDP-Med-" + System.currentTimeMillis());
  try {
    policyDir.mkdirs();
    final JBossPDP pdp=createPDPForMed(policyDir);
    final String requestTemplate=IOUtils.toString(getClass().getResourceAsStream(JBossPDPTestUtils.TESTOBJECTS_REQUESTS + "/med-example-request.xml"),"UTF-8");
    final Map<String,Object> substitutionMap=new HashMap<String,Object>();
    substitutionMap.put(JBossPDPTestUtils.SUBST_SUBJECT_ID,"bs@simpsons.com");
    assertEquals("bs@simpsons.com should be INDETERMINATE",XACMLConstants.DECISION_INDETERMINATE,getDecisionForStr(pdp,StrSubstitutor.replace(requestTemplate,substitutionMap)));
    substitutionMap.put(JBossPDPTestUtils.SUBST_SUBJECT_ID,"guest@med.example.com");
    assertEquals("guest@med.example.com should be DENY",XACMLConstants.DECISION_DENY,getDecisionForStr(pdp,StrSubstitutor.replace(requestTemplate,substitutionMap)));
    substitutionMap.put(JBossPDPTestUtils.SUBST_SUBJECT_ID,"josef@med.example.com");
    assertEquals("josef@med.example.com should be PERMIT",XACMLConstants.DECISION_PERMIT,getDecisionForStr(pdp,StrSubstitutor.replace(requestTemplate,substitutionMap)));
  }
  finally {
    FileUtils.deleteDirectory(policyDir);
  }
}
