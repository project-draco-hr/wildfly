{
  final byte commandCode;
  final ByteDataInput input=new SimpleByteDataInput(dataStream);
  try {
    expectHeader(input,ManagementProtocol.REQUEST_OPERATION);
    commandCode=input.readByte();
    final ManagementOperation operation=operationFor(commandCode);
    if (operation == null) {
      throw new ManagementException("Invalid command code " + commandCode + " received from server manager");
    }
    log.debugf("Received DomainController operation [%s]",operation);
    OutputStream outputStream=null;
    ByteDataOutput output=null;
    try {
      outputStream=connection.writeMessage();
      output=new SimpleByteDataOutput(outputStream);
      operation.handle(input,output);
    }
 catch (    Exception e) {
      throw new ManagementException("Failed to execute domain controller operation",e);
    }
 finally {
      safeClose(output);
      safeClose(outputStream);
    }
  }
 catch (  IOException e) {
    throw e;
  }
catch (  Throwable t) {
    throw new IOException("ServerManager Request failed to read command code",t);
  }
 finally {
    safeClose(input);
    safeClose(dataStream);
  }
}
