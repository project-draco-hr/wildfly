{
  final Enumeration<InetAddress> interfaceAddresses=networkInterface.getInetAddresses();
  while (interfaceAddresses.hasMoreElements()) {
    final InetAddress address=interfaceAddresses.nextElement();
    if (preferIP4Stack && address instanceof Inet4Address) {
      return address;
    }
 else     if (preferIP6Stack && address instanceof Inet6Address) {
      return address;
    }
 else     if (!preferIP4Stack && !preferIP6Stack) {
      return address;
    }
  }
  return null;
}
