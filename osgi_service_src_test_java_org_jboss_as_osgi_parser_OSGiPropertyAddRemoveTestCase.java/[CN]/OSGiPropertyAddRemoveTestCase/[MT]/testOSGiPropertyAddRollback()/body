{
  SubsystemState stateService=new SubsystemState();
  List<OperationStepHandler> addedSteps=new ArrayList<OperationStepHandler>();
  OperationContext context=mockOperationContext(stateService,addedSteps,OperationContext.ResultAction.ROLLBACK);
  ModelNode address=new ModelNode();
  address.add(new ModelNode().set(ModelDescriptionConstants.SUBSYSTEM,OSGiExtension.SUBSYSTEM_NAME));
  address.add(new ModelNode().set(CommonAttributes.PROPERTY,"PropertyX"));
  ModelNode data=new ModelNode();
  data.get(CommonAttributes.VALUE).set("hi");
  ModelNode op=OSGiPropertyAdd.getAddOperation(address,data);
  Assert.assertEquals("Precondition",0,addedSteps.size());
  OSGiPropertyAdd.INSTANCE.execute(context,op);
  Assert.assertEquals(1,addedSteps.size());
  Assert.assertNull("Precondition",stateService.getProperties().get("PropertyX"));
  addedSteps.get(0).execute(context,op);
  Assert.assertNull("Operation should have been rolled back",stateService.getProperties().get("PropertyX"));
}
