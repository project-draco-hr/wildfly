{
  if (setupTasksInForce.isEmpty()) {
    return;
  }
  final Iterator<Map.Entry<String,Integer>> it=deployed.entrySet().iterator();
  while (it.hasNext()) {
    Map.Entry<String,Integer> container=it.next();
    if (container.getValue() == 0) {
      if (active.containsKey(container.getKey())) {
        ManagementClient client=active.get(container.getKey());
        for (int i=setupTasksInForce.size() - 1; i >= 0; i--) {
          try {
            setupTasksInForce.get(i).tearDown(client,container.getKey());
          }
 catch (          Exception e) {
            log.error("Setup task failed during tear down. Offending class '" + setupTasksAll.get(i) + "'",e);
          }
        }
        active.remove(container.getKey());
        it.remove();
      }
    }
  }
  afterClassRun=true;
  if (deployed.isEmpty()) {
    deployed=null;
    setupTasksAll.clear();
    setupTasksInForce.clear();
    afterClassRun=false;
  }
}
