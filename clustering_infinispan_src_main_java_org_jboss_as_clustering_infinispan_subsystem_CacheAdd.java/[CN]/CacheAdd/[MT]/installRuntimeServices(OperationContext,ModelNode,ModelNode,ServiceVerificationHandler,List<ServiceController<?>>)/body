{
  model=Resource.Tools.readModel(context.readResource(PathAddress.EMPTY_ADDRESS));
  PathAddress cacheAddress=PathAddress.pathAddress(operation.get(OP_ADDR));
  PathAddress containerAddress=cacheAddress.subAddress(0,cacheAddress.size() - 1);
  String cacheName=cacheAddress.getLastElement().getValue();
  String containerName=containerAddress.getLastElement().getValue();
  ModelNode resolvedValue=null;
  final String jndiName=((resolvedValue=CommonAttributes.JNDI_NAME.resolveModelAttribute(context,model)).isDefined()) ? resolvedValue.asString() : null;
  final ServiceController.Mode initialMode=StartMode.valueOf(CommonAttributes.START.resolveModelAttribute(context,model).asString()).getMode();
  List<Dependency<?>> dependencies=new LinkedList<Dependency<?>>();
  ConfigurationBuilder builder=new ConfigurationBuilder().read(getDefaultConfiguration(this.mode));
  processModelNode(context,containerName,model,builder,dependencies);
  Resource rootResource=context.readResourceFromRoot(containerAddress);
  ModelNode container=rootResource.getModel();
  String defaultCache=CommonAttributes.DEFAULT_CACHE.resolveModelAttribute(context,container).asString();
  InjectedValue<EmbeddedCacheManager> containerInjection=new InjectedValue<EmbeddedCacheManager>();
  ServiceTarget target=context.getServiceTarget();
  ServiceController<Configuration> ccsController=installCacheConfigurationService(target,containerName,cacheName,defaultCache,builder,containerInjection,dependencies,verificationHandler);
  if (newControllers != null) {
    newControllers.add(ccsController);
  }
  log.debugf("Cache configuration service for %s installed for container %s",cacheName,containerName);
  ServiceController<Cache<Object,Object>> cController=installCacheService(target,containerName,cacheName,defaultCache,initialMode,builder,containerInjection,verificationHandler);
  if (newControllers != null) {
    newControllers.add(cController);
  }
  ServiceController<ManagedReferenceFactory> jsController=installJndiService(target,containerName,cacheName,jndiName,verificationHandler);
  if (newControllers != null) {
    newControllers.add(jsController);
  }
  log.debugf("Cache service for cache %s installed for container %s",cacheName,containerName);
}
