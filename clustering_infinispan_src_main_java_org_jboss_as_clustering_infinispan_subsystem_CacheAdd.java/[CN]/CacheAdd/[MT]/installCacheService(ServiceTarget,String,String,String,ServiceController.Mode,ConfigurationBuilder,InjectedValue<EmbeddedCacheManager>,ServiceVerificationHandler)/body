{
  CacheDependencies cacheDependencies=new CacheDependencies(containerInjection);
  CacheService<Object,Object> cacheService=new CacheService<Object,Object>(cacheName,cacheDependencies);
  ServiceName containerServiceName=EmbeddedCacheManagerService.getServiceName(containerName);
  ServiceName cacheServiceName=containerServiceName.append(cacheName);
  ServiceName cacheConfigurationServiceName=CacheConfigurationService.getServiceName(containerName,cacheName);
  Configuration config=builder.build();
  ServiceBuilder<Cache<Object,Object>> cacheBuilder=target.addService(cacheServiceName,cacheService).addDependency(cacheConfigurationServiceName).setInitialMode(initialMode);
  if (config.transaction().recovery().enabled()) {
    cacheBuilder.addDependency(TxnServices.JBOSS_TXN_ARJUNA_RECOVERY_MANAGER,XAResourceRecoveryRegistry.class,cacheDependencies.getRecoveryRegistryInjector());
  }
  if (cacheName.equals(defaultCache)) {
    cacheBuilder.addAliases(CacheService.getServiceName(containerName,null));
  }
  if (initialMode == ServiceController.Mode.ACTIVE) {
    cacheBuilder.addListener(verificationHandler);
  }
  return cacheBuilder.install();
}
