{
  try {
    final ServiceTarget serviceTarget=serviceActivatorContext.getServiceTarget();
    final XMLMapper mapper=XMLMapper.Factory.create();
    extensionRegistrar.registerStandardDomainReaders(mapper);
    final DomainControllerImpl domainController=new DomainControllerImpl();
    serviceTarget.addService(DomainController.SERVICE_NAME,domainController).addInjection(domainController.getXmlMapperInjector(),mapper).addInjection(domainController.getDomainConfigDirInjector(),environment.getDomainConfigurationDir()).addInjection(domainController.getDomainDeploymentsDirInjector(),environment.getDomainDeploymentDir()).addDependency(SERVICE_NAME_BASE.append("executor"),ScheduledExecutorService.class,domainController.getScheduledExecutorServiceInjector()).install();
    final DomainControllerOperationHandler domainControllerOperationHandler=new DomainControllerOperationHandler();
    serviceTarget.addService(DomainControllerOperationHandler.SERVICE_NAME,domainControllerOperationHandler).addDependency(DomainController.SERVICE_NAME,DomainController.class,domainControllerOperationHandler.getDomainControllerInjector()).addDependency(SERVICE_NAME_BASE.append("executor"),ScheduledExecutorService.class,domainControllerOperationHandler.getExecutorServiceInjector()).addDependency(SERVICE_NAME_BASE.append("thread-factory"),ThreadFactory.class,domainControllerOperationHandler.getThreadFactoryInjector()).addInjection(domainControllerOperationHandler.getLocalFileRepositoryInjector(),fileRepository).addDependency(ManagementCommunicationService.SERVICE_NAME,ManagementCommunicationService.class,new ManagementCommunicationServiceInjector(domainControllerOperationHandler)).install();
    final DomainControllerClientOperationHandler domainControllerClientOperationHandler=new DomainControllerClientOperationHandler();
    serviceTarget.addService(DomainControllerClientOperationHandler.SERVICE_NAME,domainControllerClientOperationHandler).addDependency(DomainController.SERVICE_NAME,DomainController.class,domainControllerClientOperationHandler.getDomainControllerInjector()).addDependency(ManagementCommunicationService.SERVICE_NAME,ManagementCommunicationService.class,new ManagementCommunicationServiceInjector(domainControllerClientOperationHandler)).install();
    serviceTarget.addService(DomainControllerConnection.SERVICE_NAME,new NewLocalDomainControllerConnection(NewHostController.this,domainController,fileRepository)).addDependency(DomainController.SERVICE_NAME).install();
  }
 catch (  final Exception e) {
    throw new RuntimeException("Exception starting local domain controller",e);
  }
}
