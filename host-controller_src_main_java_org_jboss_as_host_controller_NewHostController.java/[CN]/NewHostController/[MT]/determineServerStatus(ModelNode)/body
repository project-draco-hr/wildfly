{
  ServerStatus status;
  if (!server.isDefined()) {
    status=ServerStatus.DOES_NOT_EXIST;
  }
 else {
    final ManagedServer client=servers.get(ManagedServer.getServerProcessName(server.require(NAME).asString()));
    if (client == null) {
      status=server.require(START).asBoolean() ? ServerStatus.STOPPED : ServerStatus.DISABLED;
    }
 else {
switch (client.getState()) {
case AVAILABLE:
case BOOTING:
case STARTING:
        status=ServerStatus.STARTING;
      break;
case FAILED:
case MAX_FAILED:
    status=ServerStatus.FAILED;
  break;
case STARTED:
status=ServerStatus.STARTED;
break;
case STOPPING:
status=ServerStatus.STOPPING;
break;
case STOPPED:
status=ServerStatus.STOPPED;
break;
default :
throw new IllegalStateException("Unexpected state " + client.getState());
}
}
}
return status;
}
