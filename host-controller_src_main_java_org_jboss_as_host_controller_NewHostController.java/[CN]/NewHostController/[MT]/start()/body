{
  modelManager.start();
  List<ModelNode> hostModelUpdates=parseHostXml();
  for (  ModelNode update : hostModelUpdates) {
    try {
      System.out.println("update " + update);
      execute(update);
    }
 catch (    OperationFailedException e) {
      throw new RuntimeException(e.getFailureDescription().asString());
    }
  }
  System.out.println("=== Parsed model \n " + getModel());
  launchProcessControllerSlave();
  final BatchBuilder batchBuilder=serviceContainer.batchBuilder();
  batchBuilder.addListener(new AbstractServiceListener<Object>(){
    @Override public void serviceFailed(    final ServiceController<?> serviceController,    final StartException reason){
      log.errorf(reason,"Service [%s] failed.",serviceController.getName());
    }
  }
);
  final ServiceActivatorContext serviceActivatorContext=new ServiceActivatorContextImpl(batchBuilder,serviceContainer);
  activateManagementCommunication(serviceActivatorContext);
  if (getHostModel().getLocalDomainControllerElement() != null) {
    activateLocalDomainController(serviceActivatorContext);
  }
 else {
    activateRemoteDomainControllerConnection(serviceActivatorContext);
  }
  final ManagementElement managementElement=getHostModel().getManagementElement();
  final NewHostControllerService hostControllerService=new NewHostControllerService(this);
  batchBuilder.addService(SERVICE_NAME_BASE,hostControllerService).addDependency(NetworkInterfaceService.JBOSS_NETWORK_INTERFACE.append(managementElement.getInterfaceName()),NetworkInterfaceBinding.class,hostControllerService.getManagementInterfaceInjector()).addInjection(hostControllerService.getManagementPortInjector(),managementElement.getPort()).addDependency(DomainControllerConnection.SERVICE_NAME,DomainControllerConnection.class,hostControllerService.getDomainControllerConnectionInjector()).setInitialMode(ServiceController.Mode.ACTIVE).install();
  batchBuilder.install();
}
