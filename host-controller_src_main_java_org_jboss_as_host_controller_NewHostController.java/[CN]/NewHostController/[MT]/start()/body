{
  modelManager.start();
  List<ModelNode> hostModelUpdates=parseHostXml();
  for (  ModelNode update : hostModelUpdates) {
    try {
      System.out.println("update " + update);
      execute(update);
    }
 catch (    OperationFailedException e) {
      throw new RuntimeException(e.getFailureDescription().asString());
    }
  }
  System.out.println("=== Parsed model \n " + getModel());
  launchProcessControllerSlave();
  final BatchBuilder batchBuilder=serviceContainer.batchBuilder();
  batchBuilder.addListener(new AbstractServiceListener<Object>(){
    @Override public void serviceFailed(    final ServiceController<?> serviceController,    final StartException reason){
      log.errorf(reason,"Service [%s] failed.",serviceController.getName());
    }
  }
);
  final ServiceActivatorContext serviceActivatorContext=new ServiceActivatorContextImpl(batchBuilder,serviceContainer);
  try {
    Thread.sleep(1000);
  }
 catch (  InterruptedException e) {
    throw new RuntimeException(e);
  }
  activateManagementCommunication(serviceActivatorContext);
  activateDomainControllerConnection(serviceActivatorContext);
  final NewHostControllerService hostControllerService=new NewHostControllerService(this);
  batchBuilder.addService(SERVICE_NAME_BASE,hostControllerService).addDependency(NetworkInterfaceService.JBOSS_NETWORK_INTERFACE.append(getHostModel().get(MANAGEMENT,INTERFACE).asString()),NetworkInterfaceBinding.class,hostControllerService.getManagementInterfaceInjector()).addInjection(hostControllerService.getManagementPortInjector(),getHostModel().get(MANAGEMENT,PORT).asInt()).addDependency(DomainControllerConnection.SERVICE_NAME,DomainControllerConnection.class,hostControllerService.getDomainControllerConnectionInjector()).setInitialMode(ServiceController.Mode.ACTIVE).install();
  batchBuilder.install();
}
