{
  final OperationContextImpl context=new OperationContextImpl(this,controllerType,EnumSet.noneOf(OperationContextImpl.ContextFlag.class),handler,null,model,control,processState,bootingFlag.get());
  final ModelNode result=context.getResult();
  result.setEmptyList();
  boolean sawExtensionAdd=false;
  List<ParsedOp> postExtensionOps=null;
  for (  ModelNode bootOp : bootList) {
    final ParsedOp parsedOp=new ParsedOp(bootOp);
    if (postExtensionOps != null) {
      if (parsedOp.isExtensionAdd()) {
        final OperationStepHandler stepHandler=rootRegistration.getOperationHandler(parsedOp.address,parsedOp.operationName);
        context.addStep(result.add(),bootOp,stepHandler,OperationContext.Stage.MODEL);
      }
 else {
        postExtensionOps.add(parsedOp);
      }
    }
 else {
      final OperationStepHandler stepHandler=rootRegistration.getOperationHandler(parsedOp.address,parsedOp.operationName);
      if (!sawExtensionAdd && stepHandler == null) {
        String msg=String.format("No handler for operation %s at address %s",parsedOp.operationName,parsedOp.address);
        log.error(msg);
        context.getFailureDescription().set(msg);
        break;
      }
 else       if (stepHandler instanceof ExtensionAddHandler) {
        context.addStep(result.add(),bootOp,stepHandler,OperationContext.Stage.MODEL);
        sawExtensionAdd=true;
      }
 else       if (!sawExtensionAdd) {
        context.addStep(result.add(),bootOp,stepHandler,OperationContext.Stage.MODEL);
      }
 else {
        postExtensionOps=new ArrayList<ParsedOp>();
        postExtensionOps.add(parsedOp);
      }
    }
  }
  if (context.completeStep() == OperationContext.ResultAction.KEEP && postExtensionOps != null) {
    final OperationContextImpl postExtContext=new OperationContextImpl(this,controllerType,EnumSet.noneOf(OperationContextImpl.ContextFlag.class),handler,null,model,control,processState,bootingFlag.get());
    final ModelNode postExtResult=context.getResult();
    postExtResult.setEmptyList();
    for (    ParsedOp parsedOp : postExtensionOps) {
      final OperationStepHandler stepHandler=rootRegistration.getOperationHandler(parsedOp.address,parsedOp.operationName);
      if (stepHandler == null) {
        String msg=String.format("No handler for operation %s at address %s",parsedOp.operationName,parsedOp.address);
        log.error(msg);
        postExtContext.getFailureDescription().set(msg);
        break;
      }
 else {
        final ModelNode response=postExtResult.add();
        postExtContext.addStep(response,parsedOp.operation,stepHandler,OperationContext.Stage.MODEL);
      }
    }
    postExtContext.completeStep();
  }
}
