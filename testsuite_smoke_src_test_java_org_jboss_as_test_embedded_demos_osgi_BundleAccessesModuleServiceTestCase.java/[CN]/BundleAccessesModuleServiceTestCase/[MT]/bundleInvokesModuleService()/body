{
  JavaArchive targetArchive=getTargetModuleArchive();
  String targetDeploymentName=getRemoteRuntime().deploy(targetArchive);
  assertNotNull("Deployment name not null",targetDeploymentName);
  try {
    registerModule(ModuleIdentifier.create("deployment." + targetDeploymentName));
    OSGiBundle clientBundle=getRemoteRuntime().installBundle(getClientBundleArchive());
    assertBundleState(Bundle.INSTALLED,clientBundle.getState());
    try {
      clientBundle.start();
      assertBundleState(Bundle.ACTIVE,clientBundle.getState());
    }
  finally {
      clientBundle.uninstall();
    }
  }
  finally {
    getRemoteRuntime().undeploy(targetDeploymentName);
  }
}
