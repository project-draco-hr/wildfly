{
  String name=model.require(EJB3SubsystemModel.NAME).asString();
  String passivationStore=model.hasDefined(EJB3SubsystemModel.PASSIVATION_STORE) ? model.get(EJB3SubsystemModel.PASSIVATION_STORE).asString() : null;
  Set<String> aliases=new HashSet<String>();
  if (model.hasDefined(EJB3SubsystemModel.ALIASES)) {
    for (    ModelNode alias : model.get(EJB3SubsystemModel.ALIASES).asList()) {
      aliases.add(alias.asString());
    }
  }
  ServiceTarget target=context.getServiceTarget();
  ServiceBuilder<CacheFactory<K,V>> builder=(passivationStore != null) ? new GroupAwareCacheFactoryService<K,V>(name,aliases).build(target,passivationStore) : new NonPassivatingCacheFactoryService<K,V>(name,aliases).build(target);
  if (verificationHandler != null) {
    builder.addListener(verificationHandler);
  }
  return builder.setInitialMode(ServiceController.Mode.ON_DEMAND).install();
}
