{
  if (domainPersister != null) {
    throw MESSAGES.configurationPersisterAlreadyInitialized();
  }
  final File configDir=environment.getDomainConfigurationDir();
  ConfigurationFile domainConfigurationFile=null;
  if (slave) {
    if (environment.isBackupDomainFiles()) {
      domainConfigurationFile=getBackupDomainConfigurationFile();
      domainPersister=ConfigurationPersisterFactory.createRemoteBackupDomainXmlConfigurationPersister(configDir,executorService,extensionRegistry);
    }
 else     if (environment.isUseCachedDc()) {
      domainConfigurationFile=getBackupDomainConfigurationFile();
      domainPersister=ConfigurationPersisterFactory.createCachedRemoteDomainXmlConfigurationPersister(configDir,executorService,extensionRegistry);
    }
 else {
      domainPersister=ConfigurationPersisterFactory.createTransientDomainXmlConfigurationPersister(executorService,extensionRegistry);
    }
  }
 else {
    domainConfigurationFile=getStandardDomainConfigurationFile();
    if (environment.getRunningModeControl().isReloaded()) {
      if (environment.isBackupDomainFiles()) {
        ConfigurationFile cachedRemote=getBackupDomainConfigurationFile();
        File cachedRemoteFile=cachedRemote.getBootFile();
        if (cachedRemoteFile.exists() && cachedRemoteFile.lastModified() > domainConfigurationFile.getBootFile().lastModified()) {
          domainConfigurationFile=cachedRemote;
        }
      }
      domainConfigurationFile.resetBootFile(environment.getRunningModeControl().isUseCurrentDomainConfig());
    }
    domainPersister=ConfigurationPersisterFactory.createDomainXmlConfigurationPersister(domainConfigurationFile,executorService,extensionRegistry);
  }
  environment.setDomainConfigurationFile(domainConfigurationFile);
  this.slave=slave;
}
