{
  if (domainPersister != null) {
    throw new IllegalStateException("Configuration persister for domain model is already initialized");
  }
  final File configDir=environment.getDomainConfigurationDir();
  if (slave) {
    if (environment.isBackupDomainFiles() || environment.isUseCachedDc()) {
      domainPersister=ConfigurationPersisterFactory.createCachedRemoteDomainXmlConfigurationPersister(configDir,executorService);
    }
 else {
      domainPersister=ConfigurationPersisterFactory.createTransientDomainXmlConfigurationPersister(executorService);
    }
  }
 else {
    final ConfigurationFile configurationFile=environment.getDomainConfigurationFile();
    domainPersister=ConfigurationPersisterFactory.createDomainXmlConfigurationPersister(configDir,configurationFile,executorService);
  }
  this.slave=Boolean.valueOf(slave);
}
