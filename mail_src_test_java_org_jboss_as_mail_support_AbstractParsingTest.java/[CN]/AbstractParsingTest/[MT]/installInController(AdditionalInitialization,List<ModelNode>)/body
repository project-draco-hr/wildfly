{
  ServiceContainer container=ServiceContainer.Factory.create("test" + counter.incrementAndGet());
  ServiceTarget target=container.subTarget();
  ControlledProcessState processState=new ControlledProcessState(true);
  StringConfigurationPersister persister=new StringConfigurationPersister(bootOperations,TestParser.INSTANCE);
  ModelControllerService svc=new ModelControllerService(additionalInit,processState,persister);
  ServiceBuilder<ModelController> builder=target.addService(ServiceName.of("ModelController"),svc);
  builder.install();
  if (additionalInit != null) {
    additionalInit.addExtraServices(target);
  }
  svc.latch.await();
  ModelController controller=svc.getValue();
  ModelNode setup=Util.getEmptyOperation("setup",new ModelNode());
  controller.execute(setup,null,null,null);
  processState.setRunning();
  KernelServices kernelServices=new KernelServices(container,controller,persister);
  this.kernelServices.add(kernelServices);
  return kernelServices;
}
