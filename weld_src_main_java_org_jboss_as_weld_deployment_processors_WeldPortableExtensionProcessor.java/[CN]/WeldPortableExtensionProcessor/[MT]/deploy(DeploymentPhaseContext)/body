{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  if (PrivateSubDeploymentMarker.isPrivate(deploymentUnit)) {
    if (!WeldDeploymentMarker.isWeldDeployment(deploymentUnit)) {
      return;
    }
  }
 else   if (deploymentUnit.getParent() == null) {
    if (!WeldDeploymentMarker.isWeldDeployment(deploymentUnit)) {
      return;
    }
  }
 else {
    if (!WeldDeploymentMarker.isWeldDeployment(deploymentUnit.getParent())) {
      return;
    }
  }
  final DeploymentUnit topLevelDeployment=deploymentUnit.getParent() == null ? deploymentUnit : deploymentUnit.getParent();
  final Module module=deploymentUnit.getAttachment(Attachments.MODULE);
  loadAttachments(module,topLevelDeployment);
}
