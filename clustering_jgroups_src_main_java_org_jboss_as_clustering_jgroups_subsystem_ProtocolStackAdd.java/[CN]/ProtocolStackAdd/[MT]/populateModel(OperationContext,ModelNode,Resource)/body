{
  final ModelNode model=resource.getModel();
  populate(operation,model);
  if (operation.hasDefined(ModelKeys.TRANSPORT)) {
    ModelNode addTransport=operation.get(ModelKeys.TRANSPORT).clone();
    addTransport.get(OPERATION_NAME).set(ModelDescriptionConstants.ADD);
    ModelNode transportAddress=operation.get(OP_ADDR).clone();
    transportAddress.add(ModelKeys.TRANSPORT,ModelKeys.TRANSPORT_NAME);
    transportAddress.protect();
    addTransport.get(OP_ADDR).set(transportAddress);
    context.addStep(addTransport,TransportResource.TRANSPORT_ADD,OperationContext.Stage.IMMEDIATE);
  }
  if (operation.hasDefined(ModelKeys.PROTOCOLS)) {
    List<ModelNode> protocols=operation.get(ModelKeys.PROTOCOLS).asList();
    for (int i=protocols.size() - 1; i >= 0; i--) {
      ModelNode protocol=protocols.get(i);
      ModelNode addProtocol=protocol.clone();
      addProtocol.get(OPERATION_NAME).set(ModelKeys.ADD_PROTOCOL);
      ModelNode protocolAddress=operation.get(OP_ADDR).clone();
      protocolAddress.protect();
      addProtocol.get(OP_ADDR).set(protocolAddress);
      context.addStep(addProtocol,ProtocolResource.PROTOCOL_ADD_HANDLER,OperationContext.Stage.IMMEDIATE);
    }
  }
}
