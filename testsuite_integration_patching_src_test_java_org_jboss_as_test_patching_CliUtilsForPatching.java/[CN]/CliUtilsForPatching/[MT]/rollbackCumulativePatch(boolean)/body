{
  CLIWrapper cli=null;
  final String infoCommand="patch info --distribution=%s";
  final String rollbackCommand="patch rollback --patch-id=%s --distribution=%s --reset-configuration=%s";
  try {
    cli=new CLIWrapper(true);
    String command=String.format(infoCommand,PatchingTestUtil.AS_DISTRIBUTION);
    logger.info("----- sending command to CLI: " + command + " -----");
    cli.sendLine(command);
    String response=cli.readOutput();
    ModelNode responseNode=ModelNode.fromJSONString(response);
    String cumulativePatchId=responseNode.get("result").get("cumulative-patch-id").asString();
    return cli.sendLine(String.format(rollbackCommand,cumulativePatchId,PatchingTestUtil.AS_DISTRIBUTION,resetConfiguration),true);
  }
  finally {
    if (cli != null) {
      cli.quit();
    }
  }
}
