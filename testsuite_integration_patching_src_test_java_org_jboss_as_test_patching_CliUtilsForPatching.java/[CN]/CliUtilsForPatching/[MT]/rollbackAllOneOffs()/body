{
  CLIWrapper cli=null;
  boolean success=true;
  final String infoCommand="patch info --distribution=%s";
  final String rollbackCommand="patch rollback --patch-id=%s --distribution=%s --reset-configuration=true";
  try {
    cli=new CLIWrapper(false);
    cli.sendLine(String.format(infoCommand,PatchingTestUtil.AS_DISTRIBUTION));
    String response=cli.readOutput();
    ModelNode responseNode=ModelNode.fromJSONString(response);
    List<ModelNode> patchesList=responseNode.get("result").get("patches").asList();
    for (    ModelNode n : patchesList) {
      success=success && cli.sendLine(String.format(rollbackCommand,n.asString(),PatchingTestUtil.AS_DISTRIBUTION),true);
    }
    return success;
  }
  finally {
    if (cli != null) {
      cli.quit();
    }
  }
}
