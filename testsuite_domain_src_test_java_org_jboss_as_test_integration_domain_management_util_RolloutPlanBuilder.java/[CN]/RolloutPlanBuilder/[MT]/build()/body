{
  ModelNode plan=new ModelNode();
  for (  Object step : series) {
    if (step instanceof Object[]) {
      Object[] pair=(Object[])step;
      String groupName=(String)pair[0];
      RolloutPolicy policy=(RolloutPolicy)pair[1];
      ModelNode group=new ModelNode();
      group.get(groupName).set(policy.toModelNode());
      ModelNode serverGroup=new ModelNode();
      serverGroup.get(SERVER_GROUP).set(group);
      plan.get(IN_SERIES).add(serverGroup);
    }
 else {
      Map<String,RolloutPolicy> concurrentGroups=(Map<String,RolloutPolicy>)step;
      ModelNode groups=new ModelNode();
      for (      String groupName : concurrentGroups.keySet()) {
        ModelNode group=new ModelNode();
        group.get(groupName).set(concurrentGroups.get(groupName).toModelNode());
        groups.get(groupName).set(group);
      }
      ModelNode concurrentGroupsNode=new ModelNode();
      concurrentGroupsNode.get(CONCURRENT_GROUPS).set(groups);
      plan.get(IN_SERIES).add(concurrentGroupsNode);
    }
  }
  plan.get(ROLLBACK_ACROSS_GROUPS).set(rollBackAcrossGroups);
  ModelNode rolloutPlan=new ModelNode();
  rolloutPlan.get(ROLLOUT_PLAN).set(plan);
  return rolloutPlan;
}
