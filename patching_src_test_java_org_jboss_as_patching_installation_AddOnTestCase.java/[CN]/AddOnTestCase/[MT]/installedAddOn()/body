{
  String addOnName=randomString();
  installAddOn(env.getModuleRoot(),addOnName);
  ProductConfig productConfig=new ProductConfig("product","version","consoleSlot");
  TestUtils.tree(env.getInstalledImage().getJbossHome());
  InstalledIdentity installedIdentity=InstalledIdentity.load(env.getInstalledImage().getJbossHome(),productConfig,env.getInstalledImage().getModulesDir());
  Identity identity=installedIdentity.getIdentity();
  assertEquals(productConfig.getProductName(),identity.getName());
  assertEquals(productConfig.resolveVersion(),identity.getVersion());
  Collection<AddOn> addOns=installedIdentity.getAddOns();
  assertEquals(1,addOns.size());
  AddOn addOn=addOns.iterator().next();
  assertEquals(addOnName,addOn.getName());
  PatchableTarget.TargetInfo targetInfo=addOn.loadTargetInfo();
  assertEquals(BASE,targetInfo.getCumulativeID());
  assertTrue(targetInfo.getPatchIDs().isEmpty());
  DirectoryStructure directoryStructure=targetInfo.getDirectoryStructure();
  assertEquals(newFile(env.getModuleRoot(),"system",ADD_ONS,addOnName),directoryStructure.getModuleRoot());
  assertNull(directoryStructure.getBundleRepositoryRoot());
}
