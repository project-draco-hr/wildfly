{
  ObjectName objectName=ManagedServiceContainer.OBJECT_NAME;
  MBeanServerConnection mbeanServer=getMBeanServerConnection();
  ManagedServiceContainer proxy=MBeanProxy.get(mbeanServer,objectName,ManagedServiceContainer.class);
  State currentState=State.valueOf(proxy.getState(serviceName.getCanonicalName()));
  while (timeout > 0 && currentState != expectedState) {
    Thread.sleep(100);
    timeout-=100;
    currentState=State.valueOf(proxy.getState(serviceName.getCanonicalName()));
  }
  if (currentState != expectedState)   throw new IllegalStateException("Unexpected state for [" + serviceName + "] - "+ currentState);
}
