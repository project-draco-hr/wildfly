{
  if (psCache != null) {
    PreparedStatementCache.Key key=new PreparedStatementCache.Key(sql,PreparedStatementCache.Key.PREPARED_STATEMENT,resultSetType,resultSetConcurrency);
    CachedPreparedStatement cachedps=(CachedPreparedStatement)psCache.get(key);
    if (cachedps != null) {
      if (canUse(cachedps)) {
        cachedps.inUse();
      }
 else {
        return doPrepareStatement(sql,resultSetType,resultSetConcurrency);
      }
    }
 else {
      PreparedStatement ps=doPrepareStatement(sql,resultSetType,resultSetConcurrency);
      cachedps=WRAPPED_CONNECTION_FACTORY.createCachedPreparedStatement(ps);
      psCache.insert(key,cachedps);
    }
    return cachedps;
  }
 else {
    return doPrepareStatement(sql,resultSetType,resultSetConcurrency);
  }
}
