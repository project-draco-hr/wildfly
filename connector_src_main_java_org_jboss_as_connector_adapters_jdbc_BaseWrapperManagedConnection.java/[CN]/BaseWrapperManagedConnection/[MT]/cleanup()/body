{
synchronized (handles) {
    for (Iterator<WrappedConnection> i=handles.iterator(); i.hasNext(); ) {
      WrappedConnection lc=i.next();
      lc.setManagedConnection(null);
    }
    handles.clear();
  }
synchronized (stateLock) {
    jdbcAutoCommit=true;
    jdbcReadOnly=readOnly;
    if (jdbcTransactionIsolation != transactionIsolation) {
      try {
        con.setTransactionIsolation(transactionIsolation);
        jdbcTransactionIsolation=transactionIsolation;
      }
 catch (      SQLException e) {
        mcf.log.warn("Error resetting transaction isolation ",e);
      }
    }
  }
  lock=new ReentrantLock(true);
}
