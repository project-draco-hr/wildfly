{
  mdr.getValue().registerJndiMapping(url.toExternalForm(),cf.getClass().getName(),jndi);
  log.infof("Registered connection factory %s",jndi);
  final ConnectionFactoryService connectionFactoryService=new ConnectionFactoryService(cf);
  final ServiceName connectionFactoryServiceName=ConnectionFactoryService.SERVICE_NAME_BASE.append(jndi);
  serviceTarget.addService(connectionFactoryServiceName,connectionFactoryService).setInitialMode(ServiceController.Mode.ACTIVE).install();
  final ConnectionFactoryReferenceFactoryService referenceFactoryService=new ConnectionFactoryReferenceFactoryService();
  final ServiceName referenceFactoryServiceName=ConnectionFactoryReferenceFactoryService.SERVICE_NAME_BASE.append(jndi);
  serviceTarget.addService(referenceFactoryServiceName,referenceFactoryService).addDependency(connectionFactoryServiceName,Object.class,referenceFactoryService.getDataSourceInjector()).setInitialMode(ServiceController.Mode.ACTIVE).install();
  final ContextNames.BindInfo bindInfo=ContextNames.bindInfoFor(jndi);
  final BinderService binderService=new BinderService(bindInfo.getBindName());
  serviceTarget.addService(bindInfo.getBinderServiceName(),binderService).addDependency(referenceFactoryServiceName,ManagedReferenceFactory.class,binderService.getManagedObjectInjector()).addDependency(bindInfo.getParentContextServiceName(),ServiceBasedNamingStore.class,binderService.getNamingStoreInjector()).addDependency(ConnectorServices.RESOURCE_ADAPTER_SERVICE_PREFIX.append(deploymentName)).addListener(new AbstractServiceListener<Object>(){
    public void serviceStarted(    ServiceController<?> controller){
      log.infof("Bound JCA ConnectionFactory [%s]",jndi);
    }
    public void serviceStopped(    ServiceController<?> serviceController){
      log.infof("Unbound JCA ConnectionFactory [%s]",jndi);
    }
    public void serviceRemoved(    ServiceController<?> serviceController){
      log.debugf("Removed JCA ConnectionFactory [%s]",jndi);
      serviceController.removeListener(this);
    }
  }
).setInitialMode(ServiceController.Mode.ACTIVE).install();
  return new String[]{jndi};
}
