{
  ServiceName sslServiceName=realmServiceName.append(SSLIdentityService.SERVICE_SUFFIX);
  ServiceName keystoreServiceName=null;
  char[] password=null;
  if (ssl.hasDefined(KEYSTORE_PATH)) {
    keystoreServiceName=realmServiceName.append(FileKeystoreService.KEYSTORE_SUFFIX);
    password=addFileKeystoreService(context,ssl,keystoreServiceName,serviceTarget,newControllers);
  }
  ServiceName truststoreServiceName=null;
  if (trustStore != null) {
    truststoreServiceName=realmServiceName.append(FileKeystoreService.TRUSTSTORE_SUFFIX);
    addFileKeystoreService(context,trustStore,truststoreServiceName,serviceTarget,newControllers);
  }
  SSLIdentityService sslIdentityService=new SSLIdentityService(ssl,password);
  ServiceBuilder<?> sslBuilder=serviceTarget.addService(sslServiceName,sslIdentityService);
  if (keystoreServiceName != null) {
    sslBuilder.addDependency(keystoreServiceName,KeyStore.class,sslIdentityService.getKeyStoreInjector());
  }
  if (truststoreServiceName != null) {
    sslBuilder.addDependency(truststoreServiceName,KeyStore.class,sslIdentityService.getTrustStoreInjector());
  }
  newControllers.add(sslBuilder.setInitialMode(ON_DEMAND).install());
  return sslServiceName;
}
