{
  if (cache != null && cache.isDefined()) {
    ModelNode cacheDefinition=null;
    boolean byAccessTime=false;
    if (cache.hasDefined(BY_ACCESS_TIME)) {
      cacheDefinition=cache.require(BY_ACCESS_TIME);
      byAccessTime=true;
    }
 else     if (cache.hasDefined(BY_SEARCH_TIME)) {
      cacheDefinition=cache.require(BY_SEARCH_TIME);
    }
    if (cacheDefinition != null) {
      int evictionTime=LdapCacheResourceDefinition.EVICTION_TIME.resolveModelAttribute(context,cacheDefinition).asInt();
      boolean cacheFailures=LdapCacheResourceDefinition.CACHE_FAILURES.resolveModelAttribute(context,cacheDefinition).asBoolean();
      int maxSize=LdapCacheResourceDefinition.MAX_CACHE_SIZE.resolveModelAttribute(context,cacheDefinition).asInt();
      return byAccessTime ? LdapCacheService.createByAccessCacheService(searcher,evictionTime,cacheFailures,maxSize) : LdapCacheService.createBySearchCacheService(searcher,evictionTime,cacheFailures,maxSize);
    }
  }
  return LdapCacheService.createNoCacheService(searcher);
}
