{
  ServiceName secretServiceName=SecretIdentityService.ServiceUtil.createServiceName(realmName);
  ModelNode resolvedValueNode=SecretServerIdentityResourceDefinition.VALUE.resolveModelAttribute(context,secret);
  boolean base64=secret.get(SecretServerIdentityResourceDefinition.VALUE.getName()).getType() != ModelType.EXPRESSION;
  SecretIdentityService sis=new SecretIdentityService(resolvedValueNode.asString(),base64);
  final ServiceController<CallbackHandlerFactory> serviceController=serviceTarget.addService(secretServiceName,sis).setInitialMode(ON_DEMAND).install();
  if (newControllers != null) {
    newControllers.add(serviceController);
  }
  CallbackHandlerFactory.ServiceUtil.addDependency(realmBuilder,injector,secretServiceName,false);
}
