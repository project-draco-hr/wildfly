{
  ServiceName jaasServiceName=JaasCallbackHandler.ServiceUtil.createServiceName(realmName);
  String name=JaasAuthenticationResourceDefinition.NAME.resolveModelAttribute(context,jaas).asString();
  boolean assignGroups=JaasAuthenticationResourceDefinition.ASSIGN_GROUPS.resolveModelAttribute(context,jaas).asBoolean();
  JaasCallbackHandler jaasCallbackHandler=new JaasCallbackHandler(realmName,name,assignGroups);
  ServiceBuilder<?> jaasBuilder=serviceTarget.addService(jaasServiceName,jaasCallbackHandler);
  if (injectServerManager) {
    jaasBuilder.addDependency(ServiceName.JBOSS.append("security","simple-security-manager"),ServerSecurityManager.class,jaasCallbackHandler.getSecurityManagerValue());
  }
  final ServiceController<?> sc=jaasBuilder.setInitialMode(ON_DEMAND).install();
  if (newControllers != null) {
    newControllers.add(sc);
  }
  CallbackHandlerService.ServiceUtil.addDependency(realmBuilder,injector,jaasServiceName,false);
}
