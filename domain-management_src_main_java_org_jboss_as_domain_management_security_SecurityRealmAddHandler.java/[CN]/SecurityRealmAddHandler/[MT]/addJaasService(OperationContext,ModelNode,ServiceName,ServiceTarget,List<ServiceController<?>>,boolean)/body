{
  ServiceName jaasServiceName=realmServiceName.append(JaasCallbackHandler.SERVICE_SUFFIX);
  String name=JaasAuthenticationResourceDefinition.NAME.resolveModelAttribute(context,jaas).asString();
  JaasCallbackHandler jaasCallbackHandler=new JaasCallbackHandler(name);
  ServiceBuilder<?> jaasBuilder=serviceTarget.addService(jaasServiceName,jaasCallbackHandler);
  if (injectServerManager) {
    jaasBuilder.addDependency(ServiceName.JBOSS.append("security","simple-security-manager"),ServerSecurityManager.class,jaasCallbackHandler.getSecurityManagerValue());
  }
  newControllers.add(jaasBuilder.setInitialMode(ON_DEMAND).install());
  return jaasServiceName;
}
