{
  final List<ServiceController<?>> newControllers=new ArrayList<ServiceController<?>>();
  final String realmName=ManagementUtil.getSecurityRealmName(operation);
  final ModelNode model=Resource.Tools.readModel(context.readResource(PathAddress.EMPTY_ADDRESS));
  SecurityRealmAddHandler.INSTANCE.installServices(context,realmName,model,new ServiceVerificationHandler(),newControllers);
  context.completeStep(new OperationContext.RollbackHandler(){
    @Override public void handleRollback(    OperationContext context,    ModelNode operation){
      for (      ServiceController<?> sc : newControllers) {
        context.removeService(sc);
      }
    }
  }
);
}
