{
  if (failure != null) {
    SECURITY_LOGGER.tracef("Using cached failure for search with key '%s'",key);
    throw failure;
  }
 else   if (result != null) {
    SECURITY_LOGGER.tracef("Using cached result for search with key '%s'",key);
    return result;
  }
synchronized (this) {
    if (failure != null) {
      SECURITY_LOGGER.tracef("Using cached failure for search with key '%s'",key);
      throw failure;
    }
 else     if (result != null) {
      SECURITY_LOGGER.tracef("Using cached result for search with key '%s'",key);
      return result;
    }
    try {
      R result=internalSearch(contextFactory.getDirContext(),key);
      SECURITY_LOGGER.tracef("New search for entry with key '%s'",key);
      SearchResult<R> searchResult=new SearchResultImpl<R>(result);
      return this.result=searchResult;
    }
 catch (    NamingException e) {
      if (cacheFailures) {
        failure=e;
      }
      throw e;
    }
  }
}
