{
  try {
    String jbossHomeKey="jboss.home";
    String jbossHomeDir=System.getProperty(jbossHomeKey);
    if (jbossHomeDir == null)     throw new IllegalStateException("Cannot find system property: " + jbossHomeKey);
    File modulesJar=new File(jbossHomeDir + "/jboss-modules.jar");
    if (modulesJar.exists() == false)     throw new IllegalStateException("Cannot find: " + modulesJar);
    List<String> cmd=new ArrayList<String>();
    cmd.add("java");
    cmd.add("-Djboss.home.dir=" + jbossHomeDir);
    cmd.add("-Dorg.jboss.boot.log.file=" + jbossHomeDir + "/standalone/log/boot.log");
    cmd.add("-Dlogging.configuration=file:" + jbossHomeDir + "/standalone/configuration/logging.properties");
    cmd.add("-jar");
    cmd.add(modulesJar.getAbsolutePath());
    cmd.add("-mp");
    cmd.add(jbossHomeDir + "/modules");
    cmd.add("-logmodule");
    cmd.add("org.jboss.logmanager");
    cmd.add("org.jboss.as.standalone");
    log.info("Starting container with: " + cmd.toString());
    ProcessBuilder processBuilder=new ProcessBuilder(cmd);
    processBuilder.redirectErrorStream(true);
    process=processBuilder.start();
    new Thread(new ConsoleConsumer()).start();
    long timeout=5000;
    boolean testRunnerMBeanAvaialble=false;
    MBeanServerConnection mbeanServer=null;
    while (timeout > 0 && testRunnerMBeanAvaialble == false) {
      if (mbeanServer == null) {
        try {
          mbeanServer=getMBeanServerConnection();
        }
 catch (        Exception ex) {
        }
      }
      testRunnerMBeanAvaialble=(mbeanServer != null && mbeanServer.isRegistered(JMXTestRunnerMBean.OBJECT_NAME));
      Thread.sleep(100);
      timeout-=100;
    }
  }
 catch (  Exception e) {
    throw new LifecycleException("Could not start container",e);
  }
}
