{
  try {
    boolean acquired=semaphore.tryAcquire(timeout,timeUnit);
    if (!acquired)     throw MESSAGES.failedToAcquirePermit(timeout,timeUnit);
  }
 catch (  InterruptedException e) {
    throw MESSAGES.acquireSemaphoreInterrupted();
  }
synchronized (pool) {
    if (!pool.isEmpty()) {
      return pool.removeFirst();
    }
  }
  T bean=null;
  try {
    ++inUse;
    bean=create();
  }
  finally {
    if (bean == null) {
      --inUse;
      semaphore.release();
    }
  }
  return bean;
}
