{
  PrimitiveListAttributeDefinition ld=PrimitiveListAttributeDefinition.Builder.of("test",ModelType.INT).setAllowExpression(true).setElementValidator(new IntRangeValidator(1,false,true)).build();
  ModelNode op=new ModelNode();
  op.get("test").add(2).add("${test:1}");
  ModelNode validated=ld.validateOperation(op);
  assertEquals(op.get("test").get(0),validated.get(0));
  assertEquals(new ModelNode().setExpression(op.get("test").get(1).asString()),validated.get(1));
  ModelNode model=new ModelNode();
  ld.validateAndSet(op,model);
  assertEquals(op.get("test").get(0),model.get("test").get(0));
  assertEquals(new ModelNode().setExpression(op.get("test").get(1).asString()),model.get("test").get(1));
  ld=PrimitiveListAttributeDefinition.Builder.of("test",ModelType.PROPERTY).setAllowExpression(true).setElementValidator(new ModelTypeValidator(ModelType.PROPERTY,false,true)).build();
  op=new ModelNode();
  op.get("test").add("foo",2).add("bar","${test:1}");
  try {
    ld.validateOperation(op);
    fail("Did not reject " + op);
  }
 catch (  IllegalStateException good) {
  }
  try {
    ld.validateAndSet(op,new ModelNode());
    fail("Did not reject " + op);
  }
 catch (  IllegalStateException good) {
  }
}
