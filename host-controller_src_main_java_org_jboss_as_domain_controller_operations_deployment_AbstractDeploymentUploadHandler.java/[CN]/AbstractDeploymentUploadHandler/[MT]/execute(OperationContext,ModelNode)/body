{
  if (contentRepository != null) {
    AuthorizationResult authorizationResult=context.authorize(operation,ACTION_EFFECT_SET);
    if (authorizationResult.getDecision() == AuthorizationResult.Decision.DENY) {
      throw ControllerMessages.MESSAGES.unauthorized(operation.get(ModelDescriptionConstants.OP).asString(),PathAddress.pathAddress(operation.get(ModelDescriptionConstants.OP_ADDR)),authorizationResult.getExplanation());
    }
    try {
      InputStream is=getContentInputStream(context,operation);
      try {
        byte[] hash=contentRepository.addContent(is);
        context.getResult().set(hash);
      }
  finally {
        safeClose(is);
      }
    }
 catch (    IOException e) {
      throw new OperationFailedException(new ModelNode().set(e.toString()));
    }
  }
  context.stepCompleted();
}
