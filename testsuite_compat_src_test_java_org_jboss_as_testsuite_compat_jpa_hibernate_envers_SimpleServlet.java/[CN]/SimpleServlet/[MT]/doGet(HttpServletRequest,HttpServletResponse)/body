{
  String type=req.getParameter("type");
  Writer writer=resp.getWriter();
  Long count=0L;
  if (type.equals("query")) {
    EntityManager localEntityManager=emf.createEntityManager();
    Query query=localEntityManager.createQuery("select count(*) from Person");
    Long count1=(Long)query.getSingleResult();
    localEntityManager.close();
    query=em.createQuery("select count(*) from Person");
    Long count2=(Long)query.getSingleResult();
    if (count1 != count2) {
      throw new RuntimeException("Local EntityManager and Injected EntityManager get different result");
    }
 else {
      count=count1;
    }
  }
 else   if (type.equals("revision")) {
    EntityManager localEntityManager=emf.createEntityManager();
    AuditReader reader=AuditReaderFactory.get(localEntityManager);
    Address address1_rev=reader.find(Address.class,1,1);
    count=Long.valueOf(address1_rev.getPersons().size());
  }
  writer.write(count.toString());
}
