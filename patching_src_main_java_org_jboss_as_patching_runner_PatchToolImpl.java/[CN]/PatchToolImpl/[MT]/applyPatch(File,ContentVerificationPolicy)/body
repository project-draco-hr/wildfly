{
  try {
    if (file.isDirectory()) {
      final File patchXml=new File(file,PatchXml.PATCH_XML);
      if (patchXml.exists()) {
        return execute(file,contentPolicy);
      }
    }
    final InputStream is=new FileInputStream(file);
    try {
      return applyPatch(is,contentPolicy);
    }
  finally {
      if (is != null)       try {
        is.close();
      }
 catch (      IOException e) {
        PatchLogger.ROOT_LOGGER.debugf(e,"failed to close input stream");
      }
    }
  }
 catch (  PatchingException e) {
    throw e;
  }
catch (  Exception e) {
    throw new PatchingException(e);
  }
}
