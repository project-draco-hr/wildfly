{
  ServiceReference sref=context.getServiceReference(Repository.class.getName());
  Repository repo=(Repository)context.getService(sref);
  assertNotNull("Repository not null",repo);
  XRepository xrepo=(XRepository)repo;
  RequirementBuilder reqbuilder=xrepo.getRequirementBuilder();
  Requirement req=reqbuilder.createArtifactRequirement("org.apache.felix:org.apache.felix.eventadmin:1.2.6");
  assertNotNull("Requirement not null",req);
  Collection<Capability> caps=xrepo.findProviders(req);
  assertEquals("Capability not null",1,caps.size());
  XIdentityCapability xcap=(XIdentityCapability)caps.iterator().next();
  assertEquals("org.apache.felix.eventadmin",xcap.getSymbolicName());
  InputStream content=xcap.getResource().getContent();
  try {
    Bundle bundle=context.installBundle(xcap.getSymbolicName(),content);
    try {
      bundle.start();
      assertBundleState(Bundle.ACTIVE,bundle.getState());
      sref=context.getServiceReference("org.osgi.service.event.EventAdmin");
      assertNotNull("EventAdmin service not null",sref);
    }
  finally {
      bundle.uninstall();
    }
  }
  finally {
    content.close();
  }
}
