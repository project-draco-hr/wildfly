{
  if (attributes != null) {
    final ServletContext context=this.context.getServletContext();
    for (    ServletContextAttribute attribute : attributes) {
      context.setAttribute(attribute.getName(),attribute.getValue());
    }
  }
  context.setRealm(realm.getValue());
  WebInjectionContainer.setCurrentInjectionContainer(injectionContainer);
  final List<SetupAction> actions=new ArrayList<SetupAction>();
  actions.addAll(setupActions);
  context.setInstanceManager(injectionContainer);
  context.setThreadBindingListener(new ThreadSetupBindingListener(actions));
  WEB_LOGGER.registerWebapp(context.getName());
  try {
    try {
      context.create();
    }
 catch (    Exception e) {
      throw new StartException(MESSAGES.createContextFailed(),e);
    }
    try {
      context.start();
    }
 catch (    LifecycleException e) {
      throw new StartException(MESSAGES.startContextFailed(),e);
    }
    if (context.getState() != 1) {
      throw new StartException(MESSAGES.startContextFailed());
    }
  }
  finally {
    WebInjectionContainer.setCurrentInjectionContainer(null);
  }
}
