{
  context.setRealm(realm.getValue());
  JsfInjectionProvider.getInjectionContainer().set(injectionContainer);
  final List<SetupAction> actions=new ArrayList<SetupAction>();
  actions.addAll(setupActions);
  context.setThreadBindingListener(new ThreadSetupBindingListener(actions));
  try {
    try {
      context.create();
    }
 catch (    Exception e) {
      throw new StartException("failed to create context",e);
    }
    try {
      context.start();
    }
 catch (    LifecycleException e) {
      throw new StartException("failed to start context",e);
    }
    if (context.getState() != 1) {
      throw new StartException("failed to start context");
    }
    log.info("registering web context: " + context.getName());
  }
  finally {
    JsfInjectionProvider.getInjectionContainer().set(null);
  }
}
