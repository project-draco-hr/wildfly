{
  final S state=node.artifact.getState(parentState,ctx);
  if (state == null) {
    return;
  }
  if (node.handler != null) {
    node.handler.handle(ctx,state);
  }
  if (state instanceof ArtifactCollectionState) {
    final ArtifactCollectionState<?> col=(ArtifactCollectionState<?>)state;
    col.resetIndex();
    while (col.hasNext(ctx)) {
      col.next(ctx);
      for (      ArtifactTreeNode<S,? extends Artifact.State> child : node.children) {
        handleNode(ctx,child,state);
      }
    }
  }
 else {
    for (    ArtifactTreeNode<S,? extends Artifact.State> child : node.children) {
      handleNode(ctx,child,state);
    }
  }
}
