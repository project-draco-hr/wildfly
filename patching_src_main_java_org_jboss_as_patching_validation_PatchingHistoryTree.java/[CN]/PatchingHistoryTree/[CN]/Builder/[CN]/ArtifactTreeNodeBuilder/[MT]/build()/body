{
  final List<ArtifactTreeNode<S,? extends Artifact.State>> nodes;
switch (children.size()) {
case 0:
    nodes=Collections.emptyList();
  break;
case 1:
nodes=Collections.<ArtifactTreeNode<S,? extends Artifact.State>>singletonList(children.values().iterator().next().build());
break;
default :
nodes=new ArrayList<ArtifactTreeNode<S,? extends Artifact.State>>(children.size());
for (ArtifactTreeNodeBuilder<S,? extends Artifact.State> nodeBuilder : children.values()) {
nodes.add(nodeBuilder.build());
}
}
return new ArtifactTreeNode<P,S>(artifact,handler,nodes);
}
