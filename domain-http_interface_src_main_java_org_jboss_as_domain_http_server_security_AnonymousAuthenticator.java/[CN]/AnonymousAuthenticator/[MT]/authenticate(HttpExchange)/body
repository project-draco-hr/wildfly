{
  Subject subject=(Subject)exchange.getAttribute(Subject.class.getName(),AttributeScope.CONNECTION);
  if (subject != null) {
    Set<HttpPrincipal> httpPrincipals=subject.getPrincipals(HttpPrincipal.class);
    if (httpPrincipals.size() > 0) {
      return new Success(httpPrincipals.iterator().next());
    }
  }
  HttpPrincipal principal=new HttpPrincipal(ANONYMOUS,ANONYMOUS);
  RealmUser realmUser=new RealmUser(ANONYMOUS);
  subject=new Subject();
  Set<Principal> principals=subject.getPrincipals();
  principals.add(principal);
  principals.add(realmUser);
  exchange.setAttribute(Subject.class.getName(),subject,AttributeScope.CONNECTION);
  return new Authenticator.Success(principal);
}
