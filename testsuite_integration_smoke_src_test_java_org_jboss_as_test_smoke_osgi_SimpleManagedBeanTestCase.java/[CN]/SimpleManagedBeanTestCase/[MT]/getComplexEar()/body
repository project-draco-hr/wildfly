{
  final WebArchive war=ShrinkWrap.create(WebArchive.class,COMPLEX_WAR);
  war.addClasses(SimpleBeanServlet.class);
  final JavaArchive jar=ShrinkWrap.create(JavaArchive.class,COMPLEX_CDI_JAR);
  jar.addClasses(SimpleManagedBean.class);
  jar.addAsManifestResource(EmptyAsset.INSTANCE,"beans.xml");
  jar.setManifest(new Asset(){
    @Override public InputStream openStream(){
      OSGiManifestBuilder builder=OSGiManifestBuilder.newInstance();
      builder.addBundleSymbolicName(jar.getName());
      builder.addBundleManifestVersion(2);
      builder.addExportPackages(SimpleManagedBean.class);
      builder.addImportPackages(ManagedBean.class,DataSource.class);
      return builder.openStream();
    }
  }
);
  final EnterpriseArchive ear=ShrinkWrap.create(EnterpriseArchive.class,COMPLEX_EAR);
  ear.addAsModule(war);
  ear.addAsModule(jar);
  return ear;
}
