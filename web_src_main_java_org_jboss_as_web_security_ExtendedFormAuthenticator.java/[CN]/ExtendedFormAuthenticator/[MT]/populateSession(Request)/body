{
  Session session=request.getSessionInternal(false);
  if (session != null) {
    HttpSession httpSession=session.getSession();
    WebLogger.WEB_SECURITY_LOGGER.tracef("SessionID: " + httpSession.getId());
    String username=request.getParameter(Constants.FORM_USERNAME);
    WebLogger.WEB_SECURITY_LOGGER.tracef("Setting " + Constants.FORM_USERNAME + " = "+ username);
    httpSession.setAttribute(Constants.FORM_USERNAME,username);
    if (includePassword) {
      String password=request.getParameter(Constants.FORM_PASSWORD);
      String displayPassword=(password == null ? " = null" : " = --hidden--");
      WebLogger.WEB_SECURITY_LOGGER.tracef("Setting " + Constants.FORM_PASSWORD + displayPassword);
      httpSession.setAttribute(Constants.FORM_PASSWORD,password);
    }
    Throwable t=SecurityActions.getAuthException();
    WebLogger.WEB_SECURITY_LOGGER.tracef("Setting " + LOGIN_EXCEPTION + " = "+ t);
    httpSession.setAttribute(LOGIN_EXCEPTION,t);
    session.setNote(DID_POPULATE,Boolean.TRUE);
  }
 else {
    WebLogger.WEB_SECURITY_LOGGER.tracef("No Session to store login parameters in");
  }
}
