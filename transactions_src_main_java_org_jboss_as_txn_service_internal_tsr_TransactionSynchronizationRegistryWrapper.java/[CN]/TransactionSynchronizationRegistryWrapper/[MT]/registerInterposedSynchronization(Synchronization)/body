{
  try {
    Transaction tx=transactionManager.getTransaction();
    JCAOrderedLastSynchronizationList jcaOrderedLastSynchronization=interposedSyncs.get(tx);
    if (jcaOrderedLastSynchronization == null) {
      JCAOrderedLastSynchronizationList toPut=new JCAOrderedLastSynchronizationList(tx,interposedSyncs);
      jcaOrderedLastSynchronization=interposedSyncs.putIfAbsent(tx,toPut);
      if (jcaOrderedLastSynchronization == null) {
        jcaOrderedLastSynchronization=toPut;
        delegate.registerInterposedSynchronization(jcaOrderedLastSynchronization);
      }
    }
    jcaOrderedLastSynchronization.addInterposedSynchronization(sync);
  }
 catch (  SystemException e) {
    throw new IllegalStateException(e);
  }
}
