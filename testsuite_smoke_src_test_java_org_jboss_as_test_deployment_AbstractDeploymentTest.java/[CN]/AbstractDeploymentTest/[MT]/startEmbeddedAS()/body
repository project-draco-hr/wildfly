{
  String asHome=getASHome();
  Properties props=new Properties();
  props.setProperty(ServerEnvironment.HOME_DIR,asHome);
  ServerEnvironment env=new ServerEnvironment(props,"embedded as7",true);
  System.setProperty("module.path",env.getModulesDir().getAbsolutePath());
  DeploymentManagerProvider service=new DeploymentManagerProvider();
  StandaloneServer server=new StandaloneServer(env);
  try {
    server.start(Collections.<ServiceActivator>singletonList(service));
  }
 catch (  ServerStartException e) {
    e.printStackTrace();
    fail("Failed to start embedded server.");
  }
synchronized (service) {
    try {
      service.wait(5000);
    }
 catch (    InterruptedException e) {
    }
  }
  assertTrue("Deployment manager provider started.",service.isStarted());
  ServerDeploymentManager deploymentManager=service.getDeploymentManager();
  assertNotNull(deploymentManager);
  return deploymentManager;
}
