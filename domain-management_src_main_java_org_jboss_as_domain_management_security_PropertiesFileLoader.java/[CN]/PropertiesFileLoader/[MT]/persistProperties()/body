{
  beginPersistence();
  List<String> content=readFile(propertiesFile);
  BufferedWriter bw=new BufferedWriter(new OutputStreamWriter(new FileOutputStream(propertiesFile),"UTF8"));
  try {
    for (    String line : content) {
      String trimmed=line.trim();
      if (trimmed.length() == 0) {
        bw.newLine();
      }
 else {
        Matcher matcher=PROPERTY_PATTERN.matcher(trimmed);
        if (matcher.matches()) {
          final String key=matcher.group(1);
          if (toSave.containsKey(key)) {
            writeProperty(bw,key);
            toSave.remove(key);
            toSave.remove(key + "!disable");
          }
        }
 else {
          write(bw,line,true);
        }
      }
    }
    endPersistence(bw);
  }
  finally {
    safeClose(bw);
  }
}
