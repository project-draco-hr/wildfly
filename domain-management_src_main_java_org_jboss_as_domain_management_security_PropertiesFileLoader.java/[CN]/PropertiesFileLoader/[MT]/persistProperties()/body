{
  beginPersistence();
  List<String> content=new ArrayList<String>();
  FileReader fileReader=new FileReader(propertiesFile);
  BufferedReader bufferedFileReader=new BufferedReader(fileReader);
  try {
    String line=null;
    int i=0;
    while ((line=bufferedFileReader.readLine()) != null) {
      content.add(line);
    }
  }
  finally {
    safeClose(bufferedFileReader);
    safeClose(fileReader);
  }
  BufferedWriter bw=new BufferedWriter(new OutputStreamWriter(new FileOutputStream(propertiesFile),"UTF8"));
  try {
    for (    String line : content) {
      String trimmed=line.trim();
      if (trimmed.startsWith(COMMENT_PREFIX)) {
        write(bw,line,true);
      }
 else       if (trimmed.length() == 0) {
        bw.newLine();
      }
 else {
        int equals=trimmed.indexOf('=');
        if (equals > 0) {
          String userName=trimmed.substring(0,equals);
          if (toSave.containsKey(userName)) {
            String escapedUserName=escapeString(userName,ESCAPE_ARRAY);
            write(bw,escapedUserName + "=" + toSave.getProperty(userName),true);
            toSave.remove(userName);
          }
        }
      }
    }
    endPersistence(bw);
  }
  finally {
    safeClose(bw);
  }
}
