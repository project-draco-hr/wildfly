{
  boolean loadRequired=properties == null || fileUpdated != propertiesFile.lastModified();
  if (loadRequired) {
synchronized (this) {
      long fileLastModified=propertiesFile.lastModified();
      boolean loadReallyRequired=properties == null || fileUpdated != fileLastModified;
      if (loadReallyRequired) {
        ROOT_LOGGER.debugf("Reloading properties file '%s'",propertiesFile.getAbsolutePath());
        Properties props=new Properties();
        InputStreamReader is=new InputStreamReader(new FileInputStream(propertiesFile),Charset.forName("UTF-8"));
        try {
          props.load(is);
        }
  finally {
          is.close();
        }
        verifyProperties(props);
        String realmName=null;
        BufferedReader br=new BufferedReader(new FileReader(propertiesFile));
        try {
          String currentLine=null;
          while (realmName == null && (currentLine=br.readLine()) != null) {
            String trimmed=currentLine.trim();
            if (trimmed.startsWith(COMMENT_PREFIX) && trimmed.contains(REALM_COMMENT_PREFIX)) {
              int start=trimmed.indexOf(REALM_COMMENT_PREFIX) + REALM_COMMENT_PREFIX.length();
              int end=trimmed.indexOf(REALM_COMMENT_SUFFIX,start);
              if (end > -1) {
                realmName=trimmed.substring(start,end);
              }
            }
          }
        }
  finally {
          safeClose(br);
        }
        this.realmName=realmName;
        properties=props;
        fileUpdated=fileLastModified;
      }
    }
  }
}
