{
  Map<NetworkInterface,Set<InetAddress>> result=new HashMap<NetworkInterface,Set<InetAddress>>();
  for (  Map.Entry<NetworkInterface,Set<InetAddress>> entry : candidates.entrySet()) {
    NetworkInterface ni=entry.getKey();
    HashSet<InetAddress> addresses=null;
    for (    InetAddress address : entry.getValue()) {
      InetAddress accepted=isAcceptable(ni,address);
      if (accepted != null) {
        if (addresses == null) {
          addresses=new HashSet<InetAddress>();
          result.put(ni,addresses);
        }
        addresses.add(accepted);
      }
    }
  }
  return result;
}
