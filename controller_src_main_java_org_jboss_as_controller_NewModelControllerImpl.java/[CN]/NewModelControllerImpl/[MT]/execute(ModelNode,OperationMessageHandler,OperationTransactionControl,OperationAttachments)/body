{
  NewOperationContextImpl context=new NewOperationContextImpl(this,controllerType,EnumSet.of(NewOperationContextImpl.ContextFlag.ROLLBACK_ON_FAIL),handler,modelReference.get(),control,bootingFlag.getAndSet(false));
  ModelNode response=new ModelNode();
  if (prepareStep != null) {
    context.addStep(prepareStep,NewOperationContext.Stage.MODEL);
  }
  context.addStep(new NewStepHandler(){
    public void execute(    final NewOperationContext context,    final ModelNode operation){
      if (context.completeStep() == NewOperationContext.ResultAction.KEEP && context.isModelAffected()) {
      }
    }
  }
,NewOperationContext.Stage.VERIFY);
  NewStepHandler stepHandler=(NewStepHandler)rootRegistration.getOperationHandler(PathAddress.pathAddress(operation.require(ADDRESS)),operation.require(OP).asString());
  context.addStep(response,operation,stepHandler,NewOperationContext.Stage.MODEL);
  final ModelNode headers=operation.get(OPERATION_HEADERS);
  final boolean rollbackOnFailure=headers == null || headers.get(ROLLBACK_ON_RUNTIME_FAILURE).asBoolean(true);
  RB_ON_RT_FAILURE.set(Boolean.valueOf(rollbackOnFailure));
  try {
    context.completeStep();
  }
  finally {
    RB_ON_RT_FAILURE.set(null);
  }
  return response;
}
