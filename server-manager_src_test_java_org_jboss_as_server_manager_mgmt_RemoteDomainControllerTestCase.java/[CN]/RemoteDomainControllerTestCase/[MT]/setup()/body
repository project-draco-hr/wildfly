{
  final ScheduledExecutorService executorService=Executors.newScheduledThreadPool(10);
  communicationService=new ManagementCommunicationService();
  communicationService.getThreadFactoryInjector().inject(Executors.defaultThreadFactory());
  communicationService.getExecutorServiceInjector().inject(executorService);
  final NetworkInterfaceService networkInterfaceService=new NetworkInterfaceService("test",true,false,true,null);
  networkInterfaceService.start(null);
  communicationService.getInterfaceInjector().inject(networkInterfaceService.getValue());
  communicationService.getPortInjector().inject(12345);
  operationHandler=new DomainControllerOperationHandler();
  operationHandler.getThreadFactoryInjector().inject(Executors.defaultThreadFactory());
  operationHandler.getExecutorServiceInjector().inject(executorService);
  operationHandler.getLocalFileRepositoryInjector().inject(new LocalFileRepository(new ServerManagerEnvironment(System.getProperties(),false,System.in,System.out,System.err,"test",InetAddress.getLocalHost(),3223,InetAddress.getLocalHost(),3223,"java")));
  final DomainControllerImpl domainController=new DomainControllerImpl();
  domainController.getDomainConfigDirInjector().inject(new File(getClass().getResource("/test/configuration").toURI()));
  File tmpDir=new File(System.getProperty("java.io.tmpdir"));
  File deploymentDir=new File(tmpDir,"domain-deployments-" + ((int)Math.random()));
  deploymentDir.deleteOnExit();
  deploymentDir.mkdirs();
  domainController.getDomainDeploymentsDirInjector().inject(deploymentDir);
  final XMLMapper mapper=XMLMapper.Factory.create();
  StandardElementReaderRegistrar.Factory.getRegistrar().registerStandardDomainReaders(mapper);
  domainController.getXmlMapperInjector().inject(mapper);
  domainController.getScheduledExecutorServiceInjector().inject(executorService);
  domainController.start(null);
  operationHandler.getDomainControllerInjector().inject(domainController);
  operationHandler.start(null);
  communicationService.addHandler(operationHandler);
  communicationService.start(null);
  domainControllerConnection=new RemoteDomainControllerConnection("sm",InetAddress.getLocalHost(),12345,InetAddress.getLocalHost(),11223,null,1000,Executors.newScheduledThreadPool(2),Executors.defaultThreadFactory());
}
