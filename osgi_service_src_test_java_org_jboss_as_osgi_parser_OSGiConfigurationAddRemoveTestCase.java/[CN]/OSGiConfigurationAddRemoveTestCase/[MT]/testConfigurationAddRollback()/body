{
  SubsystemState stateService=new SubsystemState();
  List<OperationStepHandler> addedSteps=new ArrayList<OperationStepHandler>();
  OperationContext context=mockOperationContext(stateService,addedSteps,OperationContext.ResultAction.ROLLBACK);
  String pid="org.acme.pid1";
  Map<String,String> data=Collections.singletonMap("mykey","myval");
  ModelNode op=getAddOperation(pid,data);
  Assert.assertEquals("Precondition",0,addedSteps.size());
  OSGiConfigurationAdd.INSTANCE.execute(context,op);
  Assert.assertEquals(1,addedSteps.size());
  Assert.assertEquals("Precondition",0,stateService.getConfigurations().size());
  addedSteps.get(0).execute(context,op);
  Assert.assertEquals("Operation should have been rolled back",0,stateService.getConfigurations().size());
}
