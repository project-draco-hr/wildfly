{
  ModelControllerClient client=null;
  try {
    System.out.println("Connecting");
    client=ModelControllerClient.Factory.create(InetAddress.getByName("localhost"),9999);
    System.out.println("Connected");
    System.out.println("--- Synchronous simple operation");
    ModelNode result=client.execute(createOperation(0));
    System.out.println("Received synchronous result " + result);
    System.out.println("--- Synchronous operation");
    client.execute(createOperation(0),new TestResultHandler());
    System.out.println("--- Asynchronous operation");
    TestResultHandler handler=new TestResultHandler();
    Operation operation=client.execute(createOperation(1000),handler);
    System.out.println("Control returned to client");
    handler.waitForFragment();
    System.out.println("Fragment signalled");
    handler.waitForComplete();
    System.out.println("--- Asynchronous cancelled operation");
    TestResultHandler handler2=new TestResultHandler();
    Operation operation2=client.execute(createOperation(1000),handler2);
    handler2.waitForFragment();
    operation2.cancel();
    handler2.waitForComplete();
  }
  finally {
    StreamUtils.safeClose(client);
    System.out.println("Closed");
  }
}
