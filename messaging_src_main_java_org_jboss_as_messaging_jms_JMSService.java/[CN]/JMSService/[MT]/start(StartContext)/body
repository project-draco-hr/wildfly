{
  ClassLoader oldTccl=SecurityActions.setThreadContextClassLoader(getClass());
  try {
    jmsServer=new JMSServerManagerImpl(hornetQServer.getValue(),new AS7BindingRegistry(context.getController().getServiceContainer()));
    final ServiceBuilder<Void> hornetqActivationService=context.getChildTarget().addService(HornetQActivationService.getHornetQActivationServiceName(hqServiceName),new HornetQActivationService()).setInitialMode(Mode.ACTIVE);
    hornetQServer.getValue().registerActivateCallback(new ActivateCallback(){
      public ServiceController<Void> hornetqActivationController;
      public void preActivate(){
      }
      public void activated(){
        hornetQServer.getValue().getRemotingService().allowInvmSecurityOverride(new HornetQPrincipal(HornetQDefaultCredentials.getUsername(),HornetQDefaultCredentials.getPassword()));
        hornetqActivationController=hornetqActivationService.install();
      }
      public void deActivate(){
        if (hornetqActivationController != null) {
          hornetqActivationController.setMode(REMOVE);
        }
      }
    }
);
    jmsServer.start();
  }
 catch (  Exception e) {
    throw MESSAGES.failedToStartService(e);
  }
 finally {
    SecurityActions.setThreadContextClassLoader(oldTccl);
  }
}
