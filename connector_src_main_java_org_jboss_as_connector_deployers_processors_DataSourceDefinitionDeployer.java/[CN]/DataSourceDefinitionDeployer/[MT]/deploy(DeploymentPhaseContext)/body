{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final EEModuleDescription eeModuleDescription=deploymentUnit.getAttachment(Attachments.EE_MODULE_DESCRIPTION);
  final CompositeIndex index=deploymentUnit.getAttachment(org.jboss.as.server.deployment.Attachments.COMPOSITE_ANNOTATION_INDEX);
  List<AnnotationInstance> datasourceDefinitions=index.getAnnotations(DATASOURCE_DEFINITIONS);
  List<AnnotationInstance> nestedDataSources=this.getNestedDataSourceAnnotations(datasourceDefinitions);
  this.processDataSourceDefinitions(eeModuleDescription,nestedDataSources);
  List<AnnotationInstance> datasources=index.getAnnotations(DATASOURCE_DEFINITION);
  this.processDataSourceDefinitions(eeModuleDescription,datasources);
}
