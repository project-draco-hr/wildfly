{
  final CustomContext customContext=mock(CustomContext.class);
  when(deploymentUnit.getAttachment(WebContextFactory.ATTACHMENT)).thenReturn(contextFactory);
  when(contextFactory.createContext(deploymentUnit)).thenReturn(customContext);
  processor.deploy(phaseContext);
  InOrder inOrder=Mockito.inOrder(customContext,contextFactory);
  inOrder.verify(contextFactory).createContext(deploymentUnit);
  inOrder.verify(customContext).addLifecycleListener(any(JBossContextConfig.class));
  inOrder.verify(contextFactory).postProcessContext(eq(deploymentUnit),contextCaptor.capture());
  assertEquals(contextCaptor.getValue(),customContext);
  assertTrue(contextCaptor.getValue() instanceof CustomContext);
}
