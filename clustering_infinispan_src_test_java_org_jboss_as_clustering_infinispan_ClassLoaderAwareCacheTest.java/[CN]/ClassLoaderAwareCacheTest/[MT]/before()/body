{
  ArgumentCaptor<CommandInterceptor> capturedInterceptor=ArgumentCaptor.forClass(CommandInterceptor.class);
  cache=new ClassLoaderAwareCache<Object,Object>(mockCache,this.loader);
  verify(this.mockCache).addInterceptor(capturedInterceptor.capture(),eq(0));
  assertNotSame(Thread.currentThread().getContextClassLoader(),this.cache.getClassLoader());
  Object result=new Object();
  CommandInterceptor interceptor=capturedInterceptor.getValue();
  TestInterceptor test=new TestInterceptor(this.loader,result);
  interceptor.setNext(test);
  assertSame(result,interceptor.visitKeySetCommand(mock(InvocationContext.class),new KeySetCommand(mock(DataContainer.class))));
  assertTrue(test.triggered);
}
