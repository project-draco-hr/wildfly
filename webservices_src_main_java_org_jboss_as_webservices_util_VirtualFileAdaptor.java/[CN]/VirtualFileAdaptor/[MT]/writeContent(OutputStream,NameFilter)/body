{
  InputStream is=null;
  try {
    is=getFile().openStream();
    if (is instanceof JarInputStream) {
      JarInputStream jis=(JarInputStream)is;
      JarOutputStream os=new JarOutputStream(bos);
      JarEntry je=null;
      while ((je=jis.getNextJarEntry()) != null) {
        if (filter != null && filter.accept(je.getName())) {
          os.putNextEntry(je);
          VFSUtils.copyStream(jis,os);
        }
      }
      VFSUtils.safeClose(os);
    }
 else {
      VFSUtils.copyStream(is,bos);
    }
  }
  finally {
    VFSUtils.safeClose(is);
  }
}
