{
  InputStream in=null;
  String message="";
  if (operation.hasDefined(INPUT_STREAM_INDEX)) {
    int streamIndex=operation.get(INPUT_STREAM_INDEX).asInt();
    if (streamIndex > context.getAttachmentStreamCount() - 1) {
      message=String.format("Invalid %s [%d], the maximum index is [%d]",INPUT_STREAM_INDEX,streamIndex,(context.getAttachmentStreamCount() - 1));
      throw createFailureException(message);
    }
    message="Null stream at index " + streamIndex;
    in=context.getAttachmentStream(streamIndex);
  }
 else   if (operation.hasDefined(BYTES)) {
    in=new ByteArrayInputStream(operation.get(BYTES).asBytes());
    message="Invalid byte stream.";
  }
 else   if (operation.hasDefined(URL)) {
    final String urlSpec=operation.get(URL).asString();
    try {
      message="Invalid url stream.";
      in=new URL(urlSpec).openStream();
    }
 catch (    MalformedURLException e) {
      throw createFailureException(message);
    }
catch (    IOException e) {
      throw createFailureException(message);
    }
  }
  if (in == null) {
    throw createFailureException(message);
  }
  return in;
}
