{
  if (!closed.compareAndSet(false,true)) {
    return;
  }
  if (registration != null) {
    registration.close();
  }
synchronized (channels) {
    for (    T channel : channels) {
      closeChannelOnShutdown(channel);
    }
  }
}
