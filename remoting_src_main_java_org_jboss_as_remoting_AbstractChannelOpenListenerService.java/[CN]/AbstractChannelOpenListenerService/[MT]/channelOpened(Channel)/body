{
  if (closed) {
    log.debugf("server shutting down, closing channel %s.",channel);
    channel.closeAsync();
    return;
  }
  final ManagementChannelInitialization.ManagementChannelShutdownHandle handle=handleChannelOpened(channel);
  handles.add(handle);
  channel.addCloseHandler(new CloseHandler<Channel>(){
    public void handleClose(    final Channel closed,    final IOException exception){
      handles.remove(handle);
      handle.shutdownNow();
      log.tracef("Handling close for %s",handle);
    }
  }
);
}
