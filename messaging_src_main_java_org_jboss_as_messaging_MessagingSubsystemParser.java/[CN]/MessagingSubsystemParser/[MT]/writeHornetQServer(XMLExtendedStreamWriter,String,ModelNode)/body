{
  writer.writeStartElement(Element.HORNETQ_SERVER.getLocalName());
  if (!"default".equals(serverName)) {
    writer.writeAttribute(Attribute.NAME.getLocalName(),serverName);
  }
  for (  AttributeDefinition simpleAttribute : CommonAttributes.SIMPLE_ROOT_RESOURCE_ATTRIBUTES) {
    simpleAttribute.marshallAsElement(node,writer);
  }
  writeConnectors(writer,node);
  writeAcceptors(writer,node);
  if (node.hasDefined(BROADCAST_GROUP)) {
    writeBroadcastGroups(writer,node.get(BROADCAST_GROUP));
  }
  if (node.hasDefined(DISCOVERY_GROUP)) {
    writeDiscoveryGroups(writer,node.get(DISCOVERY_GROUP));
  }
  if (node.hasDefined(DIVERT)) {
    writeDiverts(writer,node.get(DIVERT));
  }
  if (node.hasDefined(CommonAttributes.QUEUE)) {
    writeQueues(writer,node.get(CommonAttributes.QUEUE));
  }
  if (node.hasDefined(CommonAttributes.BRIDGE)) {
    writeBridges(writer,node.get(CommonAttributes.BRIDGE));
  }
  if (node.hasDefined(CommonAttributes.CLUSTER_CONNECTION)) {
    writeClusterConnections(writer,node.get(CommonAttributes.CLUSTER_CONNECTION));
  }
  if (node.hasDefined(CommonAttributes.GROUPING_HANDLER)) {
    writeGroupingHandler(writer,node.get(GROUPING_HANDLER));
  }
  final ModelNode paths=node.get(ModelDescriptionConstants.PATH);
  if (paths.hasDefined(CommonAttributes.PAGING_DIRECTORY)) {
    writeDirectory(writer,Element.PAGING_DIRECTORY,node.get(ModelDescriptionConstants.PATH));
  }
  if (paths.hasDefined(BINDINGS_DIRECTORY)) {
    writeDirectory(writer,Element.BINDINGS_DIRECTORY,node.get(ModelDescriptionConstants.PATH));
  }
  if (paths.hasDefined(CommonAttributes.JOURNAL_DIRECTORY)) {
    writeDirectory(writer,Element.JOURNAL_DIRECTORY,node.get(ModelDescriptionConstants.PATH));
  }
  if (paths.hasDefined(CommonAttributes.LARGE_MESSAGES_DIRECTORY)) {
    writeDirectory(writer,Element.LARGE_MESSAGES_DIRECTORY,node.get(ModelDescriptionConstants.PATH));
  }
  if (node.hasDefined(CommonAttributes.SECURITY_SETTING)) {
    writeSecuritySettings(writer,node.get(CommonAttributes.SECURITY_SETTING));
  }
  if (node.hasDefined(ADDRESS_SETTING)) {
    writeAddressSettings(writer,node.get(ADDRESS_SETTING));
  }
  if (node.hasDefined(CommonAttributes.CONNECTOR_SERVICE)) {
    writeConnectorServices(writer,node.get(CommonAttributes.CONNECTOR_SERVICE));
  }
  if (node.hasDefined(CONNECTION_FACTORY) || node.hasDefined(POOLED_CONNECTION_FACTORY)) {
    ModelNode cf=node.get(CONNECTION_FACTORY);
    ModelNode pcf=node.get(POOLED_CONNECTION_FACTORY);
    boolean hasCf=cf.isDefined() && cf.keys().size() > 0;
    boolean hasPcf=cf.isDefined() && cf.keys().size() > 0;
    if (hasCf || hasPcf) {
      writer.writeStartElement(JMS_CONNECTION_FACTORIES);
      if (hasCf) {
        writeConnectionFactories(writer,cf);
      }
      if (hasPcf) {
        writePooledConnectionFactories(writer,pcf);
      }
      writer.writeEndElement();
    }
  }
  if (node.has(JMS_QUEUE) || node.has(JMS_TOPIC)) {
    ModelNode queue=node.get(JMS_QUEUE);
    ModelNode topic=node.get(JMS_TOPIC);
    boolean hasQueue=queue.isDefined() && queue.keys().size() > 0;
    boolean hasTopic=topic.isDefined() && topic.keys().size() > 0;
    if (hasQueue || hasTopic) {
      writer.writeStartElement(JMS_DESTINATIONS);
      if (hasQueue) {
        writeJmsQueues(writer,node.get(JMS_QUEUE));
      }
      if (hasTopic) {
        writeTopics(writer,node.get(JMS_TOPIC));
      }
      writer.writeEndElement();
    }
  }
  writer.writeEndElement();
}
