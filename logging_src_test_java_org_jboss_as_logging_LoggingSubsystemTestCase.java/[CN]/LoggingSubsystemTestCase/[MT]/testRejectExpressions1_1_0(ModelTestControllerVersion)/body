{
  final ModelVersion modelVersion=ModelVersion.create(1,1,0);
  final KernelServicesBuilder builder=createKernelServicesBuilder(LoggingTestEnvironment.getManagementInstance());
  builder.createLegacyKernelServicesBuilder(LoggingTestEnvironment.getManagementInstance(),controllerVersion,modelVersion).addMavenResourceURL("org.jboss.as:jboss-as-logging:" + controllerVersion.getMavenGavVersion()).dontPersistXml();
  KernelServices mainServices=builder.build();
  KernelServices legacyServices=mainServices.getLegacyServices(modelVersion);
  Assert.assertNotNull(legacyServices);
  Assert.assertTrue("main services did not boot",mainServices.isSuccessfulBoot());
  Assert.assertTrue(legacyServices.isSuccessfulBoot());
  final List<ModelNode> ops=builder.parseXmlResource("/expressions.xml");
  ModelTestUtils.checkFailedTransformedBootOperations(mainServices,modelVersion,ops,new FailedOperationTransformationConfig().addFailedAttribute(createRootLoggerAddress(),new RejectExpressionsConfig(RootLoggerResourceDefinition.EXPRESSION_ATTRIBUTES)).addFailedAttribute(SUBSYSTEM_ADDRESS.append(LoggerResourceDefinition.LOGGER_PATH),new RejectExpressionsConfig(LoggerResourceDefinition.EXPRESSION_ATTRIBUTES)).addFailedAttribute(SUBSYSTEM_ADDRESS.append(AsyncHandlerResourceDefinition.ASYNC_HANDLER_PATH),new RejectExpressionsConfig(AsyncHandlerResourceDefinition.ATTRIBUTES)).addFailedAttribute(SUBSYSTEM_ADDRESS.append(ConsoleHandlerResourceDefinition.CONSOLE_HANDLER_PATH),FailedOperationTransformationConfig.ChainedConfig.createBuilder(FileHandlerResourceDefinition.ATTRIBUTES).addConfig(new RejectExpressionsConfig(ConsoleHandlerResourceDefinition.ATTRIBUTES)).build()).addFailedAttribute(SUBSYSTEM_ADDRESS.append(FileHandlerResourceDefinition.FILE_HANDLER_PATH),new RejectExpressionsConfig(FileHandlerResourceDefinition.ATTRIBUTES)).addFailedAttribute(SUBSYSTEM_ADDRESS.append(FileHandlerResourceDefinition.FILE_HANDLER_PATH),FailedOperationTransformationConfig.ChainedConfig.createBuilder(FileHandlerResourceDefinition.ATTRIBUTES).addConfig(new FailedOperationTransformationConfig.NewAttributesConfig(CommonAttributes.ENABLED)).addConfig(new RejectExpressionsConfig(Logging.join(FileHandlerResourceDefinition.DEFAULT_ATTRIBUTES,AUTOFLUSH,APPEND,FILE))).addConfig(new FailedOperationTransformationConfig.NewAttributesConfig(AbstractHandlerDefinition.NAMED_FORMATTER)).build()).addFailedAttribute(SUBSYSTEM_ADDRESS.append(PeriodicHandlerResourceDefinition.PERIODIC_HANDLER_PATH),new RejectExpressionsConfig(PeriodicHandlerResourceDefinition.ATTRIBUTES)).addFailedAttribute(SUBSYSTEM_ADDRESS.append(SizeRotatingHandlerResourceDefinition.SIZE_ROTATING_HANDLER_PATH),new RejectExpressionsConfig(SizeRotatingHandlerResourceDefinition.ATTRIBUTES)).addFailedAttribute(SUBSYSTEM_ADDRESS.append(CustomHandlerResourceDefinition.CUSTOM_HANDLE_PATH),new RejectExpressionsConfig(CustomHandlerResourceDefinition.WRITABLE_ATTRIBUTES)).addFailedAttribute(SUBSYSTEM_ADDRESS.append(SyslogHandlerResourceDefinition.SYSLOG_HANDLER_PATH),FailedOperationTransformationConfig.REJECTED_RESOURCE).addFailedAttribute(SUBSYSTEM_ADDRESS.append(PatternFormatterResourceDefinition.PATTERN_FORMATTER_PATH),FailedOperationTransformationConfig.REJECTED_RESOURCE).addFailedAttribute(SUBSYSTEM_ADDRESS.append(CommonAttributes.LOGGING_PROFILE),FailedOperationTransformationConfig.REJECTED_RESOURCE).addFailedAttribute(SUBSYSTEM_ADDRESS.append(CommonAttributes.LOGGING_PROFILE).append(ConsoleHandlerResourceDefinition.CONSOLE_HANDLER_PATH),FailedOperationTransformationConfig.REJECTED_RESOURCE).addFailedAttribute(SUBSYSTEM_ADDRESS.append(CommonAttributes.LOGGING_PROFILE).append(FileHandlerResourceDefinition.FILE_HANDLER_PATH),FailedOperationTransformationConfig.REJECTED_RESOURCE).addFailedAttribute(SUBSYSTEM_ADDRESS.append(CommonAttributes.LOGGING_PROFILE).append(RootLoggerResourceDefinition.ROOT_LOGGER_PATH),FailedOperationTransformationConfig.REJECTED_RESOURCE).addFailedAttribute(SUBSYSTEM_ADDRESS.append(CommonAttributes.LOGGING_PROFILE).append(LoggerResourceDefinition.LOGGER_PATH),FailedOperationTransformationConfig.REJECTED_RESOURCE).addFailedAttribute(SUBSYSTEM_ADDRESS.append(CommonAttributes.LOGGING_PROFILE).append(SyslogHandlerResourceDefinition.SYSLOG_HANDLER_PATH),FailedOperationTransformationConfig.REJECTED_RESOURCE).addFailedAttribute(SUBSYSTEM_ADDRESS.append(CommonAttributes.LOGGING_PROFILE).append(PatternFormatterResourceDefinition.PATTERN_FORMATTER_PATH),FailedOperationTransformationConfig.REJECTED_RESOURCE));
}
