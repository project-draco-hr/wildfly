{
  final String subsystemXml=getSubsystemXml();
  final ModelVersion modelVersion=ModelVersion.create(1,1,0);
  final KernelServicesBuilder builder=createKernelServicesBuilder(LoggingTestEnvironment.getManagementInstance()).setSubsystemXml(subsystemXml);
  builder.createLegacyKernelServicesBuilder(LoggingTestEnvironment.getManagementInstance(),modelVersion).addMavenResourceURL(gav).skipReverseControllerCheck();
  KernelServices mainServices=builder.build();
  KernelServices legacyServices=mainServices.getLegacyServices(modelVersion);
  Assert.assertNotNull(legacyServices);
  final ModelNode legacyModel=checkSubsystemModelTransformation(mainServices,modelVersion);
  testTransformOperations(mainServices,modelVersion,legacyModel);
}
