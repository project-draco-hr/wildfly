{
  final byte rootId;
  final String filePath;
  final FileRepository localFileRepository=getController().getFileRepository();
  ByteDataInput input=null;
  try {
    input=new SimpleByteDataInput(inputStream);
    expectHeader(input,DomainControllerProtocol.PARAM_ROOT_ID);
    rootId=input.readByte();
    expectHeader(input,DomainControllerProtocol.PARAM_FILE_PATH);
    filePath=input.readUTF();
switch (rootId) {
case DomainControllerProtocol.PARAM_ROOT_ID_FILE:
{
        localPath=localFileRepository.getFile(filePath);
        break;
      }
case DomainControllerProtocol.PARAM_ROOT_ID_CONFIGURATION:
{
      localPath=localFileRepository.getConfigurationFile(filePath);
      break;
    }
case DomainControllerProtocol.PARAM_ROOT_ID_DEPLOYMENT:
{
    byte[] hash=HashUtil.hexStringToByteArray(filePath);
    localPath=localFileRepository.getDeploymentRoot(hash);
    break;
  }
default :
{
  throw new IOException(String.format("Invalid root id [%d]",rootId));
}
}
}
  finally {
StreamUtils.safeClose(input);
}
}
