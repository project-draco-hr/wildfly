{
  BundleContext context=bundle.getBundleContext();
  ServiceReference<HttpService> sref=FrameworkUtils.waitForServiceReference(context,HttpService.class);
  HttpService httpService=context.getService(sref);
  String reqspec="/servlet?test=param&param=Kermit";
  try {
    assertNotAvailable(reqspec);
    httpService.registerServlet("/servlet",new HttpServiceServlet(bundle),null,null);
    Assert.assertEquals("Hello: Kermit",performCall(reqspec));
    httpService.unregister("/servlet");
    assertNotAvailable(reqspec);
    assertNotAvailable(reqspec);
  }
  finally {
    context.ungetService(sref);
  }
}
