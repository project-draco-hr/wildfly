{
  BundleContext context=bundle.getBundleContext();
  final ServiceReference sref=context.getServiceReference(HttpService.class.getName());
  Assert.assertNotNull("ServiceReference was not found for " + HttpService.class.getName(),sref);
  String reqspec="/httpservice/servlet?test=param&param=Kermit";
  try {
    HttpService httpService=(HttpService)context.getService(sref);
    assertNotAvailable(reqspec);
    httpService.registerServlet("/servlet",new HttpServiceServlet(bundle),null,null);
    Assert.assertEquals("Hello: Kermit",performCall(reqspec));
    httpService.unregister("/servlet");
    assertNotAvailable(reqspec);
  }
  finally {
    context.ungetService(sref);
  }
}
