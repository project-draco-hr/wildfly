{
  BundleContext context=bundle.getBundleContext();
  ServiceReference sref=FrameworkUtils.waitForServiceReference(context,HttpService.class);
  HttpService httpService=(HttpService)context.getService(sref);
  String reqspec="/httpservice/servlet?test=init&init=someKey";
  try {
    assertNotAvailable(reqspec);
    Properties initParams=new Properties();
    initParams.setProperty("someKey","someValue");
    httpService.registerServlet("/servlet",new HttpServiceServlet(bundle),initParams,null);
    Assert.assertEquals("someKey=someValue",performCall(reqspec));
  }
  finally {
    context.ungetService(sref);
  }
  assertNotAvailable(reqspec);
}
