{
  BundleContext context=bundle.getBundleContext();
  ServiceReference<HttpService> sref=FrameworkUtils.waitForServiceReference(context,HttpService.class);
  HttpService httpService=context.getService(sref);
  String reqspec="/servlet2?test=param&param=Kermit";
  try {
    assertNotAvailable(reqspec);
    HttpServiceServlet servlet=new HttpServiceServlet(bundle);
    Dictionary<String,String> parms=new Hashtable<String,String>();
    parms.put("foo","bar");
    httpService.registerServlet("/servlet2",servlet,parms,null);
    Assert.assertEquals("/servlet2",servlet.getServletContext().getContextPath());
    Assert.assertEquals("bar",servlet.getServletConfig().getInitParameter("foo"));
    httpService.unregister("/servlet2");
    assertNotAvailable(reqspec);
  }
  finally {
    context.ungetService(sref);
  }
}
