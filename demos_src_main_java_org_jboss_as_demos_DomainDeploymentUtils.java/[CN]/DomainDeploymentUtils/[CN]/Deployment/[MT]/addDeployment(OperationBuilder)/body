{
  System.out.println("Deploying " + realArchive.getName());
  Set<String> deployments=getDeploymentNames();
  int index=context.getInputStreamCount();
  context.addInputStream(new FileInputStream(realArchive));
  ModelNode result=new ModelNode();
  if (deployments.contains(archiveName)) {
    result.get("operation").set("full-replace-deployment");
    result.get("name").set(archiveName);
    result.get("input-stream-index").set(index);
  }
 else {
    result.get("operation").set("composite");
    ModelNode steps=result.get("steps");
    ModelNode add=steps.add();
    add.get("operation").set("add");
    add.get("address").add("deployment",archiveName);
    add.get("content").get(0).get("input-stream-index").set(index);
    ModelNode mainAdd=steps.add();
    mainAdd.get("operation").set("add");
    mainAdd.get("address").add("server-group","main-server-group");
    mainAdd.get("address").add("deployment",archiveName);
    ModelNode mainDeploy=steps.add();
    mainDeploy.get("operation").set("deploy");
    mainDeploy.get("address").add("server-group","main-server-group");
    mainDeploy.get("address").add("deployment",archiveName);
    ModelNode otherAdd=steps.add();
    otherAdd.get("operation").set("add");
    otherAdd.get("address").add("server-group","other-server-group");
    otherAdd.get("address").add("deployment",archiveName);
    ModelNode otherDeploy=steps.add();
    otherDeploy.get("operation").set("deploy");
    otherDeploy.get("address").add("server-group","other-server-group");
    otherDeploy.get("address").add("deployment",archiveName);
  }
  return result;
}
