{
  ServiceTarget target=context.getServiceTarget();
  ProtocolDefaultsService.build(target).setInitialMode(ON_DEMAND).install();
  InjectedValueServiceBuilder builder=new InjectedValueServiceBuilder(target);
  String defaultChannel=ModelNodes.asString(JGroupsSubsystemResourceDefinition.DEFAULT_CHANNEL.resolveModelAttribute(context,model));
  if ((defaultChannel != null) && !defaultChannel.equals(ChannelService.DEFAULT)) {
    builder.build(ChannelService.getServiceName(ChannelService.DEFAULT),ChannelService.getServiceName(defaultChannel),Channel.class).install();
    builder.build(ConnectedChannelService.getServiceName(ChannelService.DEFAULT),ConnectedChannelService.getServiceName(defaultChannel),Channel.class).install();
    builder.build(ChannelService.getFactoryServiceName(ChannelService.DEFAULT),ChannelService.getFactoryServiceName(defaultChannel),ChannelFactory.class).install();
    for (    GroupServiceInstaller installer : ServiceLoader.load(ClusteredGroupServiceInstaller.class,ClusteredGroupServiceInstaller.class.getClassLoader())) {
      Iterator<ServiceName> names=installer.getServiceNames(defaultChannel).iterator();
      for (      ServiceName name : installer.getServiceNames(ChannelService.DEFAULT)) {
        builder.build(name,names.next(),Object.class).install();
      }
    }
  }
  String defaultStack=ModelNodes.asString(JGroupsSubsystemResourceDefinition.DEFAULT_STACK.resolveModelAttribute(context,model));
  if ((defaultStack != null) && !defaultStack.equals(ChannelFactoryService.DEFAULT)) {
    builder.build(ChannelFactoryService.getServiceName(ChannelFactoryService.DEFAULT),ChannelFactoryService.getServiceName(defaultStack),ChannelFactory.class).install();
  }
}
