{
  String defaultNamespace=writer.getNamespaceContext().getNamespaceURI(XMLConstants.DEFAULT_NS_PREFIX);
  try {
    ModelNode subsystems=context.getModelNode().get(SUBSYSTEM);
    if (subsystems.has(mainSubsystemName)) {
      ModelNode subsystem=subsystems.get(mainSubsystemName);
      XMLElementWriter<SubsystemMarshallingContext> subsystemWriter=context.getSubsystemWriter(mainSubsystemName);
      if (subsystemWriter != null) {
        subsystemWriter.writeContent(writer,new SubsystemMarshallingContext(subsystem,writer));
      }
    }
  }
 catch (  Throwable t) {
    Assert.fail("could not marshal subsystem xml: " + t.getMessage() + ":\n"+ Arrays.toString(t.getStackTrace()).replaceAll(", ","\n"));
  }
 finally {
    writer.setDefaultNamespace(defaultNamespace);
  }
  writer.writeEndDocument();
}
