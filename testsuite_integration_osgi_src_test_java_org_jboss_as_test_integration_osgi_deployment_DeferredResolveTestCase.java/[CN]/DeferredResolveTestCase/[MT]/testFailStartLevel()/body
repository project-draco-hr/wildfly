{
  int orglevel=FrameworkUtils.getFrameworkStartLevel(context);
  InputStream input=deployer.getDeployment(BAD_BUNDLE);
  Bundle bundle=context.installBundle(BAD_BUNDLE,input);
  try {
    Assert.assertEquals("Bundle INSTALLED",Bundle.INSTALLED,bundle.getState());
    bundle.adapt(BundleStartLevel.class).setStartLevel(2);
    bundle.start();
    Assert.assertEquals("Bundle INSTALLED",Bundle.INSTALLED,bundle.getState());
    FrameworkUtils.setFrameworkStartLevel(context,2);
    Assert.assertEquals("Bundle RESOLVED",Bundle.RESOLVED,bundle.getState());
    bundle.start();
    Assert.assertEquals("Bundle ACTIVE",Bundle.ACTIVE,bundle.getState());
  }
  finally {
    FrameworkUtils.setFrameworkStartLevel(context,orglevel);
    bundle.uninstall();
  }
}
