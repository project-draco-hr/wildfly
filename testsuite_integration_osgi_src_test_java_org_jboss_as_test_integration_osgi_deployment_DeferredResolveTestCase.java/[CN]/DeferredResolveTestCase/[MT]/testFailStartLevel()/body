{
  int orglevel=startLevel.getStartLevel();
  InputStream input=deployer.getDeployment(BAD_BUNDLE);
  Bundle bundle=context.installBundle(BAD_BUNDLE,input);
  try {
    Assert.assertEquals("Bundle INSTALLED",Bundle.INSTALLED,bundle.getState());
    startLevel.setBundleStartLevel(bundle,2);
    bundle.start();
    Assert.assertEquals("Bundle INSTALLED",Bundle.INSTALLED,bundle.getState());
    FrameworkUtils.changeStartLevel(context,2,5,TimeUnit.SECONDS);
    Assert.assertEquals("Bundle RESOLVED",Bundle.RESOLVED,bundle.getState());
    bundle.start();
    Assert.assertEquals("Bundle ACTIVE",Bundle.ACTIVE,bundle.getState());
  }
  finally {
    startLevel.setStartLevel(orglevel);
    bundle.uninstall();
  }
}
