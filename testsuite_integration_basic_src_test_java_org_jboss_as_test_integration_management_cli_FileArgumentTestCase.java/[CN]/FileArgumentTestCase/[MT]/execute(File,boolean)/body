{
  final String jbossDist=System.getProperty("jboss.dist");
  if (jbossDist == null) {
    fail("jboss.dist system property is not set");
  }
  final String modulePath=System.getProperty("module.path");
  if (modulePath == null) {
    fail("module.path system property is not set");
  }
  final ProcessBuilder builder=new ProcessBuilder();
  builder.command("java","-jar",jbossDist + File.separatorChar + "jboss-modules.jar","-mp",modulePath,"org.jboss.as.cli","-c","--file=" + f.getAbsolutePath());
  Process cliProc=null;
  try {
    cliProc=builder.start();
  }
 catch (  IOException e) {
    fail("Failed to start CLI process: " + e.getLocalizedMessage());
  }
  int exitCode=0;
  try {
    exitCode=cliProc.waitFor();
  }
 catch (  InterruptedException e) {
    fail("Interrupted waiting for the CLI process.");
  }
  if (logFailure && exitCode != 0) {
    System.out.println("Failed to execute " + f.getAbsolutePath());
    try {
      int bytesTotal=cliProc.getInputStream().available();
      if (bytesTotal > 0) {
        final byte[] bytes=new byte[bytesTotal];
        cliProc.getInputStream().read(bytes);
        System.out.println("Command's output: '" + new String(bytes) + "'");
      }
    }
 catch (    Exception e) {
      System.out.println("Failed to read command's output: " + e.getLocalizedMessage());
    }
    try {
      int bytesTotal=cliProc.getErrorStream().available();
      if (bytesTotal > 0) {
        final byte[] bytes=new byte[bytesTotal];
        cliProc.getErrorStream().read(bytes);
        System.out.println("Command's error log: '" + new String(bytes) + "'");
      }
 else {
        System.out.println("No output data for the command.");
      }
    }
 catch (    Exception e) {
      System.out.println("Failed to read command's error output: " + e.getLocalizedMessage());
    }
  }
  return exitCode;
}
