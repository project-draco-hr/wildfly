{
  final ModelNode request;
  try {
    request=cmdCtx.buildRequest(cmd);
  }
 catch (  CommandFormatException e) {
    throw new CommandSubstitutionException(cmd,"Failed to substitute " + cmd,e);
  }
  final ModelControllerClient client=cmdCtx.getModelControllerClient();
  if (client == null) {
    throw new CommandSubstitutionException(cmd,"Substitution of " + cmd + " requires connection to the controller.");
  }
  final ModelNode response;
  try {
    response=client.execute(request);
  }
 catch (  IOException e) {
    throw new CommandSubstitutionException(cmd,"Failed to substitute " + cmd,e);
  }
  if (!Util.isSuccess(response)) {
    throw new CommandSubstitutionException(cmd,"Failed to substitute " + cmd + ": "+ Util.getFailureDescription(response));
  }
  return response.get(Util.RESULT).asString();
}
