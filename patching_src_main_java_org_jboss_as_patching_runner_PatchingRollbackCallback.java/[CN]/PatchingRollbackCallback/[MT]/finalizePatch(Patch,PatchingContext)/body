{
  final PatchInfo patchInfo=context.getPatchInfo();
  if (restoreConfiguration) {
    context.restoreConfiguration(patchId);
  }
  if (context.getPatchType() == Patch.PatchType.CUMULATIVE) {
    final String resultingVersion=patch.getResultingVersion();
    return new LocalPatchInfo(resultingVersion,cumulativeTarget,Collections.<String>emptyList(),patchInfo.getEnvironment());
  }
 else {
    final List<String> oneOffs=new ArrayList<String>(patchInfo.getPatchIDs());
    for (    final String patch : patches) {
      oneOffs.remove(patch);
    }
    final String resultingVersion=patchInfo.getVersion();
    return new LocalPatchInfo(resultingVersion,patchInfo.getCumulativeID(),oneOffs,patchInfo.getEnvironment());
  }
}
