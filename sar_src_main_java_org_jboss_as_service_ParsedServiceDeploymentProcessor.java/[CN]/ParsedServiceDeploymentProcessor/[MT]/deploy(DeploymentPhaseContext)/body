{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final JBossServiceXmlDescriptor serviceXmlDescriptor=deploymentUnit.getAttachment(JBossServiceXmlDescriptor.ATTACHMENT_KEY);
  if (serviceXmlDescriptor == null) {
    return;
  }
  final Module module=deploymentUnit.getAttachment(Attachments.MODULE);
  if (module == null)   throw new DeploymentUnitProcessingException("Failed to get module attachment for " + deploymentUnit);
  final DeploymentReflectionIndex reflectionIndex=deploymentUnit.getAttachment(Attachments.REFLECTION_INDEX);
  if (reflectionIndex == null)   throw new DeploymentUnitProcessingException("Failed to get reflection index attachment for " + deploymentUnit);
  final ClassLoader classLoader=module.getClassLoader();
  final List<JBossServiceConfig> serviceConfigs=serviceXmlDescriptor.getServiceConfigs();
  final ServiceTarget target=phaseContext.getServiceTarget();
  for (  final JBossServiceConfig serviceConfig : serviceConfigs) {
    addServices(target,serviceConfig,classLoader,reflectionIndex);
  }
}
