{
  File domainUserFile=createPropertyFile("application-users.properties","domain");
  File standaloneUserFile=createPropertyFile("application-users.properties","standalone");
  File domainRolesFile=createPropertyFile("application-roles.properties","domain");
  File standaloneRolesFile=createPropertyFile("application-roles.properties","standalone");
  String newUserName="Hugh.Jackman";
  values.setGroups(null);
  values.setUserName(newUserName);
  values.setFileMode(FileMode.APPLICATION);
  System.setProperty("jboss.server.config.user.dir",domainUserFile.getParent());
  System.setProperty("jboss.domain.config.user.dir",standaloneUserFile.getParent());
  State propertyFileFinder=new PropertyFileFinder(consoleMock,values);
  State nextState=propertyFileFinder.execute();
  assertTrue(nextState instanceof PromptRealmState);
  File locatedDomainPropertyFile=values.getUserFiles().get(values.getUserFiles().indexOf(domainUserFile));
  File locatedStandalonePropertyFile=values.getUserFiles().get(values.getUserFiles().indexOf(standaloneUserFile));
  UpdateUser updateUserState=new UpdateUser(consoleMock,values);
  AssertConsoleBuilder consoleBuilder=new AssertConsoleBuilder().expectedDisplayText(updateUserState.consoleUserMessage(locatedDomainPropertyFile.getCanonicalPath())).expectedDisplayText(AddUser.NEW_LINE).expectedDisplayText(updateUserState.consoleUserMessage(locatedStandalonePropertyFile.getCanonicalPath())).expectedDisplayText(AddUser.NEW_LINE);
  consoleMock.setResponses(consoleBuilder);
  updateUserState.update(values);
  assertUserPropertyFile(newUserName);
  consoleBuilder.validate();
}
