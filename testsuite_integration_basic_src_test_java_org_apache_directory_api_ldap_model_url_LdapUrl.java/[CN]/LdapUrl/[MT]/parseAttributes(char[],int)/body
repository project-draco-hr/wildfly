{
  int start=pos;
  int end=pos;
  Set<String> hAttributes=new HashSet<String>();
  boolean hadComma=false;
  try {
    for (int i=pos; (i < chars.length) && (chars[i] != '?'); i++) {
      if (Chars.isCharASCII(chars,i,',')) {
        hadComma=true;
        if ((end - start) == 0) {
          return -1;
        }
 else {
          String attribute=null;
          attribute=new String(chars,start,end - start).trim();
          if (attribute.length() == 0) {
            return -1;
          }
          try {
            validateAttribute(attribute);
          }
 catch (          LdapURLEncodingException luee) {
            return -1;
          }
          String decodedAttr=decode(attribute);
          if (!hAttributes.contains(decodedAttr)) {
            attributes.add(decodedAttr);
            hAttributes.add(decodedAttr);
          }
        }
        start=i + 1;
      }
 else {
        hadComma=false;
      }
      end++;
    }
    if (hadComma) {
      return -1;
    }
 else {
      if (end == start) {
        return end;
      }
      String attribute=null;
      attribute=new String(chars,start,end - start).trim();
      if (attribute.length() == 0) {
        return -1;
      }
      String decodedAttr=decode(attribute);
      if (!hAttributes.contains(decodedAttr)) {
        attributes.add(decodedAttr);
        hAttributes.add(decodedAttr);
      }
    }
    return end;
  }
 catch (  LdapUriException ue) {
    return -1;
  }
}
