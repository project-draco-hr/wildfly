{
  File auditLog=new File(System.getProperty("jbossas.ts.submodule.dir"),"target/jbossas/standalone/log/audit.log");
  assertTrue("Audit log file has not been created (" + auditLog.getAbsolutePath() + ")",auditLog.exists());
  assertTrue("Audit log file is closed for reading (" + auditLog.getAbsolutePath() + ")",auditLog.canRead());
  BufferedReader reader=new BufferedReader(new FileReader(auditLog));
  String line;
  while (null != (line=reader.readLine())) {
  }
  Utils.makeCall(url.toString(),"anil","anil",200);
  Pattern successPattern=Pattern.compile("TRACE.+org.jboss.security.audit.providers.LogAuditProvider.+Success");
  final long INTERVAL=5000;
  long startTime=System.currentTimeMillis();
  while (true) {
    boolean recordFound=false;
    while (null != (line=reader.readLine())) {
      if (successPattern.matcher(line).matches()) {
        recordFound=true;
      }
    }
    if (recordFound) {
      break;
    }
    if (System.currentTimeMillis() > startTime + INTERVAL) {
      throw new AssertionError("Login record has not been written into audit log! (time expired)");
    }
  }
}
