{
synchronized (callbacks) {
    Map<Event,Set<Callback>> callbacksByEvent=callbacks.get(name);
    if (callbacksByEvent == null) {
      callbacksByEvent=new HashMap<PathManager.Event,Set<Callback>>();
      callbacks.put(name,callbacksByEvent);
    }
    for (    Event event : events) {
      Set<Callback> callbackSet=callbacksByEvent.get(event);
      if (callbackSet == null) {
        callbackSet=new HashSet<PathManager.Callback>();
        callbacksByEvent.put(event,callbackSet);
      }
      callbackSet.add(callback);
    }
  }
  return new HandleImpl(name,callback,events);
}
