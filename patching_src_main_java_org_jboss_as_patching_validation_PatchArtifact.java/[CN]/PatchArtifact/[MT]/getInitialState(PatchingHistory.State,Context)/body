{
  State lastApplied=parent.getLastAppliedPatch();
  if (lastApplied != null) {
    return lastApplied;
  }
  final Identity identity=ctx.getInstallationManager().getIdentity();
  TargetInfo identityInfo;
  try {
    identityInfo=identity.loadTargetInfo();
  }
 catch (  IOException e) {
    e.printStackTrace();
    return null;
  }
  String patchId=identityInfo.getCumulativePatchID();
  Patch.PatchType type=Patch.PatchType.CUMULATIVE;
  if (!identityInfo.getPatchIDs().isEmpty()) {
    type=Patch.PatchType.ONE_OFF;
    patchId=identityInfo.getPatchIDs().get(0);
  }
 else   if (patchId.equals(Constants.BASE)) {
    return null;
  }
  lastApplied=new State(patchId,type);
  parent.setLastAppliedPatch(lastApplied);
  return lastApplied;
}
