{
  XBundle bundle=(XBundle)context.getBundle();
  XBundleRevision brev=bundle.getBundleRevision();
  WabServletContextFactory wscf=brev.getAttachment(WabServletContextFactory.class);
  if (wscf != null) {
    wscf.setBundleContext(bundle.getBundleContext());
  }
  ContextActivator activator=brev.getAttachment(ContextActivator.class);
  if (activator != null) {
switch (state) {
case Bundle.ACTIVE:
      try {
        if (!activator.start(4,TimeUnit.SECONDS)) {
          throw new LifecycleInterceptorException(MESSAGES.startContextFailed());
        }
      }
 catch (      TimeoutException ex) {
        throw new LifecycleInterceptorException(ex.getMessage(),ex);
      }
    break;
case Bundle.RESOLVED:
  activator.stop(4,TimeUnit.SECONDS);
break;
}
}
}
