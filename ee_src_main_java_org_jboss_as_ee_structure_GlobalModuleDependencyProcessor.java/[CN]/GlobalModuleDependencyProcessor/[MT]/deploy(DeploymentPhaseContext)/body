{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final ModuleSpecification moduleSpecification=deploymentUnit.getAttachment(Attachments.MODULE_SPECIFICATION);
  final ModelNode globalMods=this.globalModules;
  if (globalMods.isDefined()) {
    for (    final ModelNode module : globalMods.asList()) {
      final String name=module.get(NAME).asString();
      boolean annotations=module.get(ANNOTATIONS).isDefined() ? module.get(ANNOTATIONS).asBoolean() : false;
      boolean services=module.get(SERVICES).isDefined() ? module.get(SERVICES).asBoolean() : true;
      boolean metaInf=module.get(META_INF).isDefined() ? module.get(META_INF).asBoolean() : false;
      String slot=module.hasDefined(SLOT) ? module.get(SLOT).asString() : GlobalModulesDefinition.DEFAULT_SLOT;
      final ModuleIdentifier identifier=ModuleIdentifier.create(name,slot);
      final ModuleDependency dependency=new ModuleDependency(Module.getBootModuleLoader(),identifier,false,false,services,false);
      if (metaInf) {
        dependency.addImportFilter(PathFilters.getMetaInfSubdirectoriesFilter(),true);
        dependency.addImportFilter(PathFilters.getMetaInfFilter(),true);
      }
      if (annotations) {
        deploymentUnit.addToAttachmentList(Attachments.ADDITIONAL_ANNOTATION_INDEXES,identifier);
      }
      moduleSpecification.addSystemDependency(dependency);
    }
  }
}
