{
  if (traceEnabled) {
    log.tracef("pu search for name '%s' inside of %s",persistenceUnitName,deploymentUnit.getName());
  }
  int i=(persistenceUnitName == null ? -1 : persistenceUnitName.indexOf('#'));
  if (i != -1) {
    final String path=persistenceUnitName.substring(0,i);
    final String name=persistenceUnitName.substring(i + 1);
    PersistenceUnitMetadata pu=getPersistenceUnit(deploymentUnit,path,name);
    if (traceEnabled) {
      log.trace("pu search found " + pu.getScopedPersistenceUnitName());
    }
    return pu;
  }
 else {
    PersistenceUnitMetadata name=findPersistenceUnitSupplier(deploymentUnit,persistenceUnitName);
    if (traceEnabled) {
      if (name != null) {
        log.trace("pu search found " + name);
      }
    }
    return name;
  }
}
