{
  lock();
  try {
synchronized (stateLock) {
      if (!inManagedTransaction) {
        try {
          if (underlyingAutoCommit) {
            underlyingAutoCommit=false;
            con.setAutoCommit(false);
          }
          checkState();
          inManagedTransaction=true;
        }
 catch (        SQLException e) {
          checkException(e);
        }
      }
 else       throw new ResourceException("Trying to begin a nested local tx");
    }
  }
  finally {
    unlock();
  }
}
