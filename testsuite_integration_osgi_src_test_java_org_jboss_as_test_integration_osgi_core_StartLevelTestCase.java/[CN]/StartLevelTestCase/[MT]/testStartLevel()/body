{
  int frameworkStartLevel=startLevel.getStartLevel();
  assertEquals("Framework start level",1,frameworkStartLevel);
  int initialStartLevel=startLevel.getInitialBundleStartLevel();
  assertEquals("Initial bundle start level",1,initialStartLevel);
  InputStream input=deployer.getDeployment(BUNDLE_A);
  Bundle bundle=context.installBundle(BUNDLE_A,input);
  try {
    assertEquals("Bundle INSTALLED",Bundle.INSTALLED,bundle.getState());
    startLevel.setBundleStartLevel(bundle,3);
    assertEquals("Bundle start level",3,startLevel.getBundleStartLevel(bundle));
    changeStartLevel(context,2);
    assertEquals("Framework start level",2,startLevel.getStartLevel());
    try {
      bundle.start(Bundle.START_TRANSIENT);
      fail("Bundle cannot be started due to the Framework's current start level");
    }
 catch (    BundleException ex) {
    }
    assertEquals("Bundle INSTALLED",Bundle.INSTALLED,bundle.getState());
    bundle.start();
    assertEquals("Bundle INSTALLED",Bundle.INSTALLED,bundle.getState());
    changeStartLevel(context,3);
    assertEquals("Bundle ACTIVE",Bundle.ACTIVE,bundle.getState());
  }
  finally {
    bundle.uninstall();
    changeStartLevel(context,frameworkStartLevel);
  }
}
