{
  XBundle bundle=brev.getBundle();
  Deployment deployment=bundle.adapt(Deployment.class);
  ModuleIdentifier identifier=deployment.getAttachment(MODULE_IDENTIFIER_KEY);
  if (identifier == null) {
    XIdentityCapability icap=brev.getIdentityCapability();
    BundleRevisions brevs=bundle.adapt(BundleRevisions.class);
    int revsize=brevs.getRevisions().size();
    String name=icap.getSymbolicName();
    if (revsize > 1) {
      name+="-rev" + (revsize - 1);
    }
    identifier=ModuleIdentifier.create(MODULE_PREFIX + name,"" + icap.getVersion());
  }
  return identifier;
}
