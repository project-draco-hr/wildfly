{
  DeploymentUtils utils=null;
  QueueConnection conn=null;
  QueueSession session=null;
  try {
    utils=new DeploymentUtils("fakejndi.sar",FakeJndi.class.getPackage());
    utils.addWarDeployment("webapp-example.war",SimpleServlet.class.getPackage());
    utils.deploy();
    QueueConnectionFactory qcf=lookup(utils,"RemoteConnectionFactory",QueueConnectionFactory.class);
    Queue queue=lookup(utils,"queue/test",Queue.class);
    conn=qcf.createQueueConnection();
    conn.start();
    session=conn.createQueueSession(false,QueueSession.AUTO_ACKNOWLEDGE);
    QueueReceiver recv=session.createReceiver(queue);
    recv.setMessageListener(new MessageListener(){
      @Override public void onMessage(      Message message){
        TextMessage msg=(TextMessage)message;
        try {
          System.out.println("---->Received from queue: " + msg.getText());
        }
 catch (        JMSException e) {
          e.printStackTrace();
        }
      }
    }
);
    connect("other?value=One");
    connect("simple?value=Two");
    connect("simple?value=Three");
  }
  finally {
    utils.undeploy();
    safeClose(utils);
    conn.close();
  }
}
