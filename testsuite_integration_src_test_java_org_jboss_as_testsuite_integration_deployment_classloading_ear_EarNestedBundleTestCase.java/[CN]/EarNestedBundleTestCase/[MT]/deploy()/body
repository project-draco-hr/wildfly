{
  final EnterpriseArchive ear=ShrinkWrap.create(EnterpriseArchive.class,"as945.ear");
  JavaArchive earLib=ShrinkWrap.create(JavaArchive.class);
  earLib.addClass(EarNestedBundleTestCase.class);
  ear.addAsLibraries(earLib);
  final JavaArchive osgiLib=ShrinkWrap.create(JavaArchive.class,"nested-bundle.jar");
  osgiLib.addClass(TestAA.class);
  osgiLib.setManifest(new Asset(){
    public InputStream openStream(){
      OSGiManifestBuilder builder=OSGiManifestBuilder.newInstance();
      builder.addBundleSymbolicName(osgiLib.getName());
      builder.addBundleManifestVersion(2);
      return builder.openStream();
    }
  }
);
  ear.addAsLibraries(osgiLib);
  return ear;
}
