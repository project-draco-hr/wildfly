{
  ensureRemoved(TMP_JBOSS_CLI_FILE);
  jbossDist=TestSuiteEnvironment.getSystemProperty("jboss.dist");
  if (jbossDist == null) {
    fail("jboss.dist system property is not set");
  }
  final File jbossCliXml=new File(jbossDist,"bin" + File.separator + "jboss-cli.xml");
  if (!jbossCliXml.exists()) {
    fail(jbossCliXml + " doesn't exist.");
  }
  BufferedReader reader=null;
  BufferedWriter writer=null;
  try {
    reader=new BufferedReader(new FileReader(jbossCliXml));
    writer=new BufferedWriter(new FileWriter(TMP_JBOSS_CLI_FILE));
    String line=reader.readLine();
    boolean replaced=false;
    while (line != null) {
      if (!replaced) {
        final int i=line.indexOf("<resolve-parameter-values>false</resolve-parameter-values>");
        if (i >= 0) {
          line=line.substring(0,i) + "<resolve-parameter-values>true</resolve-parameter-values>" + line.substring(i + "<resolve-parameter-values>false</resolve-parameter-values>".length());
          replaced=true;
        }
      }
      writer.write(line);
      writer.newLine();
      line=reader.readLine();
    }
    if (!replaced) {
      fail(jbossCliXml.getAbsoluteFile() + " doesn't contain resolve-parameter-values element set to false.");
    }
  }
 catch (  IOException e) {
    fail(e.getLocalizedMessage());
  }
 finally {
    if (reader != null) {
      try {
        reader.close();
      }
 catch (      IOException e) {
      }
    }
    if (writer != null) {
      try {
        writer.close();
      }
 catch (      IOException e) {
      }
    }
  }
  ensureRemoved(SCRIPT_FILE);
  ensureRemoved(PROPS_FILE);
  try {
    writer=new BufferedWriter(new FileWriter(SCRIPT_FILE));
    writer.write(CONNECT_COMMAND);
    writer.newLine();
    writer.write(SET_PROP_COMMAND);
    writer.newLine();
    writer.write(GET_PROP_COMMAND);
    writer.newLine();
    writer.write(REMOVE_PROP_COMMAND);
    writer.newLine();
  }
 catch (  IOException e) {
    fail("Failed to write to " + SCRIPT_FILE.getAbsolutePath() + ": "+ e.getLocalizedMessage());
  }
 finally {
    if (writer != null) {
      try {
        writer.close();
      }
 catch (      IOException e) {
      }
    }
  }
  writer=null;
  try {
    writer=new BufferedWriter(new FileWriter(PROPS_FILE));
    writer.write(CLI_PROP_NAME);
    writer.write('=');
    writer.write(CLI_PROP_VALUE);
    writer.newLine();
    writer.write(HOST_PROP_NAME);
    writer.write('=');
    writer.write(HOST_PROP_VALUE);
    writer.newLine();
    writer.write(PORT_PROP_NAME);
    writer.write('=');
    writer.write(PORT_PROP_VALUE);
    writer.newLine();
  }
 catch (  IOException e) {
    fail("Failed to write to " + PROPS_FILE.getAbsolutePath() + ": "+ e.getLocalizedMessage());
  }
 finally {
    if (writer != null) {
      try {
        writer.close();
      }
 catch (      IOException e) {
      }
    }
  }
}
