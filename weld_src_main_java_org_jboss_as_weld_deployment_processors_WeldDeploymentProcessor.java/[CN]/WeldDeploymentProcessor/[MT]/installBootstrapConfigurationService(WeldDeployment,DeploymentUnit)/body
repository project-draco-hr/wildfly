{
  final boolean nonPortableMode=parentDeploymentUnit.getAttachment(WeldConfiguration.ATTACHMENT_KEY).isNonPortableMode();
  final ResourceLoader resourceLoader=deployment.getServices().get(ResourceLoader.class);
  deployment.getServices().add(BootstrapConfiguration.class,new FileBasedBootstrapConfiguration(resourceLoader){
    @Override public boolean isNonPortableModeEnabled(){
      return nonPortableMode;
    }
  }
);
}
