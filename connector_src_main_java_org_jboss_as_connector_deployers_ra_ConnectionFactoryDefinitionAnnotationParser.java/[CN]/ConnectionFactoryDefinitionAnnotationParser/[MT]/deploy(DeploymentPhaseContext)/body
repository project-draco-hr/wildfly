{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final EEModuleDescription eeModuleDescription=deploymentUnit.getAttachment(Attachments.EE_MODULE_DESCRIPTION);
  final CompositeIndex index=deploymentUnit.getAttachment(org.jboss.as.server.deployment.Attachments.COMPOSITE_ANNOTATION_INDEX);
  final EEApplicationClasses applicationClasses=deploymentUnit.getAttachment(Attachments.EE_APPLICATION_CLASSES_DESCRIPTION);
  List<AnnotationInstance> connectionFactoryDefinitions=index.getAnnotations(CONNECTION_FACTORY_DEFINITIONS);
  if (connectionFactoryDefinitions != null) {
    for (    AnnotationInstance annotation : connectionFactoryDefinitions) {
      final AnnotationTarget target=annotation.target();
      if (target instanceof ClassInfo == false) {
        throw MESSAGES.classOnlyAnnotation("@ConnectionFactoryDefinitions",target);
      }
      List<AnnotationInstance> connectionFactories=this.getNestedConnectionFactoryAnnotations(annotation);
      for (      AnnotationInstance connectionFactory : connectionFactories) {
        this.processConnectionFactoryDefinition(eeModuleDescription,connectionFactory,(ClassInfo)target,applicationClasses);
      }
    }
  }
  List<AnnotationInstance> connectionFactories=index.getAnnotations(CONNECTION_FACTORY_DEFINITION);
  if (connectionFactories != null) {
    for (    AnnotationInstance connectionFactory : connectionFactories) {
      final AnnotationTarget target=connectionFactory.target();
      if (target instanceof ClassInfo == false) {
        throw MESSAGES.classOnlyAnnotation("@ConnectionFactoryDefinition",target);
      }
      this.processConnectionFactoryDefinition(eeModuleDescription,connectionFactory,(ClassInfo)target,applicationClasses);
    }
  }
}
