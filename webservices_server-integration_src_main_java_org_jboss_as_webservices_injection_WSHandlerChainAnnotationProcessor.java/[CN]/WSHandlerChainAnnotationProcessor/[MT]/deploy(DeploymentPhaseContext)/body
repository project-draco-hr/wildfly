{
  final DeploymentUnit unit=phaseContext.getDeploymentUnit();
  if (DeploymentTypeMarker.isType(DeploymentType.EAR,unit)) {
    return;
  }
  AttachmentList<ResourceRoot> resourceRoots=unit.getAttachment(RESOURCE_ROOTS);
  if (EjbDeploymentMarker.isEjbDeployment(unit)) {
    resourceRoots=new AttachmentList<ResourceRoot>(ResourceRoot.class);
    final ResourceRoot root=unit.getAttachment(DEPLOYMENT_ROOT);
    resourceRoots.add(root);
  }
  if (resourceRoots == null) {
    return;
  }
  final WSEndpointHandlersMapping mapping=new WSEndpointHandlersMapping();
  Index index=null;
  for (  final ResourceRoot resourceRoot : resourceRoots) {
    index=resourceRoot.getAttachment(ANNOTATION_INDEX);
    if (index != null) {
      processHandlerChainAnnotations(resourceRoot,index,mapping);
    }
  }
  if (!mapping.isEmpty()) {
    unit.putAttachment(WS_ENDPOINT_HANDLERS_MAPPING_KEY,mapping);
  }
}
