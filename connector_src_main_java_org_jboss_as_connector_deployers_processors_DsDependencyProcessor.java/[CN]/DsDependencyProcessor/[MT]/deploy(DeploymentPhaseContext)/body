{
  final ConnectorXmlDescriptor connectorXmlDescriptor=phaseContext.getAttachment(ConnectorXmlDescriptor.ATTACHMENT_KEY);
  final String deploymentName=connectorXmlDescriptor == null ? null : connectorXmlDescriptor.getDeploymentName();
  final DataSources datasources=getDataSourcesAttachment(phaseContext.getDeploymentUnit());
  if (datasources == null || deploymentName == null || !deploymentName.startsWith("jdbc"))   return;
  log.tracef("Processing datasource deployment: %s",datasources);
  try {
    if (deploymentName.indexOf("local") != -1) {
      List<DataSource> dss=datasources.getDataSource();
      if (dss != null && dss.size() > 0) {
        for (        DataSource ds : dss) {
          try {
            log.tracef("Processing datasource deployment: %s",ds);
            if (ds.getModule() != null && !ds.getModule().trim().equals("")) {
              ModuleIdentifier jdbcIdentifier=ModuleIdentifier.fromString(ds.getModule());
              Module jdbcModule=Module.getSystemModuleLoader().loadModule(jdbcIdentifier);
              phaseContext.addToAttachmentList(Attachments.MODULE_DEPENDENCIES,new ModuleDependency(null,jdbcIdentifier,false,false,false));
            }
 else {
              log.warnf("No module defined for %s",ds.getJndiName());
            }
          }
 catch (          ModuleLoadException mle) {
            log.warnf("Unable to resolve %s for %s",ds.getModule(),ds.getJndiName());
          }
        }
      }
    }
 else {
      List<XaDataSource> xadss=datasources.getXaDataSource();
      if (xadss != null && xadss.size() > 0) {
        for (        XaDataSource xads : xadss) {
          try {
            log.tracef("Processing xa-datasource deployment: %s",xads);
            if (xads.getModule() != null && !xads.getModule().trim().equals("")) {
              ModuleIdentifier jdbcIdentifier=ModuleIdentifier.fromString(xads.getModule());
              Module jdbcModule=Module.getSystemModuleLoader().loadModule(jdbcIdentifier);
              phaseContext.addToAttachmentList(Attachments.MODULE_DEPENDENCIES,new ModuleDependency(null,jdbcIdentifier,false,false,false));
            }
 else {
              log.warnf("No module defined for %s",xads.getJndiName());
            }
          }
 catch (          ModuleLoadException mle) {
            log.warnf("Unable to resolve %s for %s",xads.getModule(),xads.getJndiName());
          }
        }
      }
    }
  }
 catch (  Throwable t) {
    throw new DeploymentUnitProcessingException(t);
  }
}
