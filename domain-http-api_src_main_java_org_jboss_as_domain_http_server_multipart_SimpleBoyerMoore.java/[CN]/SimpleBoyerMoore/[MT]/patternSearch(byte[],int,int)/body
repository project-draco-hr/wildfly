{
  if (pattern.length > length) {
    return PATTERN_NOT_FOUND;
  }
  int i=0, j=0, k=0;
  int end=offset + length;
  for (i=offset + pattern.length - 1; i < end; i+=badMatch[text[i] & 0xff]) {
    for (j=pattern.length - 1, k=i; (j >= 0) && (text[k] == pattern[j]); j--) {
      k--;
    }
    if (j == -1) {
      return k + 1;
    }
  }
  return PATTERN_NOT_FOUND;
}
