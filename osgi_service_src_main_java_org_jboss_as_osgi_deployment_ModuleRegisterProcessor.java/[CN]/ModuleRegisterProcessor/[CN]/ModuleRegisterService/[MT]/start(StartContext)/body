{
  ServiceController<?> controller=context.getController();
  LOGGER.tracef("Starting: %s in mode %s",controller.getName(),controller.getMode());
  LOGGER.infoRegisterModule(module);
  try {
    final BundleContext syscontext=injectedSystemContext.getValue();
    XBundleRevisionBuilderFactory factory=new XBundleRevisionBuilderFactory(){
      @Override public XBundleRevision createResource(){
        return new AbstractBundleRevisionAdaptor(syscontext,module);
      }
    }
;
    XResourceBuilder builder=XBundleRevisionBuilderFactory.create(factory);
    if (metadata != null) {
      builder.loadFrom(metadata);
    }
 else {
      builder.loadFrom(module);
    }
    resource=builder.getResource();
    injectedEnvironment.getValue().installResources(resource);
  }
 catch (  Throwable th) {
    throw MESSAGES.startFailedToRegisterModule(th,module);
  }
}
