{
  FileChannel ch=getChannel(file,false);
  try {
    ch.position(leadingBytes);
    int locPos=leadingBytes + (extraLoc ? (LOCLEN + (useExt ? EXTLEN : 0)) : 0);
    int cenPos=locPos + LOCLEN + (useExt ? EXTLEN : 0);
    int endPos=cenPos + CENLEN;
    if (extraLoc) {
      addLocFile(ch,leadingBytes,useExt);
    }
    addLocFile(ch,locPos,useExt);
    addCenDir(ch,cenPos,locPos);
    addEndRecord(ch,endPos,cenPos,trailingByte,useZip64);
  }
  finally {
    ch.close();
  }
}
