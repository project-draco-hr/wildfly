{
  context.addStep(new AbstractDeploymentChainStep(){
    protected void execute(    DeploymentProcessorTarget processorTarget){
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_DEPLOYMENT,new EjbJarParsingDeploymentUnitProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_CREATE_COMPONENT_DESCRIPTIONS,new EJBComponentDescriptionFactory());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_SESSION_BEAN_DD,new SessionBeanXmlDescriptorProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_CONTEXT_BINDING,new EjbContextJndiBindingProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_TIMERSERVICE_BINDING,new TimerServiceJndiBindingProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_TRANSACTION_MANAGEMENT,new TransactionManagementAnnotationProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_INJECTION_ANNOTATION,new EjbResourceInjectionAnnotationProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_STARTUP_ANNOTATION,new StartupAnnotationProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_CONCURRENCY_MANAGEMENT_ANNOTATION,new ConcurrencyManagementAnnotationProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_LOCK_ANNOTATION,new LockAnnotationProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_DECLARE_ROLES_ANNOTATION,new DeclareRolesProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_RUN_AS_ANNOTATION,new RunAsProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_STATEFUL_TIMEOUT_ANNOTATION,new StatefulTimeoutAnnotationProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_ACCESS_TIMEOUT_ANNOTATION,new AccessTimeoutAnnotationProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_TRANSACTION_ATTR_ANNOTATION,new TransactionAttributeAnnotationProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_SESSION_SYNCHRONIZATION,new SessionSynchronizationProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_RESOURCE_ADAPTER_ANNOTATION,new ResourceAdapterAnnotationProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_ASYNCHRONOUS_ANNOTATION,new AsynchronousAnnotationProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_APPLICATION_EXCEPTION_ANNOTATION,new ApplicationExceptionAnnotationProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_REMOVE_METHOD_ANNOTAION,new RemoveAnnotationProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_DD_INTERCEPTORS,new InterceptorClassDeploymentDescriptorProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_ASSEMBLY_DESC_DD,new AssemblyDescriptorProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_SECURITY_ROLE_REF_DD,new SecurityRoleRefDDProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_SECURITY_IDENTITY_DD,new SecurityIdentityDDProcessor());
      processorTarget.addDeploymentProcessor(Phase.PARSE,Phase.PARSE_EJB_SECURITY_DOMAIN_ANNOTATION,new SecurityDomainProcessor());
      processorTarget.addDeploymentProcessor(Phase.DEPENDENCIES,Phase.DEPENDENCIES_EJB,new EjbDependencyDeploymentUnitProcessor());
      processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_BUSINESS_VIEW_ANNOTATION,new BusinessViewAnnotationProcessor());
      processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_IMPLICIT_NO_INTERFACE_VIEW,new ImplicitLocalViewProcessor());
      processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_JNDI_BINDINGS,new EjbJndiBindingsDeploymentUnitProcessor());
      processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_MODULE_CONFIGURATION,new EjbJarConfigurationProcessor());
      processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_DD_INTERCEPTORS,new DeploymentDescriptorInterceptorBindingsProcessor());
      processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_DD_CONCURRENCY,new EjbConcurrencyProcessor());
      processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_DD_METHOD_RESOLUTION,new DeploymentDescriptorMethodProcessor());
      processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_DD_REMOVE_METHOD,new RemoveMethodDeploymentDescriptorProcessor());
      processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_DENY_ALL_ANNOTATION,new DenyAllProcessor());
      processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_ROLES_ALLOWED_ANNOTATION,new RolesAllowedProcessor());
      processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_PERMIT_ALL_ANNOTATION,new PermitAllProcessor());
      processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_EXCLUDE_LIST_DD,new ExcludeListDDProcessor());
      processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_METHOD_PERMISSION_DD,new MethodPermissionDDProcessor());
      processorTarget.addDeploymentProcessor(Phase.POST_MODULE,Phase.POST_MODULE_EJB_REF,new EjbRefProcessor());
      processorTarget.addDeploymentProcessor(Phase.INSTALL,Phase.INSTALL_RESOLVE_EJB_INJECTIONS,new EjbInjectionResolutionProcessor());
      processorTarget.addDeploymentProcessor(Phase.INSTALL,Phase.INSTALL_DEPENDS_ON_ANNOTATION,new EjbDependsOnAnnotationProcessor());
      processorTarget.addDeploymentProcessor(Phase.CLEANUP,Phase.CLEANUP_EJB,new EjbCleanUpProcessor());
    }
  }
,OperationContext.Stage.RUNTIME);
  final ServiceTarget serviceTarget=context.getServiceTarget();
  final EJBUtilities utilities=new EJBUtilities();
  newControllers.add(serviceTarget.addService(EJBUtilities.SERVICE_NAME,utilities).addDependency(ConnectorServices.RA_REPOSISTORY_SERVICE,ResourceAdapterRepository.class,utilities.getResourceAdapterRepositoryInjector()).addDependency(ConnectorServices.IRONJACAMAR_MDR,MetadataRepository.class,utilities.getMdrInjector()).addDependency(SimpleSecurityManagerService.SERVICE_NAME,SimpleSecurityManager.class,utilities.getSecurityManagerInjector()).addDependency(TxnServices.JBOSS_TXN_TRANSACTION_MANAGER,TransactionManager.class,utilities.getTransactionManagerInjector()).addDependency(TxnServices.JBOSS_TXN_SYNCHRONIZATION_REGISTRY,TransactionSynchronizationRegistry.class,utilities.getTransactionSynchronizationRegistryInjector()).addDependency(TxnServices.JBOSS_TXN_USER_TRANSACTION,UserTransaction.class,utilities.getUserTransactionInjector()).addListener(verificationHandler).setInitialMode(ServiceController.Mode.ACTIVE).install());
}
