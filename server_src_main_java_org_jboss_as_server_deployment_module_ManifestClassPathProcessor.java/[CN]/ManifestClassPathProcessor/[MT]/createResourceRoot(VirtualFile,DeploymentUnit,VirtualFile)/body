{
  try {
    Map<String,MountedDeploymentOverlay> overlays=deploymentUnit.getAttachment(Attachments.DEPLOYMENT_OVERLAY_LOCATIONS);
    String relativeName=file.getPathNameRelativeTo(deploymentRoot);
    MountedDeploymentOverlay overlay=overlays.get(relativeName);
    Closeable closable=null;
    if (overlay != null) {
      overlay.remountAsZip(false);
    }
 else     if (file.isFile()) {
      closable=VFS.mountZip(file,file,TempFileProviderService.provider());
    }
    final MountHandle mountHandle=new MountHandle(closable);
    final ResourceRoot resourceRoot=new ResourceRoot(file,mountHandle);
    ModuleRootMarker.mark(resourceRoot);
    ResourceRootIndexer.indexResourceRoot(resourceRoot);
    return resourceRoot;
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
