{
  Boolean outboundProperty=(Boolean)smc.get(MessageContext.MESSAGE_OUTBOUND_PROPERTY);
  SOAPMessage message=smc.getMessage();
  invoked++;
  if (outboundProperty.booleanValue()) {
    log.debug("Outgoing message:");
  }
 else {
    log.debug("Incoming message:");
  }
  log.debug("-----------");
  try {
    JBossLoggingOutputStream os=new JBossLoggingOutputStream(log,Level.DEBUG);
    message.writeTo(os);
    os.flush();
    log.debug("");
  }
 catch (  Exception e) {
    log.debug("Exception in handler: " + e);
  }
  log.debug("-----------");
  try {
switch (invoked % 4) {
case 1:
      SOAPElement firstBodyElement=(SOAPElement)message.getSOAPBody().getChildElements().next();
    final QName createSequenceQName=new QName("http://schemas.xmlsoap.org/ws/2005/02/rm","CreateSequence");
  if (!createSequenceQName.equals(firstBodyElement.getElementQName())) {
    throw new WebServiceException("CreateSequence in soap body was expected, but it contains '" + firstBodyElement.getElementQName() + "'");
  }
break;
case 2:
firstBodyElement=(SOAPElement)message.getSOAPBody().getChildElements().next();
final QName createSequenceResponseQName=new QName("http://schemas.xmlsoap.org/ws/2005/02/rm","CreateSequenceResponse");
if (!createSequenceResponseQName.equals(firstBodyElement.getElementQName())) {
throw new WebServiceException("CreateSequenceResponse in soap body was expected, but it contains '" + firstBodyElement.getElementQName() + "'");
}
break;
case 3:
Iterator headerElements=message.getSOAPHeader().getChildElements();
boolean found=false;
final QName sequenceQName=new QName("http://schemas.xmlsoap.org/ws/2005/02/rm","Sequence");
while (headerElements.hasNext()) {
SOAPElement soapElement=(SOAPElement)headerElements.next();
if (sequenceQName.equals(soapElement.getElementQName())) {
found=true;
}
}
if (!found) {
throw new WebServiceException("wsrm:Sequence is not present in soap header");
}
break;
case 0:
headerElements=message.getSOAPHeader().getChildElements();
found=false;
final QName sequenceAckQName=new QName("http://schemas.xmlsoap.org/ws/2005/02/rm","SequenceAcknowledgement");
while (headerElements.hasNext()) {
SOAPElement soapElement=(SOAPElement)headerElements.next();
if (sequenceAckQName.equals(soapElement.getElementQName())) {
found=true;
}
}
if (!found) {
throw new WebServiceException("wsrm:SequenceAcknowledgement is not present in soap header");
}
break;
}
}
 catch (SOAPException ex) {
throw new WebServiceException(ex.getMessage(),ex);
}
}
