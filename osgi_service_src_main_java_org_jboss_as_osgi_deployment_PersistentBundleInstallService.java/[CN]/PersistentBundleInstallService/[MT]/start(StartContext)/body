{
  ServiceController<?> controller=context.getController();
  LOGGER.tracef("Starting: %s in mode %s",controller.getName(),controller.getMode());
  try {
    BundleManager bundleManager=injectedBundleManager.getValue();
    StorageStateProvider storageStateProvider=injectedStorageProvider.getValue();
    StorageState storageState=storageStateProvider.getByLocation(deployment.getLocation());
    if (storageState != null) {
      deployment.addAttachment(StorageState.class,storageState);
    }
    ServiceListener<Bundle> listener=deploymentTracker.getBundleInstallListener();
    bundleManager.installBundle(deployment,listener);
  }
 catch (  Throwable th) {
    throw MESSAGES.startFailedToInstallDeployment(th,deployment);
  }
}
