{
  final DeploymentUnit depUnit=phaseContext.getDeploymentUnit();
  final PersistentBundleInstallService service=new PersistentBundleInstallService(deploymentTracker,deployment);
  final String contextName=depUnit.getName();
  final ServiceName serviceName=getServiceName(depUnit);
  final ServiceTarget serviceTarget=phaseContext.getServiceTarget();
  ServiceBuilder<Void> builder=serviceTarget.addService(serviceName,service);
  builder.addDependency(Services.BUNDLE_MANAGER,BundleManager.class,service.injectedBundleManager);
  builder.addDependency(Services.STORAGE_STATE_PROVIDER,StorageStateProvider.class,service.injectedStorageProvider);
  builder.addDependency(deploymentUnitName(contextName));
  builder.addDependency(IntegrationServices.AUTOINSTALL_COMPLETE);
  builder.install();
  return serviceName;
}
