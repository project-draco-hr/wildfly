{
  Set<InetAddress> result=new HashSet<InetAddress>();
  for (  InetAddress address : all) {
    if (preferIPv4Stack && !preferIPv6Stack && !(address instanceof Inet4Address)) {
      continue;
    }
 else     if (preferIPv6Stack && !preferIPv4Stack && !(address instanceof Inet6Address)) {
      continue;
    }
    result.add(address);
  }
  return result;
}
