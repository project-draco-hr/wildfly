{
  final IfElseBlock ifBlock=IfElseBlock.get(ctx);
  final BatchManager batchManager=ctx.getBatchManager();
  if (!batchManager.isBatchActive()) {
    throw new CommandLineException("if block did not activate batch mode.");
  }
  final Batch ifBatch=batchManager.getActiveBatch();
  if (ifBatch.size() == 0) {
    throw new CommandLineException("if block is empty.");
  }
  ifBlock.setIfRequest(ifBatch.toRequest());
  ifBlock.setInElse();
  batchManager.discardActiveBatch();
  if (!batchManager.activateNewBatch()) {
    IfElseBlock.remove(ctx);
    throw new CommandFormatException("Failed to activate batch mode for else.");
  }
}
