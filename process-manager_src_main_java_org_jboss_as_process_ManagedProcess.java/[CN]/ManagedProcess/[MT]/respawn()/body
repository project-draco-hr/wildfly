{
  if (master.isShutdown())   return;
  long wait=0;
  boolean sendDownToMaster=false;
synchronized (this) {
    if (stopped || start)     return;
    commandStream.close();
    if (respawnPolicy != null) {
      wait=respawnPolicy.getTimeOutMs(++respawnCount);
      if (wait < 0) {
        log.info(processName + " has crashed " + respawnCount+ " times, stopping it");
        try {
          stop();
        }
 catch (        IOException e) {
          log.warn("Error stopping crashed " + processName,e);
        }
        return;
      }
    }
 else {
      sendDownToMaster=true;
    }
  }
  if (sendDownToMaster) {
    master.downServer(processName);
    return;
  }
  try {
    TimeUnit.MILLISECONDS.sleep(wait);
  }
 catch (  InterruptedException e) {
    log.info("Error waiting  " + wait + "ms to respawn crashed "+ processName,e);
  }
synchronized (this) {
    if (stopped || start)     return;
  }
  try {
    start(true);
  }
 catch (  IOException e) {
    log.warn("Error respawning " + processName,e);
  }
}
