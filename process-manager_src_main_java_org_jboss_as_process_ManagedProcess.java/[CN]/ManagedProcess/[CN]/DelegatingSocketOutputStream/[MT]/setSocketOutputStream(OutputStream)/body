{
synchronized (this) {
    if (realOut != null) {
      throw new IllegalStateException("There is already a socket output stream for " + processName);
    }
    realOut=new BufferedOutputStream(out);
    current=realOut;
    if (bufferedBytes != null) {
      for (      byte[] buf : bufferedBytes) {
        current.write(buf);
        current.flush();
      }
    }
    if (bytesOut != null) {
      byte[] bytes=bytesOut.toByteArray();
      realOut.write(bytes);
      out.flush();
    }
    safeClose(bytesOut);
    bytesOut=null;
    bufferedBytes.clear();
  }
}
