{
  JavaArchive archive=getBundleArchive();
  Bundle bundle=executeDeploy(archive);
  assertNotNull("Bundle not null",bundle);
  assertBundleState(Bundle.INSTALLED,bundle.getState());
  final String deploymentName=support.getDeploymentName(archive);
  assertServiceUp(DeploymentService.SERVICE_NAME.append(deploymentName));
  assertServiceUp(OSGiDeploymentService.SERVICE_NAME.append(deploymentName));
  executeUndeploy(archive);
  assertServiceDown(DeploymentService.SERVICE_NAME.append(deploymentName));
  assertServiceDown(OSGiDeploymentService.SERVICE_NAME.append(deploymentName));
  assertBundleState(Bundle.UNINSTALLED,bundle.getState());
}
