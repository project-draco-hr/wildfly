{
  LOGGER.info("RESOURCE_LOCATION=" + RESOURCE_LOCATION);
  ModelNode op;
  server=Server.createTcpServer("-tcpAllowOthers").start();
  Class.forName("org.h2.Driver");
  connection=DriverManager.getConnection("jdbc:h2:mem:test;DB_CLOSE_DELAY=-1","sa",RIGHT_PASSWORD);
  executeUpdate(connection,"CREATE TABLE TestPeople(Name Varchar(50), Surname Varchar(50))");
  executeUpdate(connection,"INSERT INTO TestPeople VALUES ('John','Smith')");
  vaultHandler=new VaultHandler(RESOURCE_LOCATION);
  String attributeName="password";
  String vaultPasswordString=vaultHandler.addSecuredAttribute(VAULT_BLOCK,attributeName,RIGHT_PASSWORD.toCharArray());
  String wrongVaultPasswordString=vaultHandler.addSecuredAttribute(VAULT_BLOCK_WRONG,attributeName,WRONG_PASSWORD.toCharArray());
  LOGGER.debug("vaultPasswordString=" + vaultPasswordString);
  op=new ModelNode();
  op.get(OP).set(ADD);
  op.get(OP_ADDR).add(CORE_SERVICE,VAULT);
  ModelNode vaultOption=op.get(VAULT_OPTIONS);
  vaultOption.get("KEYSTORE_URL").set(vaultHandler.getKeyStore());
  vaultOption.get("KEYSTORE_PASSWORD").set(vaultHandler.getMaskedKeyStorePassword());
  vaultOption.get("KEYSTORE_ALIAS").set(vaultHandler.getAlias());
  vaultOption.get("SALT").set(vaultHandler.getSalt());
  vaultOption.get("ITERATION_COUNT").set(vaultHandler.getIterationCountAsString());
  vaultOption.get("ENC_FILE_DIR").set(vaultHandler.getEncodedVaultFileDirectory());
  managementClient.getControllerClient().execute(new OperationBuilder(op).build());
  LOGGER.debug("Vault created in sever configuration");
  ModelNode address=new ModelNode();
  address.add(SUBSYSTEM,"datasources");
  address.add("data-source",VAULT_BLOCK);
  address.protect();
  op=new ModelNode();
  op.get(OP).set(ADD);
  op.get(OP_ADDR).set(address);
  op.get("jndi-name").set("java:jboss/datasources/" + VAULT_BLOCK);
  op.get("driver-name").set("h2");
  op.get("connection-url").set("jdbc:h2:tcp://" + Utils.getSecondaryTestAddress(managementClient) + "/mem:test");
  op.get("user-name").set("sa");
  op.get("password").set("${" + vaultPasswordString + "}");
  op.get(OPERATION_HEADERS).get(ALLOW_RESOURCE_SERVICE_RESTART).set(true);
  managementClient.getControllerClient().execute(new OperationBuilder(op).build());
  LOGGER.debug(VAULT_BLOCK + " datasource created");
  address=new ModelNode();
  address.add(SUBSYSTEM,"datasources");
  address.add("data-source",VAULT_BLOCK_WRONG);
  address.protect();
  op=new ModelNode();
  op.get(OP).set(ADD);
  op.get(OP_ADDR).set(address);
  op.get("jndi-name").set("java:jboss/datasources/" + VAULT_BLOCK_WRONG);
  op.get("driver-name").set("h2");
  op.get("connection-url").set("jdbc:h2:tcp://" + Utils.getSecondaryTestAddress(managementClient) + "/mem:test");
  op.get("user-name").set("sa");
  op.get("password").set("${" + wrongVaultPasswordString + "}");
  op.get(OPERATION_HEADERS).get(ALLOW_RESOURCE_SERVICE_RESTART).set(true);
  managementClient.getControllerClient().execute(new OperationBuilder(op).build());
  LOGGER.debug(VAULT_BLOCK_WRONG + " datasource created");
}
