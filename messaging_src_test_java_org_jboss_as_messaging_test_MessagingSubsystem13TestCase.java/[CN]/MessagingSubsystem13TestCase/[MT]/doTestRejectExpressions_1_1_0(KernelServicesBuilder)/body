{
  KernelServices mainServices=builder.build();
  assertTrue(mainServices.isSuccessfulBoot());
  KernelServices legacyServices=mainServices.getLegacyServices(VERSION_1_1_0);
  assertNotNull(legacyServices);
  assertTrue(legacyServices.isSuccessfulBoot());
  PathAddress subsystemAddress=PathAddress.pathAddress(pathElement(SUBSYSTEM,MessagingExtension.SUBSYSTEM_NAME));
  List<ModelNode> modelNodes=builder.parseXmlResource("subsystem_incompatible_1_3.xml");
  modelNodes.remove(0);
  checkFailedTransformedBootOperations(mainServices,VERSION_1_1_0,modelNodes,new FailedOperationTransformationConfig().addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH),new ChainedConfig(new HashMap<String,FailedOperationTransformationConfig.PathAddressConfig>(){
{
      configureAttributes(this,HornetQServerResourceDefinition.ATTRIBUTES_WITH_EXPRESSION_AFTER_1_1_0,HornetQServerResourceDefinition.NEW_ATTRIBUTES_ADDED_AFTER_1_1_0);
    }
  }
)).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(pathElement(ModelDescriptionConstants.PATH)),new RejectExpressionsConfig(ModelDescriptionConstants.PATH)).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(pathElement(CommonAttributes.IN_VM_CONNECTOR)),new RejectExpressionsConfig(InVMTransportDefinition.SERVER_ID)).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(pathElement(CommonAttributes.IN_VM_ACCEPTOR)),new RejectExpressionsConfig(InVMTransportDefinition.SERVER_ID)).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(BroadcastGroupDefinition.PATH),new RejectExpressionsConfig(BroadcastGroupDefinition.BROADCAST_PERIOD){
    @Override public boolean expectFailed(    ModelNode operation){
      if ("groupT".equals(operation.get(OP_ADDR).get(2).get(CommonAttributes.BROADCAST_GROUP).asString())) {
        return true;
      }
      return super.expectFailed(operation);
    }
  }
).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(DiscoveryGroupDefinition.PATH),new RejectExpressionsConfig(DiscoveryGroupDefinition.REFRESH_TIMEOUT,DiscoveryGroupDefinition.INITIAL_WAIT_TIMEOUT){
    @Override public boolean expectFailed(    ModelNode operation){
      if ("groupU".equals(operation.get(OP_ADDR).get(2).get(CommonAttributes.DISCOVERY_GROUP).asString())) {
        return true;
      }
      return super.expectFailed(operation);
    }
  }
).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(DivertDefinition.PATH),new RejectExpressionsConfig(DivertDefinition.ATTRIBUTES_WITH_EXPRESSION_AFTER_1_1_0)).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(QueueDefinition.PATH),new RejectExpressionsConfig(QueueDefinition.ATTRIBUTES_WITH_EXPRESSION_AFTER_1_1_0)).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(ClusterConnectionDefinition.PATH),new ChainedConfig(new HashMap<String,FailedOperationTransformationConfig.PathAddressConfig>(){
{
      configureAttributes(this,ClusterConnectionDefinition.ATTRIBUTES_WITH_EXPRESSION_AFTER_1_1_0,ClusterConnectionDefinition.NEW_ATTRIBUTES_ADDED_AFTER_1_1_0);
    }
  }
)).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(BridgeDefinition.PATH),new RejectExpressionsConfig(BridgeDefinition.ATTRIBUTES_WITH_EXPRESSION_AFTER_1_1_0)).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(GroupingHandlerDefinition.PATH),new RejectExpressionsConfig(GroupingHandlerDefinition.ATTRIBUTES_WITH_EXPRESSION_AFTER_1_1_0)).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(AddressSettingDefinition.PATH),new RejectExpressionsConfig(AddressSettingDefinition.REJECTED_EXPRESSION_ATTRIBUTES)).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(ConnectorServiceDefinition.PATH).append(ConnectorServiceParamDefinition.PATH),new RejectExpressionsConfig(ConnectorServiceParamDefinition.VALUE)).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(ConnectionFactoryDefinition.PATH),new ChainedConfig(new HashMap<String,FailedOperationTransformationConfig.PathAddressConfig>(){
{
      configureAttributes(this,ConnectionFactoryDefinition.ATTRIBUTES_WITH_EXPRESSION_AFTER_1_1_0,new AttributeDefinition[]{CALL_FAILOVER_TIMEOUT});
    }
  }
).setReadOnly(FACTORY_TYPE)).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(PooledConnectionFactoryDefinition.PATH),new ChainedConfig(new HashMap<String,FailedOperationTransformationConfig.PathAddressConfig>(){
{
      configureAttributes(this,PooledConnectionFactoryDefinition.ATTRIBUTES_WITH_EXPRESSION_AFTER_1_1_0,PooledConnectionFactoryDefinition.NEW_ATTRIBUTES_ADDED_AFTER_1_1_0);
    }
  }
).setReadOnly(ConnectionFactoryAttributes.Pooled.TRANSACTION)).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(JMSQueueDefinition.PATH),new RejectExpressionsConfig(JMSQueueDefinition.ATTRIBUTES_WITH_EXPRESSION_AFTER_1_1_0)).addFailedAttribute(subsystemAddress.append(HORNETQ_SERVER_PATH).append(JMSTopicDefinition.PATH),new RejectExpressionsConfig(JMSTopicDefinition.ATTRIBUTES_WITH_EXPRESSION_AFTER_1_1_0)).addFailedAttribute(subsystemAddress.append(JMSBridgeDefinition.PATH),new RejectExpressionsConfig(new String[0]){
    @Override public boolean expectFailed(    ModelNode operation){
      return true;
    }
  }
));
}
