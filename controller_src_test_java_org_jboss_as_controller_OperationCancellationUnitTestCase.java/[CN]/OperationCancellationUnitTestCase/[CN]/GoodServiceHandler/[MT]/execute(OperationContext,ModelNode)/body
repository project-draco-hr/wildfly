{
  context.readResourceForUpdate(PathAddress.EMPTY_ADDRESS);
  context.addStep(new OperationStepHandler(){
    @Override public void execute(    final OperationContext context,    ModelNode operation){
      final ServiceName svcName=ServiceName.JBOSS.append("good-service");
      ServiceVerificationHandler verificationHandler=new ServiceVerificationHandler();
      context.getServiceTarget().addService(svcName,Service.NULL).addListener(verificationHandler).install();
      context.addStep(verificationHandler,OperationContext.Stage.VERIFY);
      if (useNonRecursive) {
        context.completeStep(new OperationContext.RollbackHandler(){
          @Override public void handleRollback(          OperationContext context,          ModelNode operation){
            context.removeService(svcName);
          }
        }
);
      }
 else       if (context.completeStep() == OperationContext.ResultAction.ROLLBACK) {
        context.removeService(svcName);
      }
    }
  }
,OperationContext.Stage.RUNTIME);
  if (useNonRecursive) {
    context.completeStep(OperationContext.RollbackHandler.NOOP_ROLLBACK_HANDLER);
  }
 else {
    context.completeStep();
  }
}
