{
  boolean cancelled=false;
  long timeout=System.currentTimeMillis() + 10000;
  String matchedStatus=null;
  OUT:   while (System.currentTimeMillis() < timeout) {
    for (    Resource resource : managementControllerResource.getChildren(ACTIVE_OPERATION)) {
      if (resource.getModel().get(OP).asString().equals(expectedOpName)) {
        matchedStatus=resource.getModel().get(EXECUTION_STATUS).asString();
        if (expectedExecutionStatus.toString().equals(matchedStatus)) {
          cancelled=Cancellable.class.cast(resource).cancel();
          break OUT;
        }
        break;
      }
    }
    if (matchedStatus != null) {
      Thread.sleep(100);
    }
  }
  assertEquals(expectedExecutionStatus.toString(),matchedStatus);
  assertTrue(cancelled);
  try {
    future.get();
    assertFalse(expectCancellationException);
  }
 catch (  CancellationException e) {
    assertTrue(expectCancellationException);
  }
}
