{
  final ChannelServer.Configuration configuration=new ChannelServer.Configuration();
  configuration.setEndpointName(ENDPOINT_NAME);
  configuration.setUriScheme(URI_SCHEME);
  configuration.setBindAddress(new InetSocketAddress("127.0.0.1",PORT));
  channelServer=ChannelServer.create(configuration);
  channelServer.addChannelOpenListener(TEST_CHANNEL,new OpenListener(){
    @Override public void channelOpened(    final Channel channel){
      final MockController controller=new MockController();
      final ManagementChannelHandler channels=new ManagementChannelHandler(channel,remoteExecutors);
      TransactionalProtocolHandlers.addAsHandlerFactory(channels,controller);
      transferQueue.offer(controller);
      channel.addCloseHandler(channels);
      channel.receiveMessage(channels.getReceiver());
    }
    @Override public void registrationTerminated(){
    }
  }
);
  final ProtocolChannelClient.Configuration connectionConfig=new ProtocolChannelClient.Configuration();
  connectionConfig.setEndpoint(channelServer.getEndpoint());
  connectionConfig.setUri(new URI("" + URI_SCHEME + "://127.0.0.1:"+ PORT+ ""));
  final ProtocolChannelClient client=ProtocolChannelClient.create(connectionConfig);
  futureConnection=client.connect(new PasswordClientCallbackHandler("bob",ENDPOINT_NAME,"pass".toCharArray()));
}
