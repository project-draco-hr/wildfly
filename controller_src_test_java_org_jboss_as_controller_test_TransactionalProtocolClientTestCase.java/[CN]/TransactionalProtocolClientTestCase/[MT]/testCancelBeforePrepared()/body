{
  final BlockingOperationListener listener=new BlockingOperationListener();
  final CountDownLatch latch=new CountDownLatch(1);
  final TestOperationHandler handler=new TestOperationHandler(){
    @Override public void execute(    ModelNode operation,    OperationMessageHandler handler,    OperationAttachments attachments) throws Exception {
      try {
synchronized (this) {
          latch.countDown();
          wait();
        }
      }
 catch (      InterruptedException e) {
      }
    }
  }
;
  final TestUpdateWrapper wrapper=createTestClient(0,handler);
  final Future<ModelNode> futureResult=wrapper.execute(listener);
  latch.await();
  futureResult.cancel(false);
  OperationContext.ResultAction action=null;
  while (action == null) {
    action=wrapper.getResultAction();
    Thread.sleep(15);
  }
  wrapper.assertResultAction(OperationContext.ResultAction.ROLLBACK);
  final ModelNode result=futureResult.get();
  Assert.assertEquals(FAILURE,result);
}
