{
  ServiceName factoryName=name.append("factory");
  DistributableSingleSignOnManagerFactoryBuilder builder=new DistributableSingleSignOnManagerFactoryBuilderValue().getValue();
  if (builder != null) {
    builder.build(target,factoryName,serverName,hostName).setInitialMode(ServiceController.Mode.ON_DEMAND).install();
  }
 else {
    SingleSignOnManagerFactory factory=new InMemorySingleSignOnManagerFactory();
    target.addService(factoryName,new ValueService<>(new ImmediateValue<>(factory))).install();
  }
  SingleSignOnManagerService service=new SingleSignOnManagerService();
  return target.addService(name,service).addDependency(factoryName,SingleSignOnManagerFactory.class,service.factory).addDependency(UndertowService.virtualHostName(serverName,hostName),Host.class,service.host);
}
