{
  ServiceName factoryName=name.append("factory");
  DistributableSingleSignOnManagerFactoryBuilder builder=new DistributableSingleSignOnManagerFactoryBuilderValue().getValue();
  if (builder != null) {
    builder.build(target,factoryName,hostName).setInitialMode(ServiceController.Mode.ON_DEMAND).install();
  }
 else {
    SingleSignOnManagerFactory factory=new InMemorySingleSignOnManagerFactory();
    target.addService(factoryName,new ValueService<>(new ImmediateValue<>(factory)));
  }
  SingleSignOnManagerService service=new SingleSignOnManagerService();
  return target.addService(name,service).addDependency(factoryName,SingleSignOnManagerFactory.class,service.factory).addDependency(hostName,Host.class,service.host);
}
