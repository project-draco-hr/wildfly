{
  OutputStream outputStream=null;
  ByteDataOutput output=null;
  try {
    outputStream=connection.writeMessage();
    output=new SimpleByteDataOutput(outputStream);
    output.writeByte(Protocol.REQUEST_OPERATION);
    output.writeByte(getRequestCode());
    output.writeByte(Protocol.REQUEST_START);
    output.close();
    outputStream.close();
  }
  finally {
    safeClose(output);
    safeClose(outputStream);
  }
  try {
    outputStream=connection.writeMessage();
    sendRequest(protocolVersion,outputStream);
    outputStream.close();
  }
  finally {
    safeClose(output);
    safeClose(outputStream);
  }
  try {
    outputStream=connection.writeMessage();
    output=new SimpleByteDataOutput(outputStream);
    output.writeByte(Protocol.REQUEST_END);
    output.close();
    outputStream.close();
  }
  finally {
    safeClose(output);
    safeClose(outputStream);
  }
}
