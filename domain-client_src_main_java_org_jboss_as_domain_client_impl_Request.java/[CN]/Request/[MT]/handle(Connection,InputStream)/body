{
  try {
    expectHeader(input,Protocol.RESPONSE_START);
    byte responseCode=(byte)StreamUtils.readByte(input);
    if (responseCode != getResponseCode()) {
      throw new IOException("Invalid response code.  Expecting '" + getResponseCode() + "' received '"+ responseCode+ "'");
    }
    connection.setMessageHandler(responseBodyHandler);
  }
 catch (  IOException e) {
    future.setException(e);
  }
catch (  Throwable t) {
    future.setException(new IOException("Failed to handle management message",t));
  }
}
