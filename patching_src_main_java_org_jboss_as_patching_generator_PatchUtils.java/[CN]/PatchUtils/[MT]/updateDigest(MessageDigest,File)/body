{
  if (file.isDirectory()) {
    File[] childList=file.listFiles();
    if (childList != null) {
      Map<String,File> sortedChildren=new TreeMap<String,File>();
      for (      File child : childList) {
        sortedChildren.put(child.getName(),child);
      }
      for (      File child : sortedChildren.values()) {
        updateDigest(digest,child);
      }
    }
  }
 else {
    FileInputStream fis=new FileInputStream(file);
    try {
      BufferedInputStream bis=new BufferedInputStream(fis);
      byte[] bytes=new byte[8192];
      int read;
      while ((read=bis.read(bytes)) > -1) {
        digest.update(bytes,0,read);
      }
    }
  finally {
      safeClose(fis);
    }
  }
}
