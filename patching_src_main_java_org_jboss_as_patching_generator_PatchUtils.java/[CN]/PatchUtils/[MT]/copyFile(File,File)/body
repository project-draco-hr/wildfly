{
  if (sourceFile.isDirectory()) {
    copyDir(sourceFile,targetFile);
  }
 else {
    File parent=targetFile.getParentFile();
    if (!parent.exists()) {
      if (!parent.mkdirs()) {
        throw new IllegalStateException("Cannot create directory " + parent);
      }
    }
    final InputStream is=new FileInputStream(sourceFile);
    try {
      final OutputStream os=new FileOutputStream(targetFile);
      try {
        copyStreamAndClose(is,os,DEFAULT_BUFFER_SIZE);
      }
  finally {
        safeClose(os);
      }
    }
  finally {
      safeClose(is);
    }
  }
}
