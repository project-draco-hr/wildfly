{
  final DeploymentUnit depUnit=phaseContext.getDeploymentUnit();
  final String contextName=depUnit.getName();
  BundleInfo info=depUnit.getAttachment(OSGiConstants.BUNDLE_INFO_KEY);
  Deployment deployment=BundleInstallIntegration.getDeployment(contextName);
  if (info != null || deployment != null)   return;
  Manifest manifest=depUnit.getAttachment(Attachments.OSGI_MANIFEST);
  if (manifest != null) {
    try {
      VirtualFile virtualFile=depUnit.getAttachment(Attachments.DEPLOYMENT_ROOT).getRoot();
      info=BundleInfo.createBundleInfo(AbstractVFS.adapt(virtualFile),contextName);
      depUnit.putAttachment(OSGiConstants.BUNDLE_INFO_KEY,info);
    }
 catch (    BundleException ex) {
      throw MESSAGES.cannotCreateBundleDeployment(ex,depUnit);
    }
  }
}
