{
  final DeploymentUnit depUnit=phaseContext.getDeploymentUnit();
  final String contextName=depUnit.getName();
  if (BundleLifecycleIntegration.getDeployment(contextName) != null)   return;
  OSGiMetaData metadata=depUnit.getAttachment(OSGiConstants.OSGI_METADATA_KEY);
  if (metadata != null) {
    try {
      VirtualFile virtualFile=depUnit.getAttachment(Attachments.DEPLOYMENT_ROOT).getRoot();
      BundleInfo info=BundleInfo.createBundleInfo(AbstractVFS.adapt(virtualFile),contextName,metadata);
      depUnit.putAttachment(OSGiConstants.BUNDLE_INFO_KEY,info);
    }
 catch (    BundleException ex) {
      throw MESSAGES.cannotCreateBundleDeployment(ex,depUnit);
    }
  }
}
