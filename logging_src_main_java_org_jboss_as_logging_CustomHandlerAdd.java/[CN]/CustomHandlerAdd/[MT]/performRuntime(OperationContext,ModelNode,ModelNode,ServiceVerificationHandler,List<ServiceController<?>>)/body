{
  final PathAddress address=PathAddress.pathAddress(operation.get(OP_ADDR));
  final String name=address.getLastElement().getValue();
  final ServiceTarget serviceTarget=context.getServiceTarget();
  final String className=operation.get(CLASS).asString();
  final String moduleName=operation.get(MODULE).asString();
  final CustomHandlerService service=new CustomHandlerService(className,moduleName);
  final ServiceBuilder<Handler> serviceBuilder=serviceTarget.addService(LogServices.handlerName(name),service);
  try {
    if (operation.hasDefined(LEVEL))     service.setLevel(Level.parse(operation.get(LEVEL).asString()));
    if (operation.hasDefined(ENCODING))     service.setEncoding(operation.get(ENCODING).asString());
  }
 catch (  Throwable t) {
    throw new OperationFailedException(new ModelNode().set(t.getLocalizedMessage()));
  }
  service.setFormatterSpec(createFormatterSpec(operation));
  serviceBuilder.addListener(verificationHandler);
  serviceBuilder.setInitialMode(ServiceController.Mode.ACTIVE);
  newControllers.add(serviceBuilder.install());
}
