{
  while (reader.hasNext()) {
    int type=reader.next();
switch (type) {
case START_ELEMENT:
      if (reader.getLocalName().equals("subsystems")) {
        String name="";
        for (int i=0; i < reader.getAttributeCount(); i++) {
          if (!reader.getAttributeLocalName(i).equals("name")) {
            throw new XMLStreamException("Unknown attribute " + reader.getAttributeLocalName(i),reader.getLocation());
          }
 else {
            name=propertyReplacer.replaceProperties(reader.getAttributeValue(i));
          }
        }
        if (subsystemConfigs.containsKey(name)) {
          throw new XMLStreamException("Already have a subsystems named " + name,reader.getLocation());
        }
        List<SubsystemConfig> subsystems=new ArrayList<SubsystemConfig>();
        parseSubsystem(reader,subsystems);
        this.subsystemConfigs.put(name,subsystems.toArray(new SubsystemConfig[subsystems.size()]));
      }
 else {
        throw new XMLStreamException("Invalid element " + reader.getLocalName(),reader.getLocation());
      }
    break;
case END_ELEMENT:
  if (reader.getLocalName().equals("config")) {
    return;
  }
}
}
}
