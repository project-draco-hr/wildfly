{
  File file=new File(logDir,"test-file.log");
  readFile(file,1);
  ModelNode op=createAddCoreHandlerReferenceOperation("test-file");
  executeForResult(op);
  List<ModelNode> records=readFile(file,2);
  List<ModelNode> ops=checkCoreBootRecordHeader(records.get(1),1,false,false,true);
  checkOpsEqual(op,ops.get(0));
  op=Util.createOperation(ModelDescriptionConstants.READ_RESOURCE_DESCRIPTION_OPERATION,PathAddress.EMPTY_ADDRESS);
  executeForResult(op);
  records=readFile(file,3);
  ops=checkCoreBootRecordHeader(records.get(2),1,true,false,true);
  checkOpsEqual(op,ops.get(0));
  Assert.assertTrue(server.queryNames(OBJECT_NAME,null).contains(OBJECT_NAME));
  records=readFile(file,4);
  checkJmxBootRecordHeader(records.get(3),true,new String[]{ObjectName.class.getName(),QueryExp.class.getName()},new String[]{OBJECT_NAME.toString(),null});
  op=createRemoveJmxHandlerReferenceOperation("test-file");
  executeForResult(op);
  records=readFile(file,5);
  ops=checkCoreBootRecordHeader(records.get(4),1,false,false,true);
  checkOpsEqual(op,ops.get(0));
  Assert.assertTrue(server.queryNames(OBJECT_NAME,null).contains(OBJECT_NAME));
  records=readFile(file,5);
  op=Util.createOperation(ModelDescriptionConstants.READ_RESOURCE_DESCRIPTION_OPERATION,PathAddress.EMPTY_ADDRESS);
  executeForResult(op);
  records=readFile(file,6);
  ops=checkCoreBootRecordHeader(records.get(5),1,true,false,true);
  checkOpsEqual(op,ops.get(0));
  op=createAddJmxHandlerReferenceOperation("test-file");
  executeForResult(op);
  records=readFile(file,7);
  ops=checkCoreBootRecordHeader(records.get(6),1,false,false,true);
  checkOpsEqual(op,ops.get(0));
  op=createRemoveCoreHandlerReferenceOperation("test-file");
  executeForResult(op);
  records=readFile(file,8);
  ops=checkCoreBootRecordHeader(records.get(7),1,false,false,true);
  checkOpsEqual(op,ops.get(0));
  op=Util.createOperation(ModelDescriptionConstants.READ_RESOURCE_DESCRIPTION_OPERATION,PathAddress.EMPTY_ADDRESS);
  executeForResult(op);
  records=readFile(file,8);
  Assert.assertTrue(server.queryNames(OBJECT_NAME,null).contains(OBJECT_NAME));
  records=readFile(file,9);
  checkJmxBootRecordHeader(records.get(8),true,new String[]{ObjectName.class.getName(),QueryExp.class.getName()},new String[]{OBJECT_NAME.toString(),null});
  op=createAddCoreHandlerReferenceOperation("test-file");
  executeForResult(op);
  records=readFile(file,10);
  ops=checkCoreBootRecordHeader(records.get(9),1,false,false,true);
  checkOpsEqual(op,ops.get(0));
  op=createRemoveJmxHandlerReferenceOperation("test-file");
  executeForResult(op);
  records=readFile(file,11);
  ops=checkCoreBootRecordHeader(records.get(10),1,false,false,true);
  checkOpsEqual(op,ops.get(0));
  op=createRemoveCoreHandlerReferenceOperation("test-file");
  executeForResult(op);
  records=readFile(file,12);
  ops=checkCoreBootRecordHeader(records.get(11),1,false,false,true);
  checkOpsEqual(op,ops.get(0));
  op=Util.createOperation(ModelDescriptionConstants.READ_RESOURCE_DESCRIPTION_OPERATION,PathAddress.EMPTY_ADDRESS);
  executeForResult(op);
  records=readFile(file,12);
  Assert.assertTrue(server.queryNames(OBJECT_NAME,null).contains(OBJECT_NAME));
  records=readFile(file,12);
  op=createAddJmxHandlerReferenceOperation("test-file");
  executeForResult(op);
  records=readFile(file,12);
  Assert.assertTrue(server.queryNames(OBJECT_NAME,null).contains(OBJECT_NAME));
  records=readFile(file,1);
  checkJmxBootRecordHeader(records.get(0),true,new String[]{ObjectName.class.getName(),QueryExp.class.getName()},new String[]{OBJECT_NAME.toString(),null});
  op=createAddCoreHandlerReferenceOperation("test-file");
  executeForResult(op);
  records=readFile(file,2);
  ops=checkCoreBootRecordHeader(records.get(1),1,false,false,true);
  checkOpsEqual(op,ops.get(0));
  op=createRemoveCoreHandlerReferenceOperation("test-file");
  executeForResult(op);
  records=readFile(file,3);
  ops=checkCoreBootRecordHeader(records.get(2),1,false,false,true);
  checkOpsEqual(op,ops.get(0));
  op=createRemoveJmxHandlerReferenceOperation("test-file");
  executeForResult(op);
  records=readFile(file,3);
  op=Util.createOperation(ModelDescriptionConstants.READ_RESOURCE_DESCRIPTION_OPERATION,PathAddress.EMPTY_ADDRESS);
  executeForResult(op);
  records=readFile(file,3);
  Assert.assertTrue(server.queryNames(OBJECT_NAME,null).contains(OBJECT_NAME));
  records=readFile(file,3);
  op=createAddJmxHandlerReferenceOperation("test-file");
  executeForResult(op);
  records=readFile(file,3);
  Assert.assertTrue(server.queryNames(OBJECT_NAME,null).contains(OBJECT_NAME));
  records=readFile(file,1);
  checkJmxBootRecordHeader(records.get(0),true,new String[]{ObjectName.class.getName(),QueryExp.class.getName()},new String[]{OBJECT_NAME.toString(),null});
  op=createAddCoreHandlerReferenceOperation("test-file");
  executeForResult(op);
  records=readFile(file,2);
  ops=checkCoreBootRecordHeader(records.get(1),1,false,false,true);
  checkOpsEqual(op,ops.get(0));
  op=Util.createOperation(ModelDescriptionConstants.READ_RESOURCE_DESCRIPTION_OPERATION,PathAddress.EMPTY_ADDRESS);
  executeForResult(op);
  records=readFile(file,3);
  ops=checkCoreBootRecordHeader(records.get(2),1,true,false,true);
  checkOpsEqual(op,ops.get(0));
}
