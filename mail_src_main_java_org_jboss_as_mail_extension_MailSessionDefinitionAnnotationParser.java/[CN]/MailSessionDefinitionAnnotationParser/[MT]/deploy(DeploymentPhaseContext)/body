{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final EEModuleDescription eeModuleDescription=deploymentUnit.getAttachment(Attachments.EE_MODULE_DESCRIPTION);
  final CompositeIndex index=deploymentUnit.getAttachment(org.jboss.as.server.deployment.Attachments.COMPOSITE_ANNOTATION_INDEX);
  List<AnnotationInstance> mailSessionDefinitions=index.getAnnotations(MAIL_SESSION_DEFINITIONS);
  if (mailSessionDefinitions != null) {
    for (    AnnotationInstance annotation : mailSessionDefinitions) {
      final AnnotationTarget target=annotation.target();
      if (!(target instanceof ClassInfo)) {
        throw EeLogger.ROOT_LOGGER.classOnlyAnnotation("@MailSessionDefinitions",target);
      }
      List<AnnotationInstance> mailSessions=this.getNestedMailSessionAnnotations(annotation);
      for (      AnnotationInstance mailSession : mailSessions) {
        this.processMailSession(eeModuleDescription,mailSession,(ClassInfo)target);
      }
    }
  }
  List<AnnotationInstance> mailSessions=index.getAnnotations(MAIL_SESSION_DEFINITION);
  if (mailSessions != null) {
    for (    AnnotationInstance mailSession : mailSessions) {
      final AnnotationTarget target=mailSession.target();
      if (!(target instanceof ClassInfo)) {
        throw EeLogger.ROOT_LOGGER.classOnlyAnnotation("@MailSessionDefinition",target);
      }
      this.processMailSession(eeModuleDescription,mailSession,(ClassInfo)target);
    }
  }
}
