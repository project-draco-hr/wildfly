{
  final boolean rcPresent=context.getOriginalRootResource().hasChild(PathElement.pathElement(ModelDescriptionConstants.SUBSYSTEM,RequestControllerExtension.SUBSYSTEM_NAME));
  context.addStep(new AbstractDeploymentChainStep(){
    public void execute(    DeploymentProcessorTarget processorTarget){
      processorTarget.addDeploymentProcessor(BatchSubsystemDefinition.NAME,Phase.DEPENDENCIES,Phase.DEPENDENCIES_BATCH,new BatchDependencyProcessor());
      processorTarget.addDeploymentProcessor(BatchSubsystemDefinition.NAME,Phase.POST_MODULE,Phase.POST_MODULE_BATCH_ENVIRONMENT,new BatchEnvironmentProcessor(rcPresent));
      processorTarget.addDeploymentProcessor(BatchSubsystemDefinition.NAME,Phase.INSTALL,Phase.INSTALL_BATCH_RESOURCES,new BatchDeploymentResourceProcessor());
    }
  }
,OperationContext.Stage.RUNTIME);
  final String repositoryType=JOB_REPOSITORY_TYPE.resolveModelAttribute(context,model).asString();
  JobRepositoryFactory.getInstance().setJobRepositoryType(repositoryType);
}
