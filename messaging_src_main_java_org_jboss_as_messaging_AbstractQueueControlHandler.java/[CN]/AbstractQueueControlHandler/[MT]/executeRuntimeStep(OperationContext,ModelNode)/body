{
  final String operationName=operation.require(ModelDescriptionConstants.OP).asString();
  final String queueName=PathAddress.pathAddress(operation.require(ModelDescriptionConstants.OP_ADDR)).getLastElement().getValue();
  final ServiceName hqServiceName=MessagingServices.getHornetQServiceName(PathAddress.pathAddress(operation.get(ModelDescriptionConstants.OP_ADDR)));
  ServiceController<?> hqService=context.getServiceRegistry(false).getService(hqServiceName);
  HornetQServer hqServer=HornetQServer.class.cast(hqService.getValue());
  final DelegatingQueueControl<T> control=getQueueControl(hqServer,queueName);
  if (control == null) {
    rollbackOperationWithNoHandler(context,operation);
    return;
  }
  boolean reversible=false;
  Object handback=null;
  try {
    if (LIST_MESSAGES.equals(operationName)) {
      String json=control.listMessagesAsJSON(getFilter(operation));
      context.getResult().set(ModelNode.fromJSONString(json));
    }
 else     if (LIST_MESSAGES_AS_JSON.equals(operationName)) {
      context.getResult().set(control.listMessagesAsJSON(getFilter(operation)));
    }
 else     if (COUNT_MESSAGES.equals(operationName)) {
      context.getResult().set(control.countMessages(getFilter(operation)));
    }
 else     if (REMOVE_MESSAGE.equals(operationName)) {
      singleMessageIdValidator.validate(operation);
      ModelNode id=operation.require(MESSAGE_ID);
      context.getResult().set(control.removeMessage(id));
    }
 else     if (REMOVE_MESSAGES.equals(operationName)) {
      context.getResult().set(control.removeMessages(getFilter(operation)));
    }
 else     if (EXPIRE_MESSAGES.equals(operationName)) {
      context.getResult().set(control.expireMessages(getFilter(operation)));
    }
 else     if (EXPIRE_MESSAGE.equals(operationName)) {
      singleMessageIdValidator.validate(operation);
      ModelNode id=operation.require(MESSAGE_ID);
      context.getResult().set(control.expireMessage(id));
    }
 else     if (SEND_MESSAGE_TO_DEAD_LETTER_ADDRESS.equals(operationName)) {
      singleMessageIdValidator.validate(operation);
      ModelNode id=operation.require(MESSAGE_ID);
      context.getResult().set(control.sendMessageToDeadLetterAddress(id));
    }
 else     if (SEND_MESSAGES_TO_DEAD_LETTER_ADDRESS.equals(operationName)) {
      context.getResult().set(control.sendMessagesToDeadLetterAddress(getFilter(operation)));
    }
 else     if (CHANGE_MESSAGE_PRIORITY.equals(operationName)) {
      changeMessagePriorityValidator.validate(operation);
      ModelNode id=operation.require(MESSAGE_ID);
      int priority=operation.require(NEW_PRIORITY).asInt();
      context.getResult().set(control.changeMessagePriority(id,priority));
    }
 else     if (CHANGE_MESSAGES_PRIORITY.equals(operationName)) {
      changeMessagesPriorityValidator.validate(operation);
      int priority=operation.require(NEW_PRIORITY).asInt();
      context.getResult().set(control.changeMessagesPriority(getFilter(operation),priority));
    }
 else     if (MOVE_MESSAGE.equals(operationName)) {
      moveMessageValidator.validate(operation);
      ModelNode id=operation.require(MESSAGE_ID);
      String otherQueue=operation.require(OTHER_QUEUE_NAME).asString();
      if (operation.hasDefined(REJECT_DUPLICATES)) {
        boolean reject=operation.get(REJECT_DUPLICATES).asBoolean();
        context.getResult().set(control.moveMessage(id,otherQueue,reject));
      }
 else {
        context.getResult().set(control.moveMessage(id,otherQueue));
      }
    }
 else     if (MOVE_MESSAGES.equals(operationName)) {
      moveMessagesValidator.validate(operation);
      String otherQueue=operation.require(OTHER_QUEUE_NAME).asString();
      if (operation.hasDefined(REJECT_DUPLICATES)) {
        boolean reject=operation.get(REJECT_DUPLICATES).asBoolean();
        context.getResult().set(control.moveMessages(getFilter(operation),otherQueue,reject));
      }
 else {
        context.getResult().set(control.moveMessages(getFilter(operation),otherQueue));
      }
    }
 else     if (LIST_MESSAGE_COUNTER_AS_JSON.equals(operationName)) {
      context.getResult().set(control.listMessageCounter());
    }
 else     if (LIST_MESSAGE_COUNTER_AS_HTML.equals(operationName)) {
      context.getResult().set(control.listMessageCounterAsHTML());
    }
 else     if (LIST_MESSAGE_COUNTER_HISTORY_AS_JSON.equals(operationName)) {
      context.getResult().set(control.listMessageCounterHistory());
    }
 else     if (LIST_MESSAGE_COUNTER_HISTORY_AS_HTML.equals(operationName)) {
      context.getResult().set(control.listMessageCounterHistoryAsHTML());
    }
 else     if (RESET_MESSAGE_COUNTER.equals(operationName)) {
      control.resetMessageCounter();
      context.getResult();
    }
 else     if (PAUSE.equals(operationName)) {
      control.pause();
      reversible=true;
      context.getResult();
    }
 else     if (RESUME.equals(operationName)) {
      control.resume();
      reversible=true;
      context.getResult();
    }
 else     if (LIST_CONSUMERS_AS_JSON.equals(operationName)) {
      context.getResult().set(control.listConsumersAsJSON());
    }
 else {
      handback=handleAdditionalOperation(operationName,operation,context,control.getDelegate());
      reversible=handback == null;
    }
  }
 catch (  RuntimeException e) {
    throw e;
  }
catch (  Exception e) {
    context.getFailureDescription().set(e.getLocalizedMessage());
  }
  OperationContext.RollbackHandler rh;
  if (reversible) {
    final Object rhHandback=handback;
    rh=new OperationContext.RollbackHandler(){
      @Override public void handleRollback(      OperationContext context,      ModelNode operation){
        try {
          if (PAUSE.equals(operationName)) {
            control.resume();
          }
 else           if (RESUME.equals(operationName)) {
            control.pause();
          }
 else {
            revertAdditionalOperation(operationName,operation,context,control.getDelegate(),rhHandback);
          }
        }
 catch (        Exception e) {
          ROOT_LOGGER.revertOperationFailed(e,getClass().getSimpleName(),operation.require(ModelDescriptionConstants.OP).asString(),PathAddress.pathAddress(operation.require(ModelDescriptionConstants.OP_ADDR)));
        }
      }
    }
;
  }
 else {
    rh=OperationContext.RollbackHandler.NOOP_ROLLBACK_HANDLER;
  }
  context.completeStep(rh);
}
