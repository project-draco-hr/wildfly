{
  channel.receiveMessage(this);
  boolean ok=false;
  try {
    doHandle(channel,message);
    ok=true;
  }
  finally {
    if (stopped.get()) {
      IoUtils.safeClose(channel);
    }
  }
}
