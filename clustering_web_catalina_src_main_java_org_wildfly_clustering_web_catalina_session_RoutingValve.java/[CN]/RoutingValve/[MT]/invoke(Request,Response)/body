{
  if (log.isTraceEnabled()) {
    log.tracef("Handling request %s",request.getRequestURI());
  }
  String requestedSessionId=request.getRequestedSessionId();
  if (requestedSessionId != null) {
    Map.Entry<String,String> entry=this.support.parse(requestedSessionId);
    String sessionId=entry.getKey();
    if (!requestedSessionId.equals(sessionId)) {
      request.setRequestedSessionId(sessionId);
    }
  }
  this.next.invoke(request,response);
  HttpSession session=request.getSession(false);
  if (session != null) {
    String sessionId=session.getId();
    request.changeSessionId(this.support.format(sessionId,this.support.locate(sessionId)));
  }
}
