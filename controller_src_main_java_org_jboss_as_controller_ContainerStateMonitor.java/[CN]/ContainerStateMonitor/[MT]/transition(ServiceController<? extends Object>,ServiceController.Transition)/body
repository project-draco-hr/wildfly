{
switch (transition) {
case STARTING_to_START_FAILED:
{
synchronized (this) {
        failedControllers.put(controller,controller.getStartException().toString());
      }
      break;
    }
case REMOVING_to_REMOVED:
{
synchronized (this) {
      failedControllers.remove(controller);
      servicesWithMissingDeps.remove(controller);
    }
    break;
  }
case START_FAILED_to_DOWN:
case START_FAILED_to_STARTING:
{
synchronized (this) {
    failedControllers.remove(controller);
  }
  break;
}
}
final ServiceController.Substate before=transition.getBefore();
final ServiceController.Substate after=transition.getAfter();
if (before.isRestState() && !after.isRestState()) {
untick();
}
 else if (!before.isRestState() && after.isRestState()) {
tick();
}
}
