{
  Future<MasterDomainControllerClient> clientFuture=RemoteDomainConnectionService.install(serviceTarget,getValue(),extensionRegistry,hostControllerInfo,environment.getProductConfig(),hostControllerInfo.getRemoteDomainControllerSecurityRealm(),remoteFileRepository,ignoredRegistry,new DomainModelControllerService.InternalExecutor(),this,environment,getExecutorServiceInjector().getValue(),currentRunningMode);
  MasterDomainControllerClient masterDomainControllerClient=getFuture(clientFuture);
  try {
    if (currentRunningMode == RunningMode.ADMIN_ONLY) {
      masterDomainControllerClient.fetchDomainWideConfiguration();
    }
 else {
      masterDomainControllerClient.register();
    }
  }
 catch (  Exception e) {
    ROOT_LOGGER.cannotConnectToMaster(e);
    if (currentRunningMode == RunningMode.ADMIN_ONLY) {
      ROOT_LOGGER.fetchConfigFromDomainMasterFailed(currentRunningMode,ModelDescriptionConstants.ADMIN_ONLY_POLICY,AdminOnlyDomainConfigPolicy.REQUIRE_LOCAL_CONFIG,CommandLineConstants.ADMIN_ONLY);
    }
    System.exit(ExitCodes.HOST_CONTROLLER_ABORT_EXIT_CODE);
  }
}
