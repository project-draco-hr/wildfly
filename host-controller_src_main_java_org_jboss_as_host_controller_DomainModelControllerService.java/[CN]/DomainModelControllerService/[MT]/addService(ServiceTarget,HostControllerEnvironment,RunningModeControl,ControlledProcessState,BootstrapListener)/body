{
  final Map<String,ProxyController> hostProxies=new ConcurrentHashMap<String,ProxyController>();
  final Map<String,ProxyController> serverProxies=new ConcurrentHashMap<String,ProxyController>();
  final LocalHostControllerInfoImpl hostControllerInfo=new LocalHostControllerInfoImpl(processState);
  final AbstractVaultReader vaultReader=service(AbstractVaultReader.class);
  log.debugf("Using VaultReader %s",vaultReader);
  final PrepareStepHandler prepareStepHandler=new PrepareStepHandler(hostControllerInfo,hostProxies,serverProxies);
  DomainModelControllerService service=new DomainModelControllerService(environment,runningModeControl,processState,hostControllerInfo,hostProxies,serverProxies,prepareStepHandler,vaultReader,bootstrapListener);
  return serviceTarget.addService(SERVICE_NAME,service).addDependency(HostControllerBootstrap.SERVICE_NAME_BASE.append("executor"),ExecutorService.class,service.getExecutorServiceInjector()).addDependency(ProcessControllerConnectionService.SERVICE_NAME,ProcessControllerConnectionService.class,service.injectedProcessControllerConnection).setInitialMode(ServiceController.Mode.ACTIVE).install();
}
