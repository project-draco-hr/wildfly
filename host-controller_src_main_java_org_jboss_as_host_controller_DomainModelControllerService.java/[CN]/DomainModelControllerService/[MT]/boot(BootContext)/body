{
  final ServiceTarget serviceTarget=context.getServiceTarget();
  try {
    super.boot(hostControllerConfigurationPersister.load());
    final RunningMode currentRunningMode=runningModeControl.getRunningMode();
    Future<ServerInventory> inventoryFuture=ServerInventoryService.install(serviceTarget,this,environment,hostControllerInfo.getNativeManagementInterface(),hostControllerInfo.getNativeManagementPort());
    ManagementRemotingServices.installRemotingEndpoint(serviceTarget,ManagementRemotingServices.MANAGEMENT_ENDPOINT,hostControllerInfo.getLocalHostName(),EndpointService.EndpointType.MANAGEMENT,null,null);
    if (!hostControllerInfo.isMasterDomainController() && !environment.isUseCachedDc()) {
      serverInventory=getFuture(inventoryFuture);
      Future<MasterDomainControllerClient> clientFuture=RemoteDomainConnectionService.install(serviceTarget,getValue(),hostControllerInfo.getLocalHostName(),hostControllerInfo.getRemoteDomainControllerHost(),hostControllerInfo.getRemoteDomainControllertPort(),hostControllerInfo.getRemoteDomainControllerSecurityRealm(),remoteFileRepository);
      MasterDomainControllerClient masterDomainControllerClient=getFuture(clientFuture);
      try {
        masterDomainControllerClient.register();
      }
 catch (      IllegalStateException e) {
        log.error("Could not connect to master. Aborting. Error was: " + e.getMessage());
        System.exit(ExitCodes.HOST_CONTROLLER_ABORT_EXIT_CODE);
      }
    }
 else {
      ConfigurationPersister domainPersister=hostControllerConfigurationPersister.getDomainPersister();
      super.boot(domainPersister.load());
      ManagementRemotingServices.installManagementChannelServices(serviceTarget,ManagementRemotingServices.MANAGEMENT_ENDPOINT,new MasterDomainControllerOperationHandlerService(this,this),DomainModelControllerService.SERVICE_NAME,ManagementRemotingServices.DOMAIN_CHANNEL,null,null);
      serverInventory=getFuture(inventoryFuture);
    }
    NativeManagementAddHandler.installNativeManagementServices(serviceTarget,hostControllerInfo,null,null);
    ServerToHostOperationHandlerFactoryService.install(serviceTarget,ServerInventoryService.SERVICE_NAME,proxyExecutor);
    if (hostControllerInfo.getHttpManagementInterface() != null) {
      HttpManagementAddHandler.installHttpManagementServices(serviceTarget,hostControllerInfo,environment,null);
    }
    if (currentRunningMode == RunningMode.NORMAL) {
      startServers();
    }
  }
  finally {
    try {
      finishBoot();
    }
  finally {
      bootstrapListener.tick();
    }
  }
}
