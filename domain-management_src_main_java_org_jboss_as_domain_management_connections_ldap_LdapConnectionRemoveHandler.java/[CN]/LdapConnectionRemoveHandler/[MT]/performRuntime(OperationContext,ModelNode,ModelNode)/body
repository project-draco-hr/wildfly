{
  PathAddress address=PathAddress.pathAddress(operation.require(OP_ADDR));
  String name=address.getLastElement().getValue();
  ServiceName svcName=LdapConnectionManagerService.ServiceUtil.createServiceName(name);
  ServiceRegistry registry=context.getServiceRegistry(true);
  ServiceController<?> controller=registry.getService(svcName);
  boolean removeIt;
  ServiceController.Substate substate=controller == null ? null : controller.getSubstate();
  if (substate != null && substate.getState() == ServiceController.State.UP && substate.isRestState()) {
    removeIt=operation.hasDefined(OPERATION_HEADERS) && operation.get(OPERATION_HEADERS).hasDefined(ALLOW_RESOURCE_SERVICE_RESTART) && operation.get(OPERATION_HEADERS,ALLOW_RESOURCE_SERVICE_RESTART).asBoolean();
  }
 else {
    removeIt=true;
  }
  if (removeIt) {
    context.removeService(svcName);
  }
 else {
    context.reloadRequired();
  }
}
