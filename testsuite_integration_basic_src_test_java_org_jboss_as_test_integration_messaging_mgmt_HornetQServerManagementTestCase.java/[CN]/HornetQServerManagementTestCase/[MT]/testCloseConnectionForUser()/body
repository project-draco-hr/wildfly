{
  Connection connection=connectionFactory.createConnection("guest","guest");
  connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
  final CountDownLatch connectionClosed=new CountDownLatch(1);
  connection.setExceptionListener(new ExceptionListener(){
    @Override public void onException(    JMSException e){
      connectionClosed.countDown();
    }
  }
);
  ModelNode operation=getHornetQServerOperation("close-connections-for-user");
  operation.get("user").set("guest");
  ModelNode result=execute(operation,true);
  assertTrue(result.isDefined());
  assertEquals(true,result.asBoolean());
  assertTrue(connectionClosed.await(500,MILLISECONDS));
  try {
    connection.createSession(false,Session.AUTO_ACKNOWLEDGE);
    Assert.fail("connection can no longer be used after it has been closed");
  }
 catch (  JMSException e) {
  }
}
