{
  String layerName=randomString();
  installLayer(env.getModuleRoot(),env.getInstalledImage().getLayersConf(),layerName);
  ProductConfig productConfig=new ProductConfig("product","version","consoleSlot");
  TestUtils.tree(env.getInstalledImage().getJbossHome());
  InstalledIdentity installedIdentity=InstalledIdentity.load(env.getInstalledImage().getJbossHome(),productConfig,env.getInstalledImage().getModulesDir());
  Identity identity=installedIdentity.getIdentity();
  assertEquals(productConfig.getProductName(),identity.getName());
  assertEquals(productConfig.resolveVersion(),identity.getVersion());
  List<Layer> layers=installedIdentity.getLayers();
  assertEquals(1,layers.size());
  Layer layer=layers.get(0);
  assertEquals(layerName,layer.getName());
  PatchableTarget.TargetInfo targetInfo=layer.loadTargetInfo();
  assertEquals(BASE,targetInfo.getCumulativeID());
  assertTrue(targetInfo.getPatchIDs().isEmpty());
  DirectoryStructure directoryStructure=targetInfo.getDirectoryStructure();
  assertEquals(newFile(env.getModuleRoot(),"system","layers",layerName),directoryStructure.getModuleRoot());
  assertNull(directoryStructure.getBundleRepositoryRoot());
}
