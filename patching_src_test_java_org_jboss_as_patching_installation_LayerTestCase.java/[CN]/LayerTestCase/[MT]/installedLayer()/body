{
  String layerName=randomString();
  installLayer(env.getModuleRoot(),env.getInstalledImage().getLayersConf(),layerName);
  TestUtils.tree(env.getInstalledImage().getJbossHome());
  InstalledIdentity installedIdentity=loadInstalledIdentity();
  Identity identity=installedIdentity.getIdentity();
  assertEquals(productConfig.getProductName(),identity.getName());
  assertEquals(productConfig.resolveVersion(),identity.getVersion());
  List<Layer> layers=installedIdentity.getLayers();
  assertEquals(2,layers.size());
  Layer layer=layers.get(0);
  assertEquals(layerName,layer.getName());
  assertEquals(BASE,layers.get(1).getName());
  PatchableTarget.TargetInfo targetInfo=layer.loadTargetInfo();
  assertEquals(BASE,targetInfo.getCumulativePatchID());
  assertTrue(targetInfo.getPatchIDs().isEmpty());
  DirectoryStructure directoryStructure=targetInfo.getDirectoryStructure();
  assertEquals(newFile(env.getModuleRoot(),"system","layers",layerName),directoryStructure.getModuleRoot());
  assertNull(directoryStructure.getBundleRepositoryRoot());
}
