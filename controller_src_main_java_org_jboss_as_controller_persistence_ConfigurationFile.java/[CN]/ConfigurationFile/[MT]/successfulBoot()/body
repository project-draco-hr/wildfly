{
synchronized (this) {
    if (doneBootup.get()) {
      return;
    }
    try {
      if (!bootFile.equals(mainFile)) {
        copyFile(bootFile,mainFile);
      }
      createHistoryDirectory();
      final File historyBase=new File(historyRoot,mainFile.getName());
      final File last=addSuffixToFile(historyBase,LAST);
      final File original=addSuffixToFile(historyBase,BOOT);
      final File initial=addSuffixToFile(historyBase,INITIAL);
      if (!initial.exists()) {
        copyFile(mainFile,initial);
      }
      copyFile(mainFile,last);
      copyFile(mainFile,original);
      snapshot();
    }
 catch (    IOException e) {
      throw new ConfigurationPersistenceException(String.format("Failed to create backup copies of configuration file %s",bootFile),e);
    }
    doneBootup.set(true);
  }
}
