{
  mkdir(this.historyRoot);
  mkdir(this.snapshotsDirectory);
  if (currentHistory.exists()) {
    if (!currentHistory.isDirectory()) {
      throw new IllegalStateException(currentHistory.getAbsolutePath() + " is not a directory");
    }
    final Date date=new Date();
    if (currentHistory.listFiles().length > 0) {
      final String backupName=getTimeStamp(date);
      final File old=new File(historyRoot,backupName);
      if (!new File(currentHistory.getAbsolutePath()).renameTo(old)) {
        throw new IllegalStateException("Could not rename " + currentHistory.getAbsolutePath() + " to "+ old.getAbsolutePath());
      }
    }
    final String cutoffFileName=getTimeStamp(subtractDays(date,HISTORY_DAYS));
    for (    String name : historyRoot.list()) {
      if (name.length() == cutoffFileName.length() && TIMESTAMP_PATTERN.matcher(name).matches() && name.compareTo(cutoffFileName) < 0) {
        deleteRecursive(new File(historyRoot,name));
      }
    }
  }
  currentHistory.mkdir();
  if (!currentHistory.exists()) {
    throw new IllegalStateException("Could not create " + currentHistory.getAbsolutePath());
  }
}
