{
  phaseContext.addDeploymentDependency(Services.SYSTEM_CONTEXT,OSGiConstants.SYSTEM_CONTEXT_KEY);
  phaseContext.addDeploymentDependency(Services.ENVIRONMENT,OSGiConstants.ENVIRONMENT_KEY);
  DeploymentUnit depUnit=phaseContext.getDeploymentUnit();
  if (depUnit.hasAttachment(OSGiConstants.DEPLOYMENT_KEY)) {
    phaseContext.getServiceRegistry().getRequiredService(Services.FRAMEWORK_ACTIVE).setMode(Mode.ACTIVE);
    phaseContext.addDependency(IntegrationServices.AUTOINSTALL_COMPLETE,AttachmentKey.create(Object.class));
    phaseContext.addDeploymentDependency(Services.BUNDLE_MANAGER,OSGiConstants.BUNDLE_MANAGER_KEY);
    phaseContext.addDeploymentDependency(Services.RESOLVER,OSGiConstants.RESOLVER_KEY);
  }
}
