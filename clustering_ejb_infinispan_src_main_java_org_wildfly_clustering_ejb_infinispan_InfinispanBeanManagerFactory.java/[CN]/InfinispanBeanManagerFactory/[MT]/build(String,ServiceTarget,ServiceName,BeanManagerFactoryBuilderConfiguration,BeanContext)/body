{
  InfinispanBeanManagerFactory<G,I,T> factory=new InfinispanBeanManagerFactory<>(context,config);
  String containerName=config.getContainerName();
  ServiceName deploymentUnitServiceName=context.getDeploymentUnitServiceName();
  return target.addService(serviceName,factory).addDependency(CacheService.getServiceName(containerName,BeanCacheConfigurationService.getCacheName(context.getDeploymentUnitServiceName())),Cache.class,factory.cache).addDependency(KeyAffinityServiceFactoryService.getServiceName(containerName),KeyAffinityServiceFactory.class,factory.affinityFactory).addDependency(deploymentUnitServiceName.append("marshalling"),VersionedMarshallingConfiguration.class,factory.config).addDependency(deploymentUnitServiceName.append(name,"expiration"),ScheduledExecutorService.class,factory.scheduler).addDependency(deploymentUnitServiceName.append(name,"eviction"),Executor.class,factory.executor).addDependency(GroupServiceNames.COMMAND_DISPATCHER.getServiceName(containerName),CommandDispatcherFactory.class,factory.dispatcherFactory).addDependency(CacheServiceNames.REGISTRY.getServiceName(containerName),Registry.class,factory.registry).addDependency(CacheServiceNames.NODE_FACTORY.getServiceName(containerName),NodeFactory.class,factory.nodeFactory);
}
