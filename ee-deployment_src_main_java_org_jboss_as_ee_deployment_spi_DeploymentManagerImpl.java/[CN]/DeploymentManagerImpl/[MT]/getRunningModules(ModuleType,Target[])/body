{
  if (isConnected == false)   throw new IllegalStateException("DeploymentManager is not connected");
  log.debug("getRunningModules [type=" + moduleType + ",targets="+ Arrays.asList(targets)+ "]");
  Set<JBossTargetModuleID> moduleSet=new HashSet<JBossTargetModuleID>();
  TargetModuleID[] availableModules=getAvailableModules(moduleType,targets);
  if (availableModules == null) {
    log.debug("No modules available");
    return null;
  }
  for (int i=0; i < availableModules.length; i++) {
    JBossTargetModuleID moduleID=(JBossTargetModuleID)availableModules[i];
    if (moduleID.isRunning()) {
      moduleSet.add(moduleID);
    }
  }
  log.debug("Found [" + moduleSet.size() + "] running modules");
  TargetModuleID[] idarr=new TargetModuleID[moduleSet.size()];
  moduleSet.toArray(idarr);
  return idarr;
}
