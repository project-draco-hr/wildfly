{
  if (isConnected == false)   throw new IllegalStateException(MESSAGES.deploymentManagerNotConnected());
  DeploymentManagerState state=new DeploymentManagerState();
  TargetModuleID[] targetModuleIDs=new TargetModuleID[targets.length];
  try {
    state.unpackDeploymentPlan(deploymentPlan);
    state.initDeploymentMetaData();
    TargetModuleInfo moduleInfo=state.createDeployment(moduleArchive);
    for (int i=0; i < targets.length; i++) {
      JBossTarget target=(JBossTarget)targets[i];
      String moduleID=moduleInfo.getModuleID();
      ModuleType type=moduleType != null ? moduleType : moduleInfo.getModuleType();
      File contentFile=moduleInfo.getContentFile();
      targetModuleIDs[i]=new TargetModuleIDImpl(target,moduleID,null,type,contentFile);
    }
  }
 catch (  IOException e) {
    String message=MESSAGES.deploymentValidationFailed();
    DeploymentStatus status=new DeploymentStatusImpl(StateType.FAILED,CommandType.DISTRIBUTE,ActionType.EXECUTE,message);
    ROOT_LOGGER.errorf(e,message);
    state.cleanup();
    return new ProgressObjectImpl(status,targetModuleIDs);
  }
  DeploymentStatus status=new DeploymentStatusImpl(StateType.RUNNING,CommandType.DISTRIBUTE,ActionType.EXECUTE,null);
  ProgressObject progress=new ProgressObjectImpl(status,targetModuleIDs);
  DeploymentWorker worker=new DeploymentWorker(progress,state);
  worker.start();
  return progress;
}
