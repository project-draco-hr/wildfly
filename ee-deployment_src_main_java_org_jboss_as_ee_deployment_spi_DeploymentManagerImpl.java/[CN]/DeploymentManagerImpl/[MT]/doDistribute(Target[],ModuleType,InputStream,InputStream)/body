{
  if (isConnected == false)   throw new IllegalStateException(MESSAGES.deploymentManagerNotConnected());
  TargetModuleID[] targetModuleIDs=new TargetModuleID[targets.length];
  try {
    mapDeploymentPlan=unpackDeploymentPlan(deploymentPlan);
    initDeploymentMetaData();
    TargetModuleInfo moduleInfo=createDeployment(moduleArchive,metaData.getDeploymentName());
    URL deployment=moduleInfo.getModuleID();
    if (type == null)     type=moduleInfo.getModuleType();
    for (int i=0; i < targets.length; i++) {
      JBossTarget target=(JBossTarget)targets[i];
      String moduleID=deployment.toExternalForm();
      targetModuleIDs[i]=new TargetModuleIDImpl(target,moduleID,null,type);
    }
    for (int i=0; i < tmpFiles.size(); i++) {
      File file=tmpFiles.get(i);
      if (file.equals(deployment) == false)       file.delete();
    }
  }
 catch (  IOException e) {
    String message=MESSAGES.deploymentValidationFailed();
    DeploymentStatus status=new DeploymentStatusImpl(StateType.FAILED,CommandType.DISTRIBUTE,ActionType.EXECUTE,message);
    ROOT_LOGGER.errorf(e,message);
    return new ProgressObjectImpl(status,targetModuleIDs);
  }
  DeploymentStatus status=new DeploymentStatusImpl(StateType.RUNNING,CommandType.DISTRIBUTE,ActionType.EXECUTE,null);
  ProgressObject progress=new ProgressObjectImpl(status,targetModuleIDs);
  DeploymentWorker worker=new DeploymentWorker(progress);
  worker.start();
  return progress;
}
