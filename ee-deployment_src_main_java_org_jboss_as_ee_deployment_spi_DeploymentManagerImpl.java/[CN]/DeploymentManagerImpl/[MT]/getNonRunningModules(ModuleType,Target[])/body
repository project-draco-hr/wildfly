{
  if (isConnected == false)   throw new IllegalStateException(MESSAGES.deploymentManagerNotConnected());
  ROOT_LOGGER.debugf("getNonRunningModules [type=%s,targets=%s]",moduleType,Arrays.asList(targets));
  Set<JBossTargetModuleID> moduleSet=new HashSet<JBossTargetModuleID>();
  TargetModuleID[] availableModules=getAvailableModules(moduleType,targets);
  if (availableModules == null) {
    ROOT_LOGGER.debugf("No modules available");
    return null;
  }
  for (int i=0; i < availableModules.length; i++) {
    JBossTargetModuleID moduleID=(JBossTargetModuleID)availableModules[i];
    if (moduleID.isRunning() == false) {
      moduleSet.add(moduleID);
    }
  }
  ROOT_LOGGER.debugf("Found [%d] non running modules",moduleSet.size());
  TargetModuleID[] idarr=new TargetModuleID[moduleSet.size()];
  moduleSet.toArray(idarr);
  return idarr;
}
