{
  checkCanRemove(context,operation);
  final String name=PathAddress.pathAddress(operation.require(OP_ADDR)).getLastElement().getValue();
  final Resource resource=context.readResource(PathAddress.EMPTY_ADDRESS);
  final List<byte[]> deploymentHashes=DeploymentUtils.getDeploymentHash(resource);
  context.removeResource(PathAddress.EMPTY_ADDRESS);
  context.addStep(new OperationStepHandler(){
    public void execute(    OperationContext context,    ModelNode operation) throws OperationFailedException {
      context.completeStep(new OperationContext.ResultHandler(){
        @Override public void handleResult(        ResultAction resultAction,        OperationContext context,        ModelNode operation){
          if (resultAction != ResultAction.ROLLBACK) {
            removeContent(name,deploymentHashes);
          }
        }
      }
);
    }
  }
,OperationContext.Stage.RUNTIME);
  context.stepCompleted();
}
