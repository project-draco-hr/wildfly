{
  final String deploymentName=PathAddress.pathAddress(operation.require(OP_ADDR)).getLastElement().getValue();
  final Resource root=context.readResourceFromRoot(PathAddress.EMPTY_ADDRESS);
  if (root.hasChild(PathElement.pathElement(SERVER_GROUP))) {
    final List<String> badGroups=new ArrayList<String>();
    for (    final Resource.ResourceEntry entry : root.getChildren(SERVER_GROUP)) {
      if (entry.hasChild(PathElement.pathElement(DEPLOYMENT,deploymentName))) {
        badGroups.add(entry.getName());
      }
    }
    if (badGroups.size() > 0) {
      throw new OperationFailedException(new ModelNode().set(MESSAGES.cannotRemoveDeploymentInUse(deploymentName,badGroups)));
    }
  }
}
