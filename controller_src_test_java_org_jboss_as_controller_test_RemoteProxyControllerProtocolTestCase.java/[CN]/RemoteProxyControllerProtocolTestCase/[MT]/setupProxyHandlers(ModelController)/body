{
  handler.setDelegate(new TransactionalModelControllerOperationHandler(controller,channels.getExecutorService()){
    @Override public void shutdownNow(){
      super.shutdown();
      final List<Integer> cancelled=super.cancelAllActiveOperations();
      throw new IllegalStateException("failed to complete operations" + cancelled);
    }
  }
);
  final Channel clientChannel=channels.getClientChannel();
  final RemoteProxyController proxyController=RemoteProxyController.create(channels.getExecutorService(),PathAddress.pathAddress(),ProxyOperationAddressTranslator.HOST,channels.getClientChannel());
  clientChannel.addCloseHandler(new CloseHandler<Channel>(){
    @Override public void handleClose(    Channel closed,    IOException exception){
      proxyController.shutdownNow();
    }
  }
);
  clientChannel.receiveMessage(ManagementChannelReceiver.createDelegating(proxyController));
  return proxyController;
}
