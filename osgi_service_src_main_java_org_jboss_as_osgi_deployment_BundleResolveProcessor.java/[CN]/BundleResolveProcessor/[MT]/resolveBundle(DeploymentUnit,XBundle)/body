{
  XBundleRevision brev=bundle.getBundleRevision();
  XEnvironment env=depUnit.getAttachment(OSGiConstants.ENVIRONMENT_KEY);
  XResolver resolver=depUnit.getAttachment(OSGiConstants.RESOLVER_KEY);
  XResolveContext context=resolver.createResolveContext(env,Collections.singleton(brev),null);
  try {
    Map<Resource,Wiring> wiremap=resolver.resolveAndApply(context);
    BundleWiring wiring=(BundleWiring)wiremap.get(brev);
    depUnit.putAttachment(Attachments.BUNDLE_STATE_KEY,BundleState.RESOLVED);
    depUnit.putAttachment(OSGiConstants.BUNDLE_WIRING_KEY,wiring);
    Module module=brev.getModuleClassLoader().getModule();
    depUnit.putAttachment(Attachments.MODULE,module);
  }
 catch (  ResolutionException ex) {
    LOGGER.warnCannotResolve(ex.getUnresolvedRequirements());
  }
}
