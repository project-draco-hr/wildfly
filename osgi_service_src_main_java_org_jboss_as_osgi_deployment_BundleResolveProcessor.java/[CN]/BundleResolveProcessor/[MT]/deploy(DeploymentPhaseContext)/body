{
  DeploymentUnit depUnit=phaseContext.getDeploymentUnit();
  Deployment deployment=depUnit.getAttachment(OSGiConstants.DEPLOYMENT_KEY);
  XBundle bundle=depUnit.getAttachment(OSGiConstants.INSTALLED_BUNDLE_KEY);
  if (bundle == null || deployment.isAutoStart() == false)   return;
  if (depUnit.hasAttachment(Attachments.MODULE))   return;
  XBundleRevision brev=bundle.getBundleRevision();
  XEnvironment env=depUnit.getAttachment(OSGiConstants.ENVIRONMENT_KEY);
  XResolver resolver=depUnit.getAttachment(OSGiConstants.RESOLVER_KEY);
  XResolveContext context=resolver.createResolveContext(env,Collections.singleton(brev),null);
  try {
    Map<Resource,Wiring> wiremap=resolver.resolveAndApply(context);
    BundleWiring wiring=(BundleWiring)wiremap.get(brev);
    depUnit.putAttachment(OSGiConstants.BUNDLE_WIRING_KEY,wiring);
  }
 catch (  ResolutionException ex) {
    LOGGER.warnCannotResolve(ex.getUnresolvedRequirements());
  }
}
