{
  XBundleRevision brev=bundle.getBundleRevision();
  DeploymentUnit depUnit=phaseContext.getDeploymentUnit();
  XEnvironment env=depUnit.getAttachment(OSGiConstants.ENVIRONMENT_KEY);
  XResolver resolver=depUnit.getAttachment(OSGiConstants.RESOLVER_KEY);
  BundleManager bundleManager=depUnit.getAttachment(OSGiConstants.BUNDLE_MANAGER_KEY);
  XResolveContext context=resolver.createResolveContext(env,Collections.singleton(brev),null);
  try {
    LOGGER.debugf("Resolve: %s",depUnit.getName());
    resolver.resolveAndApply(context);
    depUnit.putAttachment(Attachments.BUNDLE_STATE_KEY,BundleState.RESOLVED);
    ServiceName bundleResolve=bundleManager.getServiceName(bundle,Bundle.RESOLVED);
    phaseContext.addDeploymentDependency(bundleResolve,AttachmentKey.create(Object.class));
    ServiceName moduleService=ServiceModuleLoader.moduleServiceName(brev.getModuleIdentifier());
    phaseContext.addDeploymentDependency(moduleService,Attachments.MODULE);
  }
 catch (  ResolutionException ex) {
    LOGGER.warnCannotResolve(ex.getUnresolvedRequirements());
  }
}
