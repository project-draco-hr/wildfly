{
  final FormDataParser parser=formParserFactory.createParser(exchange);
  FormData data=parser.parseBlocking();
  for (  String fieldName : data) {
    FormValue value=data.getFirst(fieldName);
    if (value.isFile()) {
      ModelNode response=null;
      InputStream in=new BufferedInputStream(new FileInputStream(value.getFile()));
      try {
        final ModelNode dmr=new ModelNode();
        dmr.get("operation").set("upload-deployment-stream");
        dmr.get("address").setEmptyList();
        dmr.get("input-stream-index").set(0);
        OperationBuilder operation=new OperationBuilder(dmr);
        operation.addInputStream(in);
        response=modelController.execute(dmr,OperationMessageHandler.logging,ModelController.OperationTransactionControl.COMMIT,operation.build());
        if (!response.get(OUTCOME).asString().equals(SUCCESS)) {
          Common.sendError(exchange,false,response);
          return;
        }
      }
 catch (      Throwable t) {
        ROOT_LOGGER.uploadError(t);
        Common.sendError(exchange,false,t.getLocalizedMessage());
        return;
      }
 finally {
        IoUtils.safeClose(in);
      }
      writeResponse(exchange,response,Common.TEXT_HTML);
      return;
    }
  }
  Common.sendError(exchange,false,"No file found");
}
