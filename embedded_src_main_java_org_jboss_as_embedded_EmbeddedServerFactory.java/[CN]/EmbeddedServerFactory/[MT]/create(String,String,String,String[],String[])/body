{
  if (jbossHomePath == null || jbossHomePath.isEmpty()) {
    throw MESSAGES.invalidJBossHome(jbossHomePath);
  }
  File jbossHomeDir=new File(jbossHomePath);
  if (!jbossHomeDir.isDirectory()) {
    throw MESSAGES.invalidJBossHome(jbossHomePath);
  }
  if (modulePath == null)   modulePath=jbossHomeDir.getAbsolutePath() + File.separator + "modules";
  if (bundlePath == null)   bundlePath=jbossHomeDir.getAbsolutePath() + File.separator + "bundles";
  return create(setupModuleLoader(modulePath,systemPackages),jbossHomeDir,bundlePath,cmdargs);
}
