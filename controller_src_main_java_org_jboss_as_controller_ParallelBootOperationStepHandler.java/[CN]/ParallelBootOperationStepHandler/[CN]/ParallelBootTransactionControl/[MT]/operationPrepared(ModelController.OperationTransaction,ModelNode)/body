{
  if (!signalled) {
    this.transaction=transaction;
    preparedLatch.countDown();
    signalled=true;
    try {
      committedLatch.await();
    }
 catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
      throw new RuntimeException("Interrupted awaiting transaction commit or rollback");
    }
  }
}
