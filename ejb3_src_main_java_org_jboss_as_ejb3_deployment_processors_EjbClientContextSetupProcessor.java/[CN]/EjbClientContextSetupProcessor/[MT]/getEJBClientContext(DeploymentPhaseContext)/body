{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final DeploymentUnit parentDeploymentUnit=deploymentUnit.getParent();
  final EJBClientContext ejbClientContext;
  if (parentDeploymentUnit != null) {
    ejbClientContext=parentDeploymentUnit.getAttachment(EjbDeploymentAttachmentKeys.EJB_CLIENT_CONTEXT);
  }
 else {
    ejbClientContext=deploymentUnit.getAttachment(EjbDeploymentAttachmentKeys.EJB_CLIENT_CONTEXT);
  }
  if (ejbClientContext != null) {
    return ejbClientContext;
  }
  logger.debug("Deployment unit " + deploymentUnit + " doesn't have any explicit EJB client context configured. "+ "Falling back on the default "+ DefaultEjbClientContextService.DEFAULT_SERVICE_NAME+ " EJB client context service");
  final ServiceRegistry serviceRegistry=phaseContext.getServiceRegistry();
  final ServiceController<EJBClientContext> ejbClientContextServiceController=(ServiceController<EJBClientContext>)serviceRegistry.getRequiredService(DefaultEjbClientContextService.DEFAULT_SERVICE_NAME);
  return ejbClientContextServiceController.getValue();
}
