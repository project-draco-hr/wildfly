{
  final DeploymentUnit deploymentUnit=phaseContext.getDeploymentUnit();
  final DeploymentUnit parentDeploymentUnit=deploymentUnit.getParent();
  final EJBClientContext ejbClientContext;
  ServiceName serviceName;
  if (parentDeploymentUnit != null) {
    ejbClientContext=parentDeploymentUnit.getAttachment(EjbDeploymentAttachmentKeys.EJB_CLIENT_CONTEXT);
    serviceName=DescriptorBasedEJBClientContextService.BASE_SERVICE_NAME.append(parentDeploymentUnit.getName());
  }
 else {
    ejbClientContext=deploymentUnit.getAttachment(EjbDeploymentAttachmentKeys.EJB_CLIENT_CONTEXT);
    serviceName=DescriptorBasedEJBClientContextService.BASE_SERVICE_NAME.append(deploymentUnit.getName());
  }
  if (ejbClientContext != null) {
    return serviceName;
  }
  return DefaultEjbClientContextService.DEFAULT_SERVICE_NAME;
}
