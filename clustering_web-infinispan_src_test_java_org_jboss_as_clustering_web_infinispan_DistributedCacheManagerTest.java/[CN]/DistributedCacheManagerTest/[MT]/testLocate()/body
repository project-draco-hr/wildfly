{
  EmbeddedCacheManager container=mock(EmbeddedCacheManager.class);
  DistributionManager distManager=mock(DistributionManager.class);
  Address localAddress=mock(Address.class);
  Address remoteAddress=mock(Address.class);
  Address remoteUnknownAddress=mock(Address.class);
  String localSessionId="ABC123";
  String localJvmRoute="local";
  String remoteSessionId="CBA321";
  String remoteJvmRoute="remote";
  String remoteUnknownSessionId="unknown";
  when(this.cache.getAdvancedCache()).thenReturn(this.cache);
  when(this.cache.getDistributionManager()).thenReturn(distManager);
  when(this.cache.getCacheManager()).thenReturn(container);
  when(container.getAddress()).thenReturn(localAddress);
  when(distManager.getPrimaryLocation(localSessionId)).thenReturn(localAddress);
  when(distManager.getPrimaryLocation(remoteSessionId)).thenReturn(remoteAddress);
  when(distManager.getPrimaryLocation(remoteUnknownSessionId)).thenReturn(remoteUnknownAddress);
  when(this.registry.getLocalEntry()).thenReturn(new AbstractMap.SimpleImmutableEntry<String,Void>(localJvmRoute,null));
  when(this.registry.getRemoteEntry(remoteAddress)).thenReturn(new AbstractMap.SimpleImmutableEntry<String,Void>(remoteJvmRoute,null));
  when(this.registry.getRemoteEntry(remoteUnknownAddress)).thenReturn(null);
  assertSame(localJvmRoute,this.manager.locate(localSessionId));
  assertSame(remoteJvmRoute,this.manager.locate(remoteSessionId));
  assertSame(localJvmRoute,this.manager.locate(remoteUnknownSessionId));
  when(this.cache.getDistributionManager()).thenReturn(null);
  assertSame(localJvmRoute,this.manager.locate(localSessionId));
  assertSame(localJvmRoute,this.manager.locate(remoteSessionId));
  assertSame(localJvmRoute,this.manager.locate(remoteUnknownSessionId));
}
