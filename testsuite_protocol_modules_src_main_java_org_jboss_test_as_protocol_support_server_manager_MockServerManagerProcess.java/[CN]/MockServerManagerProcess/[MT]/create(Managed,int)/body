{
  MockServerManagerEnvironment environment=new MockServerManagerEnvironment(false,pmPort);
  MockServerManagerProcess sm=new MockServerManagerProcess(managed,environment);
  sm.serverListener=TestDirectServerManagerCommunicationListener.create(sm,InetAddress.getLocalHost(),0,20,sm.messageHandler);
  if (pmPort > 0) {
    sm.pmSlave=ProcessManagerSlaveFactory.getInstance().getProcessManagerSlave(environment,sm.parseHost(),sm.messageHandler);
    new Thread(sm.pmSlave.getController(),"Test ServerManager PM Slave").start();
  }
  return sm;
}
