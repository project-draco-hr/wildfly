{
  byte[] bytes=this.bytes;
  if (bytes != null)   return bytes;
  if (this.object == null)   return null;
  int version=this.context.getCurrentVersion();
  ByteArrayOutputStream output=new ByteArrayOutputStream();
  SimpleDataOutput data=new SimpleDataOutput(Marshalling.createByteOutput(output));
  data.writeInt(version);
  Marshaller marshaller=this.context.createMarshaller(version);
  try {
    marshaller.start(data);
    ClassLoader currentLoader=null;
    ClassLoader contextLoader=context.getContextClassLoader(version);
    if (contextLoader != null) {
      currentLoader=getCurrentThreadContextClassLoader();
      setCurrentThreadContextClassLoader(contextLoader);
    }
    try {
      marshaller.writeObject(this.object);
    }
  finally {
      if (contextLoader != null) {
        setCurrentThreadContextClassLoader(currentLoader);
      }
    }
    marshaller.finish();
    return output.toByteArray();
  }
  finally {
    marshaller.close();
  }
}
