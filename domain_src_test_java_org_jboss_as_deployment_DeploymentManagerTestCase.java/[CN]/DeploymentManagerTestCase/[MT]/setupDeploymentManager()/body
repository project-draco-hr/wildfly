{
  serviceContainer=ServiceContainer.Factory.create();
  final ServiceName chainServiceName=ServiceName.JBOSS.append("deployment","chain");
  final ServiceName moduleLoaderServiceName=ServiceName.JBOSS.append("deployment","module","loader");
  deploymentManager=new DeploymentManagerImpl(serviceContainer){
    @Override protected DeploymentChain determineDeploymentChain(    final VirtualFile deploymentRoot){
      return deploymentChain;
    }
    @Override protected DeploymentModuleLoader determineDeploymentModuleLoader(    final VirtualFile deploymentRoot){
      return deploymentModuleLoader;
    }
  }
;
  final BatchBuilder batchBuilder=serviceContainer.batchBuilder();
  batchBuilder.addService(chainServiceName,new PassthroughService(deploymentChain));
  batchBuilder.addService(moduleLoaderServiceName,new PassthroughService(deploymentModuleLoader));
  batchBuilder.install();
}
