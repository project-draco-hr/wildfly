{
  try {
    if (this.tm.getTransaction().getStatus() != Status.STATUS_MARKED_ROLLBACK) {
      this.tm.commit();
    }
 else {
      log.debug("endBatch(): rolling back batch");
      this.tm.rollback();
    }
  }
 catch (  RollbackException e) {
    log.warn("endBatch(): rolling back transaction with exception",e);
  }
catch (  RuntimeException e) {
    throw e;
  }
catch (  Exception e) {
    throw new RuntimeException("endTransaction(): Caught Exception ending batch: ",e);
  }
}
