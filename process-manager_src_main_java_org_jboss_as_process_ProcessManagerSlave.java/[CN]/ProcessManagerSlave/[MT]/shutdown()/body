{
  if (controller.shutdown.getAndSet(true)) {
    return;
  }
  try {
    handler.shutdown();
  }
 catch (  Throwable t) {
    t.printStackTrace(System.err);
  }
 finally {
    if (socket != null) {
      closeSocket();
    }
    final Thread thread=new Thread(new Runnable(){
      public void run(){
        System.exit(0);
      }
    }
);
    thread.setName("Exit thread");
    thread.start();
  }
}
