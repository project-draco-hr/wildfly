{
  final EjbClientContextService clientContextService=new EjbClientContextService();
  final ServiceBuilder<EJBClientContext> clientBuilder=context.getServiceTarget().addService(EjbClientContextService.DEFAULT_SERVICE_NAME,clientContextService);
  if (!appclient) {
    final String nodeName=SecurityActions.getSystemProperty(ServerEnvironment.NODE_NAME);
    final LocalEjbReceiver byValueLocalEjbReceiver=new LocalEjbReceiver(nodeName,false);
    newControllers.add(context.getServiceTarget().addService(LocalEjbReceiver.BY_VALUE_SERVICE_NAME,byValueLocalEjbReceiver).addDependency(DeploymentRepository.SERVICE_NAME,DeploymentRepository.class,byValueLocalEjbReceiver.getDeploymentRepository()).install());
    final LocalEjbReceiver byReferenceLocalEjbReceiver=new LocalEjbReceiver(nodeName,true);
    newControllers.add(context.getServiceTarget().addService(LocalEjbReceiver.BY_REFERENCE_SERVICE_NAME,byReferenceLocalEjbReceiver).addDependency(DeploymentRepository.SERVICE_NAME,DeploymentRepository.class,byReferenceLocalEjbReceiver.getDeploymentRepository()).install());
    clientContextService.addReceiver(clientBuilder,LocalEjbReceiver.BY_VALUE_SERVICE_NAME);
  }
  newControllers.add(clientBuilder.install());
}
