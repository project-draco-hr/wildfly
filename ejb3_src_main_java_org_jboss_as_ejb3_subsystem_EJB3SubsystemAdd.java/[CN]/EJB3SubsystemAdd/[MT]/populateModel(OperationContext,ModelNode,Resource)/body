{
  ModelNode model=resource.getModel();
  for (  AttributeDefinition attr : EJB3SubsystemRootResourceDefinition.ATTRIBUTES) {
    attr.validateAndSet(operation,model);
  }
  if (context.getProcessType().isServer()) {
    context.addStep(new ValidateClusteredCacheRefHandler(),OperationContext.Stage.MODEL);
  }
  final ModelNode defaultSecurityDomainModelNode=DEFAULT_SECURITY_DOMAIN.resolveModelAttribute(context,model);
  final String defaultSecurityDomain=defaultSecurityDomainModelNode.isDefined() ? defaultSecurityDomainModelNode.asString() : null;
  if (defaultSecurityDomain != null) {
    if (model.hasDefined(EJB3SubsystemModel.SECURITY_DOMAINS)) {
      List<ModelNode> securityDomains=SECURITY_DOMAINS.resolveModelAttribute(context,model).asList();
      boolean defaultFound=false;
      for (      ModelNode current : securityDomains) {
        String securityDomainName=SECURITY_DOMAIN_NAME.resolveModelAttribute(context,current).asString();
        if (defaultSecurityDomain.equals(securityDomainName)) {
          defaultFound=true;
          break;
        }
      }
      if (!defaultFound) {
        throw EjbLogger.ROOT_LOGGER.defaultSecurityDomainNotReferenced(defaultSecurityDomain);
      }
    }
  }
}
